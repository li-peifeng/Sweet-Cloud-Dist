import{d as L,c as t,be as H,a0 as J,as as M,a1 as s,C as k,bq as P,T as G,bg as z,bh as K,bi as Q,bj as U,bk as W,bl as X,bm as Y,J as S,bn as Z,bo as p,bp as ee,S as $,F as te,br as re,e as ne,aP as v,b2 as f,q as ae,bV as x,m as ie,bI as de,a5 as ue,cI as ce,cm as ge,cn as le,aH as oe,H as I,E as se,n as O,R as me,b3 as y,cr as he}from"./index.edd92069.js";import{T as c}from"./item_type.be442da4.js";import{R as ve}from"./ResponsiveGrid.9522d7d4.js";const b=e=>{const d=L();return t(re,{w:"$full",display:"flex",flexDirection:"column",get required(){return e.required},get children(){return[t(H,{get for(){return e.name},display:"flex",alignItems:"center",get children(){var a;return d(((a=e.full_name_path)!=null?a:e.driver==="common")?`storages.common.${e.name}`:`drivers.${e.driver}.${e.name}`)}}),t(J,{get fallback(){return t(M,{get children(){return d("settings.unknown_type")}})},get children(){return[t(s,{get when(){return e.type===c.String},get children(){return t(k,{get id(){return e.name},get type(){return e.name=="password"?"password":"text"},get readOnly(){return e.readonly},get value(){return e.value},get onInput(){return e.type===c.String?a=>{var i;return(i=e.onChange)==null?void 0:i.call(e,a.currentTarget.value)}:void 0}})}}),t(s,{get when(){return e.type===c.Number},get children(){return t(k,{type:"number",get id(){return e.name},get readOnly(){return e.readonly},get value(){return e.value},get onInput(){return e.type===c.Number?a=>{var i;return(i=e.onChange)==null?void 0:i.call(e,parseInt(a.currentTarget.value))}:void 0}})}}),t(s,{get when(){return e.type===c.Bool},get children(){return t(P,{get id(){return e.name},get readOnly(){return e.readonly},get defaultChecked(){return e.value},get onChange(){return e.type===c.Bool?a=>{var i;return(i=e.onChange)==null?void 0:i.call(e,a.currentTarget.checked)}:void 0}})}}),t(s,{get when(){return e.type===c.Text},get children(){return t(G,{get id(){return e.name},get readOnly(){return e.readonly},get value(){return e.value},get onChange(){return e.type===c.Text?a=>{var i;return(i=e.onChange)==null?void 0:i.call(e,a.currentTarget.value)}:void 0}})}}),t(s,{get when(){return e.type===c.Select},get children(){return t(z,{get id(){return e.name},get readOnly(){return e.readonly},get defaultValue(){return e.value},get onChange(){return e.type===c.Select?a=>{var i;return(i=e.onChange)==null?void 0:i.call(e,a)}:void 0},get children(){return[t(K,{get children(){return[t(Q,{get children(){return d("global.choose")}}),t(U,{}),t(W,{})]}}),t(X,{get children(){return t(Y,{get children(){return t(S,{get each(){var a;return(a=e.options)==null?void 0:a.split(",")},children:a=>t(Z,{value:a,get children(){return[t(p,{get children(){var i;return d(((i=e.options_prefix)!=null?i:e.driver==="common"?`storages.common.${e.name}s`:`drivers.${e.driver}.${e.name}s`)+`.${a}`)}}),t(ee,{})]}})})}})}})]}})}})]}}),t($,{get when(){return e.help},get children(){return t(te,{get children(){return d(e.driver==="common"?`storages.common.${e.name}-tips`:`drivers.${e.driver}.${e.name}-tips`)}})}})]}})};function _(e,d){switch(e){case c.Bool:return d?d==="true":!1;case c.Number:return d?parseInt(d):0;default:return d||""}}const $e=()=>{const e=L(),{params:d,back:a,to:i}=ne(),{id:g}=d,[R,F]=v(()=>f.get("/admin/driver/list"),!0),[l,w]=ae({}),q=async()=>{const r=await F();y(r,w)},[A,B]=v(()=>f.get(`/admin/storage/get?id=${g}`),!0),[N,V]=v(()=>f.get(`/admin/driver/info?driver=${u.driver}`),!0);g?(async()=>{const r=await B();y(r,async n=>{o(n),m(JSON.parse(n.addition));const h=await V();y(h,E=>w({[u.driver]:E}))})})():q();const[u,o]=x({}),[C,m]=x({}),[j,D]=v(()=>(o("addition",JSON.stringify(C)),f.post(`/admin/storage/${g?"update":"create"}`,u))),T=ie(()=>{var n;const r=(n=l()[u.driver])==null?void 0:n.config.alert;if(console.log(r),r)return r.split("|")[0]});return t(he,{get loading(){return g?A()||N():R()},get children(){return[t(de,{mb:"$2",get children(){return e(`global.${g?"edit":"add"}`)}}),t(ue,{mb:"$2",spacing:"$2",get children(){return[t(b,{name:"driver",default:"",readonly:g!==void 0,required:!0,get type(){return c.Select},get options(){return g?u.driver:Object.keys(l()).join(",")},get value(){return u.driver},full_name_path:"storages.common.driver",options_prefix:"drivers.drivers",driver:"drivers",onChange:r=>{for(const n of l()[r].common)o(n.name,_(n.type,n.default));m(ce(n=>{for(const h in n)delete n[h]}));for(const n of l()[r].additional)m(n.name,_(n.type,n.default));o("driver",r)}}),t($,{get when(){return T()},get children(){return t(ge,{get status(){return T()},w:"$full",get children(){return[t(le,{}),oe(()=>e(`drivers.config.${u.driver}.alert`))]}})}})]}}),t(ve,{get children(){return t($,{get when(){return l()[u.driver]},get children(){return[t(S,{get each(){return l()[u.driver].common},children:r=>t(b,I(r,{driver:"common",get value(){return u[r.name]},onChange:n=>{o(r.name,n)}}))}),t(S,{get each(){return l()[u.driver].additional},children:r=>t(b,I(r,{get driver(){return u.driver},get value(){return C[r.name]},onChange:n=>{m(r.name,n)}}))})]}})}}),t(se,{mt:"$2",get loading(){return j()},onClick:async()=>{l()[u.driver].config.need_ms&&(O.info(e("manage.add_storage-tips")),window.open(me("/@amore/messenger"),"_blank"));const r=await D();y(r,()=>{O.success(e("global.save_success")),a()},(n,h)=>{r.data.id&&i(`/@amore/storages/edit/${r.data.id}`)})},get children(){return e(`global.${g?"save":"add"}`)}})]}})};export{$e as default};
