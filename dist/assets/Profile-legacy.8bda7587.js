System.register(["./index-legacy.479435ca.js","./useTitle-legacy.43c4fcd1.js","./LinkWithBase-legacy.32d9c645.js","./webauthn-json.browser-ponyfill-legacy.8ddd819a.js"],(function(e,r){"use strict";var n,t,s,i,a,c,o,u,l,d,g,h,p,w,_,m,f,b,$,y,v,k,C,x,I,S,j,B,L,P,T,E,R,U,D,F,N,O,z,G;return{setters:[e=>{n=e.d,t=e.aP,s=e.b2,i=e.j,a=e.c,c=e.cM,o=e.Z,u=e.bG,l=e.B,d=e.b3,g=e.n,h=e.S,p=e.e,w=e.an,_=e.cN,m=e.o,f=e.am,b=e.aB,$=e.cO,y=e.cP,v=e.cQ,k=e.cR,C=e.al,x=e.a_,I=e.cS,S=e.br,j=e.be,B=e.t,L=e.F,P=e.x,T=e.a2,E=e.z,R=e.ay,U=e.c5,D=e.bx},e=>{F=e.g},e=>{N=e.L},e=>{O=e.s,z=e.c,G=e.b}],execute:function(){const r=e=>{const r=n(),[p,w]=t((()=>s.post("/authn/delete_authn",{id:e.id}))),[_,m]=i(!1);return a(h,{get when(){return!_()},get children(){return a(c,{w:"$full",overflowX:"auto",shadow:"$md",rounded:"$lg",p:"$2",direction:{"@initial":"column","@xl":"row"},spacing:"$2",get children(){return[a(o,{w:"$full",alignItems:"start",spacing:"$1",get children(){return a(u,{color:"$info9",css:{wordBreak:"break-all"},get children(){return"Fingerprint: "+e.fingerprint+"\tID: "+e.id}})}}),a(c,{direction:{"@initial":"row","@xl":"column"},justifyContent:{"@xl":"center"},spacing:"$1",get children(){return a(l,{colorScheme:"danger",get loading(){return p()},onClick:async()=>{const e=await w();d(e,(()=>{g.success(r("global.delete_success")),m(!0)}))},get children(){return r("global.delete")}})}})]}})}})},J=e=>a(U,{get colorScheme(){return e.can?"success":"danger"},get children(){return e.children}});e("default",(()=>{const e=n();F("manage.sidemenu.profile");const{searchParams:c,to:U}=p(),[M,Q]=i(w().username),[W,X]=i(""),[Z,q]=i(""),A=b("sso_compatibility_mode"),[H,K]=t((e=>s.post("/me/update",{username:e?w().username:M(),password:e?"":W(),sso_id:w().sso_id}))),[V,Y]=t((()=>s.get("/authn/getcredentials"))),[,ee]=t((()=>s.get("/authn/webauthn_begin_registration"))),[re,ne]=t(((e,r)=>s.post("/authn/webauthn_finish_registration",JSON.stringify(r),{headers:{session:e}}))),te=async r=>{if(W()&&W()!==Z())return void g.warning(e("users.confirm_password_not_same"));const n=await K(r);d(n,(()=>{_({...w(),username:M()}),r?U(""):(g.success(e("users.update_profile_success")),U(`/@tiamo?redirect=${encodeURIComponent(location.pathname)}`))}))},se=c.sso_id;function ie(e){const r=e.data;r.sso_id&&(_({...w(),sso_id:r.sso_id}),te(!0))}se&&(_({...w(),sso_id:se}),te(!0)),window.addEventListener("message",ie),m((()=>{window.removeEventListener("message",ie)}));const[ae,ce]=i([]);return O()&&!f.is_guest(w())&&b("webauthn_login_enabled")&&(async()=>{const e=await Y();D(e,ce)})(),a(o,{w:"$full",spacing:"$4",alignItems:"start",get children(){return[a(h,{get when(){return!f.is_guest(w())},get fallback(){return[a($,{status:"warning",flexDirection:{"@initial":"column","@lg":"row"},get children(){return[a(y,{mr:"$2_5"}),a(v,{mr:"$2_5",get children(){return e("users.guest-tips")}}),a(k,{get children(){return e("users.modify_nothing")}})]}}),a(C,{spacing:"$2",get children(){return[a(x,{get children(){return e("global.have_account")}}),a(x,{color:"$info9",as:N,get href(){return`/@tiamo?redirect=${encodeURIComponent(location.pathname)}`},get children(){return e("global.go_login")}})]}})]},get children(){return[a(u,{get children(){return e("users.update_profile")}}),a(I,{gap:"$2",columns:{"@initial":1,"@md":2},get children(){return a(S,{get children(){return[a(j,{for:"username",get children(){return e("users.change_username")}}),a(B,{id:"username",get value(){return M()},onInput:e=>{Q(e.currentTarget.value)}})]}})}}),a(I,{gap:"$2",columns:{"@initial":1,"@md":2},get children(){return[a(S,{get children(){return[a(j,{for:"password",get children(){return e("users.change_password")}}),a(B,{id:"password",type:"password",placeholder:"********",get value(){return W()},onInput:e=>{X(e.currentTarget.value)}}),a(L,{get children(){return e("users.change_password-tips")}})]}}),a(S,{get children(){return[a(j,{for:"confirm-password",get children(){return e("users.confirm_password")}}),a(B,{id:"confirm-password",type:"password",placeholder:"********",get value(){return Z()},onInput:e=>{q(e.currentTarget.value)}}),a(L,{get children(){return e("users.confirm_password-tips")}})]}})]}}),a(C,{spacing:"$2",get children(){return[a(l,{get loading(){return H()},onClick:[te,!1],get children(){return e("global.save")}}),a(h,{get when(){return!w().otp},get children(){return a(l,{colorScheme:"accent",onClick:()=>{U("/@amore/2fa")},get children(){return e("users.enable_2fa")}})}})]}})]}}),a(h,{get when(){return P((()=>!!b("sso_login_enabled")))()&&!f.is_guest(w())},get children(){return[a(u,{get children(){return e("users.sso_login")}}),a(C,{spacing:"$2",get children(){return a(h,{get when(){return w().sso_id},get fallback(){return a(l,{onClick:()=>{const e=s.getUri()+"/auth/sso?method=get_sso_id";A?window.location.href=e:window.open(e,"authPopup","width=500,height=600")},get children(){return e("users.connect_sso")}})},get children(){return a(l,{colorScheme:"danger",get loading(){return H()},onClick:()=>{_({...w(),sso_id:""}),te(!0)},get children(){return e("users.disconnect_sso")}})}})}})]}}),a(h,{get when(){return P((()=>!f.is_guest(w())))()&&b("webauthn_login_enabled")},get children(){return[a(u,{get children(){return e("users.webauthn")}}),a(C,{wrap:"wrap",gap:"$2",mt:"$2",get children(){return a(T,{get loading(){return V()},get children(){return a(E,{get each(){return ae()},children:e=>a(r,{get id(){return e.id},get fingerprint(){return e.fingerprint}})})}})}}),a(l,{get loading(){return re()},onClick:async()=>{if(!O())return void g.error(e("users.webauthn_not_supported"));const r=await ee();d(r,(async r=>{const n=z(r.options),t=r.session;try{const r=await G(n);d(await ne(t,r),(()=>{g.success(e("users.add_webauthn_success"))}))}catch(s){s instanceof Error&&g.error(s.message)}}))},get children(){return e("users.add_webauthn")}})]}}),a(C,{wrap:"wrap",gap:"$2",mt:"$2",get children(){return a(E,{each:R,children:(r,n)=>a(J,{get can(){return f.can(w(),n())},get children(){return e(`users.permissions.${r}`)}})})}})]}})}))}}}));
