import{bJ as ee,D as F,bK as M,bL as v,ac as N,W as E,e,a4 as k,ax as O,R as P,b as D,bF as m,bM as x,d as te,av as U,aZ as _,bE as ne,bN as oe,bO as re,bP as se,a as ae,j as ie,k as f,bQ as le,aK as I,a3 as ce,bD as G,an as ue,bC as ge,S as $,I as R,bR as de,aV as pe,a8 as he,B as z,ar as fe,bu as B,n as C,a_ as me}from"./index.3116ab02.js";import{r as we,b as be,s as $e}from"./index.7cb765a4.js";import{s as Ce,g as _e,a as ve}from"./webauthn-json.browser-ponyfill.1c672167.js";const xe="https://github.com/alist-org/alist";function Se(s){return ee(`${s}-${xe}`)}const ye=N('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="896" width="967.8852157128662"><defs><path id="path-2" opacity="1" fill-rule="evenodd" d="M896,448 C1142.6325445712241,465.5747656464056 695.2579309733121,896 448,896 C200.74206902668806,896 5.684341886080802e-14,695.2579309733121 0,448.0000000000001 C0,200.74206902668806 200.74206902668791,5.684341886080802e-14 447.99999999999994,0 C695.2579309733121,0 475,418 896,448Z"></path><linearGradient id="linearGradient-3" x1="0.5" y1="0" x2="0.5" y2="1"><stop offset="0" stop-opacity="1"></stop><stop offset="1" stop-opacity="1"></stop></linearGradient></defs><g opacity="1"><use xlink:href="#path-2" fill="url(#linearGradient-3)" fill-opacity="1"></use></g></svg>'),ke=s=>{const u=F({startColor:"#28aff0",endColor:"#120fc4"},s);return(()=>{const n=ye.cloneNode(!0),c=n.firstChild,g=c.firstChild,r=g.nextSibling,a=r.firstChild,i=a.nextSibling;return M(t=>{const l=u.startColor,d=u.endColor;return l!==t._v$&&v(a,"stop-color",t._v$=l),d!==t._v$2&&v(i,"stop-color",t._v$2=d),t},{_v$:void 0,_v$2:void 0}),n})()},Ie=N('<svg height="1337" width="1337"><defs><path id="path-1" opacity="1" fill-rule="evenodd" d="M1337,668.5 C1337,1037.455193874239 1037.455193874239,1337 668.5,1337 C523.6725684305388,1337 337,1236 370.50000000000006,1094 C434.03835568300906,824.6732385973953 6.906089672974592e-14,892.6277623047779 0,668.5000000000001 C0,299.5448061257611 299.5448061257609,1.1368683772161603e-13 668.4999999999999,0 C1037.455193874239,0 1337,299.544806125761 1337,668.5Z"></path><linearGradient id="linearGradient-2" x1="0.79" y1="0.62" x2="0.21" y2="0.86"><stop offset="0" stop-opacity="1"></stop><stop offset="1" stop-opacity="1"></stop></linearGradient></defs><g opacity="1"><use xlink:href="#path-1" fill="url(#linearGradient-2)" fill-opacity="1"></use></g></svg>'),Ge=s=>{const u=F({startColor:"#28aff0",endColor:"#120fc4"},s);return(()=>{const n=Ie.cloneNode(!0),c=n.firstChild,g=c.firstChild,r=g.nextSibling,a=r.firstChild,i=a.nextSibling;return M(t=>{const l=u.startColor,d=u.endColor;return l!==t._v$&&v(a,"stop-color",t._v$=l),d!==t._v$2&&v(i,"stop-color",t._v$2=d),t},{_v$:void 0,_v$2:void 0}),n})()},Re=()=>{const s=E("#a9c6ff","#062b74");return e(k,{get bgColor(){return s()},pos:"fixed",top:"0",left:"0",overflow:"hidden",zIndex:"-1",w:"100vw",h:"100vh",get children(){return[e(k,{pos:"absolute",right:{"@initial":"-100px","@sm":"-300px"},top:{"@initial":"-1170px","@sm":"-900px"},get children(){return e(Ge,{})}}),e(k,{pos:"absolute",left:{"@initial":"-100px","@sm":"-200px"},bottom:{"@initial":"-760px","@sm":"-400px"},get children(){return e(ke,{})}})]}})},Ee=()=>{const s=O("sso_login_enabled"),u=P("sso_login_platform"),n=O("sso_compatibility_mode"),{searchParams:c,to:g}=D(),r=c.token;r!=null&&r!=""&&(m(r),g(decodeURIComponent(c.redirect||x||"/"),!0));function a(i){const t=i.data;t.token&&(m(t.token),g(decodeURIComponent(c.redirect||x||"/"),!0))}if(window.addEventListener("message",a),te(()=>{window.removeEventListener("message",a)}),s){const i=()=>{const l=_.getUri()+"/auth/sso?method=sso_get_token";if(n){window.location.href=l;return}window.open(l,"authPopup","width=500,height=600")};let t;switch(u){case"Github":t=se;break;case"Microsoft":t=we;break;case"Google":t=re;break;case"Dingtalk":t=oe;break;default:t=ne}return e(U,{cursor:"pointer",boxSize:"$8",as:t,p:"$0_5",onclick:i})}},Te=()=>{const s=P("logo").split(`
`),u=E(s[0],s.pop()),n=ae(),c=ie(()=>`${P("site_title")}`);be(c);const g=E("white","$neutral1"),[r,a]=f(localStorage.getItem("username")||""),[i,t]=f(localStorage.getItem("password")||""),[l,d]=f(""),[w,A]=f(!1),[b,j]=le("remember-pwd","false"),[K,J]=I(async()=>_.post("/auth/login/hash",{username:r(),password:Se(i()),otp_code:l()})),[,V]=I((o,p,h)=>_.post("/authn/webauthn_finish_login?username="+h,JSON.stringify(p),{headers:{session:o}})),[,Z]=I(o=>_.get("/authn/webauthn_begin_login?username="+o)),{searchParams:L,to:T}=D(),H=O("webauthn_login_enabled"),W=async()=>{A(!w())},S=async()=>{if(w()){if(!Ce()){C.error(n("users.webauthn_not_supported"));return}m(),b()==="true"?localStorage.setItem("username",r()):localStorage.removeItem("username");const o=await Z(r());me(o,async p=>{const h=_e(p.options),Q=await ve(h),X=await V(p.session,Q,r());B(X,Y=>{C.success(n("login.success")),m(Y.token),T(decodeURIComponent(L.redirect||x||"/"),!0)})})}else{b()==="true"?(localStorage.setItem("username",r()),localStorage.setItem("password",i())):(localStorage.removeItem("username"),localStorage.removeItem("password"));const o=await J();B(o,p=>{C.success(n("login.success")),m(p.token),T(decodeURIComponent(L.redirect||x||"/"),!0)},(p,h)=>{!y()&&h===402?q(!0):C.error(p)})}},[y,q]=f(!1);return e(fe,{zIndex:"1",w:"$full",h:"100vh",get children(){return[e(ce,{get bgColor(){return g()},rounded:"$xl",p:"24px",w:{"@initial":"90%","@sm":"364px"},spacing:"$4",get children(){return[e(G,{alignItems:"center",justifyContent:"space-around",get children(){return[e(ue,{mr:"$2",boxSize:"$12",get src(){return u()}}),e(ge,{color:"$info9",fontSize:"$2xl",get children(){return c()}})]}}),e($,{get when(){return!y()},get fallback(){return e(R,{id:"totp",name:"otp",get placeholder(){return n("login.otp-tips")},get value(){return l()},onInput:o=>d(o.currentTarget.value),onKeyDown:o=>{o.key==="Enter"&&S()}})},get children(){return[e(R,{name:"username",get placeholder(){return n("login.username-tips")},get value(){return r()},onInput:o=>a(o.currentTarget.value)}),e($,{get when(){return!w()},get children(){return e(R,{name:"password",get placeholder(){return n("login.password-tips")},type:"password",get value(){return i()},onInput:o=>t(o.currentTarget.value),onKeyDown:o=>{o.key==="Enter"&&S()}})}}),e(G,{px:"$1",w:"$full",fontSize:"$sm",color:"$neutral10",justifyContent:"space-between",alignItems:"center",get children(){return[e(de,{get checked(){return b()==="true"},onChange:()=>j(b()==="true"?"false":"true"),get children(){return n("login.remember")}}),e(pe,{get children(){return n("\u672A\u6388\u6743\u4E0D\u5F97\u8FDB\u5165!")}})]}})]}}),e(he,{w:"$full",spacing:"$2",get children(){return[e($,{get when(){return!w()},get children(){return e(z,{colorScheme:"primary",w:"$full",onClick:()=>{y()?d(""):(a(""),t(""))},get children(){return n("login.clear")}})}}),e(z,{w:"$full",get loading(){return K()},onClick:S,get children(){return n("login.login")}})]}}),e(G,{mt:"$2",justifyContent:"space-evenly",alignItems:"center",color:"$neutral10",w:"$full",get children(){return[e(Ee,{}),e($,{when:H,get children(){return e(U,{cursor:"pointer",boxSize:"$8",as:$e,p:"$0_5",onclick:W})}})]}})]}}),e(Re,{})]}})};export{Te as default};
