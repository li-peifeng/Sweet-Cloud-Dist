import{cX as jt,c5 as kt,b as te,c9 as ee,a0 as wt,a as re,e as Lt,aH as ie,a8 as ne,b5 as ae,bq as se,bJ as oe,E as le,ay as ue,a9 as de,cd as fe,an as ce,a3 as he}from"./index.db1e60aa.js";import{c as Ft}from"./_commonjs-dynamic-modules.30ae7933.js";import{O as ve}from"./icon.72d5d85a.js";var Ht={exports:{}};/*!
 * artplayer.js v5.0.9
 * Github: https://github.com/zhw2590582/ArtPlayer
 * (c) 2017-2023 Harvey Zack
 * Released under the MIT License.
 */(function(et,lt){(function(R,M,s,t,e){var p=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof kt<"u"?kt:{},I=typeof p[t]=="function"&&p[t],b=I.cache||{},A=typeof Ft=="function"&&Ft.bind(et);function c(v,m){if(!b[v]){if(!R[v]){var T=typeof p[t]=="function"&&p[t];if(!m&&T)return T(v,!0);if(I)return I(v,!0);if(A&&typeof v=="string")return A(v);var f=new Error("Cannot find module '"+v+"'");throw f.code="MODULE_NOT_FOUND",f}r.resolve=function(d){var u=R[v][1][d];return u!=null?u:d},r.cache={};var n=b[v]=new c.Module(v);R[v][0].call(n.exports,r,n,n.exports,this)}return b[v].exports;function r(d){var u=r.resolve(d);return u===!1?{}:c(u)}}c.isParcelRequire=!0,c.Module=function(v){this.id=v,this.bundle=c,this.exports={}},c.modules=R,c.cache=b,c.parent=I,c.register=function(v,m){R[v]=[function(T,f){f.exports=m},{}]},Object.defineProperty(c,"root",{get:function(){return p[t]}}),p[t]=c;for(var o=0;o<M.length;o++)c(M[o]);if(s){var h=c(s);et.exports=h}})({"5lTcX":[function(R,M,s){var t=R("@parcel/transformer-js/src/esmodule-helpers.js");t.defineInteropFlag(s);var e=R("bundle-text:./style/index.less"),p=t.interopDefault(e),I=R("option-validator"),b=t.interopDefault(I),A=R("./utils/emitter"),c=t.interopDefault(A),o=R("./utils"),h=R("./scheme"),v=t.interopDefault(h),m=R("./config"),T=t.interopDefault(m),f=R("./template"),n=t.interopDefault(f),r=R("./i18n"),d=t.interopDefault(r),u=R("./player"),y=t.interopDefault(u),l=R("./control"),a=t.interopDefault(l),i=R("./contextmenu"),D=t.interopDefault(i),E=R("./info"),S=t.interopDefault(E),L=R("./subtitle"),x=t.interopDefault(L),g=R("./events"),O=t.interopDefault(g),P=R("./hotkey"),C=t.interopDefault(P),w=R("./layer"),F=t.interopDefault(w),k=R("./loading"),_=t.interopDefault(k),B=R("./notice"),N=t.interopDefault(B),U=R("./mask"),j=t.interopDefault(U),W=R("./icons"),H=t.interopDefault(W),G=R("./setting"),K=t.interopDefault(G),X=R("./storage"),Z=t.interopDefault(X),z=R("./plugins"),V=t.interopDefault(z);let Y=0;const Q=[];class $ extends c.default{constructor(tt,rt){super(),this.id=++Y;const nt=o.mergeDeep($.option,tt);if(nt.container=tt.container,this.option=(0,b.default)(nt,v.default),this.isLock=!1,this.isReady=!1,this.isFocus=!1,this.isInput=!1,this.isRotate=!1,this.isDestroy=!1,this.template=new n.default(this),this.events=new O.default(this),this.storage=new Z.default(this),this.icons=new H.default(this),this.i18n=new d.default(this),this.notice=new N.default(this),this.player=new y.default(this),this.layers=new F.default(this),this.controls=new a.default(this),this.contextmenu=new D.default(this),this.subtitle=new x.default(this),this.info=new S.default(this),this.loading=new _.default(this),this.hotkey=new C.default(this),this.mask=new j.default(this),this.setting=new K.default(this),this.plugins=new V.default(this),typeof rt=="function"&&this.on("ready",()=>rt.call(this,this)),$.DEBUG){const it=at=>console.log(`[ART.${this.id}] -> ${at}`);it("Version@"+$.version),it("Env@"+$.env),it("Build@"+$.build);for(let at=0;at<T.default.events.length;at++)this.on("video:"+T.default.events[at],ut=>it("Event@"+ut.type))}Q.push(this)}static get instances(){return Q}static get version(){return"5.0.9"}static get env(){return"production"}static get build(){return"2023-05-14 11:10:25"}static get config(){return T.default}static get utils(){return o}static get scheme(){return v.default}static get Emitter(){return c.default}static get validator(){return b.default}static get kindOf(){return b.default.kindOf}static get html(){return n.default.html}static get option(){return{id:"",container:"#artplayer",url:"",poster:"",type:"",theme:"#f00",volume:.7,isLive:!1,muted:!1,autoplay:!1,autoSize:!1,autoMini:!1,loop:!1,flip:!1,playbackRate:!1,aspectRatio:!1,screenshot:!1,setting:!1,hotkey:!0,pip:!1,mutex:!0,backdrop:!0,fullscreen:!1,fullscreenWeb:!1,subtitleOffset:!1,miniProgressBar:!1,useSSR:!1,playsInline:!0,lock:!1,fastForward:!1,autoPlayback:!1,autoOrientation:!1,airplay:!1,layers:[],contextmenu:[],controls:[],settings:[],quality:[],highlight:[],plugins:[],thumbnails:{url:"",number:60,column:10,width:0,height:0},subtitle:{url:"",type:"",style:{},escape:!0,encoding:"utf-8",onVttLoad:tt=>tt},moreVideoAttr:{controls:!1,preload:o.isSafari?"auto":"metadata"},i18n:{},icons:{},cssVar:{},customType:{},lang:navigator.language.toLowerCase()}}get proxy(){return this.events.proxy}get query(){return this.template.query}get video(){return this.template.$video}destroy(tt=!0){this.events.destroy(),this.template.destroy(tt),Q.splice(Q.indexOf(this),1),this.isDestroy=!0,this.emit("destroy")}}if(s.default=$,$.DEBUG=!1,$.CONTEXTMENU=!0,$.NOTICE_TIME=2e3,$.SETTING_WIDTH=250,$.SETTING_ITEM_WIDTH=200,$.SETTING_ITEM_HEIGHT=35,$.RESIZE_TIME=200,$.SCROLL_TIME=200,$.SCROLL_GAP=50,$.AUTO_PLAYBACK_MAX=10,$.AUTO_PLAYBACK_MIN=5,$.AUTO_PLAYBACK_TIMEOUT=3e3,$.RECONNECT_TIME_MAX=5,$.RECONNECT_SLEEP_TIME=1e3,$.CONTROL_HIDE_TIME=3e3,$.DBCLICK_TIME=300,$.DBCLICK_FULLSCREEN=!0,$.MOBILE_DBCLICK_PLAY=!0,$.MOBILE_CLICK_PLAY=!1,$.AUTO_ORIENTATION_TIME=200,$.INFO_LOOP_TIME=1e3,$.FAST_FORWARD_VALUE=3,$.FAST_FORWARD_TIME=1e3,$.TOUCH_MOVE_RATIO=.5,$.VOLUME_STEP=.1,$.SEEK_STEP=5,$.PLAYBACK_RATE=[.5,.75,1,1.25,1.5,2],$.ASPECT_RATIO=["default","4:3","16:9"],$.FLIP=["normal","horizontal","vertical"],$.FULLSCREEN_WEB_IN_BODY=!1,typeof document<"u"&&!document.getElementById("artplayer-style")){const J=o.createElement("style");J.id="artplayer-style",J.textContent=p.default,document.head.appendChild(J)}typeof window<"u"&&(window.Artplayer=$),console.log(`%c ArtPlayer %c ${$.version} %c https://artplayer.org`,"color: #fff; background: #5f5f5f","color: #fff; background: #4bc729","")},{"bundle-text:./style/index.less":"0016T","option-validator":"bAWi2","./utils/emitter":"66mFZ","./utils":"71aH7","./scheme":"AKEiO","./config":"lyjeQ","./template":"X13Zf","./i18n":"3jKkj","./player":"a90nx","./control":"8Z0Uf","./contextmenu":"2KYsr","./info":"02ajl","./subtitle":"eSWto","./events":"jo4S1","./hotkey":"6NoFy","./layer":"6G6hZ","./loading":"3dsEe","./notice":"dWGTw","./mask":"5POkG","./icons":"6OeNg","./setting":"3eYNH","./storage":"2aaJe","./plugins":"8MTUM","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"0016T":[function(R,M,s){M.exports='.art-video-player{--art-theme:red;--art-font-color:#fff;--art-background-color:#000;--art-text-shadow-color:#00000080;--art-transition-duration:.2s;--art-padding:10px;--art-border-radius:3px;--art-progress-height:6px;--art-progress-color:#fff3;--art-hover-color:#ffffff80;--art-loaded-color:#fff3;--art-loop-color:#ffffffbf;--art-state-size:80px;--art-state-opacity:.8;--art-bottom-height:100px;--art-bottom-offset:20px;--art-bottom-gap:5px;--art-highlight-width:8px;--art-highlight-color:#ffffff80;--art-loop-width:2px;--art-control-height:46px;--art-control-opacity:.75;--art-control-icon-size:36px;--art-control-icon-scale:1.1;--art-volume-height:120px;--art-volume-handle-size:14px;--art-lock-size:36px;--art-indicator-scale:0;--art-indicator-size:16px;--art-fullscreen-web-index:9999;--art-settings-icon-size:24px;--art-settings-max-height:300px;--art-selector-max-height:300px;--art-contextmenus-min-width:250px;--art-subtitle-font-size:20px;--art-subtitle-gap:5px;--art-subtitle-bottom:15px;--art-subtitle-border:#000;--art-widget-background:#000000d9;--art-tip-background:#00000080;--art-scrollbar-size:4px;--art-scrollbar-background:#ffffff40;--art-scrollbar-background-hover:#ffffff80;--art-mini-progress-height:2px}.art-bg-cover{background-position:50%;background-repeat:no-repeat;background-size:cover}.art-bottom-gradient{background-image:linear-gradient(#0000,#0006,#000);background-position:bottom;background-repeat:repeat-x}.art-backdrop-filter{-webkit-backdrop-filter:saturate(180%)blur(20px);backdrop-filter:saturate(180%)blur(20px);background-color:#000000bf!important}.art-truncate{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.art-video-player{width:100%;height:100%;zoom:1;text-align:left;direction:ltr;user-select:none;box-sizing:border-box;color:var(--art-font-color);background-color:var(--art-background-color);text-shadow:0 0 2px var(--art-text-shadow-color);-webkit-tap-highlight-color:#0000;-ms-touch-action:manipulation;touch-action:manipulation;-ms-high-contrast-adjust:none;outline:0;margin:0 auto;padding:0;font-family:PingFang SC,Helvetica Neue,Microsoft YaHei,Roboto,Arial,sans-serif;font-size:14px;line-height:1.3;position:relative}.art-video-player *,.art-video-player :before,.art-video-player :after{box-sizing:border-box;margin:0;padding:0}.art-video-player ::-webkit-scrollbar{width:var(--art-scrollbar-size);height:var(--art-scrollbar-size)}.art-video-player ::-webkit-scrollbar-thumb{background-color:var(--art-scrollbar-background)}.art-video-player ::-webkit-scrollbar-thumb:hover{background-color:var(--art-scrollbar-background-hover)}.art-video-player img{max-width:100%;vertical-align:top}.art-video-player svg{fill:var(--art-font-color)}.art-video-player a{color:var(--art-font-color);text-decoration:none}.art-icon{justify-content:center;align-items:center;line-height:1;display:flex}.art-video-player.art-backdrop .art-contextmenus,.art-video-player.art-backdrop .art-info,.art-video-player.art-backdrop .art-settings,.art-video-player.art-backdrop .art-layer-auto-playback,.art-video-player.art-backdrop .art-selector-list,.art-video-player.art-backdrop .art-volume-inner{-webkit-backdrop-filter:saturate(180%)blur(20px);backdrop-filter:saturate(180%)blur(20px);background-color:#000000bf!important}.art-video{z-index:10;width:100%;height:100%;cursor:pointer;position:absolute;inset:0}.art-poster{z-index:11;width:100%;height:100%;pointer-events:none;background-position:50%;background-repeat:no-repeat;background-size:cover;position:absolute;inset:0}.art-video-player .art-subtitle{z-index:20;width:100%;text-align:center;pointer-events:none;justify-content:center;align-items:center;gap:var(--art-subtitle-gap);bottom:var(--art-subtitle-bottom);font-size:var(--art-subtitle-font-size);transition:bottom var(--art-transition-duration)ease;text-shadow:var(--art-subtitle-border)1px 0 1px,var(--art-subtitle-border)0 1px 1px,var(--art-subtitle-border)-1px 0 1px,var(--art-subtitle-border)0 -1px 1px,var(--art-subtitle-border)1px 1px 1px,var(--art-subtitle-border)-1px -1px 1px,var(--art-subtitle-border)1px -1px 1px,var(--art-subtitle-border)-1px 1px 1px;flex-direction:column;padding:0 5%;display:none;position:absolute}.art-video-player.art-subtitle-show .art-subtitle{display:flex}.art-video-player.art-control-show .art-subtitle{bottom:calc(var(--art-control-height) + var(--art-subtitle-bottom))}.art-danmuku{z-index:30;width:100%;height:100%;pointer-events:none;position:absolute;inset:0;overflow:hidden}.art-video-player .art-layers{z-index:40;width:100%;height:100%;pointer-events:none;display:none;position:absolute;inset:0}.art-video-player .art-layers .art-layer{pointer-events:auto}.art-video-player.art-layer-show .art-layers{display:flex}.art-video-player .art-mask{z-index:50;width:100%;height:100%;pointer-events:none;justify-content:center;align-items:center;display:flex;position:absolute;inset:0}.art-video-player .art-mask .art-state{opacity:0;width:var(--art-state-size);height:var(--art-state-size);transition:all var(--art-transition-duration)ease;justify-content:center;align-items:center;display:flex;transform:scale(2)}.art-video-player.art-mask-show .art-state{cursor:pointer;pointer-events:auto;opacity:var(--art-state-opacity);transform:scale(1)}.art-video-player.art-loading-show .art-state{display:none}.art-video-player .art-loading{z-index:70;width:100%;height:100%;pointer-events:none;justify-content:center;align-items:center;display:none;position:absolute;inset:0}.art-video-player.art-loading-show .art-loading{display:flex}.art-video-player .art-bottom{z-index:60;width:100%;height:100%;opacity:0;pointer-events:none;justify-content:flex-end;gap:var(--art-bottom-gap);padding:0 var(--art-padding);transition:opacity var(--art-transition-duration)ease;background-size:100% var(--art-bottom-height);background-image:linear-gradient(#0000,#0006,#000);background-position:bottom;background-repeat:repeat-x;flex-direction:column;display:flex;position:absolute;inset:0;overflow:hidden}.art-video-player .art-bottom .art-controls,.art-video-player .art-bottom .art-progress{transform:translateY(var(--art-bottom-offset));transition:transform var(--art-transition-duration)ease}.art-video-player.art-control-show .art-bottom,.art-video-player.art-hover .art-bottom{opacity:1}.art-video-player.art-control-show .art-bottom .art-controls,.art-video-player.art-hover .art-bottom .art-controls,.art-video-player.art-control-show .art-bottom .art-progress,.art-video-player.art-hover .art-bottom .art-progress{transform:translateY(0)}.art-bottom .art-progress{z-index:0;pointer-events:auto;position:relative}.art-bottom .art-progress .art-control-progress{cursor:pointer;height:var(--art-progress-height);justify-content:center;align-items:center;display:flex;position:relative}.art-bottom .art-progress .art-control-progress .art-control-progress-inner{height:50%;width:100%;transition:height var(--art-transition-duration)ease;background-color:var(--art-progress-color);align-items:center;display:flex;position:relative}.art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-hover{z-index:0;width:100%;height:100%;width:0%;background-color:var(--art-hover-color);display:none;position:absolute;inset:0}.art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-loaded{z-index:10;width:100%;height:100%;width:0%;background-color:var(--art-loaded-color);position:absolute;inset:0}.art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-played{z-index:20;width:100%;height:100%;width:0%;background-color:var(--art-theme);position:absolute;inset:0}.art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-highlight{z-index:30;width:100%;height:100%;pointer-events:none;position:absolute;inset:0}.art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-highlight span{z-index:0;width:100%;height:100%;pointer-events:auto;width:var(--art-highlight-width);transform:translateX(calc(var(--art-highlight-width)/-2));background-color:var(--art-highlight-color);position:absolute;inset:0 auto 0 0}.art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator{z-index:40;width:var(--art-indicator-size);height:var(--art-indicator-size);transform:scale(var(--art-indicator-scale));margin-left:calc(var(--art-indicator-size)/-2);transition:transform var(--art-transition-duration)ease;border-radius:50%;justify-content:center;align-items:center;display:flex;position:absolute;left:0}.art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator .art-icon{width:100%;height:100%;pointer-events:none}.art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator:hover{transform:scale(1.2)!important}.art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator:active{transform:scale(1)!important}.art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-tip{z-index:50;border-radius:var(--art-border-radius);white-space:nowrap;background-color:var(--art-tip-background);padding:3px 5px;font-size:12px;line-height:1;display:none;position:absolute;top:-25px;left:0}.art-bottom .art-progress .art-control-progress:hover .art-control-progress-inner{height:100%}.art-bottom .art-progress .art-control-thumbnails{border-radius:var(--art-border-radius);pointer-events:none;background-color:var(--art-widget-background);display:none;position:absolute;bottom:10px;left:0;box-shadow:0 1px 3px #0003,0 1px 2px -1px #0003}.art-bottom .art-progress .art-control-loop{z-index:0;width:100%;height:100%;pointer-events:none;display:none;position:absolute;inset:0}.art-bottom .art-progress .art-control-loop .art-loop-point{z-index:0;width:100%;height:100%;width:var(--art-loop-width);background-color:var(--art-loop-color);transform:translateX(calc(var(--art-loop-width)/-2))scaleY(1.5);position:absolute;inset:0 0 0 0%}.art-bottom:hover .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator{transform:scale(1)}.art-controls{z-index:10;pointer-events:auto;height:var(--art-control-height);justify-content:space-between;align-items:center;display:flex;position:relative}.art-controls .art-controls-left,.art-controls .art-controls-right{height:100%;display:flex}.art-controls .art-controls-center{height:100%;flex:1;justify-content:center;align-items:center;padding:0 10px;display:none}.art-controls .art-controls-right{justify-content:flex-end}.art-controls .art-control{cursor:pointer;white-space:nowrap;opacity:var(--art-control-opacity);min-height:var(--art-control-height);min-width:var(--art-control-height);transition:opacity var(--art-transition-duration)ease;flex-shrink:0;justify-content:center;align-items:center;display:flex}.art-controls .art-control .art-icon{height:var(--art-control-icon-size);width:var(--art-control-icon-size);transform:scale(var(--art-control-icon-scale));transition:transform var(--art-transition-duration)ease}.art-controls .art-control .art-icon:active{transform:scale(calc(var(--art-control-icon-scale)*.8))}.art-controls .art-control:hover{opacity:1}.art-control-volume{position:relative}.art-control-volume .art-volume-panel{text-align:center;cursor:default;opacity:0;pointer-events:none;left:0;right:0;bottom:var(--art-control-height);width:var(--art-control-height);height:var(--art-volume-height);transition:all var(--art-transition-duration)ease;justify-content:center;align-items:center;padding:0 5px;font-size:12px;display:flex;position:absolute;transform:translateY(10px)}.art-control-volume .art-volume-panel .art-volume-inner{height:100%;width:100%;border-radius:var(--art-border-radius);background-color:var(--art-widget-background);flex-direction:column;align-items:center;gap:10px;padding:10px 0 12px;display:flex}.art-control-volume .art-volume-panel .art-volume-inner .art-volume-slider{width:100%;cursor:pointer;flex:1;justify-content:center;display:flex;position:relative}.art-control-volume .art-volume-panel .art-volume-inner .art-volume-slider .art-volume-handle{width:2px;border-radius:var(--art-border-radius);background-color:#ffffff40;justify-content:center;display:flex;position:relative;overflow:hidden}.art-control-volume .art-volume-panel .art-volume-inner .art-volume-slider .art-volume-handle .art-volume-loaded{z-index:0;width:100%;height:100%;background-color:var(--art-theme);position:absolute;inset:0}.art-control-volume .art-volume-panel .art-volume-inner .art-volume-slider .art-volume-indicator{width:var(--art-volume-handle-size);height:var(--art-volume-handle-size);margin-top:calc(var(--art-volume-handle-size)/-2);background-color:var(--art-theme);transition:transform var(--art-transition-duration)ease;border-radius:100%;flex-shrink:0;position:absolute;transform:scale(1)}.art-control-volume .art-volume-panel .art-volume-inner .art-volume-slider:active .art-volume-indicator{transform:scale(.9)}.art-control-volume:hover .art-volume-panel{opacity:1;pointer-events:auto;transform:translateY(0)}.art-video-player .art-notice{z-index:80;width:100%;height:100%;height:auto;padding:var(--art-padding);pointer-events:none;display:none;position:absolute;inset:0 0 auto}.art-video-player .art-notice .art-notice-inner{border-radius:var(--art-border-radius);background-color:var(--art-tip-background);padding:5px;line-height:1;display:inline-flex}.art-video-player.art-notice-show .art-notice{display:flex}.art-video-player .art-contextmenus{z-index:120;border-radius:var(--art-border-radius);background-color:var(--art-widget-background);min-width:var(--art-contextmenus-min-width);flex-direction:column;padding:5px 0;font-size:12px;display:none;position:absolute}.art-video-player .art-contextmenus .art-contextmenu{cursor:pointer;border-bottom:1px solid #ffffff1a;padding:10px 15px;display:flex}.art-video-player .art-contextmenus .art-contextmenu span{padding:0 8px}.art-video-player .art-contextmenus .art-contextmenu span:hover,.art-video-player .art-contextmenus .art-contextmenu span.art-current{color:var(--art-theme)}.art-video-player .art-contextmenus .art-contextmenu:hover{background-color:#ffffff1a}.art-video-player .art-contextmenus .art-contextmenu:last-child{border-bottom:none}.art-video-player.art-contextmenu-show .art-contextmenus{display:flex}.art-video-player .art-settings{z-index:90;border-radius:var(--art-border-radius);transform-origin:100% 100%;max-height:var(--art-settings-max-height);left:auto;right:var(--art-padding);bottom:var(--art-control-height);transform:scale(var(--art-settings-scale));transition:all var(--art-transition-duration)ease;background-color:var(--art-widget-background);flex-direction:column;display:none;position:absolute;overflow:hidden auto}.art-video-player .art-settings .art-setting-panel{flex-direction:column;display:none}.art-video-player .art-settings .art-setting-panel.art-current{display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item{cursor:pointer;transition:background-color var(--art-transition-duration)ease;justify-content:space-between;align-items:center;padding:0 5px;display:flex;overflow:hidden}.art-video-player .art-settings .art-setting-panel .art-setting-item:hover{background-color:#ffffff1a}.art-video-player .art-settings .art-setting-panel .art-setting-item.art-current{color:var(--art-theme)}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-icon-check{visibility:hidden;height:15px}.art-video-player .art-settings .art-setting-panel .art-setting-item.art-current .art-icon-check{visibility:visible}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-left{justify-content:center;align-items:center;gap:5px;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-left .art-setting-item-left-icon{height:var(--art-settings-icon-size);width:var(--art-settings-icon-size);justify-content:center;align-items:center;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right{justify-content:center;align-items:center;gap:5px;font-size:12px;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right .art-setting-item-right-tooltip{white-space:nowrap;color:#ffffff80}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right .art-setting-item-right-icon{min-width:32px;height:24px;justify-content:center;align-items:center;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right .art-setting-range{height:3px;width:80px;appearance:none;background-color:#fff3;outline:none}.art-video-player .art-settings .art-setting-panel .art-setting-item-back{border-bottom:1px solid #ffffff1a}.art-video-player.art-setting-show .art-settings{display:flex}.art-video-player .art-info{left:var(--art-padding);top:var(--art-padding);z-index:100;border-radius:var(--art-border-radius);background-color:var(--art-widget-background);padding:10px;font-size:12px;display:none;position:absolute}.art-video-player .art-info .art-info-panel{flex-direction:column;gap:5px;display:flex}.art-video-player .art-info .art-info-panel .art-info-item{align-items:center;gap:5px;display:flex}.art-video-player .art-info .art-info-panel .art-info-item .art-info-title{width:100px;text-align:right}.art-video-player .art-info .art-info-panel .art-info-item .art-info-content{width:250px;text-overflow:ellipsis;white-space:nowrap;user-select:all;overflow:hidden}.art-video-player .art-info .art-info-close{cursor:pointer;position:absolute;top:5px;right:5px}.art-video-player.art-info-show .art-info{display:flex}.art-hide-cursor *{cursor:none!important}.art-video-player[data-aspect-ratio]{overflow:hidden}.art-video-player[data-aspect-ratio] .art-video{object-fit:fill;box-sizing:content-box}.art-fullscreen{--art-control-height:60px;--art-control-icon-scale:1.3}.art-fullscreen-web{--art-control-height:60px;--art-control-icon-scale:1.3;z-index:var(--art-fullscreen-web-index);width:100%;height:100%;position:fixed;inset:0}.art-mini-popup{z-index:9999;width:320px;height:180px;border-radius:var(--art-border-radius);cursor:move;user-select:none;background:#000;transition:opacity .2s;position:fixed;overflow:hidden;box-shadow:0 0 5px #00000080}.art-mini-popup svg{fill:#fff}.art-mini-popup .art-video{pointer-events:none}.art-mini-popup .art-mini-close{z-index:20;cursor:pointer;opacity:0;transition:opacity .2s;position:absolute;top:10px;right:10px}.art-mini-popup .art-mini-state{z-index:30;width:100%;height:100%;pointer-events:none;opacity:0;background-color:#00000040;justify-content:center;align-items:center;transition:opacity .2s;display:flex;position:absolute;inset:0}.art-mini-popup .art-mini-state .art-icon{opacity:.75;cursor:pointer;pointer-events:auto;transition:transform .2s;transform:scale(3)}.art-mini-popup .art-mini-state .art-icon:active{transform:scale(2.5)}.art-mini-popup.art-mini-droging{opacity:.9}.art-mini-popup:hover .art-mini-close,.art-mini-popup:hover .art-mini-state{opacity:1}.art-video-player[data-flip=horizontal] .art-video{transform:scaleX(-1)}.art-video-player[data-flip=vertical] .art-video{transform:scaleY(-1)}.art-video-player .art-layer-mini-progress-bar{z-index:0;width:100%;height:100%;height:var(--art-mini-progress-height);background-color:var(--art-theme);display:flex;position:absolute;inset:auto 0 0}.art-video-player .art-layer-lock{height:var(--art-lock-size);width:var(--art-lock-size);top:50%;left:var(--art-padding);background-color:var(--art-tip-background);border-radius:50%;justify-content:center;align-items:center;display:none;position:absolute;transform:translateY(-50%)}.art-video-player .art-layer-auto-playback{border-radius:var(--art-border-radius);left:var(--art-padding);bottom:calc(var(--art-control-height) + var(--art-bottom-gap) + 10px);background-color:var(--art-widget-background);align-items:center;gap:10px;padding:10px;line-height:1;display:none;position:absolute}.art-video-player .art-layer-auto-playback .art-auto-playback-close{cursor:pointer;justify-content:center;align-items:center;display:flex}.art-video-player .art-layer-auto-playback .art-auto-playback-close svg{width:15px;height:15px;fill:var(--art-theme)}.art-video-player .art-layer-auto-playback .art-auto-playback-jump{color:var(--art-theme);cursor:pointer}.art-video-player.art-lock .art-bottom{display:none!important}.art-video-player.art-lock .art-subtitle{bottom:var(--art-subtitle-bottom)!important}.art-video-player.art-lock .art-layer-mini-progress-bar{display:flex!important}.art-video-player.art-control-show .art-layer-mini-progress-bar{display:none}.art-video-player.art-control-show .art-layer-lock{display:flex}.art-control-selector{position:relative}.art-control-selector .art-selector-list{text-align:center;border-radius:var(--art-border-radius);opacity:0;pointer-events:none;bottom:var(--art-control-height);max-height:var(--art-selector-max-height);background-color:var(--art-widget-background);transition:all var(--art-transition-duration)ease;flex-direction:column;align-items:center;display:flex;position:absolute;overflow:hidden auto;transform:translateY(10px)}.art-control-selector .art-selector-list .art-selector-item{width:100%;flex-shrink:0;justify-content:center;align-items:center;padding:10px 15px;line-height:1;display:flex}.art-control-selector .art-selector-list .art-selector-item:hover{background-color:#ffffff1a}.art-control-selector .art-selector-list .art-selector-item:hover,.art-control-selector .art-selector-list .art-selector-item.art-current{color:var(--art-theme)}.art-control-selector:hover .art-selector-list{opacity:1;pointer-events:auto;transform:translateY(0)}[class*=hint--]{font-style:normal;display:inline-block;position:relative}[class*=hint--]:before,[class*=hint--]:after{visibility:hidden;opacity:0;z-index:1000000;pointer-events:none;transition:all .3s;position:absolute;transform:translate(0,0)}[class*=hint--]:hover:before,[class*=hint--]:hover:after{visibility:visible;opacity:1;transition-delay:.1s}[class*=hint--]:before{content:"";z-index:1000001;background:0 0;border:6px solid #0000;position:absolute}[class*=hint--]:after{color:#fff;white-space:nowrap;background:#000;padding:8px 10px;font-family:Helvetica Neue,Helvetica,Arial,sans-serif;font-size:12px;line-height:12px}[class*=hint--][aria-label]:after{content:attr(aria-label)}[class*=hint--][data-hint]:after{content:attr(data-hint)}[aria-label=""]:before,[aria-label=""]:after,[data-hint=""]:before,[data-hint=""]:after{display:none!important}.hint--top-left:before,.hint--top-right:before,.hint--top:before{border-top-color:#000}.hint--bottom-left:before,.hint--bottom-right:before,.hint--bottom:before{border-bottom-color:#000}.hint--left:before{border-left-color:#000}.hint--right:before{border-right-color:#000}.hint--top:before{margin-bottom:-11px}.hint--top:before,.hint--top:after{bottom:100%;left:50%}.hint--top:before{left:calc(50% - 6px)}.hint--top:after{transform:translate(-50%)}.hint--top:hover:before{transform:translateY(-8px)}.hint--top:hover:after{transform:translate(-50%)translateY(-8px)}.hint--bottom:before{margin-top:-11px}.hint--bottom:before,.hint--bottom:after{top:100%;left:50%}.hint--bottom:before{left:calc(50% - 6px)}.hint--bottom:after{transform:translate(-50%)}.hint--bottom:hover:before{transform:translateY(8px)}.hint--bottom:hover:after{transform:translate(-50%)translateY(8px)}.hint--right:before{margin-bottom:-6px;margin-left:-11px}.hint--right:after{margin-bottom:-14px}.hint--right:before,.hint--right:after{bottom:50%;left:100%}.hint--right:hover:before,.hint--right:hover:after{transform:translate(8px)}.hint--left:before{margin-bottom:-6px;margin-right:-11px}.hint--left:after{margin-bottom:-14px}.hint--left:before,.hint--left:after{bottom:50%;right:100%}.hint--left:hover:before,.hint--left:hover:after{transform:translate(-8px)}.hint--top-left:before{margin-bottom:-11px}.hint--top-left:before,.hint--top-left:after{bottom:100%;left:50%}.hint--top-left:before{left:calc(50% - 6px)}.hint--top-left:after{margin-left:12px;transform:translate(-100%)}.hint--top-left:hover:before{transform:translateY(-8px)}.hint--top-left:hover:after{transform:translate(-100%)translateY(-8px)}.hint--top-right:before{margin-bottom:-11px}.hint--top-right:before,.hint--top-right:after{bottom:100%;left:50%}.hint--top-right:before{left:calc(50% - 6px)}.hint--top-right:after{margin-left:-12px;transform:translate(0)}.hint--top-right:hover:before,.hint--top-right:hover:after{transform:translateY(-8px)}.hint--bottom-left:before{margin-top:-11px}.hint--bottom-left:before,.hint--bottom-left:after{top:100%;left:50%}.hint--bottom-left:before{left:calc(50% - 6px)}.hint--bottom-left:after{margin-left:12px;transform:translate(-100%)}.hint--bottom-left:hover:before{transform:translateY(8px)}.hint--bottom-left:hover:after{transform:translate(-100%)translateY(8px)}.hint--bottom-right:before{margin-top:-11px}.hint--bottom-right:before,.hint--bottom-right:after{top:100%;left:50%}.hint--bottom-right:before{left:calc(50% - 6px)}.hint--bottom-right:after{margin-left:-12px;transform:translate(0)}.hint--bottom-right:hover:before,.hint--bottom-right:hover:after{transform:translateY(8px)}.hint--small:after,.hint--medium:after,.hint--large:after{white-space:normal;word-wrap:break-word;line-height:1.4em}.hint--small:after{width:80px}.hint--medium:after{width:150px}.hint--large:after{width:300px}[class*=hint--]:after{text-shadow:0 -1px #000;box-shadow:4px 4px 8px #0000004d}.hint--error:after{text-shadow:0 -1px #592726;background-color:#b34e4d}.hint--error.hint--top-left:before,.hint--error.hint--top-right:before,.hint--error.hint--top:before{border-top-color:#b34e4d}.hint--error.hint--bottom-left:before,.hint--error.hint--bottom-right:before,.hint--error.hint--bottom:before{border-bottom-color:#b34e4d}.hint--error.hint--left:before{border-left-color:#b34e4d}.hint--error.hint--right:before{border-right-color:#b34e4d}.hint--warning:after{text-shadow:0 -1px #6c5328;background-color:#c09854}.hint--warning.hint--top-left:before,.hint--warning.hint--top-right:before,.hint--warning.hint--top:before{border-top-color:#c09854}.hint--warning.hint--bottom-left:before,.hint--warning.hint--bottom-right:before,.hint--warning.hint--bottom:before{border-bottom-color:#c09854}.hint--warning.hint--left:before{border-left-color:#c09854}.hint--warning.hint--right:before{border-right-color:#c09854}.hint--info:after{text-shadow:0 -1px #1a3c4d;background-color:#3986ac}.hint--info.hint--top-left:before,.hint--info.hint--top-right:before,.hint--info.hint--top:before{border-top-color:#3986ac}.hint--info.hint--bottom-left:before,.hint--info.hint--bottom-right:before,.hint--info.hint--bottom:before{border-bottom-color:#3986ac}.hint--info.hint--left:before{border-left-color:#3986ac}.hint--info.hint--right:before{border-right-color:#3986ac}.hint--success:after{text-shadow:0 -1px #1a321a;background-color:#458746}.hint--success.hint--top-left:before,.hint--success.hint--top-right:before,.hint--success.hint--top:before{border-top-color:#458746}.hint--success.hint--bottom-left:before,.hint--success.hint--bottom-right:before,.hint--success.hint--bottom:before{border-bottom-color:#458746}.hint--success.hint--left:before{border-left-color:#458746}.hint--success.hint--right:before{border-right-color:#458746}.hint--always:after,.hint--always:before{opacity:1;visibility:visible}.hint--always.hint--top:before{transform:translateY(-8px)}.hint--always.hint--top:after{transform:translate(-50%)translateY(-8px)}.hint--always.hint--top-left:before{transform:translateY(-8px)}.hint--always.hint--top-left:after{transform:translate(-100%)translateY(-8px)}.hint--always.hint--top-right:before,.hint--always.hint--top-right:after{transform:translateY(-8px)}.hint--always.hint--bottom:before{transform:translateY(8px)}.hint--always.hint--bottom:after{transform:translate(-50%)translateY(8px)}.hint--always.hint--bottom-left:before{transform:translateY(8px)}.hint--always.hint--bottom-left:after{transform:translate(-100%)translateY(8px)}.hint--always.hint--bottom-right:before,.hint--always.hint--bottom-right:after{transform:translateY(8px)}.hint--always.hint--left:before,.hint--always.hint--left:after{transform:translate(-8px)}.hint--always.hint--right:before,.hint--always.hint--right:after{transform:translate(8px)}.hint--rounded:after{border-radius:4px}.hint--no-animate:before,.hint--no-animate:after{transition-duration:0s}.hint--bounce:before,.hint--bounce:after{-webkit-transition:opacity .3s,visibility .3s,-webkit-transform .3s cubic-bezier(.71,1.7,.77,1.24);-moz-transition:opacity .3s,visibility .3s,-moz-transform .3s cubic-bezier(.71,1.7,.77,1.24);transition:opacity .3s,visibility .3s,transform .3s cubic-bezier(.71,1.7,.77,1.24)}.hint--no-shadow:before,.hint--no-shadow:after{text-shadow:initial;box-shadow:initial}.hint--no-arrow:before{display:none}.art-video-player.art-mobile{--art-bottom-gap:10px;--art-control-height:38px;--art-control-icon-scale:1;--art-state-size:60px;--art-settings-max-height:180px;--art-selector-max-height:180px;--art-indicator-scale:1;--art-control-opacity:1}.art-video-player.art-mobile .art-controls-left{margin-left:calc(var(--art-padding)/-1)}.art-video-player.art-mobile .art-controls-right{margin-right:calc(var(--art-padding)/-1)}'},{}],bAWi2:[function(R,M,s){M.exports=function(){function t(o){return(t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(h){return typeof h}:function(h){return h&&typeof Symbol=="function"&&h.constructor===Symbol&&h!==Symbol.prototype?"symbol":typeof h})(o)}var e=Object.prototype.toString,p=function(o){if(o===void 0)return"undefined";if(o===null)return"null";var h=t(o);if(h==="boolean")return"boolean";if(h==="string")return"string";if(h==="number")return"number";if(h==="symbol")return"symbol";if(h==="function")return function(v){return I(v)==="GeneratorFunction"}(o)?"generatorfunction":"function";if(function(v){return Array.isArray?Array.isArray(v):v instanceof Array}(o))return"array";if(function(v){return!(!v.constructor||typeof v.constructor.isBuffer!="function")&&v.constructor.isBuffer(v)}(o))return"buffer";if(function(v){try{if(typeof v.length=="number"&&typeof v.callee=="function")return!0}catch(m){if(m.message.indexOf("callee")!==-1)return!0}return!1}(o))return"arguments";if(function(v){return v instanceof Date||typeof v.toDateString=="function"&&typeof v.getDate=="function"&&typeof v.setDate=="function"}(o))return"date";if(function(v){return v instanceof Error||typeof v.message=="string"&&v.constructor&&typeof v.constructor.stackTraceLimit=="number"}(o))return"error";if(function(v){return v instanceof RegExp||typeof v.flags=="string"&&typeof v.ignoreCase=="boolean"&&typeof v.multiline=="boolean"&&typeof v.global=="boolean"}(o))return"regexp";switch(I(o)){case"Symbol":return"symbol";case"Promise":return"promise";case"WeakMap":return"weakmap";case"WeakSet":return"weakset";case"Map":return"map";case"Set":return"set";case"Int8Array":return"int8array";case"Uint8Array":return"uint8array";case"Uint8ClampedArray":return"uint8clampedarray";case"Int16Array":return"int16array";case"Uint16Array":return"uint16array";case"Int32Array":return"int32array";case"Uint32Array":return"uint32array";case"Float32Array":return"float32array";case"Float64Array":return"float64array"}if(function(v){return typeof v.throw=="function"&&typeof v.return=="function"&&typeof v.next=="function"}(o))return"generator";switch(h=e.call(o)){case"[object Object]":return"object";case"[object Map Iterator]":return"mapiterator";case"[object Set Iterator]":return"setiterator";case"[object String Iterator]":return"stringiterator";case"[object Array Iterator]":return"arrayiterator"}return h.slice(8,-1).toLowerCase().replace(/\s/g,"")};function I(o){return o.constructor?o.constructor.name:null}function b(o,h){var v=2<arguments.length&&arguments[2]!==void 0?arguments[2]:["option"];return A(o,h,v),c(o,h,v),function(m,T,f){var n=p(T),r=p(m);if(n==="object"){if(r!=="object")throw new Error("[Type Error]: '".concat(f.join("."),"' require 'object' type, but got '").concat(r,"'"));Object.keys(T).forEach(function(d){var u=m[d],y=T[d],l=f.slice();l.push(d),A(u,y,l),c(u,y,l),b(u,y,l)})}if(n==="array"){if(r!=="array")throw new Error("[Type Error]: '".concat(f.join("."),"' require 'array' type, but got '").concat(r,"'"));m.forEach(function(d,u){var y=m[u],l=T[u]||T[0],a=f.slice();a.push(u),A(y,l,a),c(y,l,a),b(y,l,a)})}}(o,h,v),o}function A(o,h,v){if(p(h)==="string"){var m=p(o);if(h[0]==="?"&&(h=h.slice(1)+"|undefined"),!(-1<h.indexOf("|")?h.split("|").map(function(T){return T.toLowerCase().trim()}).filter(Boolean).some(function(T){return m===T}):h.toLowerCase().trim()===m))throw new Error("[Type Error]: '".concat(v.join("."),"' require '").concat(h,"' type, but got '").concat(m,"'"))}}function c(o,h,v){if(p(h)==="function"){var m=h(o,p(o),v);if(m!==!0){var T=p(m);throw T==="string"?new Error(m):T==="error"?m:new Error("[Validator Error]: The scheme for '".concat(v.join("."),"' validator require return true, but got '").concat(m,"'"))}}}return b.kindOf=p,b}()},{}],"66mFZ":[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s),s.default=class{on(t,e,p){const I=this.e||(this.e={});return(I[t]||(I[t]=[])).push({fn:e,ctx:p}),this}once(t,e,p){const I=this;function b(...A){I.off(t,b),e.apply(p,A)}return b._=e,this.on(t,b,p)}emit(t,...e){const p=((this.e||(this.e={}))[t]||[]).slice();for(let I=0;I<p.length;I+=1)p[I].fn.apply(p[I].ctx,e);return this}off(t,e){const p=this.e||(this.e={}),I=p[t],b=[];if(I&&e)for(let A=0,c=I.length;A<c;A+=1)I[A].fn!==e&&I[A].fn._!==e&&b.push(I[A]);return b.length?p[t]=b:delete p[t],this}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"9pCYc":[function(R,M,s){s.interopDefault=function(t){return t&&t.__esModule?t:{default:t}},s.defineInteropFlag=function(t){Object.defineProperty(t,"__esModule",{value:!0})},s.exportAll=function(t,e){return Object.keys(t).forEach(function(p){p==="default"||p==="__esModule"||e.hasOwnProperty(p)||Object.defineProperty(e,p,{enumerable:!0,get:function(){return t[p]}})}),e},s.export=function(t,e,p){Object.defineProperty(t,e,{enumerable:!0,get:p})}},{}],"71aH7":[function(R,M,s){var t=R("@parcel/transformer-js/src/esmodule-helpers.js");t.defineInteropFlag(s);var e=R("./dom");t.exportAll(e,s);var p=R("./error");t.exportAll(p,s);var I=R("./subtitle");t.exportAll(I,s);var b=R("./file");t.exportAll(b,s);var A=R("./property");t.exportAll(A,s);var c=R("./time");t.exportAll(c,s);var o=R("./format");t.exportAll(o,s);var h=R("./compatibility");t.exportAll(h,s)},{"./dom":"bSNiV","./error":"hwmZz","./subtitle":"inzwq","./file":"6b7Ip","./property":"5NSdr","./time":"epmNy","./format":"gapRl","./compatibility":"6ZTr6","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],bSNiV:[function(R,M,s){var t=R("@parcel/transformer-js/src/esmodule-helpers.js");t.defineInteropFlag(s),t.export(s,"query",()=>p),t.export(s,"queryAll",()=>I),t.export(s,"addClass",()=>b),t.export(s,"removeClass",()=>A),t.export(s,"hasClass",()=>c),t.export(s,"append",()=>o),t.export(s,"remove",()=>h),t.export(s,"setStyle",()=>v),t.export(s,"setStyles",()=>m),t.export(s,"getStyle",()=>T),t.export(s,"sublings",()=>f),t.export(s,"inverseClass",()=>n),t.export(s,"tooltip",()=>r),t.export(s,"isInViewport",()=>d),t.export(s,"includeFromEvent",()=>u),t.export(s,"replaceElement",()=>y),t.export(s,"createElement",()=>l),t.export(s,"getIcon",()=>a);var e=R("./compatibility");function p(i,D=document){return D.querySelector(i)}function I(i,D=document){return Array.from(D.querySelectorAll(i))}function b(i,D){return i.classList.add(D)}function A(i,D){return i.classList.remove(D)}function c(i,D){return i.classList.contains(D)}function o(i,D){return D instanceof Element?i.appendChild(D):i.insertAdjacentHTML("beforeend",String(D)),i.lastElementChild||i.lastChild}function h(i){return i.parentNode.removeChild(i)}function v(i,D,E){return i.style[D]=E,i}function m(i,D){for(const E in D)v(i,E,D[E]);return i}function T(i,D,E=!0){const S=window.getComputedStyle(i,null).getPropertyValue(D);return E?parseFloat(S):S}function f(i){return Array.from(i.parentElement.children).filter(D=>D!==i)}function n(i,D){f(i).forEach(E=>A(E,D)),b(i,D)}function r(i,D,E="top"){e.isMobile||(i.setAttribute("aria-label",D),b(i,"hint--rounded"),b(i,`hint--${E}`))}function d(i,D=0){const E=i.getBoundingClientRect(),S=window.innerHeight||document.documentElement.clientHeight,L=window.innerWidth||document.documentElement.clientWidth,x=E.top-D<=S&&E.top+E.height+D>=0,g=E.left-D<=L+D&&E.left+E.width+D>=0;return x&&g}function u(i,D){return i.composedPath&&i.composedPath().indexOf(D)>-1}function y(i,D){return D.parentNode.replaceChild(i,D),i}function l(i){return document.createElement(i)}function a(i="",D=""){const E=l("i");return b(E,"art-icon"),b(E,`art-icon-${i}`),o(E,D),E}},{"./compatibility":"6ZTr6","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6ZTr6":[function(R,M,s){var t=R("@parcel/transformer-js/src/esmodule-helpers.js");t.defineInteropFlag(s),t.export(s,"userAgent",()=>e),t.export(s,"isSafari",()=>p),t.export(s,"isWechat",()=>I),t.export(s,"isIE",()=>b),t.export(s,"isAndroid",()=>A),t.export(s,"isIOS",()=>c),t.export(s,"isIOS13",()=>o),t.export(s,"isMobile",()=>h);const e=typeof navigator<"u"?navigator.userAgent:"",p=/^((?!chrome|android).)*safari/i.test(e),I=/MicroMessenger/i.test(e),b=/MSIE|Trident/i.test(e),A=/android/i.test(e),c=/iPad|iPhone|iPod/i.test(e)&&!window.MSStream,o=c||e.includes("Macintosh")&&navigator.maxTouchPoints>=1,h=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e)||o},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],hwmZz:[function(R,M,s){var t=R("@parcel/transformer-js/src/esmodule-helpers.js");t.defineInteropFlag(s),t.export(s,"ArtPlayerError",()=>e),t.export(s,"errorHandle",()=>p);class e extends Error{constructor(b,A){super(b),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,A||this.constructor),this.name="ArtPlayerError"}}function p(I,b){if(!I)throw new e(b);return I}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],inzwq:[function(R,M,s){var t=R("@parcel/transformer-js/src/esmodule-helpers.js");function e(b){return`WEBVTT \r
\r
`.concat((A=b,A.replace(/(\d\d:\d\d:\d\d)[,.](\d+)/g,(c,o,h)=>{let v=h.slice(0,3);return h.length===1&&(v=h+"00"),h.length===2&&(v=h+"0"),`${o},${v}`})).replace(/\{\\([ibu])\}/g,"</$1>").replace(/\{\\([ibu])1\}/g,"<$1>").replace(/\{([ibu])\}/g,"<$1>").replace(/\{\/([ibu])\}/g,"</$1>").replace(/(\d\d:\d\d:\d\d),(\d\d\d)/g,"$1.$2").replace(/{[\s\S]*?}/g,"").concat(`\r
\r
`));var A}function p(b){return URL.createObjectURL(new Blob([b],{type:"text/vtt"}))}function I(b){const A=new RegExp("Dialogue:\\s\\d,(\\d+:\\d\\d:\\d\\d.\\d\\d),(\\d+:\\d\\d:\\d\\d.\\d\\d),([^,]*),([^,]*),(?:[^,]*,){4}([\\s\\S]*)$","i");function c(o=""){return o.split(/[:.]/).map((h,v,m)=>{if(v===m.length-1){if(h.length===1)return`.${h}00`;if(h.length===2)return`.${h}0`}else if(h.length===1)return(v===0?"0":":0")+h;return v===0?h:v===m.length-1?`.${h}`:`:${h}`}).join("")}return`WEBVTT

${b.split(/\r?\n/).map(o=>{const h=o.match(A);return h?{start:c(h[1].trim()),end:c(h[2].trim()),text:h[5].replace(/{[\s\S]*?}/g,"").replace(/(\\N)/g,`
`).trim().split(/\r?\n/).map(v=>v.trim()).join(`
`)}:null}).filter(o=>o).map((o,h)=>o?`${h+1}
${o.start} --> ${o.end}
${o.text}`:"").filter(o=>o.trim()).join(`

`)}`}t.defineInteropFlag(s),t.export(s,"srtToVtt",()=>e),t.export(s,"vttToBlob",()=>p),t.export(s,"assToVtt",()=>I)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6b7Ip":[function(R,M,s){var t=R("@parcel/transformer-js/src/esmodule-helpers.js");function e(I){return I.includes("?")?e(I.split("?")[0]):I.includes("#")?e(I.split("#")[0]):I.trim().toLowerCase().split(".").pop()}function p(I,b){const A=document.createElement("a");A.style.display="none",A.href=I,A.download=b,document.body.appendChild(A),A.click(),document.body.removeChild(A)}t.defineInteropFlag(s),t.export(s,"getExt",()=>e),t.export(s,"download",()=>p)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"5NSdr":[function(R,M,s){var t=R("@parcel/transformer-js/src/esmodule-helpers.js");t.defineInteropFlag(s),t.export(s,"def",()=>e),t.export(s,"has",()=>I),t.export(s,"get",()=>b),t.export(s,"mergeDeep",()=>A);const e=Object.defineProperty,{hasOwnProperty:p}=Object.prototype;function I(c,o){return p.call(c,o)}function b(c,o){return Object.getOwnPropertyDescriptor(c,o)}function A(...c){const o=h=>h&&typeof h=="object"&&!Array.isArray(h);return c.reduce((h,v)=>(Object.keys(v).forEach(m=>{const T=h[m],f=v[m];Array.isArray(T)&&Array.isArray(f)?h[m]=T.concat(...f):o(T)&&o(f)?h[m]=A(T,f):h[m]=f}),h),{})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],epmNy:[function(R,M,s){var t=R("@parcel/transformer-js/src/esmodule-helpers.js");function e(b=0){return new Promise(A=>setTimeout(A,b))}function p(b,A){let c;return function(...o){clearTimeout(c),c=setTimeout(()=>(c=null,b.apply(this,o)),A)}}function I(b,A){let c=!1;return function(...o){c||(b.apply(this,o),c=!0,setTimeout(function(){c=!1},A))}}t.defineInteropFlag(s),t.export(s,"sleep",()=>e),t.export(s,"debounce",()=>p),t.export(s,"throttle",()=>I)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],gapRl:[function(R,M,s){var t=R("@parcel/transformer-js/src/esmodule-helpers.js");function e(c,o,h){return Math.max(Math.min(c,Math.max(o,h)),Math.min(o,h))}function p(c){return c.charAt(0).toUpperCase()+c.slice(1)}function I(c){return["string","number"].includes(typeof c)}function b(c){const o=Math.floor(c/3600),h=Math.floor((c-3600*o)/60),v=Math.floor(c-3600*o-60*h);return(o>0?[o,h,v]:[h,v]).map(m=>m<10?`0${m}`:String(m)).join(":")}function A(c){return c.replace(/[&<>'"]/g,o=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"})[o]||o)}t.defineInteropFlag(s),t.export(s,"clamp",()=>e),t.export(s,"capitalize",()=>p),t.export(s,"isStringOrNumber",()=>I),t.export(s,"secondToTime",()=>b),t.export(s,"escape",()=>A)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],AKEiO:[function(R,M,s){var t=R("@parcel/transformer-js/src/esmodule-helpers.js");t.defineInteropFlag(s),t.export(s,"ComponentOption",()=>v);var e=R("../utils");const p="array",I="boolean",b="string",A="number",c="object",o="function";function h(m,T,f){return(0,e.errorHandle)(T===b||T===A||m instanceof Element,`${f.join(".")} require '${b}' or 'Element' type`)}const v={html:h,disable:`?${I}`,name:`?${b}`,index:`?${A}`,style:`?${c}`,click:`?${o}`,mounted:`?${o}`,tooltip:`?${b}|${A}`,width:`?${A}`,selector:`?${p}`,onSelect:`?${o}`,switch:`?${I}`,onSwitch:`?${o}`,range:`?${p}`,onRange:`?${o}`,onChange:`?${o}`};s.default={id:b,container:h,url:b,poster:b,type:b,theme:b,lang:b,volume:A,isLive:I,muted:I,autoplay:I,autoSize:I,autoMini:I,loop:I,flip:I,playbackRate:I,aspectRatio:I,screenshot:I,setting:I,hotkey:I,pip:I,mutex:I,backdrop:I,fullscreen:I,fullscreenWeb:I,subtitleOffset:I,miniProgressBar:I,useSSR:I,playsInline:I,lock:I,fastForward:I,autoPlayback:I,autoOrientation:I,airplay:I,plugins:[o],layers:[v],contextmenu:[v],settings:[v],controls:[{...v,position:(m,T,f)=>{const n=["top","left","right"];return(0,e.errorHandle)(n.includes(m),`${f.join(".")} only accept ${n.toString()} as parameters`)}}],quality:[{default:`?${I}`,html:b,url:b}],highlight:[{time:A,text:b}],thumbnails:{url:b,number:A,column:A,width:A,height:A},subtitle:{url:b,type:b,style:c,escape:I,encoding:b,onVttLoad:o},moreVideoAttr:c,i18n:c,icons:c,cssVar:c,customType:c}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],lyjeQ:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s),s.default={propertys:["audioTracks","autoplay","buffered","controller","controls","crossOrigin","currentSrc","currentTime","defaultMuted","defaultPlaybackRate","duration","ended","error","loop","mediaGroup","muted","networkState","paused","playbackRate","played","preload","readyState","seekable","seeking","src","startDate","textTracks","videoTracks","volume"],methods:["addTextTrack","canPlayType","load","play","pause"],events:["abort","canplay","canplaythrough","durationchange","emptied","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting"],prototypes:["width","height","videoWidth","videoHeight","poster","webkitDecodedFrameCount","webkitDroppedFrameCount","playsInline","webkitSupportsFullscreen","webkitDisplayingFullscreen","onenterpictureinpicture","onleavepictureinpicture","disablePictureInPicture","cancelVideoFrameCallback","requestVideoFrameCallback","getVideoPlaybackQuality","requestPictureInPicture","webkitEnterFullScreen","webkitEnterFullscreen","webkitExitFullScreen","webkitExitFullscreen"]}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],X13Zf:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("./utils");class e{constructor(I){this.art=I;const{option:b,constructor:A}=I;b.container instanceof Element?this.$container=b.container:(this.$container=(0,t.query)(b.container),(0,t.errorHandle)(this.$container,`No container element found by ${b.container}`));const c=this.$container.tagName.toLowerCase();(0,t.errorHandle)(c==="div",`Unsupported container element type, only support 'div' but got '${c}'`),(0,t.errorHandle)(A.instances.every(o=>o.template.$container!==this.$container),"Cannot mount multiple instances on the same dom element"),this.query=this.query.bind(this),this.$container.dataset.artId=I.id,this.$original=this.$container.cloneNode(!0),this.init()}static get html(){return'<div class="art-video-player art-subtitle-show art-layer-show art-control-show art-mask-show"><video class="art-video"><track default kind="metadata" src=""></track></video><div class="art-poster"></div><div class="art-subtitle"></div><div class="art-danmuku"></div><div class="art-layers"></div><div class="art-mask"><div class="art-state"></div></div><div class="art-bottom"><div class="art-progress"></div><div class="art-controls"><div class="art-controls-left"></div><div class="art-controls-center"></div><div class="art-controls-right"></div></div></div><div class="art-loading"></div><div class="art-notice"><div class="art-notice-inner"></div></div><div class="art-settings"></div><div class="art-info"><div class="art-info-panel"><div class="art-info-item"><div class="art-info-title">Player version:</div><div class="art-info-content">5.0.9</div></div><div class="art-info-item"><div class="art-info-title">Video url:</div><div class="art-info-content" data-video="src"></div></div><div class="art-info-item"><div class="art-info-title">Video volume:</div><div class="art-info-content" data-video="volume"></div></div><div class="art-info-item"><div class="art-info-title">Video time:</div><div class="art-info-content" data-video="currentTime"></div></div><div class="art-info-item"><div class="art-info-title">Video duration:</div><div class="art-info-content" data-video="duration"></div></div><div class="art-info-item"><div class="art-info-title">Video resolution:</div><div class="art-info-content"><span data-video="videoWidth"></span> x <span data-video="videoHeight"></span></div></div></div><div class="art-info-close">[x]</div></div><div class="art-contextmenus"></div></div>'}query(I){return(0,t.query)(I,this.$container)}init(){const{option:I}=this.art;I.useSSR||(this.$container.innerHTML=e.html),this.$player=this.query(".art-video-player"),this.$video=this.query(".art-video"),this.$track=this.query("track"),this.$poster=this.query(".art-poster"),this.$subtitle=this.query(".art-subtitle"),this.$danmuku=this.query(".art-danmuku"),this.$bottom=this.query(".art-bottom"),this.$progress=this.query(".art-progress"),this.$controls=this.query(".art-controls"),this.$controlsLeft=this.query(".art-controls-left"),this.$controlsCenter=this.query(".art-controls-center"),this.$controlsRight=this.query(".art-controls-right"),this.$layer=this.query(".art-layers"),this.$loading=this.query(".art-loading"),this.$notice=this.query(".art-notice"),this.$noticeInner=this.query(".art-notice-inner"),this.$mask=this.query(".art-mask"),this.$state=this.query(".art-state"),this.$setting=this.query(".art-settings"),this.$info=this.query(".art-info"),this.$infoPanel=this.query(".art-info-panel"),this.$infoClose=this.query(".art-info-close"),this.$contextmenu=this.query(".art-contextmenus"),I.backdrop&&(0,t.addClass)(this.$player,"art-backdrop"),t.isMobile&&(0,t.addClass)(this.$player,"art-mobile")}destroy(I){I?(0,t.replaceElement)(this.$original,this.$container):(0,t.addClass)(this.$player,"art-destroy")}}s.default=e},{"./utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"3jKkj":[function(R,M,s){var t=R("@parcel/transformer-js/src/esmodule-helpers.js");t.defineInteropFlag(s);var e=R("../utils"),p=R("./zh-cn.json"),I=t.interopDefault(p),b=R("./zh-tw.json"),A=t.interopDefault(b),c=R("./pl.json"),o=t.interopDefault(c),h=R("./cs.json"),v=t.interopDefault(h),m=R("./es.json"),T=t.interopDefault(m),f=R("./fa.json"),n=t.interopDefault(f),r=R("./fr.json"),d=t.interopDefault(r),u=R("./id.json"),y=t.interopDefault(u),l=R("./ru.json"),a=t.interopDefault(l);s.default=class{constructor(i){this.art=i,this.languages={"zh-cn":I.default,"zh-tw":A.default,pl:o.default,cs:v.default,es:T.default,fa:n.default,fr:d.default,id:y.default,ru:a.default},this.update(i.option.i18n)}init(){const i=this.art.option.lang.toLowerCase();this.language=this.languages[i]||{}}get(i){return this.language[i]||i}update(i){this.languages=(0,e.mergeDeep)(this.languages,i),this.init()}}},{"../utils":"71aH7","./zh-cn.json":"lNQi5","./zh-tw.json":"eRpom","./pl.json":"iEpPa","./cs.json":"dBgp3","./es.json":"dNIrL","./fa.json":"7Plhe","./fr.json":"kGNjI","./id.json":"6MQTw","./ru.json":"7LASr","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],lNQi5:[function(R,M,s){M.exports=JSON.parse('{"Video Info":"\u7EDF\u8BA1\u4FE1\u606F","Close":"\u5173\u95ED","Video Load Failed":"\u52A0\u8F7D\u5931\u8D25","Volume":"\u97F3\u91CF","Play":"\u64AD\u653E","Pause":"\u6682\u505C","Rate":"\u901F\u5EA6","Mute":"\u9759\u97F3","Video Flip":"\u753B\u9762\u7FFB\u8F6C","Horizontal":"\u6C34\u5E73","Vertical":"\u5782\u76F4","Reconnect":"\u91CD\u65B0\u8FDE\u63A5","Show Setting":"\u663E\u793A\u8BBE\u7F6E","Hide Setting":"\u9690\u85CF\u8BBE\u7F6E","Screenshot":"\u622A\u56FE","Play Speed":"\u64AD\u653E\u901F\u5EA6","Aspect Ratio":"\u753B\u9762\u6BD4\u4F8B","Default":"\u9ED8\u8BA4","Normal":"\u6B63\u5E38","Open":"\u6253\u5F00","Switch Video":"\u5207\u6362","Switch Subtitle":"\u5207\u6362\u5B57\u5E55","Fullscreen":"\u5168\u5C4F","Exit Fullscreen":"\u9000\u51FA\u5168\u5C4F","Web Fullscreen":"\u7F51\u9875\u5168\u5C4F","Exit Web Fullscreen":"\u9000\u51FA\u7F51\u9875\u5168\u5C4F","Mini Player":"\u8FF7\u4F60\u64AD\u653E\u5668","PIP Mode":"\u5F00\u542F\u753B\u4E2D\u753B","Exit PIP Mode":"\u9000\u51FA\u753B\u4E2D\u753B","PIP Not Supported":"\u4E0D\u652F\u6301\u753B\u4E2D\u753B","Fullscreen Not Supported":"\u4E0D\u652F\u6301\u5168\u5C4F","Subtitle Offset":"\u5B57\u5E55\u504F\u79FB","Last Seen":"\u4E0A\u6B21\u770B\u5230","Jump Play":"\u8DF3\u8F6C\u64AD\u653E","AirPlay":"\u9694\u7A7A\u64AD\u653E","AirPlay Not Available":"\u9694\u7A7A\u64AD\u653E\u4E0D\u53EF\u7528"}')},{}],eRpom:[function(R,M,s){M.exports=JSON.parse('{"Video Info":"\u7D71\u8A08\u8A0A\u606F","Close":"\u95DC\u9589","Video Load Failed":"\u8F09\u5165\u5931\u6557","Volume":"\u97F3\u91CF","Play":"\u64AD\u653E","Pause":"\u66AB\u505C","Rate":"\u901F\u5EA6","Mute":"\u975C\u97F3","Video Flip":"\u756B\u9762\u7FFB\u8F49","Horizontal":"\u6C34\u5E73","Vertical":"\u5782\u76F4","Reconnect":"\u91CD\u65B0\u9023\u63A5","Show Setting":"\u986F\u793A\u8BBE\u7F6E","Hide Setting":"\u96B1\u85CF\u8BBE\u7F6E","Screenshot":"\u622A\u5716","Play Speed":"\u64AD\u653E\u901F\u5EA6","Aspect Ratio":"\u756B\u9762\u6BD4\u4F8B","Default":"\u9ED8\u8A8D","Normal":"\u6B63\u5E38","Open":"\u6253\u958B","Switch Video":"\u5207\u63DB","Switch Subtitle":"\u5207\u63DB\u5B57\u5E55","Fullscreen":"\u5168\u5C4F","Exit Fullscreen":"\u9000\u51FA\u5168\u5C4F","Web Fullscreen":"\u7DB2\u9801\u5168\u5C4F","Exit Web Fullscreen":"\u9000\u51FA\u7DB2\u9801\u5168\u5C4F","Mini Player":"\u8FF7\u4F60\u64AD\u653E\u5668","PIP Mode":"\u958B\u555F\u756B\u4E2D\u756B","Exit PIP Mode":"\u9000\u51FA\u756B\u4E2D\u756B","PIP Not Supported":"\u4E0D\u652F\u6301\u756B\u4E2D\u756B","Fullscreen Not Supported":"\u4E0D\u652F\u6301\u5168\u5C4F","Subtitle Offset":"\u5B57\u5E55\u504F\u79FB","Last Seen":"\u4E0A\u6B21\u770B\u5230","Jump Play":"\u8DF3\u8F49\u64AD\u653E","AirPlay":"\u9694\u7A7A\u64AD\u653E","AirPlay Not Available":"\u9694\u7A7A\u64AD\u653E\u4E0D\u53EF\u7528"}')},{}],iEpPa:[function(R,M,s){M.exports=JSON.parse('{"Video Info":"Informacje o wideo","Close":"Zamknij","Video Load Failed":"B\u0142\u0105d \u0142adowania wideo","Volume":"G\u0142o\u015Bno\u015B\u0107","Play":"Odtw\xF3rz","Pause":"Wstrzymaj","Rate":"Oce\u0144","Mute":"Wycisz","Video Flip":"Rotacja wideo","Horizontal":"Pozioma","Vertical":"Pionowa","Reconnect":"Po\u0142\u0105cz ponownie","Show Setting":"Poka\u017C ustawienia","Hide Setting":"Ukryj ustawienia","Screenshot":"Zrzut ekranu","Play Speed":"Pr\u0119dko\u015B\u0107 odtwarzania","Aspect Ratio":"Wsp\xF3\u0142czynnik proporcji","Default":"Domy\u015Blny","Normal":"Normalny","Open":"Otw\xF3rz","Switch Video":"Prze\u0142\u0105cz wideo","Switch Subtitle":"Prze\u0142\u0105cz napisy","Fullscreen":"Pe\u0142ny ekran","Exit Fullscreen":"Zamknij pe\u0142ny ekran","Web Fullscreen":"Tryb pe\u0142nej strony","Exit Web Fullscreen":"Zamknij tryb pe\u0142nej strony","Mini Player":"Miniodtwarzacz","PIP Mode":"Tryb PiP","Exit PIP Mode":"Zamknij tryb PiP","PIP Not Supported":"Tryb PiP nieobs\u0142ugiwany","Fullscreen Not Supported":"Pe\u0142ny ekran nieobs\u0142ugiwany","Subtitle Offset":"Przesuni\u0119cie napis\xF3w","Last Seen":"Ostatnio widziany","Jump Play":"Skocz do gry","AirPlay":"AirPlay","AirPlay Not Available":"AirPlay nie jest dost\u0119pny"}')},{}],dBgp3:[function(R,M,s){M.exports=JSON.parse('{"Video Info":"Info o videu","Close":"Zav\u0159\xEDt","Video Load Failed":"Nahr\xE1n\xED videa selhalo","Volume":"Hlasitost","Play":"P\u0159ehr\xE1t","Pause":"Pozastavit","Rate":"Hodnocen\xED","Mute":"Ztlumit","Video Flip":"Oto\u010Dit video","Horizontal":"Horizont\xE1ln\u011B","Vertical":"Vertik\xE1ln\u011B","Reconnect":"Op\u011Btovn\xE9 p\u0159ipojen\xED","Show Setting":"Zobrazit nastaven\xED","Hide Setting":"Skr\xFDt nastaven\xED","Screenshot":"Sn\xEDmek obrazovky","Play Speed":"Rychlost p\u0159ehr\xE1v\xE1n\xED","Aspect Ratio":"Pom\u011Br stran","Default":"V\xFDchoz\xED","Normal":"Norm\xE1ln\xED","Open":"Otev\u0159\xEDt","Switch Video":"P\u0159epnout video","Switch Subtitle":"P\u0159epnout titulky","Fullscreen":"Cel\xE1 obrazovka","Exit Fullscreen":"Opustit re\u017Eim cel\xE9 obrazovky","Web Fullscreen":"Cel\xE1 str\xE1nka","Exit Web Fullscreen":"Zav\u0159\xEDt re\u017Eim cel\xE9 str\xE1nky","Mini Player":"Mini p\u0159ehr\xE1va\u010D","PIP Mode":"Re\u017Eim PIP","Exit PIP Mode":"Opustit re\u017Eim PIP","PIP Not Supported":"Re\u017Eim PIP nen\xED podporov\xE1n","Fullscreen Not Supported":"Re\u017Eim cel\xE9 obrazovky nen\xED podporov\xE1n","Subtitle Offset":"Posun titulk\u016F","Last Seen":"Naposledy vid\u011Bn","Jump Play":"Hra na skok","AirPlay":"AirPlay","AirPlay Not Available":"AirPlay nen\xED k dispozici"}')},{}],dNIrL:[function(R,M,s){M.exports=JSON.parse('{"Video Info":"Informaci\xF3n del video","Close":"Cerrar","Video Load Failed":"Fall\xF3 carga de video","Volume":"Volumen","Play":"Reproduciendo","Pause":"Pausa","Rate":"Velocidad","Mute":"Silencio","Video Flip":"Rotar video","Horizontal":"Horizontal","Vertical":"Vertical","Reconnect":"Reconectando","Show Setting":"Mostrar ajustes","Hide Setting":"Ocultar ajustes","Screenshot":"Captura de Pantalla","Play Speed":"Velocidad de reproducci\xF3n","Aspect Ratio":"Relaci\xF3n de aspecto","Default":"Por defecto","Normal":"Normal","Open":"Abrir","Switch Video":"Cambiar video","Switch Subtitle":"Cambiar subt\xEDtulo","Fullscreen":"Pantalla completa","Exit Fullscreen":"Salir de Pantalla completa","Web Fullscreen":"Pantalla completa Web","Exit Web Fullscreen":"Salir de Pantalla completa","Mini Player":"Mini reproductor","PIP Mode":"Modo PiP","Exit PIP Mode":"Cerrar modo PiP","PIP Not Supported":"Modo PiP no compatible","Fullscreen Not Supported":"Pantalla completa no soportada","Subtitle Offset":"Ajuste subt\xEDtulo","Last Seen":"Visto \xFAltima vez","Jump Play":"Saltar","AirPlay":"AirPlay","AirPlay Not Available":"AirPlay no disponible"}')},{}],"7Plhe":[function(R,M,s){M.exports=JSON.parse('{"Video Info":"\u0627\u0637\u0644\u0627\u0639\u0627\u062A \u0648\u06CC\u062F\u06CC\u0648","Close":"\u0628\u0633\u062A\u0646","Video Load Failed":"\u0628\u0627\u0631\u06AF\u0630\u0627\u0631\u06CC \u0646\u0627\u0645\u0648\u0641\u0642","Play":"\u067E\u062E\u0634","Volume":"\u0645\u06CC\u0632\u0627\u0646 \u0635\u062F\u0627","Pause":"\u062A\u0648\u0642\u0641","Rate":"\u0646\u0631\u062E","Mute":"\u0633\u06A9\u0648\u062A","Video Flip":"\u0686\u0631\u062E\u0634 \u062A\u0635\u0648\u06CC\u0631","Horizontal":"\u0627\u0641\u0642\u06CC","Vertical":"\u0639\u0645\u0648\u062F\u06CC","Reconnect":"\u0627\u062A\u0635\u0627\u0644 \u0645\u062C\u062F\u062F","Show Setting":"\u062A\u0646\u0638\u06CC\u0645\u0627\u062A","Hide Setting":"\u0628\u0633\u062A\u0646 \u062A\u0646\u0638\u06CC\u0645\u0627\u062A","Screenshot":"\u0639\u06A9\u0633 \u0627\u0632 \u0635\u0641\u062D\u0647","Play Speed":"\u0633\u0631\u0639\u062A \u067E\u062E\u0634","Aspect Ratio":"\u0646\u0633\u0628\u062A \u062A\u0635\u0648\u06CC\u0631","Default":"\u062D\u0627\u0644\u062A \u067E\u06CC\u0634\u0641\u0631\u0636","Normal":" \u062D\u0627\u0644\u062A \u0639\u0627\u062F\u06CC","Open":"\u0628\u0627\u0632\u06A9\u0631\u062F\u0646","Switch Video":"\u062A\u063A\u06CC\u06CC\u0631 \u0648\u06CC\u062F\u06CC\u0648","Switch Subtitle":"\u0646\u063A\u06CC\u06CC\u0631 \u0632\u06CC\u0631\u0646\u0648\u06CC\u0633","Fullscreen":"\u062A\u0645\u0627\u0645 \u0635\u0641\u062D\u0647","Exit Fullscreen":"\u06A9\u0648\u0686\u06A9 \u06A9\u0631\u062F\u0646","Web Fullscreen":"\u062D\u0627\u0644\u062A \u062A\u0626\u0627\u062A\u0631","Exit Web Fullscreen":"\u062E\u0631\u0648\u062C \u0627\u0632 \u062D\u0627\u0644\u062A \u062A\u0626\u0627\u062A\u0631","Mini Player":"\u062D\u0627\u0644\u062A \u067E\u062E\u0634 \u06A9\u0648\u0686\u06A9","PIP Mode":" \u0645\u06CC\u0646\u06CC \u067E\u0644\u06CC\u0631","Exit PIP Mode":"\u062E\u0631\u0648\u062C \u0627\u0632 \u0645\u06CC\u0646\u06CC \u067E\u0644\u06CC\u0631","PIP Not Supported":"\u0639\u062F\u0645 \u067E\u0634\u062A\u06CC\u0628\u0627\u0646\u06CC \u0627\u0632 \u0645\u06CC\u0646\u06CC \u067E\u0644\u06CC\u0631","Fullscreen Not Supported":"\u0639\u062F\u0645 \u067E\u0634\u062A\u06CC\u0628\u0627\u0646\u06CC \u0627\u0632 \u062D\u0627\u0644\u062A \u062A\u0645\u0627\u0645 \u0635\u0641\u062D\u0647","Subtitle Offset":"\u0627\u0641\u0633\u062A \u0632\u06CC\u0631\u0646\u0648\u06CC\u0633","Last Seen":"\u0622\u062E\u0631\u06CC\u0646 \u0628\u0627\u0632\u062F\u06CC\u062F","Jump Play":"\u062C\u0627\u0645\u067E \u067E\u0644\u06CC","AirPlay":"\u0627\u06CC\u0631 \u067E\u0644\u06CC","AirPlay Not Available":"\u0639\u062F\u0645 \u067E\u0634\u062A\u06CC\u0628\u0627\u0646\u06CC \u0627\u0632 \u0627\u06CC\u0631\u067E\u0644\u06CC"}')},{}],kGNjI:[function(R,M,s){M.exports=JSON.parse(`{"Video Info":"Informations de la vid\xE9o","Close":"Fermer","Video Load Failed":"T\xE9l\xE9chargement de la vid\xE9o \xE9chou\xE9","Volume":"Volume","Play":"Lire","Pause":"Pause","Rate":"Vitesse","Mute":"Muet","Video Flip":"Rotation de la vid\xE9o","Horizontal":"Horizontal","Vertical":"Vertical","Reconnect":"Reconnexion","Show Setting":"Afficher les param\xE8tres","Hide Setting":"Cacher les param\xE8tres","Screenshot":"Capture d'\xE9cran","Play Speed":"Vitesse de lecture","Aspect Ratio":"Rapport d'aspect","Default":"D\xE9faut","Normal":"Normal","Open":"Ouvrir","Switch Video":"Basculer la vid\xE9o","Switch Subtitle":"Basculer le sous-titre","Fullscreen":"Plein \xE9cran","Exit Fullscreen":"Quitter le plein \xE9cran","Web Fullscreen":"Plein \xE9cran Web","Exit Web Fullscreen":"Quitter le plein \xE9cran Web","Mini Player":"Mini lecteur","PIP Mode":"Mode PiP","Exit PIP Mode":"Fermer le mode PiP","PIP Not Supported":"Mode PiP non support\xE9","Fullscreen Not Supported":"Plein \xE9cran non support\xE9","Subtitle Offset":"R\xE9glage des sous-titres","Last Seen":"Derni\xE8re position","Jump Play":"Continuer","AirPlay":"AirPlay","AirPlay Not Available":"AirPlay non disponible"}`)},{}],"6MQTw":[function(R,M,s){M.exports=JSON.parse('{"Video Info":"Informasi Video","Close":"Tutup","Video Load Failed":"Gagal Memuat Video","Volume":"Volume","Play":"Putar","Pause":"Jeda","Rate":"Kecepatan","Mute":"Senyap","Video Flip":"Memutar Video","Horizontal":"Horizontal","Vertical":"Vertikal","Reconnect":"Menyambung Kembali","Show Setting":"Tampilkan Pengaturan","Hide Setting":"Sembunyikan Pengaturan","Screenshot":"Tangkapan Layar","Play Speed":"Kecepatan Putar","Aspect Ratio":"Rasio Aspek","Default":"Default","Normal":"Normal","Open":"Buka","Switch Video":"Ganti Video","Switch Subtitle":"Ganti Subtitle","Fullscreen":"Layar Penuh","Exit Fullscreen":"Keluar dari Layar Penuh","Web Fullscreen":"Layar Penuh Web","Exit Web Fullscreen":"Keluar dari Layar Penuh Web","Mini Player":"Pemutar Mini","PIP Mode":"Mode PIP","Exit PIP Mode":"Keluar dari Mode PIP","PIP Not Supported":"PIP Tidak Didukung","Fullscreen Not Supported":"Layar Penuh Tidak Didukung","Subtitle Offset":"Pergeseran Subtitle","Last Seen":"Terakhir Dilihat","Jump Play":"Lompat Putar","AirPlay":"AirPlay","AirPlay Not Available":"AirPlay Tidak Tersedia"}')},{}],"7LASr":[function(R,M,s){M.exports=JSON.parse('{"Video Info":"\u0418\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F","Close":"\u0417\u0430\u043A\u0440\u044B\u0442\u044C","Video Load Failed":"\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u0432\u0438\u0434\u0435\u043E","Volume":"\u0413\u0440\u043E\u043C\u043A\u043E\u0441\u0442\u044C","Play":"\u0418\u0433\u0440\u0430\u0442\u044C","Pause":"\u041F\u0430\u0443\u0437\u0430","Rate":"\u0421\u043A\u043E\u0440\u043E\u0441\u0442\u044C","Mute":"\u0417\u0430\u0433\u043B\u0443\u0448\u0438\u0442\u044C","Video Flip":"\u0420\u0430\u0437\u0432\u0435\u0440\u043D\u0443\u0442\u044C \u0432\u0438\u0434\u0435\u043E","Horizontal":"\u0413\u043E\u0440\u0438\u0437\u043E\u043D\u0442\u0430\u043B\u044C\u043D\u043E","Vertical":"\u0412\u0435\u0440\u0442\u0438\u043A\u0430\u043B\u044C\u043D\u043E","Reconnect":"\u041F\u0435\u0440\u0435\u043F\u043E\u0434\u043A\u043B\u044E\u0447\u0435\u043D\u0438\u043D\u0435","Show Setting":"\u041F\u043E\u043A\u0430\u0437\u0430\u0442\u044C \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438","Hide Setting":"\u0421\u043A\u0440\u044B\u0442\u044C \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438","Screenshot":"\u0421\u043A\u0440\u0438\u043D\u0448\u043E\u0442","Play Speed":"\u0421\u043A\u043E\u0440\u043E\u0441\u0442\u044C \u0432\u043E\u0441\u043F\u0440\u043E\u0438\u0437\u0432\u0435\u0434\u0435\u043D\u0438\u044F","Aspect Ratio":"\u0421\u043E\u043E\u0442\u043D\u043E\u0448\u0435\u043D\u0438\u0435 \u0441\u0442\u043E\u0440\u043E\u043D","Default":"\u041F\u043E-\u0443\u043C\u043E\u043B\u0447\u0430\u043D\u0438\u044E","Normal":"\u041D\u043E\u0440\u043C\u0430\u043B\u044C\u043D\u044B\u0439","Open":"\u041E\u0442\u043A\u0440\u044B\u0442\u044C","Switch Video":"\u041F\u0435\u0440\u0435\u043A\u043B\u044E\u0447\u0438\u0442\u044C \u0432\u0438\u0434\u0435\u043E","Switch Subtitle":"\u041F\u0435\u0440\u0435\u043A\u043B\u044E\u0447\u0438\u0442\u044C \u0441\u0443\u0431\u0442\u0438\u0442\u0440\u044B","Fullscreen":"\u041F\u043E\u043B\u043D\u043E\u044D\u043A\u0440\u0430\u043D\u043D\u044B\u0439 \u0440\u0435\u0436\u0438\u043C","Exit Fullscreen":"\u0412\u044B\u0445\u043E\u0434 \u0438\u0437 \u043F\u043E\u043B\u043D\u043E\u044D\u043A\u0440\u0430\u043D\u043D\u043E\u0433\u043E \u0440\u0435\u0436\u0438\u043C\u0430","Web Fullscreen":"\u041D\u0430 \u0432\u0441\u0435 \u043E\u043A\u043D\u043E \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0430","Exit Web Fullscreen":"\u0412\u044B\u0445\u043E\u0434 \u0438\u0437 \u0440\u0435\u0436\u0438\u043C\u0430 \u043F\u043E\u043B\u043D\u043E\u0433\u043E \u043E\u043A\u043D\u0430","Mini Player":"\u041C\u0438\u043D\u0438 \u043F\u0440\u043E\u0438\u0433\u0440\u044B\u0432\u0430\u0442\u0435\u043B\u044C","PIP Mode":"\u041A\u0430\u0440\u0442\u0438\u043D\u043A\u0430 \u0432 \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0435","Exit PIP Mode":"\u0417\u0430\u043A\u0440\u044B\u0442\u044C \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0443 \u0432 \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0435","PIP Not Supported":"\u041A\u0430\u0440\u0442\u0438\u043D\u043A\u0430 \u0432 \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0435 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F","Fullscreen Not Supported":"\u041F\u043E\u043B\u043D\u043E\u044D\u043A\u0440\u0430\u043D\u043D\u044B\u0439 \u0440\u0435\u0436\u0438\u043C \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F","Subtitle Offset":"\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0430 \u0441\u0443\u0431\u0442\u0438\u0442\u0440\u043E\u0432","Last Seen":"\u041F\u043E\u0441\u043B\u0435\u0434\u043D\u0435\u0435 \u043F\u0440\u043E\u0441\u043C\u043E\u0442\u0440\u0435\u043D\u043D\u043E\u0435","Jump Play":"\u041F\u0435\u0440\u0435\u0439\u0442\u0438","AirPlay":"AirPlay","AirPlay Not Available":"AirPlay \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u0435\u043D"}')},{}],a90nx:[function(R,M,s){var t=R("@parcel/transformer-js/src/esmodule-helpers.js");t.defineInteropFlag(s);var e=R("./urlMix"),p=t.interopDefault(e),I=R("./attrMix"),b=t.interopDefault(I),A=R("./playMix"),c=t.interopDefault(A),o=R("./pauseMix"),h=t.interopDefault(o),v=R("./toggleMix"),m=t.interopDefault(v),T=R("./seekMix"),f=t.interopDefault(T),n=R("./volumeMix"),r=t.interopDefault(n),d=R("./currentTimeMix"),u=t.interopDefault(d),y=R("./durationMix"),l=t.interopDefault(y),a=R("./switchMix"),i=t.interopDefault(a),D=R("./playbackRateMix"),E=t.interopDefault(D),S=R("./aspectRatioMix"),L=t.interopDefault(S),x=R("./screenshotMix"),g=t.interopDefault(x),O=R("./fullscreenMix"),P=t.interopDefault(O),C=R("./fullscreenWebMix"),w=t.interopDefault(C),F=R("./pipMix"),k=t.interopDefault(F),_=R("./loadedMix"),B=t.interopDefault(_),N=R("./playedMix"),U=t.interopDefault(N),j=R("./playingMix"),W=t.interopDefault(j),H=R("./autoSizeMix"),G=t.interopDefault(H),K=R("./rectMix"),X=t.interopDefault(K),Z=R("./flipMix"),z=t.interopDefault(Z),V=R("./miniMix"),Y=t.interopDefault(V),Q=R("./loopMix"),$=t.interopDefault(Q),J=R("./posterMix"),tt=t.interopDefault(J),rt=R("./autoHeightMix"),nt=t.interopDefault(rt),it=R("./cssVarMix"),at=t.interopDefault(it),ut=R("./themeMix"),dt=t.interopDefault(ut),st=R("./typeMix"),yt=t.interopDefault(st),vt=R("./stateMix"),ct=t.interopDefault(vt),Et=R("./subtitleOffsetMix"),Tt=t.interopDefault(Et),xt=R("./airplayMix"),ot=t.interopDefault(xt),ht=R("./qualityMix"),pt=t.interopDefault(ht),mt=R("./optionInit"),St=t.interopDefault(mt),ft=R("./eventInit"),gt=t.interopDefault(ft);s.default=class{constructor(q){(0,p.default)(q),(0,b.default)(q),(0,c.default)(q),(0,h.default)(q),(0,m.default)(q),(0,f.default)(q),(0,r.default)(q),(0,u.default)(q),(0,l.default)(q),(0,i.default)(q),(0,E.default)(q),(0,L.default)(q),(0,g.default)(q),(0,P.default)(q),(0,w.default)(q),(0,k.default)(q),(0,B.default)(q),(0,U.default)(q),(0,W.default)(q),(0,G.default)(q),(0,X.default)(q),(0,z.default)(q),(0,Y.default)(q),(0,$.default)(q),(0,tt.default)(q),(0,nt.default)(q),(0,at.default)(q),(0,dt.default)(q),(0,yt.default)(q),(0,ct.default)(q),(0,Tt.default)(q),(0,ot.default)(q),(0,pt.default)(q),(0,gt.default)(q),(0,St.default)(q)}}},{"./urlMix":"kQoac","./attrMix":"deCma","./playMix":"fOJuP","./pauseMix":"fzHAy","./toggleMix":"cBHxQ","./seekMix":"koAPr","./volumeMix":"6eyuR","./currentTimeMix":"faaWv","./durationMix":"5y91K","./switchMix":"iceD8","./playbackRateMix":"keKwh","./aspectRatioMix":"jihET","./screenshotMix":"36kPY","./fullscreenMix":"2GYOJ","./fullscreenWebMix":"5aYAP","./pipMix":"7EnIB","./loadedMix":"3N9mP","./playedMix":"et96R","./playingMix":"9DzzM","./autoSizeMix":"i1LDY","./rectMix":"IqARI","./flipMix":"7E7Vs","./miniMix":"gpugx","./loopMix":"f1hVG","./posterMix":"1SuFS","./autoHeightMix":"8x4te","./cssVarMix":"1CaTA","./themeMix":"2FqhO","./typeMix":"1fQQs","./stateMix":"iBOQW","./subtitleOffsetMix":"6vlBV","./airplayMix":"eftqT","./qualityMix":"5SdyX","./optionInit":"fCWZK","./eventInit":"f8Lv3","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],kQoac:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){const{option:p,template:{$video:I}}=e;(0,t.def)(e,"url",{get:()=>I.src,async set(b){if(b){const A=e.url,c=p.type||(0,t.getExt)(b),o=p.customType[c];c&&o?(await(0,t.sleep)(),e.loading.show=!0,o.call(e,I,b,e)):(URL.revokeObjectURL(A),I.src=b),A!==e.url&&(e.option.url=b,e.isReady&&A&&e.once("video:canplay",()=>{e.emit("restart",b)}))}else await(0,t.sleep)(),e.loading.show=!0}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],deCma:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){const{template:{$video:p}}=e;(0,t.def)(e,"attr",{value(I,b){if(b===void 0)return p[I];p[I]=b}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],fOJuP:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){const{i18n:p,notice:I,option:b,constructor:{instances:A},template:{$video:c}}=e;(0,t.def)(e,"play",{value:async function(){const o=await c.play();if(I.show=p.get("Play"),e.emit("play"),b.mutex)for(let h=0;h<A.length;h++){const v=A[h];v!==e&&v.pause()}return o}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],fzHAy:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){const{template:{$video:p},i18n:I,notice:b}=e;(0,t.def)(e,"pause",{value(){const A=p.pause();return b.show=I.get("Pause"),e.emit("pause"),A}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],cBHxQ:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){(0,t.def)(e,"toggle",{value:()=>e.playing?e.pause():e.play()})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],koAPr:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){const{notice:p}=e;(0,t.def)(e,"seek",{set(I){e.currentTime=I,e.emit("seek",e.currentTime),e.duration&&(p.show=`${(0,t.secondToTime)(e.currentTime)} / ${(0,t.secondToTime)(e.duration)}`)}}),(0,t.def)(e,"forward",{set(I){e.seek=e.currentTime+I}}),(0,t.def)(e,"backward",{set(I){e.seek=e.currentTime-I}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6eyuR":[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){const{template:{$video:p},i18n:I,notice:b,storage:A}=e;(0,t.def)(e,"volume",{get:()=>p.volume||0,set:c=>{p.volume=(0,t.clamp)(c,0,1),b.show=`${I.get("Volume")}: ${parseInt(100*p.volume,10)}`,p.volume!==0&&A.set("volume",p.volume)}}),(0,t.def)(e,"muted",{get:()=>p.muted,set:c=>{p.muted=c}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],faaWv:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){const{$video:p}=e.template;(0,t.def)(e,"currentTime",{get:()=>p.currentTime||0,set:I=>{I=parseFloat(I),Number.isNaN(I)||(p.currentTime=(0,t.clamp)(I,0,e.duration))}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"5y91K":[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){(0,t.def)(e,"duration",{get:()=>{const{duration:p}=e.template.$video;return p===1/0?0:p||0}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],iceD8:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){function p(I,b){return new Promise((A,c)=>{if(I===e.url)return;const{playing:o,aspectRatio:h,playbackRate:v}=e;e.pause(),e.url=I,e.notice.show="",e.once("video:error",c),e.once("video:canplay",async()=>{e.playbackRate=v,e.aspectRatio=h,e.currentTime=b,o&&await e.play(),e.notice.show="",A()})})}(0,t.def)(e,"switchQuality",{value:I=>p(I,e.currentTime)}),(0,t.def)(e,"switchUrl",{value:I=>p(I,0)}),(0,t.def)(e,"switch",{set:e.switchUrl})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],keKwh:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){const{template:{$video:p},i18n:I,notice:b}=e;(0,t.def)(e,"playbackRate",{get:()=>p.playbackRate,set(A){if(A){if(A===p.playbackRate)return;p.playbackRate=A,b.show=`${I.get("Rate")}: ${A===1?I.get("Normal"):`${A}x`}`}else e.playbackRate=1}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],jihET:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){const{i18n:p,notice:I,template:{$video:b,$player:A}}=e;(0,t.def)(e,"aspectRatio",{get:()=>A.dataset.aspectRatio||"default",set(c){if(c||(c="default"),c==="default")(0,t.setStyle)(b,"width",null),(0,t.setStyle)(b,"height",null),(0,t.setStyle)(b,"margin",null),delete A.dataset.aspectRatio;else{const o=c.split(":").map(Number),{clientWidth:h,clientHeight:v}=A,m=h/v,T=o[0]/o[1];m>T?((0,t.setStyle)(b,"width",T*v+"px"),(0,t.setStyle)(b,"height","100%"),(0,t.setStyle)(b,"margin","0 auto")):((0,t.setStyle)(b,"width","100%"),(0,t.setStyle)(b,"height",h/T+"px"),(0,t.setStyle)(b,"margin","auto 0")),A.dataset.aspectRatio=c}I.show=`${p.get("Aspect Ratio")}: ${c==="default"?p.get("Default"):c}`,e.emit("aspectRatio",c)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"36kPY":[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){const{notice:p,template:{$video:I}}=e,b=(0,t.createElement)("canvas");(0,t.def)(e,"getDataURL",{value:()=>new Promise((A,c)=>{try{b.width=I.videoWidth,b.height=I.videoHeight,b.getContext("2d").drawImage(I,0,0),A(b.toDataURL("image/png"))}catch(o){p.show=o,c(o)}})}),(0,t.def)(e,"getBlobUrl",{value:()=>new Promise((A,c)=>{try{b.width=I.videoWidth,b.height=I.videoHeight,b.getContext("2d").drawImage(I,0,0),b.toBlob(o=>{A(URL.createObjectURL(o))})}catch(o){p.show=o,c(o)}})}),(0,t.def)(e,"screenshot",{value:async()=>{const A=await e.getDataURL();return(0,t.download)(A,`artplayer_${(0,t.secondToTime)(I.currentTime)}.png`),e.emit("screenshot",A),A}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"2GYOJ":[function(R,M,s){var t=R("@parcel/transformer-js/src/esmodule-helpers.js");t.defineInteropFlag(s);var e=R("../libs/screenfull"),p=t.interopDefault(e),I=R("../utils");s.default=function(b){const{i18n:A,notice:c,template:{$video:o,$player:h}}=b;b.once("video:loadedmetadata",()=>{p.default.isEnabled?(v=>{p.default.on("change",()=>{v.emit("fullscreen",p.default.isFullscreen)}),(0,I.def)(v,"fullscreen",{get:()=>p.default.isFullscreen,async set(m){m?(v.state="fullscreen",await p.default.request(h),(0,I.addClass)(h,"art-fullscreen")):(await p.default.exit(),(0,I.removeClass)(h,"art-fullscreen")),v.emit("resize")}})})(b):document.fullscreenEnabled||o.webkitSupportsFullscreen?(v=>{(0,I.def)(v,"fullscreen",{get:()=>o.webkitDisplayingFullscreen,set(m){m?(v.state="fullscreen",o.webkitEnterFullscreen(),v.emit("fullscreen",!0)):(o.webkitExitFullscreen(),v.emit("fullscreen",!1)),v.emit("resize")}})})(b):(0,I.def)(b,"fullscreen",{get:()=>!1,set(){c.show=A.get("Fullscreen Not Supported")}}),(0,I.def)(b,"fullscreen",(0,I.get)(b,"fullscreen"))})}},{"../libs/screenfull":"8v40z","../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"8v40z":[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);const t=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],e=(()=>{if(typeof document>"u")return!1;const b=t[0],A={};for(const c of t)if(c[1]in document){for(const[o,h]of c.entries())A[b[o]]=h;return A}return!1})(),p={change:e.fullscreenchange,error:e.fullscreenerror};let I={request:(b=document.documentElement,A)=>new Promise((c,o)=>{const h=()=>{I.off("change",h),c()};I.on("change",h);const v=b[e.requestFullscreen](A);v instanceof Promise&&v.then(h).catch(o)}),exit:()=>new Promise((b,A)=>{if(!I.isFullscreen)return void b();const c=()=>{I.off("change",c),b()};I.on("change",c);const o=document[e.exitFullscreen]();o instanceof Promise&&o.then(c).catch(A)}),toggle:(b,A)=>I.isFullscreen?I.exit():I.request(b,A),onchange(b){I.on("change",b)},onerror(b){I.on("error",b)},on(b,A){const c=p[b];c&&document.addEventListener(c,A,!1)},off(b,A){const c=p[b];c&&document.removeEventListener(c,A,!1)},raw:e};Object.defineProperties(I,{isFullscreen:{get:()=>Boolean(document[e.fullscreenElement])},element:{enumerable:!0,get:()=>document[e.fullscreenElement]},isEnabled:{enumerable:!0,get:()=>Boolean(document[e.fullscreenEnabled])}}),e||(I={isEnabled:!1}),s.default=I},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"5aYAP":[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){const{constructor:p,template:{$container:I,$player:b}}=e;let A="";(0,t.def)(e,"fullscreenWeb",{get:()=>(0,t.hasClass)(b,"art-fullscreen-web"),set(c){c?(A=b.style.cssText,p.FULLSCREEN_WEB_IN_BODY&&(0,t.append)(document.body,b),e.state="fullscreenWeb",(0,t.setStyle)(b,"width","100%"),(0,t.setStyle)(b,"height","100%"),(0,t.addClass)(b,"art-fullscreen-web"),e.emit("fullscreenWeb",!0)):(p.FULLSCREEN_WEB_IN_BODY&&(0,t.append)(I,b),A&&(b.style.cssText=A,A=""),(0,t.removeClass)(b,"art-fullscreen-web"),e.emit("fullscreenWeb",!1)),e.emit("resize")}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"7EnIB":[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){const{i18n:p,notice:I,template:{$video:b}}=e;document.pictureInPictureEnabled?function(A){const{template:{$video:c},proxy:o,notice:h}=A;c.disablePictureInPicture=!1,(0,t.def)(A,"pip",{get:()=>document.pictureInPictureElement,set(v){v?(A.state="pip",c.requestPictureInPicture().catch(m=>{throw h.show=m,m})):document.exitPictureInPicture().catch(m=>{throw h.show=m,m})}}),o(c,"enterpictureinpicture",()=>{A.emit("pip",!0)}),o(c,"leavepictureinpicture",()=>{A.emit("pip",!1)})}(e):b.webkitSupportsPresentationMode?function(A){const{$video:c}=A.template;c.webkitSetPresentationMode("inline"),(0,t.def)(A,"pip",{get:()=>c.webkitPresentationMode==="picture-in-picture",set(o){o?(A.state="pip",c.webkitSetPresentationMode("picture-in-picture"),A.emit("pip",!0)):(c.webkitSetPresentationMode("inline"),A.emit("pip",!1))}})}(e):(0,t.def)(e,"pip",{get:()=>!1,set(){I.show=p.get("PIP Not Supported")}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"3N9mP":[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){const{$video:p}=e.template;(0,t.def)(e,"loaded",{get:()=>e.loadedTime/p.duration}),(0,t.def)(e,"loadedTime",{get:()=>p.buffered.length?p.buffered.end(p.buffered.length-1):0})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],et96R:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){(0,t.def)(e,"played",{get:()=>e.currentTime/e.duration})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"9DzzM":[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){const{$video:p}=e.template;(0,t.def)(e,"playing",{get:()=>p.currentTime>0&&!p.paused&&!p.ended&&p.readyState>2})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],i1LDY:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){const{$container:p,$player:I,$video:b}=e.template;(0,t.def)(e,"autoSize",{value(){const{videoWidth:A,videoHeight:c}=b,{width:o,height:h}=p.getBoundingClientRect(),v=A/c;if(o/h>v){const m=h*v/o*100;(0,t.setStyle)(I,"width",`${m}%`),(0,t.setStyle)(I,"height","100%")}else{const m=o/v/h*100;(0,t.setStyle)(I,"width","100%"),(0,t.setStyle)(I,"height",`${m}%`)}e.emit("autoSize",{width:e.width,height:e.height})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],IqARI:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){(0,t.def)(e,"rect",{get:()=>e.template.$player.getBoundingClientRect()});const p=["bottom","height","left","right","top","width"];for(let I=0;I<p.length;I++){const b=p[I];(0,t.def)(e,b,{get:()=>e.rect[b]})}(0,t.def)(e,"x",{get:()=>e.left+window.pageXOffset}),(0,t.def)(e,"y",{get:()=>e.top+window.pageYOffset})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"7E7Vs":[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){const{template:{$player:p},i18n:I,notice:b}=e;(0,t.def)(e,"flip",{get:()=>p.dataset.flip||"normal",set(A){A||(A="normal"),A==="normal"?delete p.dataset.flip:p.dataset.flip=A,b.show=`${I.get("Video Flip")}: ${I.get((0,t.capitalize)(A))}`,e.emit("flip",A)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],gpugx:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){const{icons:p,proxy:I,storage:b,template:{$player:A,$video:c}}=e;let o=!1,h=0,v=0;function m(){const{$mini:n}=e.template;n&&((0,t.removeClass)(A,"art-mini"),(0,t.setStyle)(n,"display","none"),A.prepend(c),e.emit("mini",!1))}function T(n,r){e.playing?((0,t.setStyle)(n,"display","none"),(0,t.setStyle)(r,"display","flex")):((0,t.setStyle)(n,"display","flex"),(0,t.setStyle)(r,"display","none"))}function f(){const{$mini:n}=e.template,r=n.getBoundingClientRect(),d=window.innerHeight-r.height-50,u=window.innerWidth-r.width-50;b.set("top",d),b.set("left",u),(0,t.setStyle)(n,"top",`${d}px`),(0,t.setStyle)(n,"left",`${u}px`)}(0,t.def)(e,"mini",{get:()=>(0,t.hasClass)(A,"art-mini"),set(n){if(n){e.state="mini",(0,t.addClass)(A,"art-mini");const r=function(){const{$mini:y}=e.template;if(y)return(0,t.append)(y,c),(0,t.setStyle)(y,"display","flex");{const l=(0,t.createElement)("div");(0,t.addClass)(l,"art-mini-popup"),(0,t.append)(document.body,l),e.template.$mini=l,(0,t.append)(l,c);const a=(0,t.append)(l,'<div class="art-mini-close"></div>');(0,t.append)(a,p.close),I(a,"click",m);const i=(0,t.append)(l,'<div class="art-mini-state"></div>'),D=(0,t.append)(i,p.play),E=(0,t.append)(i,p.pause);return I(D,"click",()=>e.play()),I(E,"click",()=>e.pause()),T(D,E),e.on("video:playing",()=>T(D,E)),e.on("video:pause",()=>T(D,E)),e.on("video:timeupdate",()=>T(D,E)),I(l,"mousedown",S=>{o=S.button===0,h=S.pageX,v=S.pageY}),e.on("document:mousemove",S=>{if(o){(0,t.addClass)(l,"art-mini-droging");const L=S.pageX-h,x=S.pageY-v;(0,t.setStyle)(l,"transform",`translate(${L}px, ${x}px)`)}}),e.on("document:mouseup",()=>{if(o){o=!1,(0,t.removeClass)(l,"art-mini-droging");const S=l.getBoundingClientRect();b.set("left",S.left),b.set("top",S.top),(0,t.setStyle)(l,"left",`${S.left}px`),(0,t.setStyle)(l,"top",`${S.top}px`),(0,t.setStyle)(l,"transform",null)}}),l}}(),d=b.get("top"),u=b.get("left");d&&u?((0,t.setStyle)(r,"top",`${d}px`),(0,t.setStyle)(r,"left",`${u}px`),(0,t.isInViewport)(r)||f()):f(),e.emit("mini",!0)}else m()}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],f1hVG:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){let p=[];(0,t.def)(e,"loop",{get:()=>p,set:I=>{if(Array.isArray(I)&&typeof I[0]=="number"&&typeof I[1]=="number"){const b=(0,t.clamp)(I[0],0,Math.min(I[1],e.duration)),A=(0,t.clamp)(I[1],b,e.duration);p=A-b>=1?[b,A]:[]}else p=[];e.emit("loop",p)}}),e.on("video:timeupdate",()=>{p.length&&(e.currentTime<p[0]||e.currentTime>p[1])&&(e.seek=p[0])})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"1SuFS":[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){const{template:{$poster:p}}=e;(0,t.def)(e,"poster",{get:()=>{try{return p.style.backgroundImage.match(/"(.*)"/)[1]}catch{return""}},set(I){(0,t.setStyle)(p,"backgroundImage",`url(${I})`)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"8x4te":[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){const{template:{$container:p,$video:I}}=e;(0,t.def)(e,"autoHeight",{value(){const{clientWidth:b}=p,{videoHeight:A,videoWidth:c}=I,o=A*(b/c);(0,t.setStyle)(p,"height",o+"px"),e.emit("autoHeight",o)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"1CaTA":[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){const{$player:p}=e.template;(0,t.def)(e,"cssVar",{value:(I,b)=>b?p.style.setProperty(I,b):getComputedStyle(p).getPropertyValue(I)})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"2FqhO":[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){(0,t.def)(e,"theme",{get:()=>e.cssVar("--art-theme"),set(p){e.cssVar("--art-theme",p)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"1fQQs":[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){(0,t.def)(e,"type",{get:()=>e.option.type,set(p){e.option.type=p}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],iBOQW:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){const p=["mini","pip","fullscreen","fullscreenWeb"];(0,t.def)(e,"state",{get:()=>p.find(I=>e[I])||"standard",set(I){for(let b=0;b<p.length;b++){const A=p[b];A!==I&&e[A]&&(e[A]=!1)}}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6vlBV":[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){const{clamp:p}=e.constructor.utils,{notice:I,template:b,i18n:A}=e;let c=0,o=[];e.on("subtitle:switch",()=>{o=[]}),(0,t.def)(e,"subtitleOffset",{get:()=>c,set(h){if(b.$track&&b.$track.track){const v=Array.from(b.$track.track.cues);c=p(h,-5,5);for(let m=0;m<v.length;m++){const T=v[m];o[m]||(o[m]={startTime:T.startTime,endTime:T.endTime}),T.startTime=p(o[m].startTime+c,0,e.duration),T.endTime=p(o[m].endTime+c,0,e.duration)}e.subtitle.update(),I.show=`${A.get("Subtitle Offset")}: ${h}s`,e.emit("subtitleOffset",h)}else e.emit("subtitleOffset",0)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],eftqT:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){const{i18n:p,notice:I,proxy:b,template:{$video:A}}=e;let c=!0;window.WebKitPlaybackTargetAvailabilityEvent&&A.webkitShowPlaybackTargetPicker?b(A,"webkitplaybacktargetavailabilitychanged",o=>{switch(o.availability){case"available":c=!0;break;case"not-available":c=!1}}):c=!1,(0,t.def)(e,"airplay",{value(){c?(A.webkitShowPlaybackTargetPicker(),e.emit("airplay")):I.show=p.get("AirPlay Not Available")}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"5SdyX":[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){(0,t.def)(e,"quality",{set(p){const{controls:I,notice:b,i18n:A}=e,c=p.find(o=>o.default)||p[0];I.update({name:"quality",position:"right",index:10,style:{marginRight:"10px"},html:c?c.html:"",selector:p,async onSelect(o){await e.switchQuality(o.url),b.show=`${A.get("Switch Video")}: ${o.html}`}})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],fCWZK:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){const{option:p,storage:I,template:{$video:b,$poster:A}}=e;for(const o in p.moreVideoAttr)e.attr(o,p.moreVideoAttr[o]);p.muted&&(e.muted=p.muted),p.volume&&(b.volume=(0,t.clamp)(p.volume,0,1));const c=I.get("volume");typeof c=="number"&&(b.volume=(0,t.clamp)(c,0,1)),p.poster&&(0,t.setStyle)(A,"backgroundImage",`url(${p.poster})`),p.autoplay&&(b.autoplay=p.autoplay),p.playsInline&&(b.playsInline=!0,b["webkit-playsinline"]=!0),p.theme&&(p.cssVar["--art-theme"]=p.theme);for(const o in p.cssVar)e.cssVar(o,p.cssVar[o]);e.url=p.url}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],f8Lv3:[function(R,M,s){var t=R("@parcel/transformer-js/src/esmodule-helpers.js");t.defineInteropFlag(s);var e=R("../config"),p=t.interopDefault(e),I=R("../utils");s.default=function(b){const{i18n:A,notice:c,option:o,constructor:h,proxy:v,template:{$player:m,$video:T,$poster:f}}=b;let n=0;for(let r=0;r<p.default.events.length;r++)v(T,p.default.events[r],d=>{b.emit(`video:${d.type}`,d)});b.on("video:canplay",()=>{n=0,b.loading.show=!1}),b.once("video:canplay",()=>{b.loading.show=!1,b.controls.show=!0,b.mask.show=!0,b.isReady=!0,b.emit("ready")}),b.on("video:ended",()=>{o.loop?(b.seek=0,b.play(),b.controls.show=!1,b.mask.show=!1):(b.controls.show=!0,b.mask.show=!0)}),b.on("video:error",async r=>{n<h.RECONNECT_TIME_MAX?(await(0,I.sleep)(h.RECONNECT_SLEEP_TIME),n+=1,b.url=o.url,c.show=`${A.get("Reconnect")}: ${n}`,b.emit("error",r,n)):(b.mask.show=!0,b.loading.show=!1,b.controls.show=!0,(0,I.addClass)(m,"art-error"),await(0,I.sleep)(h.RECONNECT_SLEEP_TIME),c.show=A.get("Video Load Failed"),b.destroy(!1))}),b.on("video:loadedmetadata",()=>{b.emit("resize"),I.isMobile&&(b.loading.show=!1,b.controls.show=!0,b.mask.show=!0)}),b.on("video:loadstart",()=>{b.loading.show=!0,b.mask.show=!1,b.controls.show=!0}),b.on("video:pause",()=>{b.controls.show=!0,b.mask.show=!0}),b.on("video:play",()=>{b.mask.show=!1,(0,I.setStyle)(f,"display","none")}),b.on("video:playing",()=>{b.mask.show=!1}),b.on("video:progress",()=>{b.playing&&(b.loading.show=!1)}),b.on("video:seeked",()=>{b.loading.show=!1}),b.on("video:seeking",()=>{b.loading.show=!0,b.mask.show=!1}),b.on("video:timeupdate",()=>{b.mask.show=!1}),b.on("video:waiting",()=>{b.loading.show=!0,b.mask.show=!1})}},{"../config":"lyjeQ","../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"8Z0Uf":[function(R,M,s){var t=R("@parcel/transformer-js/src/esmodule-helpers.js");t.defineInteropFlag(s);var e=R("../utils"),p=R("../utils/component"),I=t.interopDefault(p),b=R("./fullscreen"),A=t.interopDefault(b),c=R("./fullscreenWeb"),o=t.interopDefault(c),h=R("./pip"),v=t.interopDefault(h),m=R("./playAndPause"),T=t.interopDefault(m),f=R("./progress"),n=t.interopDefault(f),r=R("./time"),d=t.interopDefault(r),u=R("./volume"),y=t.interopDefault(u),l=R("./setting"),a=t.interopDefault(l),i=R("./thumbnails"),D=t.interopDefault(i),E=R("./screenshot"),S=t.interopDefault(E),L=R("./loop"),x=t.interopDefault(L),g=R("./airplay"),O=t.interopDefault(g);class P extends I.default{constructor(w){super(w),this.name="control";const{proxy:F,constructor:k,template:{$player:_}}=w;let B=Date.now();F(_,["click","mousemove","touchstart","touchmove"],()=>{this.show=!0,(0,e.removeClass)(_,"art-hide-cursor"),(0,e.addClass)(_,"art-hover"),B=Date.now()}),w.on("video:timeupdate",()=>{!w.isInput&&w.playing&&this.show&&Date.now()-B>=k.CONTROL_HIDE_TIME&&(this.show=!1,(0,e.addClass)(_,"art-hide-cursor"),(0,e.removeClass)(_,"art-hover"))}),this.init()}init(){const{option:w}=this.art;w.isLive||this.add((0,n.default)({name:"progress",position:"top",index:10})),!w.thumbnails.url||w.isLive||e.isMobile||this.add((0,D.default)({name:"thumbnails",position:"top",index:20})),this.add((0,x.default)({name:"loop",position:"top",index:30})),this.add((0,T.default)({name:"playAndPause",position:"left",index:10})),this.add((0,y.default)({name:"volume",position:"left",index:20})),w.isLive||this.add((0,d.default)({name:"time",position:"left",index:30})),w.quality.length&&(0,e.sleep)().then(()=>{this.art.quality=w.quality}),w.screenshot&&!e.isMobile&&this.add((0,S.default)({name:"screenshot",position:"right",index:20})),w.setting&&this.add((0,a.default)({name:"setting",position:"right",index:30})),w.pip&&this.add((0,v.default)({name:"pip",position:"right",index:40})),w.airplay&&window.WebKitPlaybackTargetAvailabilityEvent&&this.add((0,O.default)({name:"airplay",position:"right",index:50})),w.fullscreenWeb&&this.add((0,o.default)({name:"fullscreenWeb",position:"right",index:60})),w.fullscreen&&this.add((0,A.default)({name:"fullscreen",position:"right",index:70}));for(let F=0;F<w.controls.length;F++)this.add(w.controls[F])}add(w){const F=typeof w=="function"?w(this.art):w,{$progress:k,$controlsLeft:_,$controlsRight:B}=this.art.template;switch(F.position){case"top":this.$parent=k;break;case"left":this.$parent=_;break;case"right":this.$parent=B;break;default:(0,e.errorHandle)(!1,"Control option.position must one of 'top', 'left', 'right'")}super.add(F)}}s.default=P},{"../utils":"71aH7","../utils/component":"18nVI","./fullscreen":"c61Lj","./fullscreenWeb":"03jeB","./pip":"u8l8e","./playAndPause":"ebXtb","./progress":"bgoVP","./time":"ikc2j","./volume":"b8NFx","./setting":"03o9l","./thumbnails":"eCVx2","./screenshot":"4KCF5","./loop":"2hIff","./airplay":"4IS2d","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"18nVI":[function(R,M,s){var t=R("@parcel/transformer-js/src/esmodule-helpers.js");t.defineInteropFlag(s);var e=R("./dom"),p=R("./format"),I=R("./error"),b=R("option-validator"),A=t.interopDefault(b),c=R("../scheme");s.default=class{constructor(o){this.id=0,this.art=o,this.cache=new Map,this.add=this.add.bind(this),this.remove=this.remove.bind(this),this.update=this.update.bind(this)}get show(){return(0,e.hasClass)(this.art.template.$player,`art-${this.name}-show`)}set show(o){const{$player:h}=this.art.template,v=`art-${this.name}-show`;o?(0,e.addClass)(h,v):(0,e.removeClass)(h,v),this.art.emit(this.name,o)}toggle(){this.show=!this.show}add(o){const h=typeof o=="function"?o(this.art):o;if(h.html=h.html||"",(0,A.default)(h,c.ComponentOption),!this.$parent||!this.name||h.disable)return;const v=h.name||`${this.name}${this.id}`,m=this.cache.get(v);(0,I.errorHandle)(!m,`Can't add an existing [${v}] to the [${this.name}]`),this.id+=1;const T=(0,e.createElement)("div");(0,e.addClass)(T,`art-${this.name}`),(0,e.addClass)(T,`art-${this.name}-${v}`);const f=Array.from(this.$parent.children);T.dataset.index=h.index||this.id;const n=f.find(d=>Number(d.dataset.index)>=Number(T.dataset.index));n?n.insertAdjacentElement("beforebegin",T):(0,e.append)(this.$parent,T),h.html&&(0,e.append)(T,h.html),h.style&&(0,e.setStyles)(T,h.style),h.tooltip&&(0,e.tooltip)(T,h.tooltip);const r=[];if(h.click){const d=this.art.events.proxy(T,"click",u=>{u.preventDefault(),h.click.call(this.art,this,u)});r.push(d)}return h.selector&&["left","right"].includes(h.position)&&this.addSelector(h,T,r),this[v]=T,this.cache.set(v,{$ref:T,events:r,option:h}),h.mounted&&h.mounted.call(this.art,T),T}addSelector(o,h,v){const{hover:m,proxy:T}=this.art.events;(0,e.addClass)(h,"art-control-selector");const f=(0,e.createElement)("div");(0,e.addClass)(f,"art-selector-value"),(0,e.append)(f,o.html),h.innerText="",(0,e.append)(h,f);const n=o.selector.map((y,l)=>`<div class="art-selector-item ${y.default?"art-current":""}" data-index="${l}">${y.html}</div>`).join(""),r=(0,e.createElement)("div");(0,e.addClass)(r,"art-selector-list"),(0,e.append)(r,n),(0,e.append)(h,r);const d=()=>{const y=(0,e.getStyle)(h,"width")/2-(0,e.getStyle)(r,"width")/2;r.style.left=`${y}px`};m(h,d);const u=T(r,"click",async y=>{const l=(y.composedPath()||[]).find(D=>(0,e.hasClass)(D,"art-selector-item"));if(!l)return;(0,e.inverseClass)(l,"art-current");const a=Number(l.dataset.index),i=o.selector[a]||{};if(f.innerText=l.innerText,o.onSelect){const D=await o.onSelect.call(this.art,i,l,y);(0,p.isStringOrNumber)(D)&&(f.innerHTML=D)}d()});v.push(u)}remove(o){const h=this.cache.get(o);(0,I.errorHandle)(h,`Can't find [${o}] from the [${this.name}]`),h.option.beforeUnmount&&h.option.beforeUnmount.call(this.art,h.$ref);for(let v=0;v<h.events.length;v++)this.art.events.remove(h.events[v]);this.cache.delete(o),delete this[o],(0,e.remove)(h.$ref)}update(o){return this.cache.get(o.name)&&this.remove(o.name),this.add(o)}}},{"./dom":"bSNiV","./format":"gapRl","./error":"hwmZz","option-validator":"bAWi2","../scheme":"AKEiO","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],c61Lj:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){return p=>({...e,tooltip:p.i18n.get("Fullscreen"),mounted:I=>{const{proxy:b,icons:A,i18n:c}=p,o=(0,t.append)(I,A.fullscreenOn),h=(0,t.append)(I,A.fullscreenOff);(0,t.setStyle)(h,"display","none"),b(I,"click",()=>{p.fullscreen=!p.fullscreen}),p.on("fullscreen",v=>{v?((0,t.tooltip)(I,c.get("Exit Fullscreen")),(0,t.setStyle)(o,"display","none"),(0,t.setStyle)(h,"display","inline-flex")):((0,t.tooltip)(I,c.get("Fullscreen")),(0,t.setStyle)(o,"display","inline-flex"),(0,t.setStyle)(h,"display","none"))})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"03jeB":[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){return p=>({...e,tooltip:p.i18n.get("Web Fullscreen"),mounted:I=>{const{proxy:b,icons:A,i18n:c}=p,o=(0,t.append)(I,A.fullscreenWebOn),h=(0,t.append)(I,A.fullscreenWebOff);(0,t.setStyle)(h,"display","none"),b(I,"click",()=>{p.fullscreenWeb=!p.fullscreenWeb}),p.on("fullscreenWeb",v=>{v?((0,t.tooltip)(I,c.get("Exit Web Fullscreen")),(0,t.setStyle)(o,"display","none"),(0,t.setStyle)(h,"display","inline-flex")):((0,t.tooltip)(I,c.get("Web Fullscreen")),(0,t.setStyle)(o,"display","inline-flex"),(0,t.setStyle)(h,"display","none"))})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],u8l8e:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){return p=>({...e,tooltip:p.i18n.get("PIP Mode"),mounted:I=>{const{proxy:b,icons:A,i18n:c}=p;(0,t.append)(I,A.pip),b(I,"click",()=>{p.pip=!p.pip}),p.on("pip",o=>{(0,t.tooltip)(I,c.get(o?"Exit PIP Mode":"PIP Mode"))})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],ebXtb:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){return p=>({...e,mounted:I=>{const{proxy:b,icons:A,i18n:c}=p,o=(0,t.append)(I,A.play),h=(0,t.append)(I,A.pause);function v(){(0,t.setStyle)(o,"display","flex"),(0,t.setStyle)(h,"display","none")}function m(){(0,t.setStyle)(o,"display","none"),(0,t.setStyle)(h,"display","flex")}(0,t.tooltip)(o,c.get("Play")),(0,t.tooltip)(h,c.get("Pause")),b(o,"click",()=>{p.play()}),b(h,"click",()=>{p.pause()}),p.playing?m():v(),p.on("video:playing",()=>{m()}),p.on("video:pause",()=>{v()})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],bgoVP:[function(R,M,s){var t=R("@parcel/transformer-js/src/esmodule-helpers.js");t.defineInteropFlag(s),t.export(s,"getPosFromEvent",()=>p),t.export(s,"setCurrentTime",()=>I);var e=R("../utils");function p(b,A){const{$progress:c}=b.template,{left:o}=c.getBoundingClientRect(),h=e.isMobile?A.touches[0].clientX:A.clientX,v=(0,e.clamp)(h-o,0,c.clientWidth),m=v/c.clientWidth*b.duration;return{second:m,time:(0,e.secondToTime)(m),width:v,percentage:(0,e.clamp)(v/c.clientWidth,0,1)}}function I(b,A){if(b.isRotate){const c=A.touches[0].clientY/b.height,o=c*b.duration;b.emit("setBar","played",c),b.seek=o}else{const{second:c,percentage:o}=p(b,A);b.emit("setBar","played",o),b.seek=c}}s.default=function(b){return A=>{const{icons:c,option:o,proxy:h}=A;return{...b,html:'<div class="art-control-progress-inner"><div class="art-progress-hover"></div><div class="art-progress-loaded"></div><div class="art-progress-played"></div><div class="art-progress-highlight"></div><div class="art-progress-indicator"></div><div class="art-progress-tip"></div></div>',mounted:v=>{let m=!1;const T=(0,e.query)(".art-progress-hover",v),f=(0,e.query)(".art-progress-loaded",v),n=(0,e.query)(".art-progress-played",v),r=(0,e.query)(".art-progress-highlight",v),d=(0,e.query)(".art-progress-indicator",v),u=(0,e.query)(".art-progress-tip",v);function y(l,a){l==="loaded"&&(0,e.setStyle)(f,"width",100*a+"%"),l==="played"&&((0,e.setStyle)(n,"width",100*a+"%"),(0,e.setStyle)(d,"left",100*a+"%"))}c.indicator?(0,e.append)(d,c.indicator):(0,e.setStyle)(d,"backgroundColor","var(--art-theme)"),A.on("video:loadedmetadata",()=>{for(let l=0;l<o.highlight.length;l++){const a=o.highlight[l],i=(0,e.clamp)(a.time,0,A.duration)/A.duration*100,D=`<span data-text="${a.text}" data-time="${a.time}" style="left: ${i}%"></span>`;(0,e.append)(r,D)}}),y("loaded",A.loaded),A.on("setBar",(l,a)=>{y(l,a)}),A.on("video:progress",()=>{y("loaded",A.loaded)}),A.on("video:timeupdate",()=>{y("played",A.played)}),A.on("video:ended",()=>{y("played",1)}),e.isMobile||(h(v,"click",l=>{l.target!==d&&I(A,l)}),h(v,"mousemove",l=>{(function(a){const{width:i}=p(A,a);(0,e.setStyle)(T,"width",`${i}px`),(0,e.setStyle)(T,"display","flex")})(l),(0,e.setStyle)(u,"display","flex"),(0,e.includeFromEvent)(l,r)?function(a){const{width:i}=p(A,a),{text:D}=a.target.dataset;u.innerHTML=D;const E=u.clientWidth;i<=E/2?(0,e.setStyle)(u,"left",0):i>v.clientWidth-E/2?(0,e.setStyle)(u,"left",v.clientWidth-E+"px"):(0,e.setStyle)(u,"left",i-E/2+"px")}(l):function(a){const{width:i,time:D}=p(A,a);u.innerHTML=D;const E=u.clientWidth;i<=E/2?(0,e.setStyle)(u,"left",0):i>v.clientWidth-E/2?(0,e.setStyle)(u,"left",v.clientWidth-E+"px"):(0,e.setStyle)(u,"left",i-E/2+"px")}(l)}),h(v,"mouseleave",()=>{(0,e.setStyle)(u,"display","none"),(0,e.setStyle)(T,"display","none")}),h(v,"mousedown",l=>{m=l.button===0}),A.on("document:mousemove",l=>{if(m){const{second:a,percentage:i}=p(A,l);y("played",i),A.seek=a}}),A.on("document:mouseup",()=>{m&&(m=!1)}))}}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],ikc2j:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){return p=>({...e,style:t.isMobile?{fontSize:"12px",padding:"0 5px"}:{cursor:"auto",padding:"0 10px"},mounted:I=>{function b(){const c=`${(0,t.secondToTime)(p.currentTime)} / ${(0,t.secondToTime)(p.duration)}`;c!==I.innerText&&(I.innerText=c)}b();const A=["video:loadedmetadata","video:timeupdate","video:progress"];for(let c=0;c<A.length;c++)p.on(A[c],b)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],b8NFx:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){return p=>({...e,mounted:I=>{const{proxy:b,icons:A}=p,c=(0,t.append)(I,A.volume),o=(0,t.append)(I,A.volumeClose),h=(0,t.append)(I,'<div class="art-volume-panel"></div>'),v=(0,t.append)(h,'<div class="art-volume-inner"></div>'),m=(0,t.append)(v,'<div class="art-volume-val"></div>'),T=(0,t.append)(v,'<div class="art-volume-slider"></div>'),f=(0,t.append)(T,'<div class="art-volume-handle"></div>'),n=(0,t.append)(f,'<div class="art-volume-loaded"></div>'),r=(0,t.append)(T,'<div class="art-volume-indicator"></div>');function d(y){const{top:l,height:a}=T.getBoundingClientRect();return 1-(y.clientY-l)/a}function u(){if(p.muted||p.volume===0)(0,t.setStyle)(c,"display","none"),(0,t.setStyle)(o,"display","flex"),(0,t.setStyle)(r,"top","100%"),(0,t.setStyle)(n,"top","100%"),m.innerText=0;else{const y=100*p.volume;(0,t.setStyle)(c,"display","flex"),(0,t.setStyle)(o,"display","none"),(0,t.setStyle)(r,"top",100-y+"%"),(0,t.setStyle)(n,"top",100-y+"%"),m.innerText=Math.floor(y)}}if(u(),p.on("video:volumechange",u),b(c,"click",()=>{p.muted=!0}),b(o,"click",()=>{p.muted=!1}),t.isMobile)(0,t.setStyle)(h,"display","none");else{let y=!1;b(T,"mousedown",l=>{y=l.button===0,p.volume=d(l)}),p.on("document:mousemove",l=>{y&&(p.muted=!1,p.volume=d(l))}),p.on("document:mouseup",()=>{y&&(y=!1)})}}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"03o9l":[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){return p=>({...e,tooltip:p.i18n.get("Show Setting"),mounted:I=>{const{proxy:b,icons:A,i18n:c}=p;(0,t.append)(I,A.setting),b(I,"click",()=>{p.setting.toggle(),p.setting.updateStyle()}),p.on("setting",o=>{(0,t.tooltip)(I,c.get(o?"Hide Setting":"Show Setting"))})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],eCVx2:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils"),e=R("./progress");s.default=function(p){return I=>({...p,mounted:b=>{const{option:A,template:{$progress:c,$video:o},events:{proxy:h,loadImg:v}}=I;let m=null,T=!1,f=!1;h(c,"mousemove",async n=>{T||(T=!0,m=await v(A.thumbnails.url),f=!0),f&&((0,t.setStyle)(b,"display","flex"),function(r){const{width:d}=(0,e.getPosFromEvent)(I,r),{url:u,number:y,column:l,width:a,height:i}=A.thumbnails,D=a||m.naturalWidth/l,E=i||D/(o.videoWidth/o.videoHeight),S=c.clientWidth/y,L=Math.floor(d/S),x=Math.ceil(L/l)-1,g=L%l||l-1;(0,t.setStyle)(b,"backgroundImage",`url(${u})`),(0,t.setStyle)(b,"height",`${E}px`),(0,t.setStyle)(b,"width",`${D}px`),(0,t.setStyle)(b,"backgroundPosition",`-${g*D}px -${x*E}px`),d<=D/2?(0,t.setStyle)(b,"left",0):d>c.clientWidth-D/2?(0,t.setStyle)(b,"left",c.clientWidth-D+"px"):(0,t.setStyle)(b,"left",d-D/2+"px")}(n))}),h(c,"mouseleave",()=>{(0,t.setStyle)(b,"display","none")}),I.on("hover",n=>{n||(0,t.setStyle)(b,"display","none")})}})}},{"../utils":"71aH7","./progress":"bgoVP","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"4KCF5":[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){return p=>({...e,tooltip:p.i18n.get("Screenshot"),mounted:I=>{const{proxy:b,icons:A}=p;(0,t.append)(I,A.screenshot),b(I,"click",()=>{p.screenshot()})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"2hIff":[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){return p=>({...e,mounted:I=>{const b=(0,t.append)(I,'<span class="art-loop-point"></span>'),A=(0,t.append)(I,'<span class="art-loop-point"></span>');p.on("loop",c=>{c&&c.length?((0,t.setStyle)(I,"display","flex"),(0,t.setStyle)(b,"left",`calc(${c[0]/p.duration*100}% - ${b.clientWidth}px)`),(0,t.setStyle)(A,"left",c[1]/p.duration*100+"%")):(0,t.setStyle)(I,"display","none")})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"4IS2d":[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){return p=>({...e,tooltip:p.i18n.get("AirPlay"),mounted:I=>{const{proxy:b,icons:A}=p;(0,t.append)(I,A.airplay),b(I,"click",()=>p.airplay())}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"2KYsr":[function(R,M,s){var t=R("@parcel/transformer-js/src/esmodule-helpers.js");t.defineInteropFlag(s);var e=R("../utils"),p=R("../utils/component"),I=t.interopDefault(p),b=R("./playbackRate"),A=t.interopDefault(b),c=R("./aspectRatio"),o=t.interopDefault(c),h=R("./flip"),v=t.interopDefault(h),m=R("./info"),T=t.interopDefault(m),f=R("./version"),n=t.interopDefault(f),r=R("./close"),d=t.interopDefault(r);class u extends I.default{constructor(l){super(l),this.name="contextmenu",this.$parent=l.template.$contextmenu,e.isMobile||this.init()}init(){const{option:l,proxy:a,template:{$player:i,$contextmenu:D}}=this.art;l.playbackRate&&this.add((0,A.default)({name:"playbackRate",index:10})),l.aspectRatio&&this.add((0,o.default)({name:"aspectRatio",index:20})),l.flip&&this.add((0,v.default)({name:"flip",index:30})),this.add((0,T.default)({name:"info",index:40})),this.add((0,n.default)({name:"version",index:50})),this.add((0,d.default)({name:"close",index:60}));for(let E=0;E<l.contextmenu.length;E++)this.add(l.contextmenu[E]);a(i,"contextmenu",E=>{if(E.preventDefault(),!this.art.constructor.CONTEXTMENU)return;this.show=!0;const S=E.clientX,L=E.clientY,{height:x,width:g,left:O,top:P}=i.getBoundingClientRect(),{height:C,width:w}=D.getBoundingClientRect();let F=S-O,k=L-P;S+w>O+g&&(F=g-w),L+C>P+x&&(k=x-C),(0,e.setStyles)(D,{top:`${k}px`,left:`${F}px`})}),a(i,"click",E=>{(0,e.includeFromEvent)(E,D)||(this.show=!1)}),this.art.on("blur",()=>{this.show=!1})}}s.default=u},{"../utils":"71aH7","../utils/component":"18nVI","./playbackRate":"69eLi","./aspectRatio":"lUefg","./flip":"kysiM","./info":"gqIgJ","./version":"kRU7C","./close":"jQ8Pm","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"69eLi":[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){return p=>{const{i18n:I,constructor:{PLAYBACK_RATE:b}}=p,A=b.map(c=>`<span data-value="${c}">${c===1?I.get("Normal"):c.toFixed(1)}</span>`).join("");return{...e,html:`${I.get("Play Speed")}: ${A}`,click:(c,o)=>{const{value:h}=o.target.dataset;h&&(p.playbackRate=Number(h),c.show=!1)},mounted:c=>{const o=(0,t.query)('[data-value="1"]',c);o&&(0,t.inverseClass)(o,"art-current"),p.on("video:ratechange",()=>{const h=(0,t.queryAll)("span",c).find(v=>Number(v.dataset.value)===p.playbackRate);h&&(0,t.inverseClass)(h,"art-current")})}}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],lUefg:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){return p=>{const{i18n:I,constructor:{ASPECT_RATIO:b}}=p,A=b.map(c=>`<span data-value="${c}">${c==="default"?I.get("Default"):c}</span>`).join("");return{...e,html:`${I.get("Aspect Ratio")}: ${A}`,click:(c,o)=>{const{value:h}=o.target.dataset;h&&(p.aspectRatio=h,c.show=!1)},mounted:c=>{const o=(0,t.query)('[data-value="default"]',c);o&&(0,t.inverseClass)(o,"art-current"),p.on("aspectRatio",h=>{const v=(0,t.queryAll)("span",c).find(m=>m.dataset.value===h);v&&(0,t.inverseClass)(v,"art-current")})}}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],kysiM:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){return p=>{const{i18n:I,constructor:{FLIP:b}}=p,A=b.map(c=>`<span data-value="${c}">${I.get((0,t.capitalize)(c))}</span>`).join("");return{...e,html:`${I.get("Video Flip")}: ${A}`,click:(c,o)=>{const{value:h}=o.target.dataset;h&&(p.flip=h.toLowerCase(),c.show=!1)},mounted:c=>{const o=(0,t.query)('[data-value="normal"]',c);o&&(0,t.inverseClass)(o,"art-current"),p.on("flip",h=>{const v=(0,t.queryAll)("span",c).find(m=>m.dataset.value===h);v&&(0,t.inverseClass)(v,"art-current")})}}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],gqIgJ:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s),s.default=function(t){return e=>({...t,html:e.i18n.get("Video Info"),click:p=>{e.info.show=!0,p.show=!1}})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],kRU7C:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s),s.default=function(t){return{...t,html:'<a href="https://artplayer.org" target="_blank">ArtPlayer 5.0.9</a>'}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],jQ8Pm:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s),s.default=function(t){return e=>({...t,html:e.i18n.get("Close"),click:p=>{p.show=!1}})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"02ajl":[function(R,M,s){var t=R("@parcel/transformer-js/src/esmodule-helpers.js");t.defineInteropFlag(s);var e=R("./utils"),p=R("./utils/component"),I=t.interopDefault(p);class b extends I.default{constructor(c){super(c),this.name="info",e.isMobile||this.init()}init(){const{proxy:c,constructor:o,template:{$infoPanel:h,$infoClose:v,$video:m}}=this.art;c(v,"click",()=>{this.show=!1});let T=null;const f=(0,e.queryAll)("[data-video]",h)||[];this.art.on("destroy",()=>clearTimeout(T)),function n(){for(let r=0;r<f.length;r++){const d=f[r],u=m[d.dataset.video],y=typeof u=="number"?u.toFixed(2):u;d.innerText!==y&&(d.innerText=y)}T=setTimeout(n,o.INFO_LOOP_TIME)}()}}s.default=b},{"./utils":"71aH7","./utils/component":"18nVI","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],eSWto:[function(R,M,s){var t=R("@parcel/transformer-js/src/esmodule-helpers.js");t.defineInteropFlag(s);var e=R("./utils"),p=R("./utils/component"),I=t.interopDefault(p),b=R("option-validator"),A=t.interopDefault(b),c=R("./scheme"),o=t.interopDefault(c);class h extends I.default{constructor(m){super(m),this.name="subtitle",this.eventDestroy=()=>null,this.init(m.option.subtitle);let T=!1;m.on("video:timeupdate",()=>{if(!this.url)return;const f=this.art.template.$video.webkitDisplayingFullscreen;typeof f=="boolean"&&f!==T&&(T=f,this.createTrack(f?"subtitles":"metadata",this.url))})}get url(){return this.art.template.$track.src}set url(m){this.switch(m)}get textTrack(){return this.art.template.$video.textTracks[0]}get activeCue(){return this.textTrack.activeCues[0]}style(m,T){const{$subtitle:f}=this.art.template;return typeof m=="object"?(0,e.setStyles)(f,m):(0,e.setStyle)(f,m,T)}update(){const{$subtitle:m}=this.art.template;m.innerHTML="",this.activeCue&&(this.art.option.subtitle.escape?m.innerHTML=this.activeCue.text.split(/\r?\n/).map(T=>`<p>${(0,e.escape)(T)}</p>`).join(""):m.innerHTML=this.activeCue.text,this.art.emit("subtitleUpdate",this.activeCue.text))}async switch(m,T={}){const{i18n:f,notice:n,option:r}=this.art,d={...r.subtitle,...T,url:m},u=await this.init(d);return T.name&&(n.show=`${f.get("Switch Subtitle")}: ${T.name}`),u}createTrack(m,T){const{template:f,proxy:n}=this.art,{$video:r,$track:d}=f,u=(0,e.createElement)("track");u.default=!0,u.kind=m,u.src=T,u.track.mode="hidden",this.eventDestroy(),(0,e.remove)(d),(0,e.append)(r,u),f.$track=u,this.eventDestroy=n(this.textTrack,"cuechange",()=>this.update())}async init(m){const{notice:T,template:{$subtitle:f}}=this.art;if((0,A.default)(m,o.default.subtitle),m.url)return this.style(m.style),fetch(m.url).then(n=>n.arrayBuffer()).then(n=>{const r=new TextDecoder(m.encoding).decode(n);switch(this.art.emit("subtitleLoad",m.url),m.type||(0,e.getExt)(m.url)){case"srt":{const d=(0,e.srtToVtt)(r),u=m.onVttLoad(d);return(0,e.vttToBlob)(u)}case"ass":{const d=(0,e.assToVtt)(r),u=m.onVttLoad(d);return(0,e.vttToBlob)(u)}case"vtt":{const d=m.onVttLoad(r);return(0,e.vttToBlob)(d)}default:return m.url}}).then(n=>(f.innerHTML="",this.url===n||(URL.revokeObjectURL(this.url),this.createTrack("metadata",n),this.art.emit("subtitleSwitch",n)),n)).catch(n=>{throw T.show=n,n})}}s.default=h},{"./utils":"71aH7","./utils/component":"18nVI","option-validator":"bAWi2","./scheme":"AKEiO","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],jo4S1:[function(R,M,s){var t=R("@parcel/transformer-js/src/esmodule-helpers.js");t.defineInteropFlag(s);var e=R("../utils/error"),p=R("./clickInit"),I=t.interopDefault(p),b=R("./hoverInit"),A=t.interopDefault(b),c=R("./moveInit"),o=t.interopDefault(c),h=R("./resizeInit"),v=t.interopDefault(h),m=R("./gestureInit"),T=t.interopDefault(m),f=R("./viewInit"),n=t.interopDefault(f),r=R("./documentInit"),d=t.interopDefault(r);s.default=class{constructor(u){this.destroyEvents=[],this.proxy=this.proxy.bind(this),this.hover=this.hover.bind(this),this.loadImg=this.loadImg.bind(this),(0,I.default)(u,this),(0,A.default)(u,this),(0,o.default)(u,this),(0,v.default)(u,this),(0,T.default)(u,this),(0,n.default)(u,this),(0,d.default)(u,this)}proxy(u,y,l,a={}){if(Array.isArray(y))return y.map(D=>this.proxy(u,D,l,a));u.addEventListener(y,l,a);const i=()=>u.removeEventListener(y,l,a);return this.destroyEvents.push(i),i}hover(u,y,l){y&&this.proxy(u,"mouseenter",y),l&&this.proxy(u,"mouseleave",l)}loadImg(u){return new Promise((y,l)=>{let a;if(u instanceof HTMLImageElement)a=u;else{if(typeof u!="string")return l(new e.ArtPlayerError("Unable to get Image"));a=new Image,a.src=u}if(a.complete)return y(a);this.proxy(a,"load",()=>y(a)),this.proxy(a,"error",()=>l(new e.ArtPlayerError(`Failed to load Image: ${a.src}`)))})}remove(u){const y=this.destroyEvents.indexOf(u);y>-1&&(u(),this.destroyEvents.splice(y,1))}destroy(){for(let u=0;u<this.destroyEvents.length;u++)this.destroyEvents[u]()}}},{"../utils/error":"hwmZz","./clickInit":"6UrCm","./hoverInit":"4jWHi","./moveInit":"eqaUm","./resizeInit":"eDXPO","./gestureInit":"95GtS","./viewInit":"InUBx","./documentInit":"hoLfM","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6UrCm":[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e,p){const{constructor:I,template:{$player:b,$video:A}}=e;p.proxy(document,["click","contextmenu"],o=>{(0,t.includeFromEvent)(o,b)?(e.isInput=o.target.tagName==="INPUT",e.isFocus=!0,e.emit("focus",o)):(e.isInput=!1,e.isFocus=!1,e.emit("blur",o))});let c=0;p.proxy(A,"click",o=>{const h=Date.now(),{MOBILE_CLICK_PLAY:v,DBCLICK_TIME:m,MOBILE_DBCLICK_PLAY:T,DBCLICK_FULLSCREEN:f}=I;h-c<=m?(e.emit("dblclick",o),t.isMobile?!e.isLock&&T&&e.toggle():f&&(e.fullscreen=!e.fullscreen)):(e.emit("click",o),t.isMobile?!e.isLock&&v&&e.toggle():e.toggle()),c=h})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"4jWHi":[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e,p){const{$player:I}=e.template;p.hover(I,b=>{(0,t.addClass)(I,"art-hover"),e.emit("hover",!0,b)},b=>{(0,t.removeClass)(I,"art-hover"),e.emit("hover",!1,b)})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],eqaUm:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s),s.default=function(t,e){const{$player:p}=t.template;e.proxy(p,"mousemove",I=>{t.emit("mousemove",I)})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],eDXPO:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e,p){const{option:I,constructor:b}=e;e.on("resize",()=>{const{aspectRatio:c,notice:o}=e;e.state==="standard"&&I.autoSize&&e.autoSize(),e.aspectRatio=c,o.show=""});const A=(0,t.debounce)(()=>e.emit("resize"),b.RESIZE_TIME);p.proxy(window,["orientationchange","resize"],()=>A()),screen&&screen.orientation&&screen.orientation.onchange&&p.proxy(screen.orientation,"change",()=>A())}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"95GtS":[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils"),e=R("../control/progress");function p(I,b,A,c){var o=b-c,h=A-I,v=0;if(Math.abs(h)<2&&Math.abs(o)<2)return v;var m=function(T,f){return 180*Math.atan2(f,T)/Math.PI}(h,o);return m>=-45&&m<45?v=4:m>=45&&m<135?v=1:m>=-135&&m<-45?v=2:(m>=135&&m<=180||m>=-180&&m<-135)&&(v=3),v}s.default=function(I,b){if(t.isMobile&&!I.option.isLive){const{$video:A,$progress:c}=I.template;let o=null,h=!1,v=0,m=0,T=0;const f=d=>{if(d.touches.length===1&&!I.isLock){o===c&&(0,e.setCurrentTime)(I,d),h=!0;const{pageX:u,pageY:y}=d.touches[0];v=u,m=y,T=I.currentTime}},n=d=>{if(d.touches.length===1&&h&&I.duration){const{pageX:u,pageY:y}=d.touches[0],l=p(v,m,u,y),a=[3,4].includes(l),i=[1,2].includes(l);if(a&&!I.isRotate||i&&I.isRotate){const D=(0,t.clamp)((u-v)/I.width,-1,1),E=(0,t.clamp)((y-m)/I.height,-1,1),S=I.isRotate?E:D,L=o===A?I.constructor.TOUCH_MOVE_RATIO:1,x=(0,t.clamp)(T+I.duration*S*L,0,I.duration);I.seek=x,I.emit("setBar","played",(0,t.clamp)(x/I.duration,0,1)),I.notice.show=`${(0,t.secondToTime)(x)} / ${(0,t.secondToTime)(I.duration)}`}}},r=()=>{h&&(v=0,m=0,T=0,h=!1,o=null)};b.proxy(c,"touchstart",d=>{o=c,f(d)}),b.proxy(A,"touchstart",d=>{o=A,f(d)}),b.proxy(A,"touchmove",n),b.proxy(c,"touchmove",n),b.proxy(document,"touchend",r)}}},{"../utils":"71aH7","../control/progress":"bgoVP","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],InUBx:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e,p){const{option:I,constructor:b,template:{$container:A}}=e,c=(0,t.throttle)(()=>{e.emit("view",(0,t.isInViewport)(A,b.SCROLL_GAP))},b.SCROLL_TIME);p.proxy(window,"scroll",()=>c()),e.on("view",o=>{I.autoMini&&(e.mini=!o)})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],hoLfM:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s),s.default=function(t,e){e.proxy(document,"mousemove",p=>{t.emit("document:mousemove",p)}),e.proxy(document,"mouseup",p=>{t.emit("document:mouseup",p)})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6NoFy":[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("./utils");s.default=class{constructor(e){this.art=e,this.keys={},e.option.hotkey&&!t.isMobile&&this.init()}init(){const{proxy:e,constructor:p}=this.art;this.add(27,()=>{this.art.fullscreenWeb&&(this.art.fullscreenWeb=!1)}),this.add(32,()=>{this.art.toggle()}),this.add(37,()=>{this.art.backward=p.SEEK_STEP}),this.add(38,()=>{this.art.volume+=p.VOLUME_STEP}),this.add(39,()=>{this.art.forward=p.SEEK_STEP}),this.add(40,()=>{this.art.volume-=p.VOLUME_STEP}),e(window,"keydown",I=>{if(this.art.isFocus){const b=document.activeElement.tagName.toUpperCase(),A=document.activeElement.getAttribute("contenteditable");if(b!=="INPUT"&&b!=="TEXTAREA"&&A!==""&&A!=="true"){const c=this.keys[I.keyCode];if(c){I.preventDefault();for(let o=0;o<c.length;o++)c[o].call(this.art,I);this.art.emit("hotkey",I)}}}})}add(e,p){return this.keys[e]?this.keys[e].push(p):this.keys[e]=[p],this}remove(e,p){if(this.keys[e]){const I=this.keys[e].indexOf(p);I!==-1&&this.keys[e].splice(I,1)}return this}}},{"./utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6G6hZ":[function(R,M,s){var t=R("@parcel/transformer-js/src/esmodule-helpers.js");t.defineInteropFlag(s);var e=R("./utils/component"),p=t.interopDefault(e);class I extends p.default{constructor(A){super(A);const{option:c,template:{$layer:o}}=A;this.name="layer",this.$parent=o;for(let h=0;h<c.layers.length;h++)this.add(c.layers[h])}}s.default=I},{"./utils/component":"18nVI","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"3dsEe":[function(R,M,s){var t=R("@parcel/transformer-js/src/esmodule-helpers.js");t.defineInteropFlag(s);var e=R("./utils"),p=R("./utils/component"),I=t.interopDefault(p);class b extends I.default{constructor(c){super(c),this.name="loading",(0,e.append)(c.template.$loading,c.icons.loading)}}s.default=b},{"./utils":"71aH7","./utils/component":"18nVI","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],dWGTw:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("./utils");s.default=class{constructor(e){this.art=e,this.timer=null}set show(e){const{constructor:p,template:{$player:I,$noticeInner:b}}=this.art;e?(b.innerText=e instanceof Error?e.message.trim():e,(0,t.addClass)(I,"art-notice-show"),clearTimeout(this.timer),this.timer=setTimeout(()=>{b.innerText="",(0,t.removeClass)(I,"art-notice-show")},p.NOTICE_TIME)):(0,t.removeClass)(I,"art-notice-show")}}},{"./utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"5POkG":[function(R,M,s){var t=R("@parcel/transformer-js/src/esmodule-helpers.js");t.defineInteropFlag(s);var e=R("./utils"),p=R("./utils/component"),I=t.interopDefault(p);class b extends I.default{constructor(c){super(c),this.name="mask";const{template:o,icons:h,events:v}=c,m=(0,e.append)(o.$state,h.state),T=(0,e.append)(o.$state,h.error);(0,e.setStyle)(T,"display","none"),c.on("destroy",()=>{(0,e.setStyle)(m,"display","none"),(0,e.setStyle)(T,"display",null)}),v.proxy(o.$state,"click",()=>c.play())}}s.default=b},{"./utils":"71aH7","./utils/component":"18nVI","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6OeNg":[function(R,M,s){var t=R("@parcel/transformer-js/src/esmodule-helpers.js");t.defineInteropFlag(s);var e=R("../utils"),p=R("bundle-text:./loading.svg"),I=t.interopDefault(p),b=R("bundle-text:./state.svg"),A=t.interopDefault(b),c=R("bundle-text:./check.svg"),o=t.interopDefault(c),h=R("bundle-text:./play.svg"),v=t.interopDefault(h),m=R("bundle-text:./pause.svg"),T=t.interopDefault(m),f=R("bundle-text:./volume.svg"),n=t.interopDefault(f),r=R("bundle-text:./volume-close.svg"),d=t.interopDefault(r),u=R("bundle-text:./screenshot.svg"),y=t.interopDefault(u),l=R("bundle-text:./setting.svg"),a=t.interopDefault(l),i=R("bundle-text:./arrow-left.svg"),D=t.interopDefault(i),E=R("bundle-text:./arrow-right.svg"),S=t.interopDefault(E),L=R("bundle-text:./playback-rate.svg"),x=t.interopDefault(L),g=R("bundle-text:./aspect-ratio.svg"),O=t.interopDefault(g),P=R("bundle-text:./config.svg"),C=t.interopDefault(P),w=R("bundle-text:./pip.svg"),F=t.interopDefault(w),k=R("bundle-text:./lock.svg"),_=t.interopDefault(k),B=R("bundle-text:./unlock.svg"),N=t.interopDefault(B),U=R("bundle-text:./fullscreen-off.svg"),j=t.interopDefault(U),W=R("bundle-text:./fullscreen-on.svg"),H=t.interopDefault(W),G=R("bundle-text:./fullscreen-web-off.svg"),K=t.interopDefault(G),X=R("bundle-text:./fullscreen-web-on.svg"),Z=t.interopDefault(X),z=R("bundle-text:./switch-on.svg"),V=t.interopDefault(z),Y=R("bundle-text:./switch-off.svg"),Q=t.interopDefault(Y),$=R("bundle-text:./flip.svg"),J=t.interopDefault($),tt=R("bundle-text:./error.svg"),rt=t.interopDefault(tt),nt=R("bundle-text:./close.svg"),it=t.interopDefault(nt),at=R("bundle-text:./airplay.svg"),ut=t.interopDefault(at);s.default=class{constructor(dt){const st={loading:I.default,state:A.default,play:v.default,pause:T.default,check:o.default,volume:n.default,volumeClose:d.default,screenshot:y.default,setting:a.default,pip:F.default,arrowLeft:D.default,arrowRight:S.default,playbackRate:x.default,aspectRatio:O.default,config:C.default,lock:_.default,flip:J.default,unlock:N.default,fullscreenOff:j.default,fullscreenOn:H.default,fullscreenWebOff:K.default,fullscreenWebOn:Z.default,switchOn:V.default,switchOff:Q.default,error:rt.default,close:it.default,airplay:ut.default,...dt.option.icons};for(const yt in st)(0,e.def)(this,yt,{get:()=>(0,e.getIcon)(yt,st[yt])})}}},{"../utils":"71aH7","bundle-text:./loading.svg":"7tDub","bundle-text:./state.svg":"1ElZc","bundle-text:./check.svg":"lmgoP","bundle-text:./play.svg":"lVWoQ","bundle-text:./pause.svg":"5Mnax","bundle-text:./volume.svg":"w3eIa","bundle-text:./volume-close.svg":"rHjo1","bundle-text:./screenshot.svg":"2KcqM","bundle-text:./setting.svg":"8rQMV","bundle-text:./arrow-left.svg":"kqGBE","bundle-text:./arrow-right.svg":"aFjpC","bundle-text:./playback-rate.svg":"lx7ZM","bundle-text:./aspect-ratio.svg":"2sEjf","bundle-text:./config.svg":"fQTgE","bundle-text:./pip.svg":"2CaxO","bundle-text:./lock.svg":"aCGnW","bundle-text:./unlock.svg":"bTrAV","bundle-text:./fullscreen-off.svg":"bA3p0","bundle-text:./fullscreen-on.svg":"fTuY8","bundle-text:./fullscreen-web-off.svg":"tvKf4","bundle-text:./fullscreen-web-on.svg":"1F1oB","bundle-text:./switch-on.svg":"7qNHs","bundle-text:./switch-off.svg":"28aV8","bundle-text:./flip.svg":"1uXI6","bundle-text:./error.svg":"9f4dh","bundle-text:./close.svg":"4nTtS","bundle-text:./airplay.svg":"cDPXC","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"7tDub":[function(R,M,s){M.exports='<svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="uil-default"><path fill="none" class="bk" d="M0 0h100v100H0z"/><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="translate(0 -30)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-1s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(30 105.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.9166666666666666s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(60 75.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.8333333333333334s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(90 65 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.75s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(120 58.66 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.6666666666666666s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(150 54.02 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.5833333333333334s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(180 50 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.5s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-150 45.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.4166666666666667s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-120 41.34 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.3333333333333333s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-90 35 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.25s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-60 24.02 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.16666666666666666s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-30 -5.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.08333333333333333s" repeatCount="indefinite"/></rect></svg>'},{}],"1ElZc":[function(R,M,s){M.exports='<svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 24 24"><path fill="#fff" d="M9.5 9.325v5.35q0 .575.525.875t1.025-.05l4.15-2.65q.475-.3.475-.85t-.475-.85L11.05 8.5q-.5-.35-1.025-.05t-.525.875ZM12 22q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22Z"/></svg>'},{}],lmgoP:[function(R,M,s){M.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width:100%;height:100%"><path d="M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z" fill="#fff"/></svg>'},{}],lVWoQ:[function(R,M,s){M.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M17.982 9.275 8.06 3.27A2.013 2.013 0 0 0 5 4.994v12.011a2.017 2.017 0 0 0 3.06 1.725l9.922-6.005a2.017 2.017 0 0 0 0-3.45z"/></svg>'},{}],"5Mnax":[function(R,M,s){M.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M7 3a2 2 0 0 0-2 2v12a2 2 0 1 0 4 0V5a2 2 0 0 0-2-2zm8 0a2 2 0 0 0-2 2v12a2 2 0 1 0 4 0V5a2 2 0 0 0-2-2z"/></svg>'},{}],w3eIa:[function(R,M,s){M.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M10.188 4.65 6 8H5a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h1l4.188 3.35a.5.5 0 0 0 .812-.39V5.04a.498.498 0 0 0-.812-.39zm4.258-.872a1 1 0 0 0-.862 1.804 6.002 6.002 0 0 1-.007 10.838 1 1 0 0 0 .86 1.806A8.001 8.001 0 0 0 19 11a8.001 8.001 0 0 0-4.554-7.222z"/><path d="M15 11a3.998 3.998 0 0 0-2-3.465v6.93A3.998 3.998 0 0 0 15 11z"/></svg>'},{}],rHjo1:[function(R,M,s){M.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M15 11a3.998 3.998 0 0 0-2-3.465v2.636l1.865 1.865A4.02 4.02 0 0 0 15 11z"/><path d="M13.583 5.583A5.998 5.998 0 0 1 17 11a6 6 0 0 1-.585 2.587l1.477 1.477a8.001 8.001 0 0 0-3.446-11.286 1 1 0 0 0-.863 1.805zm5.195 13.195-2.121-2.121-1.414-1.414-1.415-1.415L13 13l-2-2-3.889-3.889-3.889-3.889a.999.999 0 1 0-1.414 1.414L5.172 8H5a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h1l4.188 3.35a.5.5 0 0 0 .812-.39v-3.131l2.587 2.587-.01.005a1 1 0 0 0 .86 1.806c.215-.102.424-.214.627-.333l2.3 2.3a1.001 1.001 0 0 0 1.414-1.416zM11 5.04a.5.5 0 0 0-.813-.39L8.682 5.854 11 8.172V5.04z"/></svg>'},{}],"2KcqM":[function(R,M,s){M.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 50 50"><path d="M19.402 6a5 5 0 0 0-4.902 4.012L14.098 12H9a5 5 0 0 0-5 5v21a5 5 0 0 0 5 5h32a5 5 0 0 0 5-5V17a5 5 0 0 0-5-5h-5.098l-.402-1.988A5 5 0 0 0 30.598 6ZM25 17c5.52 0 10 4.48 10 10s-4.48 10-10 10-10-4.48-10-10 4.48-10 10-10Zm0 2c-4.41 0-8 3.59-8 8s3.59 8 8 8 8-3.59 8-8-3.59-8-8-8Z"/></svg>'},{}],"8rQMV":[function(R,M,s){M.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><circle cx="11" cy="11" r="2"/><path d="M19.164 8.861 17.6 8.6a6.978 6.978 0 0 0-1.186-2.099l.574-1.533a1 1 0 0 0-.436-1.217l-1.997-1.153a1.001 1.001 0 0 0-1.272.23l-1.008 1.225a7.04 7.04 0 0 0-2.55.001L8.716 2.829a1 1 0 0 0-1.272-.23L5.447 3.751a1 1 0 0 0-.436 1.217l.574 1.533A6.997 6.997 0 0 0 4.4 8.6l-1.564.261A.999.999 0 0 0 2 9.847v2.306c0 .489.353.906.836.986l1.613.269a7 7 0 0 0 1.228 2.075l-.558 1.487a1 1 0 0 0 .436 1.217l1.997 1.153c.423.244.961.147 1.272-.23l1.04-1.263a7.089 7.089 0 0 0 2.272 0l1.04 1.263a1 1 0 0 0 1.272.23l1.997-1.153a1 1 0 0 0 .436-1.217l-.557-1.487c.521-.61.94-1.31 1.228-2.075l1.613-.269a.999.999 0 0 0 .835-.986V9.847a.999.999 0 0 0-.836-.986zM11 15a4 4 0 1 1 0-8 4 4 0 0 1 0 8z"/></svg>'},{}],kqGBE:[function(R,M,s){M.exports='<svg xmlns="http://www.w3.org/2000/svg" height="32" width="32"><path d="m19.41 20.09-4.58-4.59 4.58-4.59L18 9.5l-6 6 6 6z" fill="#fff"/></svg>'},{}],aFjpC:[function(R,M,s){M.exports='<svg xmlns="http://www.w3.org/2000/svg" height="32" width="32"><path d="m12.59 20.34 4.58-4.59-4.58-4.59L14 9.75l6 6-6 6z" fill="#fff"/></svg>'},{}],lx7ZM:[function(R,M,s){M.exports='<svg height="24" width="24"><path d="M10 8v8l6-4-6-4zM6.3 5l-.6-.8C7.2 3 9 2.2 11 2l.1 1c-1.8.2-3.4.9-4.8 2zM5 6.3l-.8-.6C3 7.2 2.2 9 2 11l1 .1c.2-1.8.9-3.4 2-4.8zm0 11.4c-1.1-1.4-1.8-3.1-2-4.8L2 13c.2 2 1 3.8 2.2 5.4l.8-.7zm6.1 3.3c-1.8-.2-3.4-.9-4.8-2l-.6.8C7.2 21 9 21.8 11 22l.1-1zM22 12c0-5.2-3.9-9.4-9-10l-.1 1c4.6.5 8.1 4.3 8.1 9s-3.5 8.5-8.1 9l.1 1c5.2-.5 9-4.8 9-10z" fill="#fff" style="--darkreader-inline-fill:#a8a6a4"/></svg>'},{}],"2sEjf":[function(R,M,s){M.exports=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 88 88" style="width:100%;height:100%;transform:translate(0,0)"><defs><clipPath id="__lottie_element_216"><path d="M0 0h88v88H0z"/></clipPath></defs><g style="display:block" clip-path="url('#__lottie_element_216')"><path fill="#FFF" d="m12.438-12.702-2.82 2.82c-.79.79-.79 2.05 0 2.83l7.07 7.07-7.07 7.07c-.79.79-.79 2.05 0 2.83l2.82 2.83c.79.78 2.05.78 2.83 0l11.32-11.31c.78-.78.78-2.05 0-2.83l-11.32-11.31c-.78-.79-2.04-.79-2.83 0zm-24.88 0c-.74-.74-1.92-.78-2.7-.12l-.13.12-11.31 11.31a2 2 0 0 0-.12 2.7l.12.13 11.31 11.31a2 2 0 0 0 2.7.12l.13-.12 2.83-2.83c.74-.74.78-1.91.11-2.7l-.11-.13-7.07-7.07 7.07-7.07c.74-.74.78-1.91.11-2.7l-.11-.13-2.83-2.82zM28-28c4.42 0 8 3.58 8 8v40c0 4.42-3.58 8-8 8h-56c-4.42 0-8-3.58-8-8v-40c0-4.42 3.58-8 8-8h56z" style="--darkreader-inline-fill:#a8a6a4" transform="translate(44 44)"/></g></svg>`},{}],fQTgE:[function(R,M,s){M.exports='<svg height="24" width="24"><path d="M15 17h6v1h-6v-1zm-4 0H3v1h8v2h1v-5h-1v2zm3-9h1V3h-1v2H3v1h11v2zm4-3v1h3V5h-3zM6 14h1V9H6v2H3v1h3v2zm4-2h11v-1H10v1z" fill="#fff" style="--darkreader-inline-fill:#a8a6a4"/></svg>'},{}],"2CaxO":[function(R,M,s){M.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36" height="32" width="32"><path d="M25 17h-8v6h8v-6Zm4 8V10.98C29 9.88 28.1 9 27 9H9c-1.1 0-2 .88-2 1.98V25c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2Zm-2 .02H9V10.97h18v14.05Z"/></svg>'},{}],aCGnW:[function(R,M,s){M.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="20" height="20"><path d="M298.667 426.667v-85.334a213.333 213.333 0 1 1 426.666 0v85.334H768A85.333 85.333 0 0 1 853.333 512v256A85.333 85.333 0 0 1 768 853.333H256A85.333 85.333 0 0 1 170.667 768V512A85.333 85.333 0 0 1 256 426.667h42.667zM512 213.333a128 128 0 0 0-128 128v85.334h256v-85.334a128 128 0 0 0-128-128z" fill="#fff"/></svg>'},{}],bTrAV:[function(R,M,s){M.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="20" height="20"><path d="m666.752 194.517-49.365 74.112A128 128 0 0 0 384 341.333l.043 85.334h384A85.333 85.333 0 0 1 853.376 512v256a85.333 85.333 0 0 1-85.333 85.333H256A85.333 85.333 0 0 1 170.667 768V512A85.333 85.333 0 0 1 256 426.667h42.667v-85.334a213.333 213.333 0 0 1 368.085-146.816z" fill="#fff"/></svg>'},{}],bA3p0:[function(R,M,s){M.exports='<svg class="icon" width="22" height="22" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M768 298.667h170.667V384h-256V128H768v170.667zM341.333 384h-256v-85.333H256V128h85.333v256zM768 725.333V896h-85.333V640h256v85.333H768zM341.333 640v256H256V725.333H85.333V640h256z"/></svg>'},{}],fTuY8:[function(R,M,s){M.exports='<svg class="icon" width="22" height="22" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M625.778 256H768v142.222h113.778v-256h-256V256zM256 398.222V256h142.222V142.222h-256v256H256zm512 227.556V768H625.778v113.778h256v-256H768zM398.222 768H256V625.778H142.222v256h256V768z"/></svg>'},{}],tvKf4:[function(R,M,s){M.exports='<svg class="icon" width="18" height="18" viewBox="0 0 1152 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M1075.2 0H76.8A76.8 76.8 0 0 0 0 76.8v870.4a76.8 76.8 0 0 0 76.8 76.8h998.4a76.8 76.8 0 0 0 76.8-76.8V76.8A76.8 76.8 0 0 0 1075.2 0zM1024 128v768H128V128h896zM896 512a64 64 0 0 1 7.488 127.552L896 640H768v128a64 64 0 0 1-56.512 63.552L704 832a64 64 0 0 1-63.552-56.512L640 768V582.592c0-34.496 25.024-66.112 61.632-70.208l8-.384H896zm-640 0a64 64 0 0 1-7.488-127.552L256 384h128V256a64 64 0 0 1 56.512-63.552L448 192a64 64 0 0 1 63.552 56.512L512 256v185.408c0 34.432-25.024 66.112-61.632 70.144l-8 .448H256z"/></svg>'},{}],"1F1oB":[function(R,M,s){M.exports='<svg class="icon" width="18" height="18" viewBox="0 0 1152 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M1075.2 0H76.8A76.8 76.8 0 0 0 0 76.8v870.4a76.8 76.8 0 0 0 76.8 76.8h998.4a76.8 76.8 0 0 0 76.8-76.8V76.8A76.8 76.8 0 0 0 1075.2 0zM1024 128v768H128V128h896zm-576 64a64 64 0 0 1 7.488 127.552L448 320H320v128a64 64 0 0 1-56.512 63.552L256 512a64 64 0 0 1-63.552-56.512L192 448V262.592c0-34.432 25.024-66.112 61.632-70.144l8-.448H448zm256 640a64 64 0 0 1-7.488-127.552L704 704h128V576a64 64 0 0 1 56.512-63.552L896 512a64 64 0 0 1 63.552 56.512L960 576v185.408c0 34.496-25.024 66.112-61.632 70.208l-8 .384H704z"/></svg>'},{}],"7qNHs":[function(R,M,s){M.exports='<svg class="icon" width="26" height="26" viewBox="0 0 1664 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#648FFC" d="M1152 0H512a512 512 0 0 0 0 1024h640a512 512 0 0 0 0-1024zm0 960a448 448 0 1 1 448-448 448 448 0 0 1-448 448z"/></svg>'},{}],"28aV8":[function(R,M,s){M.exports='<svg class="icon" width="26" height="26" viewBox="0 0 1740 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M511.898 1024h670.515c282.419-.41 511.18-229.478 511.18-511.898 0-282.419-228.761-511.488-511.18-511.897H511.898C229.478.615.717 229.683.717 512.102c0 282.42 228.761 511.488 511.18 511.898zm-.564-975.36A464.589 464.589 0 1 1 48.026 513.024 463.872 463.872 0 0 1 511.334 48.435v.205z"/></svg>'},{}],"1uXI6":[function(R,M,s){M.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="24" height="24"><path d="M554.667 810.667V896h-85.334v-85.333h85.334zm-384-632.662a42.667 42.667 0 0 1 34.986 18.219l203.904 291.328a42.667 42.667 0 0 1 0 48.896L205.611 827.776A42.667 42.667 0 0 1 128 803.328V220.672a42.667 42.667 0 0 1 42.667-42.667zm682.666 0a42.667 42.667 0 0 1 42.368 37.718l.299 4.949v582.656a42.667 42.667 0 0 1-74.24 28.63l-3.413-4.182-203.904-291.328a42.667 42.667 0 0 1-3.03-43.861l3.03-5.035 203.946-291.328a42.667 42.667 0 0 1 34.944-18.219zM554.667 640v85.333h-85.334V640h85.334zm-358.4-320.896V716.8L335.957 512 196.31 319.104zm358.4 150.23v85.333h-85.334v-85.334h85.334zm0-170.667V384h-85.334v-85.333h85.334zm0-170.667v85.333h-85.334V128h85.334z" fill="#fff"/></svg>'},{}],"9f4dh":[function(R,M,s){M.exports='<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="50" height="50"><path d="M593.818 168.55 949.82 763.76c26.153 43.746 10.732 99.738-34.447 125.052-14.397 8.069-30.72 12.308-47.37 12.308H155.976c-52.224 0-94.536-40.96-94.536-91.505 0-16.097 4.383-31.928 12.718-45.875l356.004-595.19c26.173-43.724 84.009-58.654 129.208-33.341a93.082 93.082 0 0 1 34.448 33.341zM512 819.2a61.44 61.44 0 1 0 0-122.88 61.44 61.44 0 0 0 0 122.88zm0-512a72.315 72.315 0 0 0-71.762 81.306l25.723 205.721a46.408 46.408 0 0 0 92.078 0l25.723-205.742A72.315 72.315 0 0 0 512 307.2z"/></svg>'},{}],"4nTtS":[function(R,M,s){M.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="22" height="22"><path d="m571.733 512 268.8-268.8c17.067-17.067 17.067-42.667 0-59.733-17.066-17.067-42.666-17.067-59.733 0L512 452.267l-268.8-268.8c-17.067-17.067-42.667-17.067-59.733 0-17.067 17.066-17.067 42.666 0 59.733l268.8 268.8-268.8 268.8c-17.067 17.067-17.067 42.667 0 59.733 8.533 8.534 19.2 12.8 29.866 12.8s21.334-4.266 29.867-12.8l268.8-268.8 268.8 268.8c8.533 8.534 19.2 12.8 29.867 12.8s21.333-4.266 29.866-12.8c17.067-17.066 17.067-42.666 0-59.733L571.733 512z"/></svg>'},{}],cDPXC:[function(R,M,s){M.exports='<svg width="18" height="18" xmlns="http://www.w3.org/2000/svg"><g fill="#fff"><path d="M16 1H2a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h3v-2H3V3h12v8h-2v2h3a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1Z"/><path d="M4 17h10l-5-6z"/></g></svg>'},{}],"3eYNH":[function(R,M,s){var t=R("@parcel/transformer-js/src/esmodule-helpers.js");t.defineInteropFlag(s);var e=R("./flip"),p=t.interopDefault(e),I=R("./aspectRatio"),b=t.interopDefault(I),A=R("./playbackRate"),c=t.interopDefault(A),o=R("./subtitleOffset"),h=t.interopDefault(o),v=R("../utils/component"),m=t.interopDefault(v),T=R("../utils/error"),f=R("../utils");class n extends m.default{constructor(d){super(d);const{option:u,controls:y,template:{$setting:l}}=d;this.name="setting",this.$parent=l,this.option=[],this.events=[],this.cache=new Map,u.setting&&(this.init(),d.on("blur",()=>{this.show&&(this.show=!1,this.render(this.option))}),d.on("focus",a=>{const i=(0,f.includeFromEvent)(a,y.setting),D=(0,f.includeFromEvent)(a,this.$parent);!this.show||i||D||(this.show=!1,this.render(this.option))}))}static makeRecursion(d,u,y){for(let l=0;l<d.length;l++){const a=d[l];a.$parentItem=u,a.$parentList=y,n.makeRecursion(a.selector||[],a,d)}return d}get defaultSettings(){const d=[],{option:u}=this.art;return u.playbackRate&&d.push((0,c.default)(this.art)),u.aspectRatio&&d.push((0,b.default)(this.art)),u.flip&&d.push((0,p.default)(this.art)),u.subtitleOffset&&d.push((0,h.default)(this.art)),d}init(){const{option:d}=this.art,u=[...this.defaultSettings,...d.settings];this.option=n.makeRecursion(u),this.destroy(),this.render(this.option)}destroy(){for(let d=0;d<this.events.length;d++)this.art.events.remove(this.events[d]);this.$parent.innerHTML="",this.events=[],this.cache=new Map}find(d="",u=this.option){for(let y=0;y<u.length;y++){const l=u[y];if(l.name===d)return l;{const a=this.find(d,l.selector||[]);if(a)return a}}}remove(d){var l;const u=this.find(d);(0,T.errorHandle)(u,`Can't find [${d}] from the [setting]`);const y=((l=u.$parentItem)==null?void 0:l.selector)||this.option;return y.splice(y.indexOf(u),1),this.option=n.makeRecursion(this.option),this.destroy(),this.render(this.option),this.option}update(d){const u=this.find(d.name);return u?(Object.assign(u,d),this.option=n.makeRecursion(this.option),this.destroy(),this.render(this.option)):this.add(d),this.option}add(d){return this.option.push(d),this.option=n.makeRecursion(this.option),this.destroy(),this.render(this.option),this.option}creatHeader(d){const{icons:u,proxy:y,constructor:l}=this.art,a=(0,f.createElement)("div");(0,f.setStyle)(a,"height",`${l.SETTING_ITEM_HEIGHT}px`),(0,f.addClass)(a,"art-setting-item"),(0,f.addClass)(a,"art-setting-item-back");const i=(0,f.append)(a,'<div class="art-setting-item-left"></div>'),D=(0,f.createElement)("div");(0,f.addClass)(D,"art-setting-item-left-icon"),(0,f.append)(D,u.arrowLeft),(0,f.append)(i,D),(0,f.append)(i,d.$parentItem.html);const E=y(a,"click",()=>this.render(d.$parentList));return this.events.push(E),a}creatItem(d,u){const{icons:y,proxy:l,constructor:a}=this.art,i=(0,f.createElement)("div");(0,f.addClass)(i,"art-setting-item"),(0,f.setStyle)(i,"height",`${a.SETTING_ITEM_HEIGHT}px`),(0,f.isStringOrNumber)(u.name)&&(i.dataset.name=u.name),(0,f.isStringOrNumber)(u.value)&&(i.dataset.value=u.value);const D=(0,f.append)(i,'<div class="art-setting-item-left"></div>'),E=(0,f.append)(i,'<div class="art-setting-item-right"></div>'),S=(0,f.createElement)("div");switch((0,f.addClass)(S,"art-setting-item-left-icon"),d){case"switch":case"range":(0,f.append)(S,(0,f.isStringOrNumber)(u.icon)||u.icon instanceof Element?u.icon:y.config);break;case"selector":u.selector&&u.selector.length?(0,f.append)(S,(0,f.isStringOrNumber)(u.icon)||u.icon instanceof Element?u.icon:y.config):(0,f.append)(S,y.check)}(0,f.append)(D,S),u.$icon=S,(0,f.def)(u,"icon",{configurable:!0,get:()=>S.innerHTML,set(g){(0,f.isStringOrNumber)(g)&&(S.innerHTML=g)}});const L=(0,f.createElement)("div");(0,f.addClass)(L,"art-setting-item-left-text"),(0,f.append)(L,u.html||""),(0,f.append)(D,L),u.$html=L,(0,f.def)(u,"html",{configurable:!0,get:()=>L.innerHTML,set(g){(0,f.isStringOrNumber)(g)&&(L.innerHTML=g)}});const x=(0,f.createElement)("div");switch((0,f.addClass)(x,"art-setting-item-right-tooltip"),(0,f.append)(x,u.tooltip||""),(0,f.append)(E,x),u.$tooltip=x,(0,f.def)(u,"tooltip",{configurable:!0,get:()=>x.innerHTML,set(g){(0,f.isStringOrNumber)(g)&&(x.innerHTML=g)}}),d){case"switch":{const g=(0,f.createElement)("div");(0,f.addClass)(g,"art-setting-item-right-icon");const O=(0,f.append)(g,y.switchOn),P=(0,f.append)(g,y.switchOff);(0,f.setStyle)(u.switch?P:O,"display","none"),(0,f.append)(E,g),u.$switch=u.switch,(0,f.def)(u,"switch",{configurable:!0,get:()=>u.$switch,set(C){u.$switch=C,C?((0,f.setStyle)(P,"display","none"),(0,f.setStyle)(O,"display",null)):((0,f.setStyle)(P,"display",null),(0,f.setStyle)(O,"display","none"))}});break}case"range":{const g=(0,f.createElement)("div");(0,f.addClass)(g,"art-setting-item-right-icon");const O=(0,f.append)(g,'<input type="range">');O.value=u.range[0]||0,O.min=u.range[1]||0,O.max=u.range[2]||10,O.step=u.range[3]||1,(0,f.addClass)(O,"art-setting-range"),(0,f.append)(E,g),u.$range=O,(0,f.def)(u,"range",{configurable:!0,get:()=>O.valueAsNumber,set(P){O.value=Number(P)}})}break;case"selector":if(u.selector&&u.selector.length){const g=(0,f.createElement)("div");(0,f.addClass)(g,"art-setting-item-right-icon"),(0,f.append)(g,y.arrowRight),(0,f.append)(E,g)}}switch(d){case"switch":if(u.onSwitch){const g=l(i,"click",async O=>{u.switch=await u.onSwitch.call(this.art,u,i,O)});this.events.push(g)}break;case"range":if(u.$range){if(u.onRange){const g=l(u.$range,"change",async O=>{u.tooltip=await u.onRange.call(this.art,u,i,O)});this.events.push(g)}if(u.onChange){const g=l(u.$range,"input",async O=>{u.tooltip=await u.onChange.call(this.art,u,i,O)});this.events.push(g)}}break;case"selector":{const g=l(i,"click",async O=>{if(u.selector&&u.selector.length)this.render(u.selector,u.width);else{(0,f.inverseClass)(i,"art-current");for(let P=0;P<u.$parentItem.selector.length;P++){const C=u.$parentItem.selector[P];C.default=C===u}if(u.$parentList&&this.render(u.$parentList),u.$parentItem&&u.$parentItem.onSelect){const P=await u.$parentItem.onSelect.call(this.art,u,i,O);u.$parentItem.$tooltip&&(0,f.isStringOrNumber)(P)&&(u.$parentItem.$tooltip.innerHTML=P)}}});this.events.push(g),u.default&&(0,f.addClass)(i,"art-current")}}return i}updateStyle(d){const{controls:u,constructor:y,template:{$player:l,$setting:a}}=this.art;if(u.setting&&!f.isMobile){const i=d||y.SETTING_WIDTH,{left:D,width:E}=u.setting.getBoundingClientRect(),{left:S,width:L}=l.getBoundingClientRect(),x=D-S+E/2-i/2;x+i>L?((0,f.setStyle)(a,"left",null),(0,f.setStyle)(a,"right",null)):((0,f.setStyle)(a,"left",`${x}px`),(0,f.setStyle)(a,"right","auto"))}}render(d,u){const{constructor:y}=this.art;if(this.cache.has(d)){const l=this.cache.get(d);(0,f.inverseClass)(l,"art-current"),(0,f.setStyle)(this.$parent,"width",`${l.dataset.width}px`),(0,f.setStyle)(this.$parent,"height",`${l.dataset.height}px`),this.updateStyle(Number(l.dataset.width))}else{const l=(0,f.createElement)("div");(0,f.addClass)(l,"art-setting-panel"),l.dataset.width=u||y.SETTING_WIDTH,l.dataset.height=d.length*y.SETTING_ITEM_HEIGHT,d[0]&&d[0].$parentItem&&((0,f.append)(l,this.creatHeader(d[0])),l.dataset.height=Number(l.dataset.height)+y.SETTING_ITEM_HEIGHT);for(let a=0;a<d.length;a++){const i=d[a];(0,f.has)(i,"switch")?(0,f.append)(l,this.creatItem("switch",i)):(0,f.has)(i,"range")?(0,f.append)(l,this.creatItem("range",i)):(0,f.append)(l,this.creatItem("selector",i))}(0,f.append)(this.$parent,l),this.cache.set(d,l),(0,f.inverseClass)(l,"art-current"),(0,f.setStyle)(this.$parent,"width",`${l.dataset.width}px`),(0,f.setStyle)(this.$parent,"height",`${l.dataset.height}px`),this.updateStyle(Number(l.dataset.width)),d[0]&&d[0].$parentItem&&d[0].$parentItem.mounted&&d[0].$parentItem.mounted.call(this.art,l,d[0].$parentItem)}}}s.default=n},{"./flip":"kONUB","./aspectRatio":"84NBV","./playbackRate":"aetWt","./subtitleOffset":"fIBkO","../utils/component":"18nVI","../utils/error":"hwmZz","../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],kONUB:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){const{i18n:p,icons:I,constructor:{SETTING_ITEM_WIDTH:b,FLIP:A}}=e;function c(o,h,v){h&&(h.innerText=p.get((0,t.capitalize)(v)));const m=(0,t.queryAll)(".art-setting-item",o).find(T=>T.dataset.value===v);m&&(0,t.inverseClass)(m,"art-current")}return{width:b,name:"flip",html:p.get("Video Flip"),tooltip:p.get((0,t.capitalize)(e.flip)),icon:I.flip,selector:A.map(o=>({value:o,name:`aspect-ratio-${o}`,default:o===e.flip,html:p.get((0,t.capitalize)(o))})),onSelect:o=>(e.flip=o.value,o.html),mounted:(o,h)=>{c(o,h.$tooltip,e.flip),e.on("flip",()=>{c(o,h.$tooltip,e.flip)})}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"84NBV":[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){const{i18n:p,icons:I,constructor:{SETTING_ITEM_WIDTH:b,ASPECT_RATIO:A}}=e;function c(h){return h==="default"?p.get("Default"):h}function o(h,v,m){v&&(v.innerText=c(m));const T=(0,t.queryAll)(".art-setting-item",h).find(f=>f.dataset.value===m);T&&(0,t.inverseClass)(T,"art-current")}return{width:b,name:"aspect-ratio",html:p.get("Aspect Ratio"),icon:I.aspectRatio,tooltip:c(e.aspectRatio),selector:A.map(h=>({value:h,name:`aspect-ratio-${h}`,default:h===e.aspectRatio,html:c(h)})),onSelect:h=>(e.aspectRatio=h.value,h.html),mounted:(h,v)=>{o(h,v.$tooltip,e.aspectRatio),e.on("aspectRatio",()=>{o(h,v.$tooltip,e.aspectRatio)})}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],aetWt:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){const{i18n:p,icons:I,constructor:{SETTING_ITEM_WIDTH:b,PLAYBACK_RATE:A}}=e;function c(h){return h===1?p.get("Normal"):h.toFixed(1)}function o(h,v,m){v&&(v.innerText=c(m));const T=(0,t.queryAll)(".art-setting-item",h).find(f=>Number(f.dataset.value)===m);T&&(0,t.inverseClass)(T,"art-current")}return{width:b,name:"playback-rate",html:p.get("Play Speed"),tooltip:c(e.playbackRate),icon:I.playbackRate,selector:A.map(h=>({value:h,name:`aspect-ratio-${h}`,default:h===e.playbackRate,html:c(h)})),onSelect:h=>(e.playbackRate=h.value,h.html),mounted:(h,v)=>{o(h,v.$tooltip,e.playbackRate),e.on("video:ratechange",()=>{o(h,v.$tooltip,e.playbackRate)})}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],fIBkO:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s),s.default=function(t){const{i18n:e,icons:p,constructor:I}=t;return{width:I.SETTING_ITEM_WIDTH,name:"subtitle-offset",html:e.get("Subtitle Offset"),icon:p.subtitle,tooltip:"0s",range:[0,-5,5,.1],onChange:b=>(t.subtitleOffset=b.range,b.range+"s")}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"2aaJe":[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s),s.default=class{constructor(){this.name="artplayer_settings",this.settings={}}get(t){try{const e=JSON.parse(window.localStorage.getItem(this.name))||{};return t?e[t]:e}catch{return t?this.settings[t]:this.settings}}set(t,e){try{const p=Object.assign({},this.get(),{[t]:e});window.localStorage.setItem(this.name,JSON.stringify(p))}catch{this.settings[t]=e}}del(t){try{const e=this.get();delete e[t],window.localStorage.setItem(this.name,JSON.stringify(e))}catch{delete this.settings[t]}}clear(){try{window.localStorage.removeItem(this.name)}catch{this.settings={}}}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"8MTUM":[function(R,M,s){var t=R("@parcel/transformer-js/src/esmodule-helpers.js");t.defineInteropFlag(s);var e=R("../utils"),p=R("./miniProgressBar"),I=t.interopDefault(p),b=R("./autoOrientation"),A=t.interopDefault(b),c=R("./autoPlayback"),o=t.interopDefault(c),h=R("./fastForward"),v=t.interopDefault(h),m=R("./lock"),T=t.interopDefault(m);s.default=class{constructor(f){this.art=f,this.id=0;const{option:n}=f;n.miniProgressBar&&!n.isLive&&this.add(I.default),n.lock&&e.isMobile&&this.add(T.default),n.autoPlayback&&!n.isLive&&this.add(o.default),n.autoOrientation&&e.isMobile&&this.add(A.default),n.fastForward&&e.isMobile&&!n.isLive&&this.add(v.default);for(let r=0;r<n.plugins.length;r++)this.add(n.plugins[r])}add(f){this.id+=1;const n=f.call(this.art,this.art),r=n&&n.name||f.name||`plugin${this.id}`;return(0,e.errorHandle)(!(0,e.has)(this,r),`Cannot add a plugin that already has the same name: ${r}`),(0,e.def)(this,r,{value:n}),this}}},{"../utils":"71aH7","./miniProgressBar":"87pSL","./autoOrientation":"ePEg5","./autoPlayback":"cVO99","./fastForward":"hFDwt","./lock":"1hsTH","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"87pSL":[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s),s.default=function(t){return t.on("ready",()=>{t.layers.add({name:"mini-progress-bar",mounted(e){t.on("destroy",()=>{e.style.display="none"}),t.on("video:timeupdate",()=>{e.style.width=100*t.played+"%"}),t.on("setBar",(p,I)=>{p==="played"&&(e.style.width=100*I+"%")})}})}),{name:"mini-progress-bar"}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],ePEg5:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){const{constructor:p,template:{$player:I,$video:b}}=e;return e.on("fullscreenWeb",A=>{if(A){const{videoWidth:c,videoHeight:o}=b,{clientWidth:h,clientHeight:v}=document.documentElement;(c>o&&h<v||c<o&&h>v)&&setTimeout(()=>{(0,t.setStyle)(I,"width",`${v}px`),(0,t.setStyle)(I,"height",`${h}px`),(0,t.setStyle)(I,"transform-origin","0 0"),(0,t.setStyle)(I,"transform",`rotate(90deg) translate(0, -${h}px)`),(0,t.addClass)(I,"art-auto-orientation"),e.isRotate=!0,e.emit("resize")},p.AUTO_ORIENTATION_TIME)}else(0,t.hasClass)(I,"art-auto-orientation")&&((0,t.removeClass)(I,"art-auto-orientation"),e.isRotate=!1,e.emit("resize"))}),e.on("fullscreen",async A=>{const c=screen.orientation.type;if(A){const{videoWidth:o,videoHeight:h}=b,{clientWidth:v,clientHeight:m}=document.documentElement;if(o>h&&v<m||o<h&&v>m){const T=c.startsWith("portrait")?"landscape":"portrait";await screen.orientation.lock(T),(0,t.addClass)(I,"art-auto-orientation-fullscreen")}}else(0,t.hasClass)(I,"art-auto-orientation-fullscreen")&&(await screen.orientation.lock(c),(0,t.removeClass)(I,"art-auto-orientation-fullscreen"))}),{name:"autoOrientation",get state(){return(0,t.hasClass)(I,"art-auto-orientation")}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],cVO99:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){const{i18n:p,icons:I,storage:b,constructor:A,proxy:c,template:{$poster:o}}=e,h=e.layers.add({name:"auto-playback",html:'<div class="art-auto-playback-close"></div><div class="art-auto-playback-last"></div><div class="art-auto-playback-jump"></div>'}),v=(0,t.query)(".art-auto-playback-last",h),m=(0,t.query)(".art-auto-playback-jump",h),T=(0,t.query)(".art-auto-playback-close",h);return e.on("video:timeupdate",()=>{if(e.playing){const f=b.get("times")||{},n=Object.keys(f);n.length>A.AUTO_PLAYBACK_MAX&&delete f[n[0]],f[e.option.id||e.option.url]=e.currentTime,b.set("times",f)}}),e.on("ready",()=>{const f=(b.get("times")||{})[e.option.id||e.option.url];f&&f>=A.AUTO_PLAYBACK_MIN&&((0,t.append)(T,I.close),(0,t.setStyle)(h,"display","flex"),v.innerText=`${p.get("Last Seen")} ${(0,t.secondToTime)(f)}`,m.innerText=p.get("Jump Play"),c(T,"click",()=>{(0,t.setStyle)(h,"display","none")}),c(m,"click",()=>{e.seek=f,e.play(),(0,t.setStyle)(o,"display","none"),(0,t.setStyle)(h,"display","none")}),e.once("video:timeupdate",()=>{setTimeout(()=>{(0,t.setStyle)(h,"display","none")},A.AUTO_PLAYBACK_TIMEOUT)}))}),{name:"auto-playback",get times(){return b.get("times")||{}},clear:()=>b.del("times"),delete(f){const n=b.get("times")||{};return delete n[f],b.set("times",n),n}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],hFDwt:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){const{constructor:p,proxy:I,template:{$player:b,$video:A}}=e;let c=null,o=!1,h=1;const v=()=>{clearTimeout(c),o&&(o=!1,e.playbackRate=h,(0,t.removeClass)(b,"art-fast-forward"))};return I(A,"touchstart",m=>{m.touches.length===1&&e.playing&&!e.isLock&&(c=setTimeout(()=>{o=!0,h=e.playbackRate,e.playbackRate=p.FAST_FORWARD_VALUE,(0,t.addClass)(b,"art-fast-forward")},p.FAST_FORWARD_TIME))}),I(document,"touchmove",v),I(document,"touchend",v),{name:"fastForward",get state(){return(0,t.hasClass)(b,"art-fast-forward")}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"1hsTH":[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var t=R("../utils");s.default=function(e){const{layers:p,icons:I,template:{$player:b}}=e;return p.add({name:"lock",mounted(A){const c=(0,t.append)(A,I.lock),o=(0,t.append)(A,I.unlock);(0,t.setStyle)(c,"display","none"),e.on("lock",h=>{h?((0,t.setStyle)(c,"display","inline-flex"),(0,t.setStyle)(o,"display","none")):((0,t.setStyle)(c,"display","none"),(0,t.setStyle)(o,"display","inline-flex"))})},click(){(0,t.hasClass)(b,"art-lock")?((0,t.removeClass)(b,"art-lock"),this.isLock=!1,e.emit("lock",!1)):((0,t.addClass)(b,"art-lock"),this.isLock=!0,e.emit("lock",!0))}}),{name:"lock",get state(){return(0,t.hasClass)(b,"art-lock")}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}]},["5lTcX"],"5lTcX","parcelRequire4dc0")})(Ht);const pe=jt(Ht.exports);var Gt={exports:{}};/*!
 * artplayer-plugin-danmuku.js v5.0.1
 * Github: https://github.com/zhw2590582/ArtPlayer
 * (c) 2017-2023 Harvey Zack
 * Released under the MIT License.
 */(function(et,lt){(function(R,M,s,t,e){var p=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof kt<"u"?kt:{},I=typeof p[t]=="function"&&p[t],b=I.cache||{},A=typeof Ft=="function"&&Ft.bind(et);function c(v,m){if(!b[v]){if(!R[v]){var T=typeof p[t]=="function"&&p[t];if(!m&&T)return T(v,!0);if(I)return I(v,!0);if(A&&typeof v=="string")return A(v);var f=new Error("Cannot find module '"+v+"'");throw f.code="MODULE_NOT_FOUND",f}r.resolve=function(d){var u=R[v][1][d];return u!=null?u:d},r.cache={};var n=b[v]=new c.Module(v);R[v][0].call(n.exports,r,n,n.exports,this)}return b[v].exports;function r(d){var u=r.resolve(d);return u===!1?{}:c(u)}}c.isParcelRequire=!0,c.Module=function(v){this.id=v,this.bundle=c,this.exports={}},c.modules=R,c.cache=b,c.parent=I,c.register=function(v,m){R[v]=[function(T,f){f.exports=m},{}]},Object.defineProperty(c,"root",{get:function(){return p[t]}}),p[t]=c;for(var o=0;o<M.length;o++)c(M[o]);if(s){var h=c(s);et.exports=h}})({bgm6t:[function(R,M,s){var t=R("@parcel/transformer-js/src/esmodule-helpers.js");t.defineInteropFlag(s);var e=R("./danmuku"),p=t.interopDefault(e),I=R("./setting"),b=t.interopDefault(I),A=R("./heatmap"),c=t.interopDefault(A);function o(h){return v=>{(function(T){const{version:f,utils:{errorHandle:n}}=T.constructor,r=f.split(".").map(Number);n(r[0]+r[1]/100>=5,`Artplayer.js@${f} \u4E0D\u517C\u5BB9\u8BE5\u5F39\u5E55\u5E93\uFF0C\u8BF7\u66F4\u65B0\u5230 Artplayer.js@5.x.x \u7248\u672C\u4EE5\u4E0A`)})(v);const m=new p.default(v,h);return(0,b.default)(v,m),h.heatmap&&!v.option.isLive&&(0,c.default)(v,m,h.heatmap),{name:"artplayerPluginDanmuku",emit:m.emit.bind(m),load:m.load.bind(m),config:m.config.bind(m),hide:m.hide.bind(m),show:m.show.bind(m),reset:m.reset.bind(m),get option(){return m.option},get isHide(){return m.isHide},get isStop(){return m.isStop}}}}s.default=o,o.env="production",o.version="5.0.1",o.build="2023-05-03 11:57:31",typeof window<"u"&&(window.artplayerPluginDanmuku=o)},{"./danmuku":"4ns48","./setting":"lO8OT","./heatmap":"8AxLD","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"4ns48":[function(R,M,s){var t=R("@parcel/transformer-js/src/esmodule-helpers.js");t.defineInteropFlag(s);var e=R("./bilibili"),p=R("./getDanmuTop"),I=t.interopDefault(p);class b{constructor(c,o){const{constructor:h,template:v}=c;if(this.utils=h.utils,this.validator=h.validator,this.$danmuku=v.$danmuku,this.$player=v.$player,this.art=c,this.danmus=[],this.queue=[],this.option={},this.$refs=[],this.isStop=!1,this.isHide=!1,this.timer=null,this.config(o),this.option.useWorker)try{this.worker=new Worker(R("12ceab24749100d0"))}catch{}this.start=this.start.bind(this),this.stop=this.stop.bind(this),this.reset=this.reset.bind(this),this.destroy=this.destroy.bind(this),c.on("video:play",this.start),c.on("video:playing",this.start),c.on("video:pause",this.stop),c.on("video:waiting",this.stop),c.on("resize",this.reset),c.on("destroy",this.destroy),this.load()}static get option(){return{danmuku:[],speed:5,margin:["2%","25%"],opacity:1,color:"#FFFFFF",mode:0,fontSize:25,filter:()=>!0,antiOverlap:!0,useWorker:!0,synchronousPlayback:!1,lockTime:5,maxLength:100,minWidth:200,maxWidth:400,mount:void 0,theme:"dark",heatmap:!1,beforeEmit:()=>!0}}static get scheme(){return{danmuku:"array|function|string",speed:"number",margin:"array",opacity:"number",color:"string",mode:"number",fontSize:"number|string",filter:"function",antiOverlap:"boolean",useWorker:"boolean",synchronousPlayback:"boolean",lockTime:"number",maxLength:"number",minWidth:"number",maxWidth:"number",mount:"undefined|htmldivelement",theme:"string",heatmap:"object|boolean",beforeEmit:"function"}}get isRotate(){return this.art.plugins.autoOrientation&&this.art.plugins.autoOrientation.state}get marginTop(){const{clamp:c}=this.utils,o=this.option.margin[0],{clientHeight:h}=this.$player;return typeof o=="number"?c(o,0,h):typeof o=="string"&&o.endsWith("%")?c(h*(parseFloat(o)/100),0,h):b.option.margin[0]}get marginBottom(){const{clamp:c}=this.utils,o=this.option.margin[1],{clientHeight:h}=this.$player;return typeof o=="number"?c(o,0,h):typeof o=="string"&&o.endsWith("%")?c(h*(parseFloat(o)/100),0,h):b.option.margin[1]}filter(c,o){return this.queue.filter(h=>h.$state===c).map(o)}getLeft(c){const o=c.getBoundingClientRect();return this.isRotate?o.top:o.left}getRef(){const c=this.$refs.pop();if(c)return c;const o=document.createElement("div");return o.style.cssText=`
            user-select: none;
            position: absolute;
            white-space: pre;
            pointer-events: none;
            perspective: 500px;
            display: inline-block;
            will-change: transform;
            font-weight: normal;
            line-height: 1.125;
            visibility: hidden;
            font-family: SimHei, "Microsoft JhengHei", Arial, Helvetica, sans-serif;
            text-shadow: rgb(0, 0, 0) 1px 0px 1px, rgb(0, 0, 0) 0px 1px 1px, rgb(0, 0, 0) 0px -1px 1px, rgb(0, 0, 0) -1px 0px 1px;
        `,o}getReady(){const{currentTime:c}=this.art;return this.queue.filter(o=>o.$state==="ready"||o.$state==="wait"&&c+.1>=o.time&&o.time>=c-.1)}getEmits(){const c=[],{clientWidth:o}=this.$player,h=this.getLeft(this.$player);return this.filter("emit",v=>{const m=v.$ref.offsetTop,T=this.getLeft(v.$ref)-h,f=v.$ref.clientHeight,n=v.$ref.clientWidth,r=T+n,d=o-r,u=r/v.$restTime,y={};y.top=m,y.left=T,y.height=f,y.width=n,y.right=d,y.speed=u,y.distance=r,y.time=v.$restTime,y.mode=v.mode,c.push(y)}),c}getFontSize(c){const{clamp:o}=this.utils,{clientHeight:h}=this.$player;return typeof c=="number"?o(c,12,h):typeof c=="string"&&c.endsWith("%")?o(h*(parseFloat(c)/100),12,h):b.option.fontSize}postMessage(c={}){return new Promise(o=>{if(this.option.useWorker&&this.worker&&this.worker.postMessage)c.id=Date.now(),this.worker.postMessage(c),this.worker.onmessage=h=>{const{data:v}=h;v.id===c.id&&o(v)};else{const h=(0,I.default)(c);o({top:h})}})}async load(){try{typeof this.option.danmuku=="function"?this.danmus=await this.option.danmuku():typeof this.option.danmuku.then=="function"?this.danmus=await this.option.danmuku:typeof this.option.danmuku=="string"?this.danmus=await(0,e.bilibiliDanmuParseFromUrl)(this.option.danmuku):this.danmus=this.option.danmuku,this.utils.errorHandle(Array.isArray(this.danmus),"Danmuku need return an array as result"),this.art.emit("artplayerPluginDanmuku:loaded",this.danmus),this.queue=[],this.$danmuku.innerText="",this.danmus.forEach(c=>this.emit(c))}catch(c){throw this.art.emit("artplayerPluginDanmuku:error",c),c}return this}config(c){const{clamp:o}=this.utils;return this.option=Object.assign({},b.option,this.option,c),this.validator(this.option,b.scheme),this.option.speed=o(this.option.speed,1,10),this.option.opacity=o(this.option.opacity,0,1),this.option.lockTime=o(Math.floor(this.option.lockTime),0,60),this.option.maxLength=o(this.option.maxLength,0,500),this.option.minWidth=o(this.option.minWidth,0,500),this.option.maxWidth=o(this.option.maxWidth,0,1/0),c.fontSize&&(this.option.fontSize=this.getFontSize(this.option.fontSize),this.reset()),this.art.emit("artplayerPluginDanmuku:config",this.option),this}makeWait(c){c.$state="wait",c.$ref&&(c.$ref.style.visibility="hidden",c.$ref.style.marginLeft="0px",c.$ref.style.transform="translateX(0px)",c.$ref.style.transition="transform 0s linear 0s",this.$refs.push(c.$ref),c.$ref=null)}continue(){const{clientWidth:c}=this.$player;return this.filter("stop",o=>{switch(o.$state="emit",o.$lastStartTime=Date.now(),o.mode){case 0:{const h=c+o.$ref.clientWidth;o.$ref.style.transform=`translateX(${-h}px)`,o.$ref.style.transition=`transform ${o.$restTime}s linear 0s`;break}}}),this}suspend(){const{clientWidth:c}=this.$player;return this.filter("emit",o=>{switch(o.$state="stop",o.mode){case 0:{const h=c-(this.getLeft(o.$ref)-this.getLeft(this.$player));o.$ref.style.transform=`translateX(${-h}px)`,o.$ref.style.transition="transform 0s linear 0s";break}}}),this}reset(){return this.queue.forEach(c=>this.makeWait(c)),this}update(){return this.timer=window.requestAnimationFrame(async()=>{if(this.art.playing&&!this.isHide){this.filter("emit",v=>{const m=(Date.now()-v.$lastStartTime)/1e3;v.$restTime-=m,v.$lastStartTime=Date.now(),v.$restTime<=0&&this.makeWait(v)});const c=this.getReady(),{clientWidth:o,clientHeight:h}=this.$player;for(let v=0;v<c.length;v++){const m=c[v];m.$ref=this.getRef(),m.$ref.innerText=m.text,this.$danmuku.appendChild(m.$ref),m.$ref.style.left=`${o}px`,m.$ref.style.opacity=this.option.opacity,m.$ref.style.fontSize=`${this.option.fontSize}px`,m.$ref.style.color=m.color,m.$ref.style.border=m.border?`1px solid ${m.color}`:null,m.$ref.style.backgroundColor=m.border?"rgb(0 0 0 / 50%)":null,m.$ref.style.marginLeft="0px",m.$lastStartTime=Date.now(),m.$restTime=this.option.synchronousPlayback&&this.art.playbackRate?this.option.speed/Number(this.art.playbackRate):this.option.speed;const T={mode:m.mode,height:m.$ref.clientHeight,speed:(o+m.$ref.clientWidth)/m.$restTime},{top:f}=await this.postMessage({target:T,emits:this.getEmits(),antiOverlap:this.option.antiOverlap,clientWidth:o,clientHeight:h,marginBottom:this.marginBottom,marginTop:this.marginTop});if(m.$ref)if(this.isStop||f===void 0)m.$state="ready",this.$refs.push(m.$ref),m.$ref=null;else switch(m.$state="emit",m.$ref.style.visibility="visible",m.mode){case 0:{m.$ref.style.top=`${f}px`;const n=o+m.$ref.clientWidth;m.$ref.style.transform=`translateX(${-n}px)`,m.$ref.style.transition=`transform ${m.$restTime}s linear 0s`;break}case 1:m.$ref.style.left="50%",m.$ref.style.top=`${f}px`,m.$ref.style.marginLeft=`-${m.$ref.clientWidth/2}px`}}}this.isStop||this.update()}),this}stop(){return this.isStop=!0,this.suspend(),window.cancelAnimationFrame(this.timer),this.art.emit("artplayerPluginDanmuku:stop"),this}start(){return this.isStop=!1,this.continue(),this.update(),this.art.emit("artplayerPluginDanmuku:start"),this}show(){return this.isHide=!1,this.start(),this.$danmuku.style.display="block",this.art.emit("artplayerPluginDanmuku:show"),this}hide(){return this.isHide=!0,this.stop(),this.queue.forEach(c=>this.makeWait(c)),this.$danmuku.style.display="none",this.art.emit("artplayerPluginDanmuku:hide"),this}emit(c){return this.validator(c,{text:"string",mode:"number|undefined",color:"string|undefined",time:"number|undefined",border:"boolean|undefined"}),c.text.trim()&&this.option.filter(c)?(c.time?c.time=this.utils.clamp(c.time,0,1/0):c.time=this.art.currentTime+.5,c.mode===void 0&&(c.mode=this.option.mode),c.color===void 0&&(c.color=this.option.color),this.queue.push({...c,$state:"wait",$ref:null,$restTime:0,$lastStartTime:0}),this):this}destroy(){this.stop(),this.worker&&this.worker.terminate&&this.worker.terminate(),this.art.off("video:play",this.start),this.art.off("video:playing",this.start),this.art.off("video:pause",this.stop),this.art.off("video:waiting",this.stop),this.art.off("resize",this.reset),this.art.off("destroy",this.destroy),this.art.emit("artplayerPluginDanmuku:destroy")}}s.default=b},{"./bilibili":"f83sx","./getDanmuTop":"jPSuD","12ceab24749100d0":"fXq73","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],f83sx:[function(R,M,s){var t=R("@parcel/transformer-js/src/esmodule-helpers.js");function e(b){switch(b){case 1:case 2:case 3:default:return 0;case 4:case 5:return 1}}function p(b){if(typeof b!="string")return[];const A=b.matchAll(/<d (?:.*? )??p="(?<p>.+?)"(?: .*?)?>(?<text>.+?)<\/d>/gs);return Array.from(A).map(c=>{const o=c.groups.p.split(",");return o.length>=8?{text:c.groups.text.trim().replaceAll("&quot;",'"').replaceAll("&apos;","'").replaceAll("&lt;","<").replaceAll("&gt;",">").replaceAll("&amp;","&"),time:Number(o[0]),mode:e(Number(o[1])),fontSize:Number(o[2]),color:`#${Number(o[3]).toString(16)}`,timestamp:Number(o[4]),pool:Number(o[5]),userID:o[6],rowID:Number(o[7])}:null}).filter(Boolean)}function I(b){return fetch(b).then(A=>A.text()).then(A=>p(A))}t.defineInteropFlag(s),t.export(s,"getMode",()=>e),t.export(s,"bilibiliDanmuParseFromXml",()=>p),t.export(s,"bilibiliDanmuParseFromUrl",()=>I)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"9pCYc":[function(R,M,s){s.interopDefault=function(t){return t&&t.__esModule?t:{default:t}},s.defineInteropFlag=function(t){Object.defineProperty(t,"__esModule",{value:!0})},s.exportAll=function(t,e){return Object.keys(t).forEach(function(p){p==="default"||p==="__esModule"||e.hasOwnProperty(p)||Object.defineProperty(e,p,{enumerable:!0,get:function(){return t[p]}})}),e},s.export=function(t,e,p){Object.defineProperty(t,e,{enumerable:!0,get:p})}},{}],jPSuD:[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s),s.default=function({target:t,emits:e,clientWidth:p,clientHeight:I,marginBottom:b,marginTop:A,antiOverlap:c}){const o=e.filter(v=>v.mode===t.mode&&v.top<=I-b).sort((v,m)=>v.top-m.top);if(o.length===0)return A;o.unshift({top:0,left:0,right:0,height:A,width:p,speed:0,distance:p}),o.push({top:I-b,left:0,right:0,height:b,width:p,speed:0,distance:p});for(let v=1;v<o.length;v+=1){const m=o[v],T=o[v-1],f=T.top+T.height;if(m.top-f>=t.height)return f}const h=[];for(let v=1;v<o.length-1;v+=1){const m=o[v];if(h.length){const T=h[h.length-1];T[0].top===m.top?T.push(m):h.push([m])}else h.push([m])}if(!c){switch(t.mode){case 0:h.sort((v,m)=>{const T=Math.min(...m.map(n=>n.right)),f=Math.min(...v.map(n=>n.right));return T*m.length-f*v.length});break;case 1:h.sort((v,m)=>{const T=Math.max(...m.map(f=>f.width));return Math.max(...v.map(f=>f.width))*v.length-T*m.length})}return h[0][0].top}switch(t.mode){case 0:{const v=h.find(m=>m.every(T=>p<T.distance?!1:t.speed<T.speed?!0:T.right/(t.speed-T.speed)>T.time));return v&&v[0]?v[0].top:void 0}case 1:return}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],fXq73:[function(R,M,s){M.exports="data:application/javascript,function%20getDanmuTop%28%7Btarget%3At%2Cemits%3Ae%2CclientWidth%3An%2CclientHeight%3Ai%2CmarginBottom%3As%2CmarginTop%3Ah%2CantiOverlap%3Ao%7D%29%7Bconst%20r%3De.filter%28%28e%3D%3Ee.mode%3D%3D%3Dt.mode%26%26e.top%3C%3Di-s%29%29.sort%28%28%28t%2Ce%29%3D%3Et.top-e.top%29%29%3Bif%280%3D%3D%3Dr.length%29return%20h%3Br.unshift%28%7Btop%3A0%2Cleft%3A0%2Cright%3A0%2Cheight%3Ah%2Cwidth%3An%2Cspeed%3A0%2Cdistance%3An%7D%29%2Cr.push%28%7Btop%3Ai-s%2Cleft%3A0%2Cright%3A0%2Cheight%3As%2Cwidth%3An%2Cspeed%3A0%2Cdistance%3An%7D%29%3Bfor%28let%20e%3D1%3Be%3Cr.length%3Be%2B%3D1%29%7Bconst%20n%3Dr%5Be%5D%2Ci%3Dr%5Be-1%5D%2Cs%3Di.top%2Bi.height%3Bif%28n.top-s%3E%3Dt.height%29return%20s%7Dconst%20p%3D%5B%5D%3Bfor%28let%20t%3D1%3Bt%3Cr.length-1%3Bt%2B%3D1%29%7Bconst%20e%3Dr%5Bt%5D%3Bif%28p.length%29%7Bconst%20t%3Dp%5Bp.length-1%5D%3Bt%5B0%5D.top%3D%3D%3De.top%3Ft.push%28e%29%3Ap.push%28%5Be%5D%29%7Delse%20p.push%28%5Be%5D%29%7Dif%28%21o%29%7Bswitch%28t.mode%29%7Bcase%200%3Ap.sort%28%28%28t%2Ce%29%3D%3E%7Bconst%20n%3DMath.min%28...e.map%28%28t%3D%3Et.right%29%29%29%2Ci%3DMath.min%28...t.map%28%28t%3D%3Et.right%29%29%29%3Breturn%20n%2ae.length-i%2at.length%7D%29%29%3Bbreak%3Bcase%201%3Ap.sort%28%28%28t%2Ce%29%3D%3E%7Bconst%20n%3DMath.max%28...e.map%28%28t%3D%3Et.width%29%29%29%3Breturn%20Math.max%28...t.map%28%28t%3D%3Et.width%29%29%29%2at.length-n%2ae.length%7D%29%29%7Dreturn%20p%5B0%5D%5B0%5D.top%7Dswitch%28t.mode%29%7Bcase%200%3A%7Bconst%20e%3Dp.find%28%28e%3D%3Ee.every%28%28e%3D%3E%7Bif%28n%3Ce.distance%29return%211%3Bif%28t.speed%3Ce.speed%29return%210%3Breturn%20e.right%2F%28t.speed-e.speed%29%3Ee.time%7D%29%29%29%29%3Breturn%20e%26%26e%5B0%5D%3Fe%5B0%5D.top%3Avoid%200%7Dcase%201%3Areturn%7D%7Donmessage%3Dt%3D%3E%7Bconst%7Bdata%3Ae%7D%3Dt%2Cn%3DgetDanmuTop%28e%29%3Bself.postMessage%28%7Btop%3An%2Cid%3Ae.id%7D%29%7D%3B"},{}],lO8OT:[function(R,M,s){var t=R("@parcel/transformer-js/src/esmodule-helpers.js");t.defineInteropFlag(s);var e=R("bundle-text:./style.less"),p=t.interopDefault(e),I=R("bundle-text:./img/danmu-on.svg"),b=t.interopDefault(I),A=R("bundle-text:./img/danmu-off.svg"),c=t.interopDefault(A),o=R("bundle-text:./img/danmu-config.svg"),h=t.interopDefault(o),v=R("bundle-text:./img/danmu-style.svg"),m=t.interopDefault(v);if(s.default=function(T,f){const{option:n}=f,{template:{$controlsCenter:r,$player:d},constructor:{SETTING_ITEM_WIDTH:u,utils:{removeClass:y,addClass:l,append:a,setStyle:i,tooltip:D,query:E,inverseClass:S,getIcon:L}}}=T;i(r,"display","flex");const x=L("danmu-on",b.default),g=L("danmu-off",c.default),O=L("danmu-config",h.default),P=L("danmu-style",m.default);(function(){const C=["#FE0302","#FF7204","#FFAA02","#FFD302","#FFFF00","#A0EE00","#00CD00","#019899","#4266BE","#89D5FF","#CC0273","#222222","#9B9B9B","#FFFFFF"].map(z=>`<div class="art-danmuku-style-panel-color${n.color===z?" art-current":""}" data-color="${z}" style="background-color:${z}"></div>`),w=a(r,`<div class="art-danmuku-emitter" style="max-width: ${n.maxWidth?`${n.maxWidth}px`:"100%"}"><div class="art-danmuku-left"><div class="art-danmuku-style"><div class="art-danmuku-style-panel"><div class="art-danmuku-style-panel-inner"><div class="art-danmuku-style-panel-title">\u6A21\u5F0F</div><div class="art-danmuku-style-panel-modes"><div class="art-danmuku-style-panel-mode art-current" data-mode="0">\u6EDA\u52A8</div><div class="art-danmuku-style-panel-mode" data-mode="1">\u9759\u6B62</div></div><div class="art-danmuku-style-panel-title">\u989C\u8272</div><div class="art-danmuku-style-panel-colors">${C.join("")}</div></div></div></div><input class="art-danmuku-input" maxlength="${n.maxLength}" placeholder="\u53D1\u4E2A\u5F39\u5E55\u89C1\u8BC1\u5F53\u4E0B" /></div><div class="art-danmuku-send">\u53D1\u9001</div></div>`),F=E(".art-danmuku-style",w),k=E(".art-danmuku-input",w),_=E(".art-danmuku-send",w),B=E(".art-danmuku-style-panel-inner",w),N=E(".art-danmuku-style-panel-modes",w),U=E(".art-danmuku-style-panel-colors",w),j=n.mount||a(d,'<div class="art-layer-danmuku-emitter"></div>');T.option.backdrop&&l(B,"art-backdrop-filter"),n.theme&&l(w,`art-danmuku-theme-${n.theme}`);let W=null,H=n.mode,G=n.color;function K(z){z<=0?(W=null,_.innerText="\u53D1\u9001",y(_,"art-disabled")):(_.innerText=z,W=setTimeout(()=>K(z-1),1e3))}function X(){const z={mode:H,color:G,border:!0,text:k.value.trim()};W===null&&n.beforeEmit(z)&&(k.value="",f.emit(z),l(_,"art-disabled"),K(n.lockTime),T.emit("artplayerPluginDanmuku:emit",z))}function Z(){r.clientWidth<n.minWidth?(a(j,w),i(j,"display","flex"),l(w,"art-danmuku-mount"),n.mount||i(d,"marginBottom","40px")):(a(r,w),i(j,"display","none"),y(w,"art-danmuku-mount"),n.mount||i(d,"marginBottom",null))}a(F,P),T.proxy(_,"click",X),T.proxy(k,"keypress",z=>{z.key==="Enter"&&(z.preventDefault(),X())}),T.proxy(N,"click",z=>{const{dataset:V}=z.target;V.mode&&(H=Number(V.mode),S(z.target,"art-current"))}),T.proxy(U,"click",z=>{const{dataset:V}=z.target;V.color&&(G=V.color,S(z.target,"art-current"))}),Z(),T.on("resize",()=>{T.isInput||Z()}),T.on("destroy",()=>{n.mount&&w.parentElement===n.mount&&n.mount.removeChild(w)})})(),T.controls.add({position:"right",name:"danmuku",click:function(){f.isHide?(f.show(),T.notice.show="\u5F39\u5E55\u663E\u793A",i(x,"display",null),i(g,"display","none")):(f.hide(),T.notice.show="\u5F39\u5E55\u9690\u85CF",i(x,"display","none"),i(g,"display",null))},mounted(C){a(C,x),a(C,g),D(C,"\u5F39\u5E55\u5F00\u5173"),i(g,"display","none"),T.on("artplayerPluginDanmuku:hide",()=>{i(x,"display","none"),i(g,"display",null)}),T.on("artplayerPluginDanmuku:show",()=>{i(x,"display",null),i(g,"display","none")})}}),T.setting.add({width:260,name:"danmuku",html:"\u5F39\u5E55\u8BBE\u7F6E",tooltip:"\u66F4\u591A",icon:O,selector:[{width:u,html:"\u64AD\u653E\u901F\u5EA6",icon:"",tooltip:"\u9002\u4E2D",selector:[{html:"\u6781\u6162",time:10},{html:"\u8F83\u6162",time:7.5},{default:!0,html:"\u9002\u4E2D",time:5},{html:"\u8F83\u5FEB",time:2.5},{html:"\u6781\u5FEB",time:1}],onSelect:function(C){return f.config({speed:C.time}),C.html}},{width:u,html:"\u5B57\u4F53\u5927\u5C0F",icon:"",tooltip:"\u9002\u4E2D",selector:[{html:"\u6781\u5C0F",fontSize:"4%"},{html:"\u8F83\u5C0F",fontSize:"5%"},{default:!0,html:"\u9002\u4E2D",fontSize:"6%"},{html:"\u8F83\u5927",fontSize:"7%"},{html:"\u6781\u5927",fontSize:"8%"}],onSelect:function(C){return f.config({fontSize:C.fontSize}),C.html}},{width:u,html:"\u4E0D\u900F\u660E\u5EA6",icon:"",tooltip:"100%",selector:[{default:!0,opacity:1,html:"100%"},{opacity:.75,html:"75%"},{opacity:.5,html:"50%"},{opacity:.25,html:"25%"},{opacity:0,html:"0%"}],onSelect:function(C){return f.config({opacity:C.opacity}),C.html}},{width:u,html:"\u663E\u793A\u8303\u56F4",icon:"",tooltip:"3/4",selector:[{html:"1/4",margin:[10,"75%"]},{html:"\u534A\u5C4F",margin:[10,"50%"]},{default:!0,html:"3/4",margin:[10,"25%"]},{html:"\u6EE1\u5C4F",margin:[10,10]}],onSelect:function(C){return f.config({margin:C.margin}),C.html}},{html:"\u5F39\u5E55\u9632\u91CD\u53E0",icon:"",tooltip:n.antiOverlap?"\u5F00\u542F":"\u5173\u95ED",switch:n.antiOverlap,onSwitch:C=>(f.config({antiOverlap:!C.switch}),C.tooltip=C.switch?"\u5173\u95ED":"\u5F00\u542F",!C.switch)},{html:"\u540C\u6B65\u89C6\u9891\u901F\u5EA6",icon:"",tooltip:n.synchronousPlayback?"\u5F00\u542F":"\u5173\u95ED",switch:n.synchronousPlayback,onSwitch:C=>(f.config({synchronousPlayback:!C.switch}),C.tooltip=C.switch?"\u5173\u95ED":"\u5F00\u542F",!C.switch)}]})},typeof document<"u"&&!document.getElementById("artplayer-plugin-danmuku")){const T=document.createElement("style");T.id="artplayer-plugin-danmuku",T.textContent=p.default,document.head.appendChild(T)}},{"bundle-text:./style.less":"hViDo","bundle-text:./img/danmu-on.svg":"4KfW9","bundle-text:./img/danmu-off.svg":"9UR3U","bundle-text:./img/danmu-config.svg":"4MPCW","bundle-text:./img/danmu-style.svg":"7lV5Q","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],hViDo:[function(R,M,s){M.exports='.art-danmuku-emitter{height:32px;width:100%;max-width:100%;background-color:#ffffff4d;border-radius:5px;font-size:12px;line-height:1;display:flex;position:relative}.art-danmuku-emitter .art-backdrop-filter{-webkit-backdrop-filter:saturate(180%)blur(20px);backdrop-filter:saturate(180%)blur(20px);background-color:#000000b3!important}.art-danmuku-emitter .art-danmuku-left{border-radius:3px 0 0 3px;flex:1;display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style{width:32px;justify-content:center;align-items:center;display:flex;position:relative}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel{z-index:999;width:200px;padding-bottom:10px;display:none;position:absolute;bottom:30px;left:-85px}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner{background-color:#000000e6;border-radius:3px;flex-direction:column;padding:10px 10px 0;display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-title{margin-bottom:10px;font-size:13px}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-modes{justify-content:space-between;margin-bottom:15px;display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-modes .art-danmuku-style-panel-mode{width:47%;cursor:pointer;color:#fff;border:1px solid #fff;justify-content:center;padding:5px 0;display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-modes .art-danmuku-style-panel-mode.art-current{background-color:#00a1d6;border:1px solid #00a1d6}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-colors{flex-wrap:wrap;justify-content:space-between;gap:5px;margin-bottom:10px;display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-colors .art-danmuku-style-panel-color{cursor:pointer;width:20px;height:20px;border:1px solid #fff}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-colors .art-danmuku-style-panel-color.art-current{position:relative;box-shadow:0 0 2px #fff}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-colors .art-danmuku-style-panel-color.art-current:before{content:"";width:100%;height:100%;border:2px solid #000;position:absolute;inset:0}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style:hover .art-danmuku-style-panel{display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-icon{opacity:.75;cursor:pointer}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-icon:hover{opacity:1}.art-danmuku-emitter .art-danmuku-left .art-danmuku-input{width:100%;color:#fff;background-color:#0000;border:none;outline:none;flex:1;padding:0 10px 0 0;display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-input::placeholder,.art-danmuku-emitter .art-danmuku-left .art-danmuku-input::-webkit-input-placeholder{color:#ffffff80}.art-danmuku-emitter .art-danmuku-send{width:50px;cursor:pointer;background-color:#00a1d6;border-radius:0 5px 5px 0;justify-content:center;align-items:center;display:flex}.art-danmuku-emitter .art-danmuku-send:hover{background-color:#00b5e5}.art-danmuku-emitter .art-danmuku-send.art-disabled{opacity:.5;pointer-events:none}.art-danmuku-emitter.art-danmuku-mount{max-width:100%!important}.art-danmuku-emitter.art-danmuku-mount .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel{left:0}.art-danmuku-emitter.art-danmuku-mount .art-danmuku-send{width:60px}.art-danmuku-emitter.art-danmuku-mount.art-danmuku-theme-light .art-danmuku-left{background:#f4f4f4;border:1px solid #dadada}.art-danmuku-emitter.art-danmuku-mount.art-danmuku-theme-light .art-danmuku-left .art-danmuku-style .art-icon svg{fill:#666}.art-danmuku-emitter.art-danmuku-mount.art-danmuku-theme-light .art-danmuku-left .art-danmuku-input{color:#000}.art-danmuku-emitter.art-danmuku-mount.art-danmuku-theme-light .art-danmuku-left .art-danmuku-input::placeholder,.art-danmuku-emitter.art-danmuku-mount.art-danmuku-theme-light .art-danmuku-left .art-danmuku-input::-webkit-input-placeholder{color:#00000080}.art-layer-danmuku-emitter{z-index:99;width:100%;position:absolute;bottom:-40px;left:0;right:0}'},{}],"4KfW9":[function(R,M,s){M.exports='<svg viewBox="0 0 1152 1024" width="22" height="22" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M311.467 661.333c0 4.267-4.267 8.534-8.534 12.8 0 4.267 0 4.267-4.266 8.534h-12.8c-4.267 0-8.534-4.267-17.067-8.534-8.533-8.533-17.067-8.533-25.6-8.533-8.533 0-12.8 4.267-17.067 12.8-4.266 12.8-8.533 21.333-4.266 29.867 4.266 8.533 12.8 17.066 25.6 21.333 17.066 8.533 34.133 17.067 46.933 17.067 12.8 0 21.333-4.267 34.133-8.534 8.534-4.266 17.067-17.066 25.6-29.866 8.534-12.8 12.8-34.134 17.067-55.467 4.267-21.333 4.267-51.2 4.267-85.333 0-12.8 0-21.334-4.267-29.867 0-8.533-4.267-12.8-8.533-17.067-4.267-4.266-8.534-8.533-12.8-8.533-4.267 0-12.8-4.267-21.334-4.267h-55.466s-4.267-4.266 0-8.533l4.266-38.4c0-4.267 0-8.533 4.267-8.533h46.933c17.067 0 25.6-4.267 34.134-12.8 8.533-8.534 12.8-21.334 12.8-42.667v-72.533c0-17.067-4.267-34.134-8.534-42.667-12.8-12.8-25.6-17.067-42.666-17.067H243.2c-8.533 0-17.067 0-21.333 4.267-4.267 8.533-4.267 12.8-4.267 25.6 0 8.533 0 17.067 4.267 21.333 4.266 4.267 12.8 8.534 21.333 8.534h64c4.267 0 8.533 0 8.533 4.266v34.134c0 8.533 0 12.8-4.266 12.8 0 0-4.267 4.266-8.534 4.266H268.8c-8.533 0-12.8 0-21.333 4.267-4.267 0-8.534 4.267-8.534 4.267-4.266 4.266-8.533 12.8-8.533 17.066 0 8.534-4.267 17.067-4.267 25.6l-8.533 72.534v29.866c0 8.534 4.267 12.8 8.533 17.067 4.267 4.267 8.534 4.267 17.067 8.533h68.267c4.266 0 8.533 0 8.533 4.267s4.267 8.533 4.267 17.067c0 21.333 0 42.666-4.267 55.466 0 8.534-4.267 21.334-8.533 25.6zM896 486.4c-93.867 0-174.933 51.2-217.6 123.733H571.733V576H640c21.333 0 34.133-4.267 42.667-12.8 8.533-8.533 12.8-21.333 12.8-42.667V358.4c0-21.333-4.267-34.133-12.8-42.667-8.534-8.533-21.334-12.8-42.667-12.8 0-4.266 4.267-4.266 4.267-8.533-4.267 0-4.267-4.267-4.267-4.267 4.267-12.8 8.533-21.333 4.267-25.6 0-8.533-4.267-12.8-12.8-21.333-8.534-4.267-17.067-4.267-21.334-4.267-8.533 4.267-12.8 8.534-21.333 21.334-4.267 8.533-8.533 12.8-12.8 21.333-4.267 8.533-8.533 12.8-12.8 21.333H512c-4.267-8.533-8.533-17.066-8.533-21.333-4.267-8.533-8.534-12.8-12.8-21.333-4.267-12.8-12.8-17.067-21.334-17.067s-17.066 0-25.6 8.533c-8.533 8.534-12.8 12.8-12.8 21.334s0 17.066 8.534 25.6l4.266 4.266L448 307.2c-17.067 0-29.867 4.267-38.4 12.8-8.533 4.267-12.8 21.333-12.8 38.4v157.867c0 21.333 4.267 34.133 12.8 42.666 8.533 8.534 21.333 12.8 42.667 12.8H512v34.134h-98.133c-12.8 0-21.334 0-25.6 4.266-4.267 4.267-8.534 8.534-8.534 21.334v17.066c0 4.267 4.267 8.534 4.267 8.534 4.267 0 4.267 4.266 8.533 4.266H512V716.8c0 12.8 4.267 21.333 8.533 25.6 4.267 4.267 12.8 8.533 21.334 8.533 12.8 0 21.333-4.266 25.6-8.533 4.266-4.267 4.266-12.8 4.266-25.6v-55.467H652.8c-8.533 25.6-12.8 51.2-12.8 76.8 0 140.8 115.2 256 256 256s256-115.2 256-256S1036.8 486.4 896 486.4zm-328.533-128h55.466c4.267 0 4.267 0 4.267 4.267V409.6h-59.733v-51.2zm0 102.4H627.2V512h-55.467v-51.2zM512 516.267h-55.467v-51.2H512v51.2zm0-102.4h-59.733V362.667H512v51.2zm384 499.2c-93.867 0-170.667-76.8-170.667-170.667S802.133 571.733 896 571.733s170.667 76.8 170.667 170.667S989.867 913.067 896 913.067z"/><path fill="#fff" d="M951.467 669.867 878.933 742.4l-29.866-25.6C832 699.733 806.4 704 789.333 721.067c-17.066 17.066-12.8 42.666 4.267 59.733l59.733 51.2c8.534 8.533 17.067 8.533 29.867 8.533s21.333-4.266 29.867-12.8l102.4-102.4c17.066-17.066 17.066-42.666 0-59.733-21.334-12.8-46.934-12.8-64 4.267zm-371.2 209.066H213.333c-72.533 0-128-55.466-128-119.466V230.4c0-64 55.467-119.467 128-119.467h512c72.534 0 128 55.467 128 119.467v140.8c0 25.6 17.067 42.667 42.667 42.667s42.667-17.067 42.667-42.667V230.4c0-115.2-93.867-204.8-213.334-204.8h-512C93.867 25.6 0 119.467 0 230.4v529.067c0 115.2 93.867 204.8 213.333 204.8h366.934c25.6 0 42.666-17.067 42.666-42.667s-21.333-42.667-42.666-42.667z"/></svg>'},{}],"9UR3U":[function(R,M,s){M.exports='<svg viewBox="0 0 1152 1024" width="22" height="22" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M311.296 661.504c0 4.096-4.096 8.704-8.704 12.8 0 4.096 0 4.096-4.096 8.704h-12.8c-4.096 0-8.704-4.096-16.896-8.704-8.704-8.704-16.896-8.704-25.6-8.704s-12.8 4.096-16.896 12.8c-4.096 12.8-8.704 21.504-4.096 29.696 4.096 8.704 12.8 16.896 25.6 21.504 16.896 8.704 34.304 16.896 47.104 16.896 12.8 0 21.504-4.096 34.304-8.704 8.704-4.096 16.896-16.896 25.6-29.696s12.8-34.304 16.896-55.296c4.096-21.504 4.096-51.2 4.096-85.504 0-12.8 0-21.504-4.096-29.696 0-8.704-4.096-12.8-8.704-16.896-4.096-4.096-8.704-8.704-12.8-8.704s-12.8-4.096-21.504-4.096h-55.808s-4.096-4.096 0-8.704l4.096-38.4c0-4.096 0-8.704 4.096-8.704h47.104c16.896 0 25.6-4.096 34.304-12.8s12.8-21.504 12.8-42.496v-72.704c0-16.896-4.096-34.304-8.704-42.496-12.8-12.8-25.6-16.896-42.496-16.896H243.2c-8.704 0-16.896 0-21.504 4.096-4.096 8.704-4.096 12.8-4.096 25.6 0 8.704 0 16.896 4.096 21.504 4.096 4.096 12.8 8.704 21.504 8.704h64c4.096 0 8.704 0 8.704 4.096v34.304c0 8.704 0 12.8-4.096 12.8 0 0-4.096 4.096-8.704 4.096H268.8c-8.704 0-12.8 0-21.504 4.096-4.096 0-8.704 4.096-8.704 4.096-4.096 4.096-8.704 12.8-8.704 16.896 0 8.704-4.096 16.896-4.096 25.6l-8.704 72.704v29.696c0 8.704 4.096 12.8 8.704 16.896s8.704 4.096 16.896 8.704h68.096c4.096 0 8.704 0 8.704 4.096s4.096 8.704 4.096 16.896c0 21.504 0 42.496-4.096 55.296.512 9.216-3.584 22.016-8.192 26.624zM896 486.4c-93.696 0-175.104 51.2-217.6 123.904H571.904V576H640c21.504 0 34.304-4.096 42.496-12.8 8.704-8.704 12.8-21.504 12.8-42.496V358.4c0-21.504-4.096-34.304-12.8-42.496-8.704-8.704-21.504-12.8-42.496-12.8 0-4.096 4.096-4.096 4.096-8.704-4.096 0-4.096-4.096-4.096-4.096 4.096-12.8 8.704-21.504 4.096-25.6 0-8.704-4.096-12.8-12.8-21.504-8.704-4.096-16.896-4.096-21.504-4.096-8.704 4.096-12.8 8.704-21.504 21.504-4.096 8.704-8.704 12.8-12.8 21.504s-8.704 12.8-12.8 21.504h-51.2c-4.096-8.704-8.704-16.896-8.704-21.504-4.096-8.704-8.704-12.8-12.8-21.504-4.096-12.8-12.8-16.896-21.504-16.896s-16.896 0-25.6 8.704-12.8 12.8-12.8 21.504 0 16.896 8.704 25.6l4.096 4.096 4.096 4.096c-16.896 0-29.696 4.096-38.4 12.8-8.704 4.096-12.8 21.504-12.8 38.4v157.696c0 21.504 4.096 34.304 12.8 42.496 8.704 8.704 21.504 12.8 42.496 12.8H512v34.304h-98.304c-12.8 0-21.504 0-25.6 4.096s-8.704 8.704-8.704 21.504v16.896c0 4.096 4.096 8.704 4.096 8.704 4.096 0 4.096 4.096 8.704 4.096H512V716.8c0 12.8 4.096 21.504 8.704 25.6 4.096 4.096 12.8 8.704 21.504 8.704 12.8 0 21.504-4.096 25.6-8.704 4.096-4.096 4.096-12.8 4.096-25.6v-55.296H652.8c-8.704 25.6-12.8 51.2-12.8 76.8 0 140.8 115.2 256 256 256s256-115.2 256-256S1036.8 486.4 896 486.4zm-328.704-128h55.296c4.096 0 4.096 0 4.096 4.096V409.6h-59.904v-51.2zm0 102.4H627.2V512h-55.296v-51.2h-4.608zM512 516.096h-55.296v-51.2H512v51.2zm0-102.4h-59.904v-51.2H512v51.2zm384 499.2c-93.696 0-170.496-76.8-170.496-170.496S802.304 571.904 896 571.904s170.496 76.8 170.496 170.496S989.696 912.896 896 912.896z"/><path fill="#fff" d="M580.096 879.104H213.504c-72.704 0-128-55.296-128-119.296V230.4c0-64 55.296-119.296 128-119.296h512c72.704 0 128 55.296 128 119.296v140.8c0 25.6 16.896 42.496 42.496 42.496s42.496-16.896 42.496-42.496V230.4c0-115.2-93.696-204.8-213.504-204.8h-512C93.696 25.6 0 119.296 0 230.4v528.896c0 115.2 93.696 204.8 213.504 204.8h367.104c25.6 0 42.496-16.896 42.496-42.496s-21.504-42.496-43.008-42.496zm171.52 10.752c-15.36-15.36-15.36-40.96 0-56.32l237.568-237.568c15.36-15.36 40.96-15.36 56.32 0s15.36 40.96 0 56.32L807.936 889.856c-15.36 15.36-40.448 15.36-56.32 0z"/></svg>'},{}],"4MPCW":[function(R,M,s){M.exports='<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22"><path d="M16.5 8c1.289 0 2.49.375 3.5 1.022V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h7.022A6.5 6.5 0 0 1 16.5 8zM7 13H5a1 1 0 0 1 0-2h2a1 1 0 0 1 0 2zm2-4H5a1 1 0 0 1 0-2h4a1 1 0 0 1 0 2z"/><path d="m20.587 13.696-.787-.131a3.503 3.503 0 0 0-.593-1.051l.301-.804a.46.46 0 0 0-.21-.56l-1.005-.581a.52.52 0 0 0-.656.113l-.499.607a3.53 3.53 0 0 0-1.276 0l-.499-.607a.52.52 0 0 0-.656-.113l-1.005.581a.46.46 0 0 0-.21.56l.301.804c-.254.31-.456.665-.593 1.051l-.787.131a.48.48 0 0 0-.413.465v1.209a.48.48 0 0 0 .413.465l.811.135c.144.382.353.733.614 1.038l-.292.78a.46.46 0 0 0 .21.56l1.005.581a.52.52 0 0 0 .656-.113l.515-.626a3.549 3.549 0 0 0 1.136 0l.515.626a.52.52 0 0 0 .656.113l1.005-.581a.46.46 0 0 0 .21-.56l-.292-.78c.261-.305.47-.656.614-1.038l.811-.135A.48.48 0 0 0 21 15.37v-1.209a.48.48 0 0 0-.413-.465zM16.5 16.057a1.29 1.29 0 1 1 .002-2.582 1.29 1.29 0 0 1-.002 2.582z"/></svg>'},{}],"7lV5Q":[function(R,M,s){M.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22 22" width="24" height="24"><path d="M17 16H5c-.55 0-1 .45-1 1s.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1zM6.96 15c.39 0 .74-.24.89-.6l.65-1.6h5l.66 1.6c.15.36.5.6.89.6.69 0 1.15-.71.88-1.34l-3.88-8.97C11.87 4.27 11.46 4 11 4s-.87.27-1.05.69l-3.88 8.97c-.27.63.2 1.34.89 1.34zM11 5.98 12.87 11H9.13L11 5.98z"/></svg>'},{}],"8AxLD":[function(R,M,s){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);const t={map:(e,p,I,b,A)=>(e-p)*(A-b)/(I-p)+b,range(e,p,I){const b=Math.round(e/I)*I;return Array.from({length:Math.floor((p-e)/I)},(A,c)=>c*I+b)}};s.default=function(e,p,I){const{query:b}=e.constructor.utils;e.controls.add({name:"heatmap",position:"top",html:"",style:{position:"absolute",top:"-100px",left:"0px",right:"0px",height:"100px",width:"100%",pointerEvents:"none"},mounted(A){let c=null,o=null;function h(){if(c=null,o=null,A.innerHTML="",!p.danmus.length||!e.duration)return;const v={w:A.offsetWidth,h:A.offsetHeight},m={xMin:0,xMax:v.w,yMin:0,yMax:128,scale:.25,opacity:.2,minHeight:Math.floor(.05*v.h),sampling:Math.floor(v.w/100),smoothing:.2,flattening:.2};typeof I=="object"&&Object.assign(m,I);const T=[],f=e.duration/v.w;for(let i=0;i<=v.w;i+=m.sampling){const D=p.danmus.filter(({time:E})=>E>i*f&&E<=(i+m.sampling)*f).length;T.push([i,D])}const n=T[T.length-1],r=n[0],d=n[1];r!==v.w&&T.push([v.w,d]);const u=T.map(i=>i[1]),y=(Math.min(...u)+Math.max(...u))/2;for(let i=0;i<T.length;i++){const D=T[i],E=D[1];D[1]=E*(E>y?1+m.scale:1-m.scale)+m.minHeight}const l=(i,D,E,S)=>{const L=((P,C)=>{const w=C[0]-P[0],F=C[1]-P[1];return{length:Math.sqrt(Math.pow(w,2)+Math.pow(F,2)),angle:Math.atan2(F,w)}})(D||i,E||i),x=t.map(Math.cos(L.angle)*m.flattening,0,1,1,0),g=L.angle*x+(S?Math.PI:0),O=L.length*m.smoothing;return[i[0]+Math.cos(g)*O,i[1]+Math.sin(g)*O]},a=T.map(i=>[t.map(i[0],m.xMin,m.xMax,0,v.w),t.map(i[1],m.yMin,m.yMax,v.h,0)]).reduce((i,D,E,S)=>E===0?`M ${S[S.length-1][0]},${v.h} L ${D[0]},${v.h} L ${D[0]},${D[1]}`:`${i} ${((L,x,g)=>{const O=l(g[x-1],g[x-2],L),P=l(L,g[x-1],g[x+1],!0),C=x===g.length-1?" z":"";return`C ${O[0]},${O[1]} ${P[0]},${P[1]} ${L[0]},${L[1]}${C}`})(D,E,S)}`,"");A.innerHTML=`<svg viewBox="0 0 ${v.w} ${v.h}"><defs><linearGradient id="heatmap-solids" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" style="stop-color:var(--art-theme);stop-opacity:${m.opacity}" /><stop offset="0%" style="stop-color:var(--art-theme);stop-opacity:${m.opacity}" id="heatmap-start" /><stop offset="0%" style="stop-color:var(--art-progress-color);stop-opacity:1" id="heatmap-stop" /><stop offset="100%" style="stop-color:var(--art-progress-color);stop-opacity:1" /></linearGradient></defs><path fill="url(#heatmap-solids)" d="${a}"></path></svg>`,c=b("#heatmap-start",A),o=b("#heatmap-stop",A),c.setAttribute("offset",100*e.played+"%"),o.setAttribute("offset",100*e.played+"%")}e.on("video:timeupdate",()=>{c&&o&&(c.setAttribute("offset",100*e.played+"%"),o.setAttribute("offset",100*e.played+"%"))}),e.on("setBar",(v,m)=>{c&&o&&v==="played"&&(c.setAttribute("offset",100*m+"%"),o.setAttribute("offset",100*m+"%"))}),e.on("ready",h),e.on("resize",h),e.on("artplayerPluginDanmuku:loaded",h)}})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}]},["bgm6t"],"bgm6t","parcelRequire4dc0")})(Gt);const Ie=jt(Gt.exports);var $t={exports:{}};(function(et,lt){var R=function(M){var s=!1;try{if(typeof WebAssembly=="object"&&typeof WebAssembly.instantiate=="function"){const f=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));f instanceof WebAssembly.Module&&(s=new WebAssembly.Instance(f)instanceof WebAssembly.Instance)}}catch{}console.log("WebAssembly support detected: "+(s?"yes":"no"));var t=this;t.canvas=M.canvas,t.renderMode=M.renderMode||(M.lossyRender?"lossy":"wasm-blend"),t.libassMemoryLimit=M.libassMemoryLimit||0,t.libassGlyphLimit=M.libassGlyphLimit||0,t.targetFps=M.targetFps||24,t.prescaleFactor=M.prescaleFactor||1,t.prescaleHeightLimit=M.prescaleHeightLimit||1080,t.maxRenderHeight=M.maxRenderHeight||0,t.dropAllAnimations=M.dropAllAnimations||!1,t.isOurCanvas=!1,t.video=M.video,t.canvasParent=null,t.fonts=M.fonts||[],t.availableFonts=M.availableFonts||[],t.fallbackFont=M.fallbackFont||"default.woff2",t.lazyFileLoading=M.lazyFileLoading||!1,t.onReadyEvent=M.onReady,s?t.workerUrl=M.workerUrl||"subtitles-octopus-worker.js":t.workerUrl=M.legacyWorkerUrl||"subtitles-octopus-worker-legacy.js",t.subUrl=M.subUrl,t.subContent=M.subContent||null,t.onErrorEvent=M.onError,t.debug=M.debug||!1,t.lastRenderTime=0,t.pixelRatio=window.devicePixelRatio||1,t.timeOffset=M.timeOffset||0,t.hasAlphaBug=!1,function(){if(typeof ImageData.prototype.constructor=="function")try{new window.ImageData(new Uint8ClampedArray([0,0,0,0]),1,1);return}catch{console.log("detected that ImageData is not constructable despite browser saying so")}var f=document.createElement("canvas"),n=f.getContext("2d");window.ImageData=function(){var r=0;if(arguments[0]instanceof Uint8ClampedArray)var d=arguments[r++];var u=arguments[r++],y=arguments[r],l=n.createImageData(u,y);return d&&l.data.set(d),l}}(),t.workerError=function(f){if(console.error("Worker error: ",f),t.onErrorEvent&&t.onErrorEvent(f),!t.debug)throw t.dispose(),new Error("Worker error: "+f)},t.init=function(){if(!window.Worker){t.workerError("worker not supported");return}t.worker||(t.worker=new Worker(t.workerUrl),t.worker.addEventListener("message",t.onWorkerMessage),t.worker.addEventListener("error",t.workerError)),t.workerActive=!1,t.createCanvas(),t.setVideo(M.video),t.setSubUrl(M.subUrl),t.worker.postMessage({target:"worker-init",width:t.canvas.width,height:t.canvas.height,URL:document.URL,currentScript:t.workerUrl,preMain:!0,renderMode:t.renderMode,subUrl:t.subUrl,subContent:t.subContent,fonts:t.fonts,availableFonts:t.availableFonts,fallbackFont:t.fallbackFont,lazyFileLoading:t.lazyFileLoading,debug:t.debug,targetFps:t.targetFps,libassMemoryLimit:t.libassMemoryLimit,libassGlyphLimit:t.libassGlyphLimit,dropAllAnimations:t.dropAllAnimations})},t.createCanvas=function(){t.canvas||(t.video?(t.isOurCanvas=!0,t.canvas=document.createElement("canvas"),t.canvas.className="libassjs-canvas",t.canvas.style.display="none",t.canvasParent=document.createElement("div"),t.canvasParent.className="libassjs-canvas-parent",t.canvasParent.appendChild(t.canvas),t.video.nextSibling?t.video.parentNode.insertBefore(t.canvasParent,t.video.nextSibling):t.video.parentNode.appendChild(t.canvasParent)):t.canvas||t.workerError("Don't know where to render: you should give video or canvas in options.")),t.ctx=t.canvas.getContext("2d"),t.bufferCanvas=document.createElement("canvas"),t.bufferCanvasCtx=t.bufferCanvas.getContext("2d"),t.bufferCanvas.width=1,t.bufferCanvas.height=1;var f=new Uint8ClampedArray([0,255,0,0]),n=new ImageData(f,1,1);t.bufferCanvasCtx.clearRect(0,0,1,1),t.ctx.clearRect(0,0,1,1);var r=t.ctx.getImageData(0,0,1,1).data;t.bufferCanvasCtx.putImageData(n,0,0),t.ctx.drawImage(t.bufferCanvas,0,0);var d=t.ctx.getImageData(0,0,1,1).data;t.hasAlphaBug=r[1]!=d[1],t.hasAlphaBug&&console.log("Detected a browser having issue with transparent pixels, applying workaround")};function e(){t.setCurrentTime(t.video.currentTime+t.timeOffset)}function p(){t.setIsPaused(!1,t.video.currentTime+t.timeOffset)}function I(){t.setIsPaused(!0,t.video.currentTime+t.timeOffset)}function b(){t.video.removeEventListener("timeupdate",e,!1)}function A(){t.video.addEventListener("timeupdate",e,!1);var f=t.video.currentTime+t.timeOffset;t.setCurrentTime(f)}function c(){t.setRate(t.video.playbackRate)}function o(){t.setIsPaused(!0,t.video.currentTime+t.timeOffset)}function h(f){f.target.removeEventListener(f.type,h,!1),t.resize()}t.setVideo=function(f){t.video=f,t.video&&(t.video.addEventListener("timeupdate",e,!1),t.video.addEventListener("playing",p,!1),t.video.addEventListener("pause",I,!1),t.video.addEventListener("seeking",b,!1),t.video.addEventListener("seeked",A,!1),t.video.addEventListener("ratechange",c,!1),t.video.addEventListener("waiting",o,!1),document.addEventListener("fullscreenchange",t.resizeWithTimeout,!1),document.addEventListener("mozfullscreenchange",t.resizeWithTimeout,!1),document.addEventListener("webkitfullscreenchange",t.resizeWithTimeout,!1),document.addEventListener("msfullscreenchange",t.resizeWithTimeout,!1),window.addEventListener("resize",t.resizeWithTimeout,!1),typeof ResizeObserver<"u"&&(t.ro=new ResizeObserver(t.resizeWithTimeout),t.ro.observe(t.video)),t.video.videoWidth>0?t.resize():t.video.addEventListener("loadedmetadata",h,!1))},t.getVideoPosition=function(){var f=t.video.videoWidth/t.video.videoHeight,n=t.video.offsetWidth,r=t.video.offsetHeight,d=n/r,u=n,y=r;d>f?u=Math.floor(r*f):y=Math.floor(n/f);var l=(n-u)/2,a=(r-y)/2;return{width:u,height:y,x:l,y:a}},t.setSubUrl=function(f){t.subUrl=f},t.renderFrameData=null;function v(){var f=t.renderFramesData,n=performance.now();t.ctx.clearRect(0,0,t.canvas.width,t.canvas.height);for(var r=0;r<f.canvases.length;r++){var d=f.canvases[r];t.bufferCanvas.width=d.w,t.bufferCanvas.height=d.h;var u=new Uint8ClampedArray(d.buffer);if(t.hasAlphaBug)for(var y=3;y<u.length;y=y+4)u[y]=u[y]>=1?u[y]:1;var l=new ImageData(u,d.w,d.h);t.bufferCanvasCtx.putImageData(l,0,0),t.ctx.drawImage(t.bufferCanvas,d.x,d.y)}if(t.debug){var a=Math.round(performance.now()-n),i=f.blendTime;console.log(typeof i<"u"?"render: "+Math.round(f.spentTime-i)+" ms, blend: "+Math.round(i)+" ms, draw: "+a+" ms; TOTAL="+Math.round(f.spentTime+a)+" ms":Math.round(f.spentTime)+" ms (+ "+a+" ms draw)"),t.renderStart=performance.now()}}function m(){var f=t.renderFramesData,n=performance.now();t.ctx.clearRect(0,0,t.canvas.width,t.canvas.height);for(var r=0;r<f.bitmaps.length;r++){var d=f.bitmaps[r];t.ctx.drawImage(d.bitmap,d.x,d.y)}if(t.debug){var u=Math.round(performance.now()-n);console.log(f.bitmaps.length+" bitmaps, libass: "+Math.round(f.libassTime)+"ms, decode: "+Math.round(f.decodeTime)+"ms, draw: "+u+"ms"),t.renderStart=performance.now()}}t.workerActive=!1,t.frameId=0,t.onWorkerMessage=function(f){t.workerActive||(t.workerActive=!0,t.onReadyEvent&&t.onReadyEvent());var n=f.data;switch(n.target){case"stdout":{console.log(n.content);break}case"console-log":{console.log.apply(console,JSON.parse(n.content));break}case"console-debug":{console.debug.apply(console,JSON.parse(n.content));break}case"console-info":{console.info.apply(console,JSON.parse(n.content));break}case"console-warn":{console.warn.apply(console,JSON.parse(n.content));break}case"console-error":{console.error.apply(console,JSON.parse(n.content));break}case"stderr":{console.error(n.content);break}case"window":{window[n.method]();break}case"canvas":{switch(n.op){case"getContext":{t.ctx=t.canvas.getContext(n.type,n.attributes);break}case"resize":{t.resize(n.width,n.height);break}case"renderCanvas":{t.lastRenderTime<n.time&&(t.lastRenderTime=n.time,t.renderFramesData=n,window.requestAnimationFrame(v));break}case"renderFastCanvas":{t.lastRenderTime<n.time&&(t.lastRenderTime=n.time,t.renderFramesData=n,window.requestAnimationFrame(m));break}case"setObjectProperty":{t.canvas[n.object][n.property]=n.value;break}default:throw"eh?"}break}case"tick":{t.frameId=n.id,t.worker.postMessage({target:"tock",id:t.frameId});break}case"custom":{if(t.onCustomMessage)t.onCustomMessage(f);else throw"Custom message received but client onCustomMessage not implemented.";break}case"setimmediate":{t.worker.postMessage({target:"setimmediate"});break}case"get-events":break;case"get-styles":break;case"ready":break;default:throw"what? "+n.target}};function T(f,n){var r=t.prescaleFactor<=0?1:t.prescaleFactor;if(n<=0||f<=0)f=0,n=0;else{var d=r<1?-1:1,u=n;d*u*r<=d*t.prescaleHeightLimit?u*=r:d*u<d*t.prescaleHeightLimit&&(u=t.prescaleHeightLimit),t.maxRenderHeight>0&&u>t.maxRenderHeight&&(u=t.maxRenderHeight),f*=u/n,n=u}return{width:f,height:n}}t.resize=function(f,n,r,d){var u=null;if(r=r||0,d=d||0,(!f||!n)&&t.video){u=t.getVideoPosition();var y=T(u.width*t.pixelRatio,u.height*t.pixelRatio);f=y.width,n=y.height;var l=t.canvasParent.getBoundingClientRect().top-t.video.getBoundingClientRect().top;r=u.y-l,d=u.x}if(!f||!n){t.video||console.error("width or height is 0. You should specify width & height for resize.");return}(t.canvas.width!=f||t.canvas.height!=n||t.canvas.style.top!=r||t.canvas.style.left!=d)&&(t.canvas.width=f,t.canvas.height=n,u!=null&&(t.canvasParent.style.position="relative",t.canvas.style.display="block",t.canvas.style.position="absolute",t.canvas.style.width=u.width+"px",t.canvas.style.height=u.height+"px",t.canvas.style.top=r+"px",t.canvas.style.left=d+"px",t.canvas.style.pointerEvents="none"),t.worker.postMessage({target:"canvas",width:t.canvas.width,height:t.canvas.height}))},t.resizeWithTimeout=function(){t.resize(),setTimeout(t.resize,100)},t.runBenchmark=function(){t.worker.postMessage({target:"runBenchmark"})},t.customMessage=function(f,n){n=n||{},t.worker.postMessage({target:"custom",userData:f,preMain:n.preMain})},t.setCurrentTime=function(f){t.worker.postMessage({target:"video",currentTime:f})},t.setTrackByUrl=function(f){t.worker.postMessage({target:"set-track-by-url",url:f})},t.setTrack=function(f){t.worker.postMessage({target:"set-track",content:f})},t.freeTrack=function(f){t.worker.postMessage({target:"free-track"})},t.render=t.setCurrentTime,t.setIsPaused=function(f,n){t.worker.postMessage({target:"video",isPaused:f,currentTime:n})},t.setRate=function(f){t.worker.postMessage({target:"video",rate:f})},t.dispose=function(){t.worker.postMessage({target:"destroy"}),t.worker.terminate(),t.worker.removeEventListener("message",t.onWorkerMessage),t.worker.removeEventListener("error",t.workerError),t.workerActive=!1,t.worker=null,t.video&&(t.video.removeEventListener("timeupdate",e,!1),t.video.removeEventListener("playing",p,!1),t.video.removeEventListener("pause",I,!1),t.video.removeEventListener("seeking",b,!1),t.video.removeEventListener("seeked",A,!1),t.video.removeEventListener("ratechange",c,!1),t.video.removeEventListener("waiting",o,!1),t.video.removeEventListener("loadedmetadata",h,!1),document.removeEventListener("fullscreenchange",t.resizeWithTimeout,!1),document.removeEventListener("mozfullscreenchange",t.resizeWithTimeout,!1),document.removeEventListener("webkitfullscreenchange",t.resizeWithTimeout,!1),document.removeEventListener("msfullscreenchange",t.resizeWithTimeout,!1),window.removeEventListener("resize",t.resizeWithTimeout,!1),t.video.parentNode.removeChild(t.canvasParent),t.video=null),t.ro&&(t.ro.disconnect(),t.ro=null),t.onCustomMessage=null,t.onErrorEvent=null,t.onReadyEvent=null},t.fetchFromWorker=function(f,n,r){try{var d=f.target,u=setTimeout(function(){l(Error("Error: Timeout while try to fetch "+d))},5e3),y=function(a){a.data.target==d&&(n(a.data),t.worker.removeEventListener("message",y),t.worker.removeEventListener("error",l),clearTimeout(u))},l=function(a){r(a),t.worker.removeEventListener("message",y),t.worker.removeEventListener("error",l),clearTimeout(u)};t.worker.addEventListener("message",y),t.worker.addEventListener("error",l),t.worker.postMessage(f)}catch(a){r(a)}},t.createEvent=function(f){t.worker.postMessage({target:"create-event",event:f})},t.getEvents=function(f,n){t.fetchFromWorker({target:"get-events"},function(r){f(r.events)},n)},t.setEvent=function(f,n){t.worker.postMessage({target:"set-event",event:f,index:n})},t.removeEvent=function(f){t.worker.postMessage({target:"remove-event",index:f})},t.createStyle=function(f){t.worker.postMessage({target:"create-style",style:f})},t.getStyles=function(f,n){t.fetchFromWorker({target:"get-styles"},function(r){f(r.styles)},n)},t.setStyle=function(f,n){t.worker.postMessage({target:"set-style",style:f,index:n})},t.removeStyle=function(f){t.worker.postMessage({target:"remove-style",index:f})},t.init()};typeof SubtitlesOctopusOnLoad=="function"&&SubtitlesOctopusOnLoad(),et.exports&&(et.exports=R)})($t);const me=$t.exports,ge= window.__dynamic_base__+"/assets/subtitles-octopus-worker.f95f2186.js",ye= window.__dynamic_base__+"/assets/subtitles-octopus-worker.62892886.wasm",Ee= window.__dynamic_base__+"/assets/TimesNewRoman.d9fb32eb.ttf",xe= window.__dynamic_base__+"/assets/SourceHanSansCN-Bold.b5627435.woff2";let bt=null;function Te(et){return/^https?:\/\//.test(et)}function _t(et){return Te(et)?et:new URL(et,document.baseURI).toString()}function Se({workerUrl:et,wasmUrl:lt}){return new Promise(R=>{fetch(et).then(M=>M.text()).then(M=>{let s=M;s=s.replace(/wasmBinaryFile\s*=\s*"(subtitles-octopus-worker\.wasm)"/g,(e,p)=>(lt?lt=_t(lt):lt=new URL(p,_t(et)).toString(),`wasmBinaryFile = "${lt}"`));const t=new Blob([s],{type:"text/javascript"});R(URL.createObjectURL(t))})})}function Nt(et){bt.canvasParent&&(bt.canvasParent.style.display=et?"block":"none")}function Oe(et){return async lt=>(bt=new me({availableFonts:{"times new roman":_t(Ee)},workerUrl:await Se({workerUrl:ge,wasmUrl:ye}),fallbackFont:_t(xe),video:lt.template.$video,...et}),bt.canvasParent.className="artplayer-plugin-ass",bt.canvasParent.style.cssText=`
      position: absolute;
      width: 100%;
      height: 100%;
      user-select: none;
      pointer-events: none;
      z-index: 20;
    `,lt.on("artplayer-plugin-ass:switch",R=>{bt.freeTrack(),bt.setTrackByUrl(R),Nt(!0)}),lt.on("subtitle",R=>Nt(R)),lt.on("artplayer-plugin-ass:visible",R=>Nt(R)),lt.on("subtitleOffset",R=>bt.timeOffset=R),lt.on("destroy",()=>bt.dispose()),{name:"artplayerPluginAss",instance:bt})}var Vt={exports:{}};(function(et,lt){typeof window<"u"&&function(M,s){et.exports=s()}(kt,function(){return function(R){var M={};function s(t){if(M[t])return M[t].exports;var e=M[t]={i:t,l:!1,exports:{}};return R[t].call(e.exports,e,e.exports,s),e.l=!0,e.exports}return s.m=R,s.c=M,s.d=function(t,e,p){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:p})},s.r=function(t){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(e&1&&(t=s(t)),e&8||e&4&&typeof t=="object"&&t&&t.__esModule)return t;var p=Object.create(null);if(s.r(p),Object.defineProperty(p,"default",{enumerable:!0,value:t}),e&2&&typeof t!="string")for(var I in t)s.d(p,I,function(b){return t[b]}.bind(null,I));return p},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/dist/",s(s.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(R,M,s){var t=Object.prototype.hasOwnProperty,e="~";function p(){}Object.create&&(p.prototype=Object.create(null),new p().__proto__||(e=!1));function I(o,h,v){this.fn=o,this.context=h,this.once=v||!1}function b(o,h,v,m,T){if(typeof v!="function")throw new TypeError("The listener must be a function");var f=new I(v,m||o,T),n=e?e+h:h;return o._events[n]?o._events[n].fn?o._events[n]=[o._events[n],f]:o._events[n].push(f):(o._events[n]=f,o._eventsCount++),o}function A(o,h){--o._eventsCount===0?o._events=new p:delete o._events[h]}function c(){this._events=new p,this._eventsCount=0}c.prototype.eventNames=function(){var h=[],v,m;if(this._eventsCount===0)return h;for(m in v=this._events)t.call(v,m)&&h.push(e?m.slice(1):m);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(v)):h},c.prototype.listeners=function(h){var v=e?e+h:h,m=this._events[v];if(!m)return[];if(m.fn)return[m.fn];for(var T=0,f=m.length,n=new Array(f);T<f;T++)n[T]=m[T].fn;return n},c.prototype.listenerCount=function(h){var v=e?e+h:h,m=this._events[v];return m?m.fn?1:m.length:0},c.prototype.emit=function(h,v,m,T,f,n){var r=e?e+h:h;if(!this._events[r])return!1;var d=this._events[r],u=arguments.length,y,l;if(d.fn){switch(d.once&&this.removeListener(h,d.fn,void 0,!0),u){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,v),!0;case 3:return d.fn.call(d.context,v,m),!0;case 4:return d.fn.call(d.context,v,m,T),!0;case 5:return d.fn.call(d.context,v,m,T,f),!0;case 6:return d.fn.call(d.context,v,m,T,f,n),!0}for(l=1,y=new Array(u-1);l<u;l++)y[l-1]=arguments[l];d.fn.apply(d.context,y)}else{var a=d.length,i;for(l=0;l<a;l++)switch(d[l].once&&this.removeListener(h,d[l].fn,void 0,!0),u){case 1:d[l].fn.call(d[l].context);break;case 2:d[l].fn.call(d[l].context,v);break;case 3:d[l].fn.call(d[l].context,v,m);break;case 4:d[l].fn.call(d[l].context,v,m,T);break;default:if(!y)for(i=1,y=new Array(u-1);i<u;i++)y[i-1]=arguments[i];d[l].fn.apply(d[l].context,y)}}return!0},c.prototype.on=function(h,v,m){return b(this,h,v,m,!1)},c.prototype.once=function(h,v,m){return b(this,h,v,m,!0)},c.prototype.removeListener=function(h,v,m,T){var f=e?e+h:h;if(!this._events[f])return this;if(!v)return A(this,f),this;var n=this._events[f];if(n.fn)n.fn===v&&(!T||n.once)&&(!m||n.context===m)&&A(this,f);else{for(var r=0,d=[],u=n.length;r<u;r++)(n[r].fn!==v||T&&!n[r].once||m&&n[r].context!==m)&&d.push(n[r]);d.length?this._events[f]=d.length===1?d[0]:d:A(this,f)}return this},c.prototype.removeAllListeners=function(h){var v;return h?(v=e?e+h:h,this._events[v]&&A(this,v)):(this._events=new p,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=e,c.EventEmitter=c,R.exports=c},"./node_modules/url-toolkit/src/url-toolkit.js":function(R,M,s){(function(t){var e=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,p=/^(?=([^\/?#]*))\1([^]*)$/,I=/(?:\/|^)\.(?=\/)/g,b=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,A={buildAbsoluteURL:function(c,o,h){if(h=h||{},c=c.trim(),o=o.trim(),!o){if(!h.alwaysNormalize)return c;var v=A.parseURL(c);if(!v)throw new Error("Error trying to parse base URL.");return v.path=A.normalizePath(v.path),A.buildURLFromParts(v)}var m=A.parseURL(o);if(!m)throw new Error("Error trying to parse relative URL.");if(m.scheme)return h.alwaysNormalize?(m.path=A.normalizePath(m.path),A.buildURLFromParts(m)):o;var T=A.parseURL(c);if(!T)throw new Error("Error trying to parse base URL.");if(!T.netLoc&&T.path&&T.path[0]!=="/"){var f=p.exec(T.path);T.netLoc=f[1],T.path=f[2]}T.netLoc&&!T.path&&(T.path="/");var n={scheme:T.scheme,netLoc:m.netLoc,path:null,params:m.params,query:m.query,fragment:m.fragment};if(!m.netLoc&&(n.netLoc=T.netLoc,m.path[0]!=="/"))if(!m.path)n.path=T.path,m.params||(n.params=T.params,m.query||(n.query=T.query));else{var r=T.path,d=r.substring(0,r.lastIndexOf("/")+1)+m.path;n.path=A.normalizePath(d)}return n.path===null&&(n.path=h.alwaysNormalize?A.normalizePath(m.path):m.path),A.buildURLFromParts(n)},parseURL:function(c){var o=e.exec(c);return o?{scheme:o[1]||"",netLoc:o[2]||"",path:o[3]||"",params:o[4]||"",query:o[5]||"",fragment:o[6]||""}:null},normalizePath:function(c){for(c=c.split("").reverse().join("").replace(I,"");c.length!==(c=c.replace(b,"")).length;);return c.split("").reverse().join("")},buildURLFromParts:function(c){return c.scheme+c.netLoc+c.path+c.params+c.query+c.fragment}};R.exports=A})()},"./node_modules/webworkify-webpack/index.js":function(R,M,s){function t(h){var v={};function m(f){if(v[f])return v[f].exports;var n=v[f]={i:f,l:!1,exports:{}};return h[f].call(n.exports,n,n.exports,m),n.l=!0,n.exports}m.m=h,m.c=v,m.i=function(f){return f},m.d=function(f,n,r){m.o(f,n)||Object.defineProperty(f,n,{configurable:!1,enumerable:!0,get:r})},m.r=function(f){Object.defineProperty(f,"__esModule",{value:!0})},m.n=function(f){var n=f&&f.__esModule?function(){return f.default}:function(){return f};return m.d(n,"a",n),n},m.o=function(f,n){return Object.prototype.hasOwnProperty.call(f,n)},m.p="/",m.oe=function(f){throw console.error(f),f};var T=m(m.s=ENTRY_MODULE);return T.default||T}var e="[\\.|\\-|\\+|\\w|/|@]+",p="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+e+").*?\\)";function I(h){return(h+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function b(h){return!isNaN(1*h)}function A(h,v,m){var T={};T[m]=[];var f=v.toString(),n=f.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!n)return T;for(var r=n[1],d=new RegExp("(\\\\n|\\W)"+I(r)+p,"g"),u;u=d.exec(f);)u[3]!=="dll-reference"&&T[m].push(u[3]);for(d=new RegExp("\\("+I(r)+'\\("(dll-reference\\s('+e+'))"\\)\\)'+p,"g");u=d.exec(f);)h[u[2]]||(T[m].push(u[1]),h[u[2]]=s(u[1]).m),T[u[2]]=T[u[2]]||[],T[u[2]].push(u[4]);for(var y=Object.keys(T),l=0;l<y.length;l++)for(var a=0;a<T[y[l]].length;a++)b(T[y[l]][a])&&(T[y[l]][a]=1*T[y[l]][a]);return T}function c(h){var v=Object.keys(h);return v.reduce(function(m,T){return m||h[T].length>0},!1)}function o(h,v){for(var m={main:[v]},T={main:[]},f={main:{}};c(m);)for(var n=Object.keys(m),r=0;r<n.length;r++){var d=n[r],u=m[d],y=u.pop();if(f[d]=f[d]||{},!(f[d][y]||!h[d][y])){f[d][y]=!0,T[d]=T[d]||[],T[d].push(y);for(var l=A(h,h[d][y],d),a=Object.keys(l),i=0;i<a.length;i++)m[a[i]]=m[a[i]]||[],m[a[i]]=m[a[i]].concat(l[a[i]])}}return T}R.exports=function(h,v){v=v||{};var m={main:s.m},T=v.all?{main:Object.keys(m.main)}:o(m,h),f="";Object.keys(T).filter(function(y){return y!=="main"}).forEach(function(y){for(var l=0;T[y][l];)l++;T[y].push(l),m[y][l]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",f=f+"var "+y+" = ("+t.toString().replace("ENTRY_MODULE",JSON.stringify(l))+")({"+T[y].map(function(a){return""+JSON.stringify(a)+": "+m[y][a].toString()}).join(",")+`});
`}),f=f+"new (("+t.toString().replace("ENTRY_MODULE",JSON.stringify(h))+")({"+T.main.map(function(y){return""+JSON.stringify(y)+": "+m.main[y].toString()}).join(",")+"}))(self);";var n=new window.Blob([f],{type:"text/javascript"});if(v.bare)return n;var r=window.URL||window.webkitURL||window.mozURL||window.msURL,d=r.createObjectURL(n),u=new window.Worker(d);return u.objectURL=d,u}},"./src/config.ts":function(R,M,s){s.r(M),s.d(M,"hlsDefaultConfig",function(){return i}),s.d(M,"mergeConfig",function(){return E}),s.d(M,"enableStreamingMode",function(){return S});var t=s("./src/controller/abr-controller.ts"),e=s("./src/controller/audio-stream-controller.ts"),p=s("./src/controller/audio-track-controller.ts"),I=s("./src/controller/subtitle-stream-controller.ts"),b=s("./src/controller/subtitle-track-controller.ts"),A=s("./src/controller/buffer-controller.ts"),c=s("./src/controller/timeline-controller.ts"),o=s("./src/controller/cap-level-controller.ts"),h=s("./src/controller/fps-controller.ts"),v=s("./src/controller/eme-controller.ts"),m=s("./src/controller/cmcd-controller.ts"),T=s("./src/utils/xhr-loader.ts"),f=s("./src/utils/fetch-loader.ts"),n=s("./src/utils/cues.ts"),r=s("./src/utils/mediakeys-helper.ts"),d=s("./src/utils/logger.ts");function u(){return u=Object.assign?Object.assign.bind():function(L){for(var x=1;x<arguments.length;x++){var g=arguments[x];for(var O in g)Object.prototype.hasOwnProperty.call(g,O)&&(L[O]=g[O])}return L},u.apply(this,arguments)}function y(L,x){var g=Object.keys(L);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols(L);x&&(O=O.filter(function(P){return Object.getOwnPropertyDescriptor(L,P).enumerable})),g.push.apply(g,O)}return g}function l(L){for(var x=1;x<arguments.length;x++){var g=arguments[x]!=null?arguments[x]:{};x%2?y(Object(g),!0).forEach(function(O){a(L,O,g[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(L,Object.getOwnPropertyDescriptors(g)):y(Object(g)).forEach(function(O){Object.defineProperty(L,O,Object.getOwnPropertyDescriptor(g,O))})}return L}function a(L,x,g){return x in L?Object.defineProperty(L,x,{value:g,enumerable:!0,configurable:!0,writable:!0}):L[x]=g,L}var i=l(l({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:T.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:t.default,bufferController:A.default,capLevelController:o.default,fpsController:h.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:r.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},D()),{},{subtitleStreamController:I.SubtitleStreamController,subtitleTrackController:b.default,timelineController:c.TimelineController,audioStreamController:e.default,audioTrackController:p.default,emeController:v.default,cmcdController:m.default});function D(){return{cueHandler:n.default,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function E(L,x){if((x.liveSyncDurationCount||x.liveMaxLatencyDurationCount)&&(x.liveSyncDuration||x.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(x.liveMaxLatencyDurationCount!==void 0&&(x.liveSyncDurationCount===void 0||x.liveMaxLatencyDurationCount<=x.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(x.liveMaxLatencyDuration!==void 0&&(x.liveSyncDuration===void 0||x.liveMaxLatencyDuration<=x.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return u({},L,x)}function S(L){var x=L.loader;if(x!==f.default&&x!==T.default)d.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),L.progressive=!1;else{var g=Object(f.fetchSupported)();g&&(L.loader=f.default,L.progressive=!0,L.enableSoftwareAES=!0,d.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":function(R,M,s){s.r(M);var t=s("./src/polyfills/number.ts"),e=s("./src/utils/ewma-bandwidth-estimator.ts"),p=s("./src/events.ts"),I=s("./src/utils/buffer-helper.ts"),b=s("./src/errors.ts"),A=s("./src/types/loader.ts"),c=s("./src/utils/logger.ts");function o(m,T){for(var f=0;f<T.length;f++){var n=T[f];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(m,n.key,n)}}function h(m,T,f){return T&&o(m.prototype,T),f&&o(m,f),Object.defineProperty(m,"prototype",{writable:!1}),m}var v=function(){function m(f){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=f;var n=f.config;this.bwEstimator=new e.default(n.abrEwmaSlowVoD,n.abrEwmaFastVoD,n.abrEwmaDefaultEstimate),this.registerListeners()}var T=m.prototype;return T.registerListeners=function(){var n=this.hls;n.on(p.Events.FRAG_LOADING,this.onFragLoading,this),n.on(p.Events.FRAG_LOADED,this.onFragLoaded,this),n.on(p.Events.FRAG_BUFFERED,this.onFragBuffered,this),n.on(p.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.on(p.Events.ERROR,this.onError,this)},T.unregisterListeners=function(){var n=this.hls;n.off(p.Events.FRAG_LOADING,this.onFragLoading,this),n.off(p.Events.FRAG_LOADED,this.onFragLoaded,this),n.off(p.Events.FRAG_BUFFERED,this.onFragBuffered,this),n.off(p.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.off(p.Events.ERROR,this.onError,this)},T.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},T.onFragLoading=function(n,r){var d=r.frag;if(d.type===A.PlaylistLevelType.MAIN&&!this.timer){var u;this.fragCurrent=d,this.partCurrent=(u=r.part)!=null?u:null,this.timer=self.setInterval(this.onCheck,100)}},T.onLevelLoaded=function(n,r){var d=this.hls.config;r.details.live?this.bwEstimator.update(d.abrEwmaSlowLive,d.abrEwmaFastLive):this.bwEstimator.update(d.abrEwmaSlowVoD,d.abrEwmaFastVoD)},T._abandonRulesCheck=function(){var n=this.fragCurrent,r=this.partCurrent,d=this.hls,u=d.autoLevelEnabled,y=d.config,l=d.media;if(!(!n||!l)){var a=r?r.stats:n.stats,i=r?r.duration:n.duration;if(a.aborted){c.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),this._nextAutoLevel=-1;return}if(!(!u||l.paused||!l.playbackRate||!l.readyState)){var D=performance.now()-a.loading.start,E=Math.abs(l.playbackRate);if(!(D<=500*i/E)){var S=d.levels,L=d.minAutoLevel,x=S[n.level],g=a.total||Math.max(a.loaded,Math.round(i*x.maxBitrate/8)),O=Math.max(1,a.bwEstimate?a.bwEstimate/8:a.loaded*1e3/D),P=(g-a.loaded)/O,C=l.currentTime,w=(I.BufferHelper.bufferInfo(l,C,y.maxBufferHole).end-C)/E;if(!(w>=2*i/E||P<=w)){var F=Number.POSITIVE_INFINITY,k;for(k=n.level-1;k>L;k--){var _=S[k].maxBitrate;if(F=i*_/(8*.8*O),F<w)break}if(!(F>=P)){var B=this.bwEstimator.getEstimate();c.logger.warn("Fragment "+n.sn+(r?" part "+r.index:"")+" of level "+n.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+k+`
      Current BW estimate: `+(Object(t.isFiniteNumber)(B)?(B/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+P.toFixed(3)+` s
      Estimated load time for the next fragment: `+F.toFixed(3)+` s
      Time to underbuffer: `+w.toFixed(3)+" s"),d.nextLoadLevel=k,this.bwEstimator.sample(D,a.loaded),this.clearTimer(),n.loader&&(this.fragCurrent=this.partCurrent=null,n.loader.abort()),d.trigger(p.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n,part:r,stats:a})}}}}}},T.onFragLoaded=function(n,r){var d=r.frag,u=r.part;if(d.type===A.PlaylistLevelType.MAIN&&Object(t.isFiniteNumber)(d.sn)){var y=u?u.stats:d.stats,l=u?u.duration:d.duration;if(this.clearTimer(),this.lastLoadedFragLevel=d.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var a=this.hls.levels[d.level],i=(a.loaded?a.loaded.bytes:0)+y.loaded,D=(a.loaded?a.loaded.duration:0)+l;a.loaded={bytes:i,duration:D},a.realBitrate=Math.round(8*i/D)}if(d.bitrateTest){var E={stats:y,frag:d,part:u,id:d.type};this.onFragBuffered(p.Events.FRAG_BUFFERED,E),d.bitrateTest=!1}}},T.onFragBuffered=function(n,r){var d=r.frag,u=r.part,y=u?u.stats:d.stats;if(!y.aborted&&!(d.type!==A.PlaylistLevelType.MAIN||d.sn==="initSegment")){var l=y.parsing.end-y.loading.start;this.bwEstimator.sample(l,y.loaded),y.bwEstimate=this.bwEstimator.getEstimate(),d.bitrateTest?this.bitrateTestDelay=l/1e3:this.bitrateTestDelay=0}},T.onError=function(n,r){switch(r.details){case b.ErrorDetails.FRAG_LOAD_ERROR:case b.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer();break}},T.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},T.getNextABRAutoLevel=function(){var n=this.fragCurrent,r=this.partCurrent,d=this.hls,u=d.maxAutoLevel,y=d.config,l=d.minAutoLevel,a=d.media,i=r?r.duration:n?n.duration:0,D=a?a.currentTime:0,E=a&&a.playbackRate!==0?Math.abs(a.playbackRate):1,S=this.bwEstimator?this.bwEstimator.getEstimate():y.abrEwmaDefaultEstimate,L=(I.BufferHelper.bufferInfo(a,D,y.maxBufferHole).end-D)/E,x=this.findBestLevel(S,l,u,L,y.abrBandWidthFactor,y.abrBandWidthUpFactor);if(x>=0)return x;c.logger.trace((L?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var g=i?Math.min(i,y.maxStarvationDelay):y.maxStarvationDelay,O=y.abrBandWidthFactor,P=y.abrBandWidthUpFactor;if(!L){var C=this.bitrateTestDelay;if(C){var w=i?Math.min(i,y.maxLoadingDelay):y.maxLoadingDelay;g=w-C,c.logger.trace("bitrate test took "+Math.round(1e3*C)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*g)+" ms"),O=P=1}}return x=this.findBestLevel(S,l,u,L+g,O,P),Math.max(x,0)},T.findBestLevel=function(n,r,d,u,y,l){for(var a,i=this.fragCurrent,D=this.partCurrent,E=this.lastLoadedFragLevel,S=this.hls.levels,L=S[E],x=!!(L!=null&&(a=L.details)!==null&&a!==void 0&&a.live),g=L==null?void 0:L.codecSet,O=D?D.duration:i?i.duration:0,P=d;P>=r;P--){var C=S[P];if(!(!C||g&&C.codecSet!==g)){var w=C.details,F=(D?w==null?void 0:w.partTarget:w==null?void 0:w.averagetargetduration)||O,k=void 0;P<=E?k=y*n:k=l*n;var _=S[P].maxBitrate,B=_*F/k;if(c.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+P+"/"+Math.round(k)+"/"+_+"/"+F+"/"+u+"/"+B),k>_&&(!B||x&&!this.bitrateTestDelay||B<u))return P}}return-1},h(m,[{key:"nextAutoLevel",get:function(){var n=this._nextAutoLevel,r=this.bwEstimator;if(n!==-1&&(!r||!r.canEstimate()))return n;var d=this.getNextABRAutoLevel();return n!==-1&&(d=Math.min(n,d)),d},set:function(n){this._nextAutoLevel=n}}]),m}();M.default=v},"./src/controller/audio-stream-controller.ts":function(R,M,s){s.r(M);var t=s("./src/polyfills/number.ts"),e=s("./src/controller/base-stream-controller.ts"),p=s("./src/events.ts"),I=s("./src/utils/buffer-helper.ts"),b=s("./src/controller/fragment-tracker.ts"),A=s("./src/types/level.ts"),c=s("./src/types/loader.ts"),o=s("./src/loader/fragment.ts"),h=s("./src/demux/chunk-cache.ts"),v=s("./src/demux/transmuxer-interface.ts"),m=s("./src/types/transmuxer.ts"),T=s("./src/controller/fragment-finders.ts"),f=s("./src/utils/discontinuities.ts"),n=s("./src/errors.ts");function r(){return r=Object.assign?Object.assign.bind():function(a){for(var i=1;i<arguments.length;i++){var D=arguments[i];for(var E in D)Object.prototype.hasOwnProperty.call(D,E)&&(a[E]=D[E])}return a},r.apply(this,arguments)}function d(a,i){a.prototype=Object.create(i.prototype),a.prototype.constructor=a,u(a,i)}function u(a,i){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(E,S){return E.__proto__=S,E},u(a,i)}var y=100,l=function(a){d(i,a);function i(E,S){var L;return L=a.call(this,E,S,"[audio-stream-controller]")||this,L.videoBuffer=null,L.videoTrackCC=-1,L.waitingVideoCC=-1,L.audioSwitch=!1,L.trackId=-1,L.waitingData=null,L.mainDetails=null,L.bufferFlushed=!1,L.cachedTrackLoadedData=null,L._registerListeners(),L}var D=i.prototype;return D.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},D._registerListeners=function(){var S=this.hls;S.on(p.Events.MEDIA_ATTACHED,this.onMediaAttached,this),S.on(p.Events.MEDIA_DETACHING,this.onMediaDetaching,this),S.on(p.Events.MANIFEST_LOADING,this.onManifestLoading,this),S.on(p.Events.LEVEL_LOADED,this.onLevelLoaded,this),S.on(p.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),S.on(p.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),S.on(p.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),S.on(p.Events.ERROR,this.onError,this),S.on(p.Events.BUFFER_RESET,this.onBufferReset,this),S.on(p.Events.BUFFER_CREATED,this.onBufferCreated,this),S.on(p.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),S.on(p.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),S.on(p.Events.FRAG_BUFFERED,this.onFragBuffered,this)},D._unregisterListeners=function(){var S=this.hls;S.off(p.Events.MEDIA_ATTACHED,this.onMediaAttached,this),S.off(p.Events.MEDIA_DETACHING,this.onMediaDetaching,this),S.off(p.Events.MANIFEST_LOADING,this.onManifestLoading,this),S.off(p.Events.LEVEL_LOADED,this.onLevelLoaded,this),S.off(p.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),S.off(p.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),S.off(p.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),S.off(p.Events.ERROR,this.onError,this),S.off(p.Events.BUFFER_RESET,this.onBufferReset,this),S.off(p.Events.BUFFER_CREATED,this.onBufferCreated,this),S.off(p.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),S.off(p.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),S.off(p.Events.FRAG_BUFFERED,this.onFragBuffered,this)},D.onInitPtsFound=function(S,L){var x=L.frag,g=L.id,O=L.initPTS;if(g==="main"){var P=x.cc;this.initPTS[x.cc]=O,this.log("InitPTS for cc: "+P+" found from main: "+O),this.videoTrackCC=P,this.state===e.State.WAITING_INIT_PTS&&this.tick()}},D.startLoad=function(S){if(!this.levels){this.startPosition=S,this.state=e.State.STOPPED;return}var L=this.lastCurrentTime;this.stopLoad(),this.setInterval(y),this.fragLoadError=0,L>0&&S===-1?(this.log("Override startPosition with lastCurrentTime @"+L.toFixed(3)),S=L,this.state=e.State.IDLE):(this.loadedmetadata=!1,this.state=e.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=S,this.tick()},D.doTick=function(){switch(this.state){case e.State.IDLE:this.doTickIdle();break;case e.State.WAITING_TRACK:{var S,L=this.levels,x=this.trackId,g=L==null||(S=L[x])===null||S===void 0?void 0:S.details;if(g){if(this.waitForCdnTuneIn(g))break;this.state=e.State.WAITING_INIT_PTS}break}case e.State.FRAG_LOADING_WAITING_RETRY:{var O,P=performance.now(),C=this.retryDate;(!C||P>=C||(O=this.media)!==null&&O!==void 0&&O.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=e.State.IDLE);break}case e.State.WAITING_INIT_PTS:{var w=this.waitingData;if(w){var F=w.frag,k=w.part,_=w.cache,B=w.complete;if(this.initPTS[F.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=e.State.FRAG_LOADING;var N=_.flush(),U={frag:F,part:k,payload:N,networkDetails:null};this._handleFragmentLoadProgress(U),B&&a.prototype._handleFragmentLoadComplete.call(this,U)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+F.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var j=this.getLoadPosition(),W=I.BufferHelper.bufferInfo(this.mediaBuffer,j,this.config.maxBufferHole),H=Object(T.fragmentWithinToleranceTest)(W.end,this.config.maxFragLookUpTolerance,F);H<0&&(this.log("Waiting fragment cc ("+F.cc+") @ "+F.start+" cancelled because another fragment at "+W.end+" is needed"),this.clearWaitingFragment())}}else this.state=e.State.IDLE}}this.onTickEnd()},D.clearWaitingFragment=function(){var S=this.waitingData;S&&(this.fragmentTracker.removeFragment(S.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=e.State.IDLE)},D.resetLoadingState=function(){this.clearWaitingFragment(),a.prototype.resetLoadingState.call(this)},D.onTickEnd=function(){var S=this.media;if(!(!S||!S.readyState)){var L=this.mediaBuffer?this.mediaBuffer:S,x=L.buffered;!this.loadedmetadata&&x.length&&(this.loadedmetadata=!0),this.lastCurrentTime=S.currentTime}},D.doTickIdle=function(){var S,L,x=this.hls,g=this.levels,O=this.media,P=this.trackId,C=x.config;if(!(!g||!g[P])&&!(!O&&(this.startFragRequested||!C.startFragPrefetch))){var w=g[P],F=w.details;if(!F||F.live&&this.levelLastLoaded!==P||this.waitForCdnTuneIn(F)){this.state=e.State.WAITING_TRACK;return}this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,o.ElementaryStreamTypes.AUDIO,c.PlaylistLevelType.AUDIO));var k=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,c.PlaylistLevelType.AUDIO);if(k!==null){var _=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,c.PlaylistLevelType.MAIN),B=k.len,N=this.getMaxBufferLength(_==null?void 0:_.len),U=this.audioSwitch;if(!(B>=N&&!U)){if(!U&&this._streamEnded(k,F)){x.trigger(p.Events.BUFFER_EOS,{type:"audio"}),this.state=e.State.ENDED;return}var j=F.fragments,W=j[0].start,H=k.end;if(U){var G=this.getLoadPosition();H=G,F.PTSKnown&&G<W&&(k.end>W||k.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),O.currentTime=W+.05)}if(!(_&&H>_.end+F.targetduration)&&!((!_||!_.len)&&k.len)){var K=this.getNextFragment(H,F);if(!K){this.bufferFlushed=!0;return}((S=K.decryptdata)===null||S===void 0?void 0:S.keyFormat)==="identity"&&!((L=K.decryptdata)!==null&&L!==void 0&&L.key)?this.loadKey(K,F):this.loadFragment(K,F,H)}}}}},D.getMaxBufferLength=function(S){var L=a.prototype.getMaxBufferLength.call(this);return S?Math.max(L,S):L},D.onMediaDetaching=function(){this.videoBuffer=null,a.prototype.onMediaDetaching.call(this)},D.onAudioTracksUpdated=function(S,L){var x=L.audioTracks;this.resetTransmuxer(),this.levels=x.map(function(g){return new A.Level(g)})},D.onAudioTrackSwitching=function(S,L){var x=!!L.url;this.trackId=L.id;var g=this.fragCurrent;g!=null&&g.loader&&g.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),x?this.setInterval(y):this.resetTransmuxer(),x?(this.audioSwitch=!0,this.state=e.State.IDLE):this.state=e.State.STOPPED,this.tick()},D.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},D.onLevelLoaded=function(S,L){this.mainDetails=L.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(p.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},D.onAudioTrackLoaded=function(S,L){var x;if(this.mainDetails==null){this.cachedTrackLoadedData=L;return}var g=this.levels,O=L.details,P=L.id;if(!g){this.warn("Audio tracks were reset while loading level "+P);return}this.log("Track "+P+" loaded ["+O.startSN+","+O.endSN+"],duration:"+O.totalduration);var C=g[P],w=0;if(O.live||(x=C.details)!==null&&x!==void 0&&x.live){var F=this.mainDetails;if(O.fragments[0]||(O.deltaUpdateFailed=!0),O.deltaUpdateFailed||!F)return;!C.details&&O.hasProgramDateTime&&F.hasProgramDateTime?(Object(f.alignMediaPlaylistByPDT)(O,F),w=O.fragments[0].start):w=this.alignPlaylists(O,C.details)}C.details=O,this.levelLastLoaded=P,!this.startFragRequested&&(this.mainDetails||!O.live)&&this.setStartPosition(C.details,w),this.state===e.State.WAITING_TRACK&&!this.waitForCdnTuneIn(O)&&(this.state=e.State.IDLE),this.tick()},D._handleFragmentLoadProgress=function(S){var L,x=S.frag,g=S.part,O=S.payload,P=this.config,C=this.trackId,w=this.levels;if(!w){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+x.sn+" of level "+x.level+" will not be buffered");return}var F=w[C];console.assert(F,"Audio track is defined on fragment load progress");var k=F.details;console.assert(k,"Audio track details are defined on fragment load progress");var _=P.defaultAudioCodec||F.audioCodec||"mp4a.40.2",B=this.transmuxer;B||(B=this.transmuxer=new v.default(this.hls,c.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var N=this.initPTS[x.cc],U=(L=x.initSegment)===null||L===void 0?void 0:L.data;if(N!==void 0){var j=!1,W=g?g.index:-1,H=W!==-1,G=new m.ChunkMetadata(x.level,x.sn,x.stats.chunkCount,O.byteLength,W,H);B.push(O,U,_,"",x,g,k.totalduration,j,G,N)}else{this.log("Unknown video PTS for cc "+x.cc+", waiting for video PTS before demuxing audio frag "+x.sn+" of ["+k.startSN+" ,"+k.endSN+"],track "+C);var K=this.waitingData=this.waitingData||{frag:x,part:g,cache:new h.default,complete:!1},X=K.cache;X.push(new Uint8Array(O)),this.waitingVideoCC=this.videoTrackCC,this.state=e.State.WAITING_INIT_PTS}},D._handleFragmentLoadComplete=function(S){if(this.waitingData){this.waitingData.complete=!0;return}a.prototype._handleFragmentLoadComplete.call(this,S)},D.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},D.onBufferCreated=function(S,L){var x=L.tracks.audio;x&&(this.mediaBuffer=x.buffer),L.tracks.video&&(this.videoBuffer=L.tracks.video.buffer)},D.onFragBuffered=function(S,L){var x=L.frag,g=L.part;if(x.type===c.PlaylistLevelType.AUDIO){if(this.fragContextChanged(x)){this.warn("Fragment "+x.sn+(g?" p: "+g.index:"")+" of level "+x.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}x.sn!=="initSegment"&&(this.fragPrevious=x,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(p.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(x,g)}},D.onError=function(S,L){switch(L.details){case n.ErrorDetails.FRAG_LOAD_ERROR:case n.ErrorDetails.FRAG_LOAD_TIMEOUT:case n.ErrorDetails.KEY_LOAD_ERROR:case n.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(c.PlaylistLevelType.AUDIO,L);break;case n.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case n.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==e.State.ERROR&&this.state!==e.State.STOPPED&&(this.state=L.fatal?e.State.ERROR:e.State.IDLE,this.warn(L.details+" while loading frag, switching to "+this.state+" state"));break;case n.ErrorDetails.BUFFER_FULL_ERROR:if(L.parent==="audio"&&(this.state===e.State.PARSING||this.state===e.State.PARSED)){var x=!0,g=this.getFwdBufferInfo(this.mediaBuffer,c.PlaylistLevelType.AUDIO);g&&g.len>.5&&(x=!this.reduceMaxBufferLength(g.len)),x&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,a.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break}},D.onBufferFlushed=function(S,L){var x=L.type;x===o.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},D._handleTransmuxComplete=function(S){var L,x="audio",g=this.hls,O=S.remuxResult,P=S.chunkMeta,C=this.getCurrentContext(P);if(!C){this.warn("The loading context changed while buffering fragment "+P.sn+" of level "+P.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(P.level);return}var w=C.frag,F=C.part,k=C.level.details,_=O.audio,B=O.text,N=O.id3,U=O.initSegment;if(!(this.fragContextChanged(w)||!k)){if(this.state=e.State.PARSING,this.audioSwitch&&_&&this.completeAudioSwitch(),U!=null&&U.tracks&&(this._bufferInitSegment(U.tracks,w,P),g.trigger(p.Events.FRAG_PARSING_INIT_SEGMENT,{frag:w,id:x,tracks:U.tracks})),_){var j=_.startPTS,W=_.endPTS,H=_.startDTS,G=_.endDTS;F&&(F.elementaryStreams[o.ElementaryStreamTypes.AUDIO]={startPTS:j,endPTS:W,startDTS:H,endDTS:G}),w.setElementaryStreamInfo(o.ElementaryStreamTypes.AUDIO,j,W,H,G),this.bufferFragmentData(_,w,F,P)}if(N!=null&&(L=N.samples)!==null&&L!==void 0&&L.length){var K=r({id:x,frag:w,details:k},N);g.trigger(p.Events.FRAG_PARSING_METADATA,K)}if(B){var X=r({id:x,frag:w,details:k},B);g.trigger(p.Events.FRAG_PARSING_USERDATA,X)}}},D._bufferInitSegment=function(S,L,x){if(this.state===e.State.PARSING){S.video&&delete S.video;var g=S.audio;if(!!g){g.levelCodec=g.codec,g.id="audio",this.log("Init audio buffer, container:"+g.container+", codecs[parsed]=["+g.codec+"]"),this.hls.trigger(p.Events.BUFFER_CODECS,S);var O=g.initSegment;if(O!=null&&O.byteLength){var P={type:"audio",frag:L,part:null,chunkMeta:x,parent:L.type,data:O};this.hls.trigger(p.Events.BUFFER_APPENDING,P)}this.tick()}}},D.loadFragment=function(S,L,x){var g=this.fragmentTracker.getState(S);this.fragCurrent=S,(this.audioSwitch||g===b.FragmentState.NOT_LOADED||g===b.FragmentState.PARTIAL)&&(S.sn==="initSegment"?this._loadInitSegment(S):L.live&&!Object(t.isFiniteNumber)(this.initPTS[S.cc])?(this.log("Waiting for video PTS in continuity counter "+S.cc+" of live stream before loading audio fragment "+S.sn+" of level "+this.trackId),this.state=e.State.WAITING_INIT_PTS):(this.startFragRequested=!0,a.prototype.loadFragment.call(this,S,L,x)))},D.completeAudioSwitch=function(){var S=this.hls,L=this.media,x=this.trackId;L&&(this.log("Switching audio track : flushing all audio"),a.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,S.trigger(p.Events.AUDIO_TRACK_SWITCHED,{id:x})},i}(e.default);M.default=l},"./src/controller/audio-track-controller.ts":function(R,M,s){s.r(M);var t=s("./src/events.ts"),e=s("./src/errors.ts"),p=s("./src/controller/base-playlist-controller.ts"),I=s("./src/types/loader.ts");function b(v,m){for(var T=0;T<m.length;T++){var f=m[T];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(v,f.key,f)}}function A(v,m,T){return m&&b(v.prototype,m),T&&b(v,T),Object.defineProperty(v,"prototype",{writable:!1}),v}function c(v,m){v.prototype=Object.create(m.prototype),v.prototype.constructor=v,o(v,m)}function o(v,m){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(f,n){return f.__proto__=n,f},o(v,m)}var h=function(v){c(m,v);function m(f){var n;return n=v.call(this,f,"[audio-track-controller]")||this,n.tracks=[],n.groupId=null,n.tracksInGroup=[],n.trackId=-1,n.trackName="",n.selectDefaultTrack=!0,n.registerListeners(),n}var T=m.prototype;return T.registerListeners=function(){var n=this.hls;n.on(t.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.on(t.Events.MANIFEST_PARSED,this.onManifestParsed,this),n.on(t.Events.LEVEL_LOADING,this.onLevelLoading,this),n.on(t.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),n.on(t.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.on(t.Events.ERROR,this.onError,this)},T.unregisterListeners=function(){var n=this.hls;n.off(t.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.off(t.Events.MANIFEST_PARSED,this.onManifestParsed,this),n.off(t.Events.LEVEL_LOADING,this.onLevelLoading,this),n.off(t.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),n.off(t.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.off(t.Events.ERROR,this.onError,this)},T.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,v.prototype.destroy.call(this)},T.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},T.onManifestParsed=function(n,r){this.tracks=r.audioTracks||[]},T.onAudioTrackLoaded=function(n,r){var d=r.id,u=r.details,y=this.tracksInGroup[d];if(!y){this.warn("Invalid audio track id "+d);return}var l=y.details;y.details=r.details,this.log("audioTrack "+d+" loaded ["+u.startSN+"-"+u.endSN+"]"),d===this.trackId&&(this.retryCount=0,this.playlistLoaded(d,r,l))},T.onLevelLoading=function(n,r){this.switchLevel(r.level)},T.onLevelSwitching=function(n,r){this.switchLevel(r.level)},T.switchLevel=function(n){var r=this.hls.levels[n];if(!!(r!=null&&r.audioGroupIds)){var d=r.audioGroupIds[r.urlId];if(this.groupId!==d){this.groupId=d;var u=this.tracks.filter(function(l){return!d||l.groupId===d});this.selectDefaultTrack&&!u.some(function(l){return l.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=u;var y={audioTracks:u};this.log("Updating audio tracks, "+u.length+' track(s) found in "'+d+'" group-id'),this.hls.trigger(t.Events.AUDIO_TRACKS_UPDATED,y),this.selectInitialTrack()}}},T.onError=function(n,r){v.prototype.onError.call(this,n,r),!(r.fatal||!r.context)&&r.context.type===I.PlaylistContextType.AUDIO_TRACK&&r.context.id===this.trackId&&r.context.groupId===this.groupId&&this.retryLoadingOrFail(r)},T.setAudioTrack=function(n){var r=this.tracksInGroup;if(n<0||n>=r.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var d=r[this.trackId];this.log("Now switching to audio-track index "+n);var u=r[n],y=u.id,l=u.groupId,a=l===void 0?"":l,i=u.name,D=u.type,E=u.url;if(this.trackId=n,this.trackName=i,this.selectDefaultTrack=!1,this.hls.trigger(t.Events.AUDIO_TRACK_SWITCHING,{id:y,groupId:a,name:i,type:D,url:E}),!(u.details&&!u.details.live)){var S=this.switchParams(u.url,d==null?void 0:d.details);this.loadPlaylist(S)}},T.selectInitialTrack=function(){var n=this.tracksInGroup;console.assert(n.length,"Initial audio track should be selected when tracks are known");var r=this.trackName,d=this.findTrackId(r)||this.findTrackId();d!==-1?this.setAudioTrack(d):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(t.Events.ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},T.findTrackId=function(n){for(var r=this.tracksInGroup,d=0;d<r.length;d++){var u=r[d];if((!this.selectDefaultTrack||u.default)&&(!n||n===u.name))return u.id}return-1},T.loadPlaylist=function(n){var r=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(r)){var d=r.id,u=r.groupId,y=r.url;if(n)try{y=n.addDirectives(y)}catch(l){this.warn("Could not construct new URL with HLS Delivery Directives: "+l)}this.log("loading audio-track playlist for id: "+d),this.clearTimer(),this.hls.trigger(t.Events.AUDIO_TRACK_LOADING,{url:y,id:d,groupId:u,deliveryDirectives:n||null})}},A(m,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(n){this.selectDefaultTrack=!1,this.setAudioTrack(n)}}]),m}(p.default);M.default=h},"./src/controller/base-playlist-controller.ts":function(R,M,s){s.r(M),s.d(M,"default",function(){return A});var t=s("./src/polyfills/number.ts"),e=s("./src/types/level.ts"),p=s("./src/controller/level-helper.ts"),I=s("./src/utils/logger.ts"),b=s("./src/errors.ts"),A=function(){function c(h,v){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=I.logger.log.bind(I.logger,v+":"),this.warn=I.logger.warn.bind(I.logger,v+":"),this.hls=h}var o=c.prototype;return o.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},o.onError=function(v,m){m.fatal&&m.type===b.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},o.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},o.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},o.stopLoad=function(){this.canLoad=!1,this.clearTimer()},o.switchParams=function(v,m){var T=m==null?void 0:m.renditionReports;if(T)for(var f=0;f<T.length;f++){var n=T[f],r=""+n.URI;if(r===v.slice(-r.length)){var d=parseInt(n["LAST-MSN"]),u=parseInt(n["LAST-PART"]);if(m&&this.hls.config.lowLatencyMode){var y=Math.min(m.age-m.partTarget,m.targetduration);u!==void 0&&y>m.partTarget&&(u+=1)}if(Object(t.isFiniteNumber)(d))return new e.HlsUrlParameters(d,Object(t.isFiniteNumber)(u)?u:void 0,e.HlsSkip.No)}}},o.loadPlaylist=function(v){},o.shouldLoadTrack=function(v){return this.canLoad&&v&&!!v.url&&(!v.details||v.details.live)},o.playlistLoaded=function(v,m,T){var f=this,n=m.details,r=m.stats,d=r.loading.end?Math.max(0,self.performance.now()-r.loading.end):0;if(n.advancedDateTime=Date.now()-d,n.live||T!=null&&T.live){if(n.reloaded(T),T&&this.log("live playlist "+v+" "+(n.advanced?"REFRESHED "+n.lastPartSn+"-"+n.lastPartIndex:"MISSED")),T&&n.fragments.length>0&&Object(p.mergeDetails)(T,n),!this.canLoad||!n.live)return;var u,y=void 0,l=void 0;if(n.canBlockReload&&n.endSN&&n.advanced){var a=this.hls.config.lowLatencyMode,i=n.lastPartSn,D=n.endSN,E=n.lastPartIndex,S=E!==-1,L=i===D,x=a?0:E;S?(y=L?D+1:i,l=L?x:E+1):y=D+1;var g=n.age,O=g+n.ageHeader,P=Math.min(O-n.partTarget,n.targetduration*1.5);if(P>0){if(T&&P>T.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+T.tuneInGoal+" to: "+P+" with playlist age: "+n.age),P=0;else{var C=Math.floor(P/n.targetduration);if(y+=C,l!==void 0){var w=Math.round(P%n.targetduration/n.partTarget);l+=w}this.log("CDN Tune-in age: "+n.ageHeader+"s last advanced "+g.toFixed(2)+"s goal: "+P+" skip sn "+C+" to part "+l)}n.tuneInGoal=P}if(u=this.getDeliveryDirectives(n,m.deliveryDirectives,y,l),a||!L){this.loadPlaylist(u);return}}else u=this.getDeliveryDirectives(n,m.deliveryDirectives,y,l);var F=Object(p.computeReloadInterval)(n,r);y!==void 0&&n.canBlockReload&&(F-=n.partTarget||1),this.log("reload live playlist "+v+" in "+Math.round(F)+" ms"),this.timer=self.setTimeout(function(){return f.loadPlaylist(u)},F)}else this.clearTimer()},o.getDeliveryDirectives=function(v,m,T,f){var n=Object(e.getSkipValue)(v,T);return m!=null&&m.skip&&v.deltaUpdateFailed&&(T=m.msn,f=m.part,n=e.HlsSkip.No),new e.HlsUrlParameters(T,f,n)},o.retryLoadingOrFail=function(v){var m=this,T=this.hls.config,f=this.retryCount<T.levelLoadingMaxRetry;if(f){var n;if(this.retryCount++,v.details.indexOf("LoadTimeOut")>-1&&(n=v.context)!==null&&n!==void 0&&n.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+v.details+'"'),this.loadPlaylist();else{var r=Math.min(Math.pow(2,this.retryCount)*T.levelLoadingRetryDelay,T.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return m.loadPlaylist()},r),this.warn("retry playlist loading #"+this.retryCount+" in "+r+' ms after "'+v.details+'"')}}else this.warn('cannot recover from error "'+v.details+'"'),this.clearTimer(),v.fatal=!0;return f},c}()},"./src/controller/base-stream-controller.ts":function(R,M,s){s.r(M),s.d(M,"State",function(){return D}),s.d(M,"default",function(){return E});var t=s("./src/polyfills/number.ts"),e=s("./src/task-loop.ts"),p=s("./src/controller/fragment-tracker.ts"),I=s("./src/utils/buffer-helper.ts"),b=s("./src/utils/logger.ts"),A=s("./src/events.ts"),c=s("./src/errors.ts"),o=s("./src/types/transmuxer.ts"),h=s("./src/utils/mp4-tools.ts"),v=s("./src/utils/discontinuities.ts"),m=s("./src/controller/fragment-finders.ts"),T=s("./src/controller/level-helper.ts"),f=s("./src/loader/fragment-loader.ts"),n=s("./src/crypt/decrypter.ts"),r=s("./src/utils/time-ranges.ts"),d=s("./src/types/loader.ts");function u(S,L){for(var x=0;x<L.length;x++){var g=L[x];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(S,g.key,g)}}function y(S,L,x){return L&&u(S.prototype,L),x&&u(S,x),Object.defineProperty(S,"prototype",{writable:!1}),S}function l(S){if(S===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return S}function a(S,L){S.prototype=Object.create(L.prototype),S.prototype.constructor=S,i(S,L)}function i(S,L){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(g,O){return g.__proto__=O,g},i(S,L)}var D={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},E=function(S){a(L,S);function L(g,O,P){var C;return C=S.call(this)||this,C.hls=void 0,C.fragPrevious=null,C.fragCurrent=null,C.fragmentTracker=void 0,C.transmuxer=null,C._state=D.STOPPED,C.media=void 0,C.mediaBuffer=void 0,C.config=void 0,C.bitrateTest=!1,C.lastCurrentTime=0,C.nextLoadPosition=0,C.startPosition=0,C.loadedmetadata=!1,C.fragLoadError=0,C.retryDate=0,C.levels=null,C.fragmentLoader=void 0,C.levelLastLoaded=null,C.startFragRequested=!1,C.decrypter=void 0,C.initPTS=[],C.onvseeking=null,C.onvended=null,C.logPrefix="",C.log=void 0,C.warn=void 0,C.logPrefix=P,C.log=b.logger.log.bind(b.logger,P+":"),C.warn=b.logger.warn.bind(b.logger,P+":"),C.hls=g,C.fragmentLoader=new f.default(g.config),C.fragmentTracker=O,C.config=g.config,C.decrypter=new n.default(g,g.config),g.on(A.Events.KEY_LOADED,C.onKeyLoaded,l(C)),C}var x=L.prototype;return x.doTick=function(){this.onTickEnd()},x.onTickEnd=function(){},x.startLoad=function(O){},x.stopLoad=function(){this.fragmentLoader.abort();var O=this.fragCurrent;O&&this.fragmentTracker.removeFragment(O),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=D.STOPPED},x._streamEnded=function(O,P){var C=this.fragCurrent,w=this.fragmentTracker;if(!P.live&&C&&C.sn>=P.endSN&&!O.nextStart){var F=P.partList;if(F!=null&&F.length){var k=F[F.length-1],_=I.BufferHelper.isBuffered(this.media,k.start+k.duration/2);return _}var B=w.getState(C);return B===p.FragmentState.PARTIAL||B===p.FragmentState.OK}return!1},x.onMediaAttached=function(O,P){var C=this.media=this.mediaBuffer=P.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),C.addEventListener("seeking",this.onvseeking),C.addEventListener("ended",this.onvended);var w=this.config;this.levels&&w.autoStartLoad&&this.state===D.STOPPED&&this.startLoad(w.startPosition)},x.onMediaDetaching=function(){var O=this.media;O!=null&&O.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),O&&(O.removeEventListener("seeking",this.onvseeking),O.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},x.onMediaSeeking=function(){var O=this.config,P=this.fragCurrent,C=this.media,w=this.mediaBuffer,F=this.state,k=C?C.currentTime:0,_=I.BufferHelper.bufferInfo(w||C,k,O.maxBufferHole);if(this.log("media seeking to "+(Object(t.isFiniteNumber)(k)?k.toFixed(3):k)+", state: "+F),F===D.ENDED)this.resetLoadingState();else if(P&&!_.len){var B=O.maxFragLookUpTolerance,N=P.start-B,U=P.start+P.duration+B,j=k>U;(k<N||j)&&(j&&P.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),P.loader.abort()),this.resetLoadingState())}C&&(this.lastCurrentTime=k),!this.loadedmetadata&&!_.len&&(this.nextLoadPosition=this.startPosition=k),this.tickImmediate()},x.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},x.onKeyLoaded=function(O,P){if(!(this.state!==D.KEY_LOADING||P.frag!==this.fragCurrent||!this.levels)){this.state=D.IDLE;var C=this.levels[P.frag.level].details;C&&this.loadFragment(P.frag,C,P.frag.start)}},x.onHandlerDestroying=function(){this.stopLoad(),S.prototype.onHandlerDestroying.call(this)},x.onHandlerDestroyed=function(){this.state=D.STOPPED,this.hls.off(A.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,S.prototype.onHandlerDestroyed.call(this)},x.loadKey=function(O,P){this.log("Loading key for "+O.sn+" of ["+P.startSN+"-"+P.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+O.level),this.state=D.KEY_LOADING,this.fragCurrent=O,this.hls.trigger(A.Events.KEY_LOADING,{frag:O})},x.loadFragment=function(O,P,C){this._loadFragForPlayback(O,P,C)},x._loadFragForPlayback=function(O,P,C){var w=this,F=function(_){if(w.fragContextChanged(O)){w.warn("Fragment "+O.sn+(_.part?" p: "+_.part.index:"")+" of level "+O.level+" was dropped during download."),w.fragmentTracker.removeFragment(O);return}O.stats.chunkCount++,w._handleFragmentLoadProgress(_)};this._doFragLoad(O,P,C,F).then(function(k){if(!!k){w.fragLoadError=0;var _=w.state;if(w.fragContextChanged(O)){(_===D.FRAG_LOADING||!w.fragCurrent&&_===D.PARSING)&&(w.fragmentTracker.removeFragment(O),w.state=D.IDLE);return}"payload"in k&&(w.log("Loaded fragment "+O.sn+" of level "+O.level),w.hls.trigger(A.Events.FRAG_LOADED,k)),w._handleFragmentLoadComplete(k)}}).catch(function(k){w.state!==D.STOPPED&&(w.warn(k),w.resetFragmentLoading(O))})},x.flushMainBuffer=function(O,P,C){if(C===void 0&&(C=null),!!(O-P)){var w={startOffset:O,endOffset:P,type:C};this.fragLoadError=0,this.hls.trigger(A.Events.BUFFER_FLUSHING,w)}},x._loadInitSegment=function(O){var P=this;this._doFragLoad(O).then(function(C){if(!C||P.fragContextChanged(O)||!P.levels)throw new Error("init load aborted");return C}).then(function(C){var w=P.hls,F=C.payload,k=O.decryptdata;if(F&&F.byteLength>0&&k&&k.key&&k.iv&&k.method==="AES-128"){var _=self.performance.now();return P.decrypter.webCryptoDecrypt(new Uint8Array(F),k.key.buffer,k.iv.buffer).then(function(B){var N=self.performance.now();return w.trigger(A.Events.FRAG_DECRYPTED,{frag:O,payload:B,stats:{tstart:_,tdecrypt:N}}),C.payload=B,C})}return C}).then(function(C){var w=P.fragCurrent,F=P.hls,k=P.levels;if(!k)throw new Error("init load aborted, missing levels");var _=k[O.level].details;console.assert(_,"Level details are defined when init segment is loaded");var B=O.stats;P.state=D.IDLE,P.fragLoadError=0,O.data=new Uint8Array(C.payload),B.parsing.start=B.buffering.start=self.performance.now(),B.parsing.end=B.buffering.end=self.performance.now(),C.frag===w&&F.trigger(A.Events.FRAG_BUFFERED,{stats:B,frag:w,part:null,id:O.type}),P.tick()}).catch(function(C){P.warn(C),P.resetFragmentLoading(O)})},x.fragContextChanged=function(O){var P=this.fragCurrent;return!O||!P||O.level!==P.level||O.sn!==P.sn||O.urlId!==P.urlId},x.fragBufferedComplete=function(O,P){var C=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+O.type+" sn: "+O.sn+(P?" part: "+P.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+O.level+" "+r.default.toString(I.BufferHelper.getBuffered(C))),this.state=D.IDLE,this.tick()},x._handleFragmentLoadComplete=function(O){var P=this.transmuxer;if(!!P){var C=O.frag,w=O.part,F=O.partsLoaded,k=!F||F.length===0||F.some(function(B){return!B}),_=new o.ChunkMetadata(C.level,C.sn,C.stats.chunkCount+1,0,w?w.index:-1,!k);P.flush(_)}},x._handleFragmentLoadProgress=function(O){},x._doFragLoad=function(O,P,C,w){var F=this;if(C===void 0&&(C=null),!this.levels)throw new Error("frag load aborted, missing levels");if(C=Math.max(O.start,C||0),this.config.lowLatencyMode&&P){var k=P.partList;if(k&&w){C>O.end&&P.fragmentHint&&(O=P.fragmentHint);var _=this.getNextPart(k,O,C);if(_>-1){var B=k[_];return this.log("Loading part sn: "+O.sn+" p: "+B.index+" cc: "+O.cc+" of playlist ["+P.startSN+"-"+P.endSN+"] parts [0-"+_+"-"+(k.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+O.level+", target: "+parseFloat(C.toFixed(3))),this.nextLoadPosition=B.start+B.duration,this.state=D.FRAG_LOADING,this.hls.trigger(A.Events.FRAG_LOADING,{frag:O,part:k[_],targetBufferTime:C}),this.doFragPartsLoad(O,k,_,w).catch(function(N){return F.handleFragLoadError(N)})}else if(!O.url||this.loadedEndOfParts(k,C))return Promise.resolve(null)}}return this.log("Loading fragment "+O.sn+" cc: "+O.cc+" "+(P?"of ["+P.startSN+"-"+P.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+O.level+", target: "+parseFloat(C.toFixed(3))),Object(t.isFiniteNumber)(O.sn)&&!this.bitrateTest&&(this.nextLoadPosition=O.start+O.duration),this.state=D.FRAG_LOADING,this.hls.trigger(A.Events.FRAG_LOADING,{frag:O,targetBufferTime:C}),this.fragmentLoader.load(O,w).catch(function(N){return F.handleFragLoadError(N)})},x.doFragPartsLoad=function(O,P,C,w){var F=this;return new Promise(function(k,_){var B=[],N=function U(j){var W=P[j];F.fragmentLoader.loadPart(O,W,w).then(function(H){B[W.index]=H;var G=H.part;F.hls.trigger(A.Events.FRAG_LOADED,H);var K=P[j+1];if(K&&K.fragment===O)U(j+1);else return k({frag:O,part:G,partsLoaded:B})}).catch(_)};N(C)})},x.handleFragLoadError=function(O){var P=O.data;return P&&P.details===c.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(P.frag,P.part):this.hls.trigger(A.Events.ERROR,P),null},x._handleTransmuxerFlush=function(O){var P=this.getCurrentContext(O);if(!P||this.state!==D.PARSING){this.fragCurrent||(this.state=D.IDLE);return}var C=P.frag,w=P.part,F=P.level,k=self.performance.now();C.stats.parsing.end=k,w&&(w.stats.parsing.end=k),this.updateLevelTiming(C,w,F,O.partial)},x.getCurrentContext=function(O){var P=this.levels,C=O.level,w=O.sn,F=O.part;if(!P||!P[C])return this.warn("Levels object was unset while buffering fragment "+w+" of level "+C+". The current chunk will not be buffered."),null;var k=P[C],_=F>-1?Object(T.getPartWith)(k,w,F):null,B=_?_.fragment:Object(T.getFragmentWithSN)(k,w,this.fragCurrent);return B?{frag:B,part:_,level:k}:null},x.bufferFragmentData=function(O,P,C,w){if(!(!O||this.state!==D.PARSING)){var F=O.data1,k=O.data2,_=F;if(F&&k&&(_=Object(h.appendUint8Array)(F,k)),!(!_||!_.length)){var B={type:O.type,frag:P,part:C,chunkMeta:w,parent:P.type,data:_};this.hls.trigger(A.Events.BUFFER_APPENDING,B),O.dropped&&O.independent&&!C&&this.flushBufferGap(P)}}},x.flushBufferGap=function(O){var P=this.media;if(!!P){if(!I.BufferHelper.isBuffered(P,P.currentTime)){this.flushMainBuffer(0,O.start);return}var C=P.currentTime,w=I.BufferHelper.bufferInfo(P,C,0),F=O.duration,k=Math.min(this.config.maxFragLookUpTolerance*2,F*.25),_=Math.max(Math.min(O.start-k,w.end-k),C+k);O.start-_>k&&this.flushMainBuffer(_,O.start)}},x.getFwdBufferInfo=function(O,P){var C=this.config,w=this.getLoadPosition();if(!Object(t.isFiniteNumber)(w))return null;var F=I.BufferHelper.bufferInfo(O,w,C.maxBufferHole);if(F.len===0&&F.nextStart!==void 0){var k=this.fragmentTracker.getBufferedFrag(w,P);if(k&&F.nextStart<k.end)return I.BufferHelper.bufferInfo(O,w,Math.max(F.nextStart,C.maxBufferHole))}return F},x.getMaxBufferLength=function(O){var P=this.config,C;return O?C=Math.max(8*P.maxBufferSize/O,P.maxBufferLength):C=P.maxBufferLength,Math.min(C,P.maxMaxBufferLength)},x.reduceMaxBufferLength=function(O){var P=this.config,C=O||P.maxBufferLength;return P.maxMaxBufferLength>=C?(P.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+P.maxMaxBufferLength+"s"),!0):!1},x.getNextFragment=function(O,P){var C=P.fragments,w=C.length;if(!w)return null;var F=this.config,k=C[0].start,_;if(P.live){var B=F.initialLiveManifestSize;if(w<B)return this.warn("Not enough fragments to start playback (have: "+w+", need: "+B+")"),null;!P.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(_=this.getInitialLiveFragment(P,C),this.startPosition=_?this.hls.liveSyncPosition||_.start:O)}else O<=k&&(_=C[0]);if(!_){var N=F.lowLatencyMode?P.partEnd:P.fragmentEnd;_=this.getFragmentAtPosition(O,N,P)}return this.mapToInitFragWhenRequired(_)},x.mapToInitFragWhenRequired=function(O){return O!=null&&O.initSegment&&!(O!=null&&O.initSegment.data)&&!this.bitrateTest?O.initSegment:O},x.getNextPart=function(O,P,C){for(var w=-1,F=!1,k=!0,_=0,B=O.length;_<B;_++){var N=O[_];if(k=k&&!N.independent,w>-1&&C<N.start)break;var U=N.loaded;!U&&(F||N.independent||k)&&N.fragment===P&&(w=_),F=U}return w},x.loadedEndOfParts=function(O,P){var C=O[O.length-1];return C&&P>C.start&&C.loaded},x.getInitialLiveFragment=function(O,P){var C=this.fragPrevious,w=null;if(C){if(O.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+C.programDateTime),w=Object(m.findFragmentByPDT)(P,C.endProgramDateTime,this.config.maxFragLookUpTolerance)),!w){var F=C.sn+1;if(F>=O.startSN&&F<=O.endSN){var k=P[F-O.startSN];C.cc===k.cc&&(w=k,this.log("Live playlist, switching playlist, load frag with next SN: "+w.sn))}w||(w=Object(m.findFragWithCC)(P,C.cc),w&&this.log("Live playlist, switching playlist, load frag with same CC: "+w.sn))}}else{var _=this.hls.liveSyncPosition;_!==null&&(w=this.getFragmentAtPosition(_,this.bitrateTest?O.fragmentEnd:O.edge,O))}return w},x.getFragmentAtPosition=function(O,P,C){var w=this.config,F=this.fragPrevious,k=C.fragments,_=C.endSN,B=C.fragmentHint,N=w.maxFragLookUpTolerance,U=!!(w.lowLatencyMode&&C.partList&&B);U&&B&&!this.bitrateTest&&(k=k.concat(B),_=B.sn);var j;if(O<P){var W=O>P-N?0:N;j=Object(m.findFragmentByPTS)(F,k,O,W)}else j=k[k.length-1];if(j){var H=j.sn-C.startSN,G=F&&j.level===F.level,K=k[H+1];F&&j.sn===F.sn&&!U&&G&&(j.sn<_&&this.fragmentTracker.getState(K)!==p.FragmentState.OK?(this.log("SN "+j.sn+" just loaded, load next one: "+K.sn),j=K):j=null)}return j},x.synchronizeToLiveEdge=function(O){var P=this.config,C=this.media;if(!!C){var w=this.hls.liveSyncPosition,F=C.currentTime,k=O.fragments[0].start,_=O.edge,B=F>=k-P.maxFragLookUpTolerance&&F<=_;if(w!==null&&C.duration>w&&(F<w||!B)){var N=P.liveMaxLatencyDuration!==void 0?P.liveMaxLatencyDuration:P.liveMaxLatencyDurationCount*O.targetduration;(!B&&C.readyState<4||F<_-N)&&(this.loadedmetadata||(this.nextLoadPosition=w),C.readyState&&(this.warn("Playback: "+F.toFixed(3)+" is located too far from the end of live sliding playlist: "+_+", reset currentTime to : "+w.toFixed(3)),C.currentTime=w))}}},x.alignPlaylists=function(O,P){var C=this.levels,w=this.levelLastLoaded,F=this.fragPrevious,k=w!==null?C[w]:null,_=O.fragments.length;if(!_)return this.warn("No fragments in live playlist"),0;var B=O.fragments[0].start,N=!P,U=O.alignedSliding&&Object(t.isFiniteNumber)(B);if(N||!U&&!B){Object(v.alignStream)(F,k,O);var j=O.fragments[0].start;return this.log("Live playlist sliding: "+j.toFixed(2)+" start-sn: "+(P?P.startSN:"na")+"->"+O.startSN+" prev-sn: "+(F?F.sn:"na")+" fragments: "+_),j}return B},x.waitForCdnTuneIn=function(O){var P=3;return O.live&&O.canBlockReload&&O.partTarget&&O.tuneInGoal>Math.max(O.partHoldBack,O.partTarget*P)},x.setStartPosition=function(O,P){var C=this.startPosition;if(C<P&&(C=-1),C===-1||this.lastCurrentTime===-1){var w=O.startTimeOffset;Object(t.isFiniteNumber)(w)?(C=P+w,w<0&&(C+=O.totalduration),C=Math.min(Math.max(P,C),P+O.totalduration),this.log("Start time offset "+w+" found in playlist, adjust startPosition to "+C),this.startPosition=C):O.live?C=this.hls.liveSyncPosition||P:this.startPosition=C=0,this.lastCurrentTime=C}this.nextLoadPosition=C},x.getLoadPosition=function(){var O=this.media,P=0;return this.loadedmetadata&&O?P=O.currentTime:this.nextLoadPosition&&(P=this.nextLoadPosition),P},x.handleFragLoadAborted=function(O,P){this.transmuxer&&O.sn!=="initSegment"&&O.stats.aborted&&(this.warn("Fragment "+O.sn+(P?" part"+P.index:"")+" of level "+O.level+" was aborted"),this.resetFragmentLoading(O))},x.resetFragmentLoading=function(O){(!this.fragCurrent||!this.fragContextChanged(O))&&(this.state=D.IDLE)},x.onFragmentOrKeyLoadError=function(O,P){if(!P.fatal){var C=P.frag;if(!(!C||C.type!==O)){var w=this.fragCurrent;console.assert(w&&C.sn===w.sn&&C.level===w.level&&C.urlId===w.urlId,"Frag load error must match current frag to retry");var F=this.config;if(this.fragLoadError+1<=F.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(C.level))return;var k=Math.min(Math.pow(2,this.fragLoadError)*F.fragLoadingRetryDelay,F.fragLoadingMaxRetryTimeout);this.warn("Fragment "+C.sn+" of "+O+" "+C.level+" failed to load, retrying in "+k+"ms"),this.retryDate=self.performance.now()+k,this.fragLoadError++,this.state=D.FRAG_LOADING_WAITING_RETRY}else P.levelRetry?(O===d.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=D.IDLE):(b.logger.error(P.details+" reaches max retry, redispatch as fatal ..."),P.fatal=!0,this.hls.stopLoad(),this.state=D.ERROR)}}},x.afterBufferFlushed=function(O,P,C){if(!!O){var w=I.BufferHelper.getBuffered(O);this.fragmentTracker.detectEvictedFragments(P,w,C),this.state===D.ENDED&&this.resetLoadingState()}},x.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=D.IDLE},x.resetLiveStartWhenNotLoaded=function(O){if(!this.loadedmetadata){this.startFragRequested=!1;var P=this.levels?this.levels[O].details:null;if(P!=null&&P.live)return this.startPosition=-1,this.setStartPosition(P,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},x.updateLevelTiming=function(O,P,C,w){var F=this,k=C.details;console.assert(!!k,"level.details must be defined");var _=Object.keys(O.elementaryStreams).reduce(function(B,N){var U=O.elementaryStreams[N];if(U){var j=U.endPTS-U.startPTS;if(j<=0)return F.warn("Could not parse fragment "+O.sn+" "+N+" duration reliably ("+j+")"),B||!1;var W=w?0:Object(T.updateFragPTSDTS)(k,O,U.startPTS,U.endPTS,U.startDTS,U.endDTS);return F.hls.trigger(A.Events.LEVEL_PTS_UPDATED,{details:k,level:C,drift:W,type:N,frag:O,start:U.startPTS,end:U.endPTS}),!0}return B},!1);_||(this.warn("Found no media in fragment "+O.sn+" of level "+C.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=D.PARSED,this.hls.trigger(A.Events.FRAG_PARSED,{frag:O,part:P})},x.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},y(L,[{key:"state",get:function(){return this._state},set:function(O){var P=this._state;P!==O&&(this._state=O,this.log(P+"->"+O))}}]),L}(e.default)},"./src/controller/buffer-controller.ts":function(R,M,s){s.r(M),s.d(M,"default",function(){return m});var t=s("./src/polyfills/number.ts"),e=s("./src/events.ts"),p=s("./src/utils/logger.ts"),I=s("./src/errors.ts"),b=s("./src/utils/buffer-helper.ts"),A=s("./src/utils/mediasource-helper.ts"),c=s("./src/loader/fragment.ts"),o=s("./src/controller/buffer-operation-queue.ts"),h=Object(A.getMediaSource)(),v=/([ha]vc.)(?:\.[^.,]+)+/,m=function(){function T(n){var r=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var d=r.hls,u=r.media,y=r.mediaSource;p.logger.log("[buffer-controller]: Media source opened"),u&&(r.updateMediaElementDuration(),d.trigger(e.Events.MEDIA_ATTACHED,{media:u})),y&&y.removeEventListener("sourceopen",r._onMediaSourceOpen),r.checkPendingTracks()},this._onMediaSourceClose=function(){p.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){p.logger.log("[buffer-controller]: Media source ended")},this.hls=n,this._initSourceBuffer(),this.registerListeners()}var f=T.prototype;return f.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},f.destroy=function(){this.unregisterListeners(),this.details=null},f.registerListeners=function(){var r=this.hls;r.on(e.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),r.on(e.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(e.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(e.Events.BUFFER_RESET,this.onBufferReset,this),r.on(e.Events.BUFFER_APPENDING,this.onBufferAppending,this),r.on(e.Events.BUFFER_CODECS,this.onBufferCodecs,this),r.on(e.Events.BUFFER_EOS,this.onBufferEos,this),r.on(e.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),r.on(e.Events.LEVEL_UPDATED,this.onLevelUpdated,this),r.on(e.Events.FRAG_PARSED,this.onFragParsed,this),r.on(e.Events.FRAG_CHANGED,this.onFragChanged,this)},f.unregisterListeners=function(){var r=this.hls;r.off(e.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),r.off(e.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(e.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(e.Events.BUFFER_RESET,this.onBufferReset,this),r.off(e.Events.BUFFER_APPENDING,this.onBufferAppending,this),r.off(e.Events.BUFFER_CODECS,this.onBufferCodecs,this),r.off(e.Events.BUFFER_EOS,this.onBufferEos,this),r.off(e.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),r.off(e.Events.LEVEL_UPDATED,this.onLevelUpdated,this),r.off(e.Events.FRAG_PARSED,this.onFragParsed,this),r.off(e.Events.FRAG_CHANGED,this.onFragChanged,this)},f._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new o.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},f.onManifestParsed=function(r,d){var u=2;(d.audio&&!d.video||!d.altAudio)&&(u=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=u,this.details=null,p.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},f.onMediaAttaching=function(r,d){var u=this.media=d.media;if(u&&h){var y=this.mediaSource=new h;y.addEventListener("sourceopen",this._onMediaSourceOpen),y.addEventListener("sourceended",this._onMediaSourceEnded),y.addEventListener("sourceclose",this._onMediaSourceClose),u.src=self.URL.createObjectURL(y),this._objectUrl=u.src}},f.onMediaDetaching=function(){var r=this.media,d=this.mediaSource,u=this._objectUrl;if(d){if(p.logger.log("[buffer-controller]: media source detaching"),d.readyState==="open")try{d.endOfStream()}catch(y){p.logger.warn("[buffer-controller]: onMediaDetaching: "+y.message+" while calling endOfStream")}this.onBufferReset(),d.removeEventListener("sourceopen",this._onMediaSourceOpen),d.removeEventListener("sourceended",this._onMediaSourceEnded),d.removeEventListener("sourceclose",this._onMediaSourceClose),r&&(u&&self.URL.revokeObjectURL(u),r.src===u?(r.removeAttribute("src"),r.load()):p.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(e.Events.MEDIA_DETACHED,void 0)},f.onBufferReset=function(){var r=this;this.getSourceBufferTypes().forEach(function(d){var u=r.sourceBuffer[d];try{u&&(r.removeBufferListeners(d),r.mediaSource&&r.mediaSource.removeSourceBuffer(u),r.sourceBuffer[d]=void 0)}catch(y){p.logger.warn("[buffer-controller]: Failed to reset the "+d+" buffer",y)}}),this._initSourceBuffer()},f.onBufferCodecs=function(r,d){var u=this,y=this.getSourceBufferTypes().length;Object.keys(d).forEach(function(l){if(y){var a=u.tracks[l];if(a&&typeof a.buffer.changeType=="function"){var i=d[l],D=i.id,E=i.codec,S=i.levelCodec,L=i.container,x=i.metadata,g=(a.levelCodec||a.codec).replace(v,"$1"),O=(S||E).replace(v,"$1");if(g!==O){var P=L+";codecs="+(S||E);u.appendChangeType(l,P),p.logger.log("[buffer-controller]: switching codec "+g+" to "+O),u.tracks[l]={buffer:a.buffer,codec:E,container:L,levelCodec:S,metadata:x,id:D}}}}else u.pendingTracks[l]=d[l]}),!y&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},f.appendChangeType=function(r,d){var u=this,y=this.operationQueue,l={execute:function(){var i=u.sourceBuffer[r];i&&(p.logger.log("[buffer-controller]: changing "+r+" sourceBuffer type to "+d),i.changeType(d)),y.shiftAndExecuteNext(r)},onStart:function(){},onComplete:function(){},onError:function(i){p.logger.warn("[buffer-controller]: Failed to change "+r+" SourceBuffer type",i)}};y.append(l,r)},f.onBufferAppending=function(r,d){var u=this,y=this.hls,l=this.operationQueue,a=this.tracks,i=d.data,D=d.type,E=d.frag,S=d.part,L=d.chunkMeta,x=L.buffering[D],g=self.performance.now();x.start=g;var O=E.stats.buffering,P=S?S.stats.buffering:null;O.start===0&&(O.start=g),P&&P.start===0&&(P.start=g);var C=a.audio,w=D==="audio"&&L.id===1&&(C==null?void 0:C.container)==="audio/mpeg",F={execute:function(){if(x.executeStart=self.performance.now(),w){var _=u.sourceBuffer[D];if(_){var B=E.start-_.timestampOffset;Math.abs(B)>=.1&&(p.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+E.start+" (delta: "+B+") sn: "+E.sn+")"),_.timestampOffset=E.start)}}u.appendExecutor(i,D)},onStart:function(){},onComplete:function(){var _=self.performance.now();x.executeEnd=x.end=_,O.first===0&&(O.first=_),P&&P.first===0&&(P.first=_);var B=u.sourceBuffer,N={};for(var U in B)N[U]=b.BufferHelper.getBuffered(B[U]);u.appendError=0,u.hls.trigger(e.Events.BUFFER_APPENDED,{type:D,frag:E,part:S,chunkMeta:L,parent:E.type,timeRanges:N})},onError:function(_){p.logger.error("[buffer-controller]: Error encountered while trying to append to the "+D+" SourceBuffer",_);var B={type:I.ErrorTypes.MEDIA_ERROR,parent:E.type,details:I.ErrorDetails.BUFFER_APPEND_ERROR,err:_,fatal:!1};_.code===DOMException.QUOTA_EXCEEDED_ERR?B.details=I.ErrorDetails.BUFFER_FULL_ERROR:(u.appendError++,B.details=I.ErrorDetails.BUFFER_APPEND_ERROR,u.appendError>y.config.appendErrorMaxRetry&&(p.logger.error("[buffer-controller]: Failed "+y.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),B.fatal=!0)),y.trigger(e.Events.ERROR,B)}};l.append(F,D)},f.onBufferFlushing=function(r,d){var u=this,y=this.operationQueue,l=function(i){return{execute:u.removeExecutor.bind(u,i,d.startOffset,d.endOffset),onStart:function(){},onComplete:function(){u.hls.trigger(e.Events.BUFFER_FLUSHED,{type:i})},onError:function(E){p.logger.warn("[buffer-controller]: Failed to remove from "+i+" SourceBuffer",E)}}};d.type?y.append(l(d.type),d.type):this.getSourceBufferTypes().forEach(function(a){y.append(l(a),a)})},f.onFragParsed=function(r,d){var u=this,y=d.frag,l=d.part,a=[],i=l?l.elementaryStreams:y.elementaryStreams;i[c.ElementaryStreamTypes.AUDIOVIDEO]?a.push("audiovideo"):(i[c.ElementaryStreamTypes.AUDIO]&&a.push("audio"),i[c.ElementaryStreamTypes.VIDEO]&&a.push("video"));var D=function(){var S=self.performance.now();y.stats.buffering.end=S,l&&(l.stats.buffering.end=S);var L=l?l.stats:y.stats;u.hls.trigger(e.Events.FRAG_BUFFERED,{frag:y,part:l,stats:L,id:y.type})};a.length===0&&p.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+y.type+" level: "+y.level+" sn: "+y.sn),this.blockBuffers(D,a)},f.onFragChanged=function(r,d){this.flushBackBuffer()},f.onBufferEos=function(r,d){var u=this,y=this.getSourceBufferTypes().reduce(function(l,a){var i=u.sourceBuffer[a];return(!d.type||d.type===a)&&i&&!i.ended&&(i.ended=!0,p.logger.log("[buffer-controller]: "+a+" sourceBuffer now EOS")),l&&!!(!i||i.ended)},!0);y&&this.blockBuffers(function(){var l=u.mediaSource;!l||l.readyState!=="open"||l.endOfStream()})},f.onLevelUpdated=function(r,d){var u=d.details;!u.fragments.length||(this.details=u,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},f.flushBackBuffer=function(){var r=this.hls,d=this.details,u=this.media,y=this.sourceBuffer;if(!(!u||d===null)){var l=this.getSourceBufferTypes();if(!!l.length){var a=d.live&&r.config.liveBackBufferLength!==null?r.config.liveBackBufferLength:r.config.backBufferLength;if(!(!Object(t.isFiniteNumber)(a)||a<0)){var i=u.currentTime,D=d.levelTargetDuration,E=Math.max(a,D),S=Math.floor(i/D)*D-E;l.forEach(function(L){var x=y[L];if(x){var g=b.BufferHelper.getBuffered(x);g.length>0&&S>g.start(0)&&(r.trigger(e.Events.BACK_BUFFER_REACHED,{bufferEnd:S}),d.live&&r.trigger(e.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:S}),r.trigger(e.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:S,type:L}))}})}}}},f.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var r=this.details,d=this.hls,u=this.media,y=this.mediaSource,l=r.fragments[0].start+r.totalduration,a=u.duration,i=Object(t.isFiniteNumber)(y.duration)?y.duration:0;r.live&&d.config.liveDurationInfinity?(p.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),y.duration=1/0,this.updateSeekableRange(r)):(l>i&&l>a||!Object(t.isFiniteNumber)(a))&&(p.logger.log("[buffer-controller]: Updating Media Source duration to "+l.toFixed(3)),y.duration=l)}},f.updateSeekableRange=function(r){var d=this.mediaSource,u=r.fragments,y=u.length;if(y&&r.live&&d!==null&&d!==void 0&&d.setLiveSeekableRange){var l=Math.max(0,u[0].start),a=Math.max(l,l+r.totalduration);d.setLiveSeekableRange(l,a)}},f.checkPendingTracks=function(){var r=this.bufferCodecEventsExpected,d=this.operationQueue,u=this.pendingTracks,y=Object.keys(u).length;if(y&&!r||y===2){this.createSourceBuffers(u),this.pendingTracks={};var l=this.getSourceBufferTypes();if(l.length===0){this.hls.trigger(e.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}l.forEach(function(a){d.executeNext(a)})}},f.createSourceBuffers=function(r){var d=this.sourceBuffer,u=this.mediaSource;if(!u)throw Error("createSourceBuffers called when mediaSource was null");var y=0;for(var l in r)if(!d[l]){var a=r[l];if(!a)throw Error("source buffer exists for track "+l+", however track does not");var i=a.levelCodec||a.codec,D=a.container+";codecs="+i;p.logger.log("[buffer-controller]: creating sourceBuffer("+D+")");try{var E=d[l]=u.addSourceBuffer(D),S=l;this.addBufferListener(S,"updatestart",this._onSBUpdateStart),this.addBufferListener(S,"updateend",this._onSBUpdateEnd),this.addBufferListener(S,"error",this._onSBUpdateError),this.tracks[l]={buffer:E,codec:i,container:a.container,levelCodec:a.levelCodec,metadata:a.metadata,id:a.id},y++}catch(L){p.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+L.message),this.hls.trigger(e.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:L,mimeType:D})}}y&&this.hls.trigger(e.Events.BUFFER_CREATED,{tracks:this.tracks})},f._onSBUpdateStart=function(r){var d=this.operationQueue,u=d.current(r);u.onStart()},f._onSBUpdateEnd=function(r){var d=this.operationQueue,u=d.current(r);u.onComplete(),d.shiftAndExecuteNext(r)},f._onSBUpdateError=function(r,d){p.logger.error("[buffer-controller]: "+r+" SourceBuffer error",d),this.hls.trigger(e.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var u=this.operationQueue.current(r);u&&u.onError(d)},f.removeExecutor=function(r,d,u){var y=this.media,l=this.mediaSource,a=this.operationQueue,i=this.sourceBuffer,D=i[r];if(!y||!l||!D){p.logger.warn("[buffer-controller]: Attempting to remove from the "+r+" SourceBuffer, but it does not exist"),a.shiftAndExecuteNext(r);return}var E=Object(t.isFiniteNumber)(y.duration)?y.duration:1/0,S=Object(t.isFiniteNumber)(l.duration)?l.duration:1/0,L=Math.max(0,d),x=Math.min(u,E,S);x>L?(p.logger.log("[buffer-controller]: Removing ["+L+","+x+"] from the "+r+" SourceBuffer"),console.assert(!D.updating,r+" sourceBuffer must not be updating"),D.remove(L,x)):a.shiftAndExecuteNext(r)},f.appendExecutor=function(r,d){var u=this.operationQueue,y=this.sourceBuffer,l=y[d];if(!l){p.logger.warn("[buffer-controller]: Attempting to append to the "+d+" SourceBuffer, but it does not exist"),u.shiftAndExecuteNext(d);return}l.ended=!1,console.assert(!l.updating,d+" sourceBuffer must not be updating"),l.appendBuffer(r)},f.blockBuffers=function(r,d){var u=this;if(d===void 0&&(d=this.getSourceBufferTypes()),!d.length){p.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(r);return}var y=this.operationQueue,l=d.map(function(a){return y.appendBlocker(a)});Promise.all(l).then(function(){r(),d.forEach(function(a){var i=u.sourceBuffer[a];(!i||!i.updating)&&y.shiftAndExecuteNext(a)})})},f.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},f.addBufferListener=function(r,d,u){var y=this.sourceBuffer[r];if(!!y){var l=u.bind(this,r);this.listeners[r].push({event:d,listener:l}),y.addEventListener(d,l)}},f.removeBufferListeners=function(r){var d=this.sourceBuffer[r];!d||this.listeners[r].forEach(function(u){d.removeEventListener(u.event,u.listener)})},T}()},"./src/controller/buffer-operation-queue.ts":function(R,M,s){s.r(M),s.d(M,"default",function(){return e});var t=s("./src/utils/logger.ts"),e=function(){function p(b){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=b}var I=p.prototype;return I.append=function(A,c){var o=this.queues[c];o.push(A),o.length===1&&this.buffers[c]&&this.executeNext(c)},I.insertAbort=function(A,c){var o=this.queues[c];o.unshift(A),this.executeNext(c)},I.appendBlocker=function(A){var c,o=new Promise(function(v){c=v}),h={execute:c,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(h,A),o},I.executeNext=function(A){var c=this.buffers,o=this.queues,h=c[A],v=o[A];if(v.length){var m=v[0];try{m.execute()}catch(T){t.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),m.onError(T),(!h||!h.updating)&&(v.shift(),this.executeNext(A))}}},I.shiftAndExecuteNext=function(A){this.queues[A].shift(),this.executeNext(A)},I.current=function(A){return this.queues[A][0]},p}()},"./src/controller/cap-level-controller.ts":function(R,M,s){s.r(M);var t=s("./src/events.ts");function e(b,A){for(var c=0;c<A.length;c++){var o=A[c];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(b,o.key,o)}}function p(b,A,c){return A&&e(b.prototype,A),c&&e(b,c),Object.defineProperty(b,"prototype",{writable:!1}),b}var I=function(){function b(c){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=c,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var A=b.prototype;return A.setStreamController=function(o){this.streamController=o},A.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},A.registerListeners=function(){var o=this.hls;o.on(t.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),o.on(t.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),o.on(t.Events.MANIFEST_PARSED,this.onManifestParsed,this),o.on(t.Events.BUFFER_CODECS,this.onBufferCodecs,this),o.on(t.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},A.unregisterListener=function(){var o=this.hls;o.off(t.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),o.off(t.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),o.off(t.Events.MANIFEST_PARSED,this.onManifestParsed,this),o.off(t.Events.BUFFER_CODECS,this.onBufferCodecs,this),o.off(t.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},A.onFpsDropLevelCapping=function(o,h){b.isLevelAllowed(h.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(h.droppedLevel)},A.onMediaAttaching=function(o,h){this.media=h.media instanceof HTMLVideoElement?h.media:null},A.onManifestParsed=function(o,h){var v=this.hls;this.restrictedLevels=[],this.firstLevel=h.firstLevel,v.config.capLevelToPlayerSize&&h.video&&this.startCapping()},A.onBufferCodecs=function(o,h){var v=this.hls;v.config.capLevelToPlayerSize&&h.video&&this.startCapping()},A.onMediaDetaching=function(){this.stopCapping()},A.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var o=this.hls.levels;if(o.length){var h=this.hls;h.autoLevelCapping=this.getMaxLevel(o.length-1),h.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=h.autoLevelCapping}}},A.getMaxLevel=function(o){var h=this,v=this.hls.levels;if(!v.length)return-1;var m=v.filter(function(T,f){return b.isLevelAllowed(f,h.restrictedLevels)&&f<=o});return this.clientRect=null,b.getMaxLevelByMediaSize(m,this.mediaWidth,this.mediaHeight)},A.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},A.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},A.getDimensions=function(){if(this.clientRect)return this.clientRect;var o=this.media,h={width:0,height:0};if(o){var v=o.getBoundingClientRect();h.width=v.width,h.height=v.height,!h.width&&!h.height&&(h.width=v.right-v.left||o.width||0,h.height=v.bottom-v.top||o.height||0)}return this.clientRect=h,h},b.isLevelAllowed=function(o,h){return h===void 0&&(h=[]),h.indexOf(o)===-1},b.getMaxLevelByMediaSize=function(o,h,v){if(!o||!o.length)return-1;for(var m=function(d,u){return u?d.width!==u.width||d.height!==u.height:!0},T=o.length-1,f=0;f<o.length;f+=1){var n=o[f];if((n.width>=h||n.height>=v)&&m(n,o[f+1])){T=f;break}}return T},p(b,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var o=1;if(!this.hls.config.ignoreDevicePixelRatio)try{o=self.devicePixelRatio}catch{}return o}}]),b}();M.default=I},"./src/controller/cmcd-controller.ts":function(R,M,s){s.r(M),s.d(M,"default",function(){return m});var t=s("./src/events.ts"),e=s("./src/types/cmcd.ts"),p=s("./src/utils/buffer-helper.ts"),I=s("./src/utils/logger.ts");function b(T,f){for(var n=0;n<f.length;n++){var r=f[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(T,r.key,r)}}function A(T,f,n){return f&&b(T.prototype,f),n&&b(T,n),Object.defineProperty(T,"prototype",{writable:!1}),T}function c(T,f){var n=typeof Symbol<"u"&&T[Symbol.iterator]||T["@@iterator"];if(n)return(n=n.call(T)).next.bind(n);if(Array.isArray(T)||(n=o(T))||f&&T&&typeof T.length=="number"){n&&(T=n);var r=0;return function(){return r>=T.length?{done:!0}:{done:!1,value:T[r++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function o(T,f){if(!!T){if(typeof T=="string")return h(T,f);var n=Object.prototype.toString.call(T).slice(8,-1);if(n==="Object"&&T.constructor&&(n=T.constructor.name),n==="Map"||n==="Set")return Array.from(T);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return h(T,f)}}function h(T,f){(f==null||f>T.length)&&(f=T.length);for(var n=0,r=new Array(f);n<f;n++)r[n]=T[n];return r}function v(){return v=Object.assign?Object.assign.bind():function(T){for(var f=1;f<arguments.length;f++){var n=arguments[f];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(T[r]=n[r])}return T},v.apply(this,arguments)}var m=function(){function T(n){var r=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){r.initialized&&(r.starved=!0),r.buffering=!0},this.onPlaying=function(){r.initialized||(r.initialized=!0),r.buffering=!1},this.applyPlaylistData=function(y){try{r.apply(y,{ot:e.CMCDObjectType.MANIFEST,su:!r.initialized})}catch(l){I.logger.warn("Could not generate manifest CMCD data.",l)}},this.applyFragmentData=function(y){try{var l=y.frag,a=r.hls.levels[l.level],i=r.getObjectType(l),D={d:l.duration*1e3,ot:i};(i===e.CMCDObjectType.VIDEO||i===e.CMCDObjectType.AUDIO||i==e.CMCDObjectType.MUXED)&&(D.br=a.bitrate/1e3,D.tb=r.getTopBandwidth(i)/1e3,D.bl=r.getBufferLength(i)),r.apply(y,D)}catch(E){I.logger.warn("Could not generate segment CMCD data.",E)}},this.hls=n;var d=this.config=n.config,u=d.cmcd;u!=null&&(d.pLoader=this.createPlaylistLoader(),d.fLoader=this.createFragmentLoader(),this.sid=u.sessionId||T.uuid(),this.cid=u.contentId,this.useHeaders=u.useHeaders===!0,this.registerListeners())}var f=T.prototype;return f.registerListeners=function(){var r=this.hls;r.on(t.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(t.Events.MEDIA_DETACHED,this.onMediaDetached,this),r.on(t.Events.BUFFER_CREATED,this.onBufferCreated,this)},f.unregisterListeners=function(){var r=this.hls;r.off(t.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(t.Events.MEDIA_DETACHED,this.onMediaDetached,this),r.off(t.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},f.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},f.onMediaAttached=function(r,d){this.media=d.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},f.onMediaDetached=function(){!this.media||(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},f.onBufferCreated=function(r,d){var u,y;this.audioBuffer=(u=d.tracks.audio)===null||u===void 0?void 0:u.buffer,this.videoBuffer=(y=d.tracks.video)===null||y===void 0?void 0:y.buffer},f.createData=function(){var r;return{v:e.CMCDVersion,sf:e.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(r=this.media)===null||r===void 0?void 0:r.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},f.apply=function(r,d){d===void 0&&(d={}),v(d,this.createData());var u=d.ot===e.CMCDObjectType.INIT||d.ot===e.CMCDObjectType.VIDEO||d.ot===e.CMCDObjectType.MUXED;if(this.starved&&u&&(d.bs=!0,d.su=!0,this.starved=!1),d.su==null&&(d.su=this.buffering),this.useHeaders){var y=T.toHeaders(d);if(!Object.keys(y).length)return;r.headers||(r.headers={}),v(r.headers,y)}else{var l=T.toQuery(d);if(!l)return;r.url=T.appendQueryToUri(r.url,l)}},f.getObjectType=function(r){var d=r.type;if(d==="subtitle")return e.CMCDObjectType.TIMED_TEXT;if(r.sn==="initSegment")return e.CMCDObjectType.INIT;if(d==="audio")return e.CMCDObjectType.AUDIO;if(d==="main")return this.hls.audioTracks.length?e.CMCDObjectType.VIDEO:e.CMCDObjectType.MUXED},f.getTopBandwidth=function(r){var d=0,u,y=this.hls;if(r===e.CMCDObjectType.AUDIO)u=y.audioTracks;else{var l=y.maxAutoLevel,a=l>-1?l+1:y.levels.length;u=y.levels.slice(0,a)}for(var i=c(u),D;!(D=i()).done;){var E=D.value;E.bitrate>d&&(d=E.bitrate)}return d>0?d:NaN},f.getBufferLength=function(r){var d=this.hls.media,u=r===e.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;if(!u||!d)return NaN;var y=p.BufferHelper.bufferInfo(u,d.currentTime,this.config.maxBufferHole);return y.len*1e3},f.createPlaylistLoader=function(){var r=this.config.pLoader,d=this.applyPlaylistData,u=r||this.config.loader;return function(){function y(a){this.loader=void 0,this.loader=new u(a)}var l=y.prototype;return l.destroy=function(){this.loader.destroy()},l.abort=function(){this.loader.abort()},l.load=function(i,D,E){d(i),this.loader.load(i,D,E)},A(y,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),y}()},f.createFragmentLoader=function(){var r=this.config.fLoader,d=this.applyFragmentData,u=r||this.config.loader;return function(){function y(a){this.loader=void 0,this.loader=new u(a)}var l=y.prototype;return l.destroy=function(){this.loader.destroy()},l.abort=function(){this.loader.abort()},l.load=function(i,D,E){d(i),this.loader.load(i,D,E)},A(y,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),y}()},T.uuid=function(){var r=URL.createObjectURL(new Blob),d=r.toString();return URL.revokeObjectURL(r),d.slice(d.lastIndexOf("/")+1)},T.serialize=function(r){for(var d=[],u=function(w){return!Number.isNaN(w)&&w!=null&&w!==""&&w!==!1},y=function(w){return Math.round(w)},l=function(w){return y(w/100)*100},a=function(w){return encodeURIComponent(w)},i={br:y,d:y,bl:l,dl:l,mtp:l,nor:a,rtp:l,tb:y},D=Object.keys(r||{}).sort(),E=c(D),S;!(S=E()).done;){var L=S.value,x=r[L];if(!!u(x)&&!(L==="v"&&x===1)&&!(L=="pr"&&x===1)){var g=i[L];g&&(x=g(x));var O=typeof x,P=void 0;L==="ot"||L==="sf"||L==="st"?P=L+"="+x:O==="boolean"?P=L:O==="number"?P=L+"="+x:P=L+"="+JSON.stringify(x),d.push(P)}}return d.join(",")},T.toHeaders=function(r){for(var d=Object.keys(r),u={},y=["Object","Request","Session","Status"],l=[{},{},{},{}],a={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},i=0,D=d;i<D.length;i++){var E=D[i],S=a[E]!=null?a[E]:1;l[S][E]=r[E]}for(var L=0;L<l.length;L++){var x=T.serialize(l[L]);x&&(u["CMCD-"+y[L]]=x)}return u},T.toQuery=function(r){return"CMCD="+encodeURIComponent(T.serialize(r))},T.appendQueryToUri=function(r,d){if(!d)return r;var u=r.includes("?")?"&":"?";return""+r+u+d},T}()},"./src/controller/eme-controller.ts":function(R,M,s){s.r(M);var t=s("./src/events.ts"),e=s("./src/errors.ts"),p=s("./src/utils/logger.ts"),I=s("./src/utils/mediakeys-helper.ts");function b(m,T){for(var f=0;f<T.length;f++){var n=T[f];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(m,n.key,n)}}function A(m,T,f){return T&&b(m.prototype,T),f&&b(m,f),Object.defineProperty(m,"prototype",{writable:!1}),m}var c=3,o=function(T,f,n){var r={audioCapabilities:[],videoCapabilities:[]};return T.forEach(function(d){r.audioCapabilities.push({contentType:'audio/mp4; codecs="'+d+'"',robustness:n.audioRobustness||""})}),f.forEach(function(d){r.videoCapabilities.push({contentType:'video/mp4; codecs="'+d+'"',robustness:n.videoRobustness||""})}),[r]},h=function(T,f,n,r){switch(T){case I.KeySystems.WIDEVINE:return o(f,n,r);default:throw new Error("Unknown key-system: "+T)}},v=function(){function m(f){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=f,this._config=f.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var T=m.prototype;return T.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},T._registerListeners=function(){this.hls.on(t.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(t.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(t.Events.MANIFEST_PARSED,this.onManifestParsed,this)},T._unregisterListeners=function(){this.hls.off(t.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(t.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(t.Events.MANIFEST_PARSED,this.onManifestParsed,this)},T.getLicenseServerUrl=function(n){switch(n){case I.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+n+'"')},T._attemptKeySystemAccess=function(n,r,d){var u=this,y=h(n,r,d,this._drmSystemOptions);p.logger.log("Requesting encrypted media key-system access");var l=this.requestMediaKeySystemAccess(n,y);this.mediaKeysPromise=l.then(function(a){return u._onMediaKeySystemAccessObtained(n,a)}),l.catch(function(a){p.logger.error('Failed to obtain key-system "'+n+'" access:',a)})},T._onMediaKeySystemAccessObtained=function(n,r){var d=this;p.logger.log('Access for key-system "'+n+'" obtained');var u={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:r,mediaKeySystemDomain:n};this._mediaKeysList.push(u);var y=Promise.resolve().then(function(){return r.createMediaKeys()}).then(function(l){return u.mediaKeys=l,p.logger.log('Media-keys created for key-system "'+n+'"'),d._onMediaKeysCreated(),l});return y.catch(function(l){p.logger.error("Failed to create media-keys:",l)}),y},T._onMediaKeysCreated=function(){var n=this;this._mediaKeysList.forEach(function(r){r.mediaKeysSession||(r.mediaKeysSession=r.mediaKeys.createSession(),n._onNewMediaKeySession(r.mediaKeysSession))})},T._onNewMediaKeySession=function(n){var r=this;p.logger.log("New key-system session "+n.sessionId),n.addEventListener("message",function(d){r._onKeySessionMessage(n,d.message)},!1)},T._onKeySessionMessage=function(n,r){p.logger.log("Got EME message event, creating license request"),this._requestLicense(r,function(d){p.logger.log("Received license data (length: "+(d&&d.byteLength)+"), updating key-session"),n.update(d).catch(function(u){p.logger.warn("Updating key-session failed: "+u)})})},T.onMediaEncrypted=function(n){var r=this;if(p.logger.log('Media is encrypted using "'+n.initDataType+'" init data type'),!this.mediaKeysPromise){p.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),this.hls.trigger(t.Events.ERROR,{type:e.ErrorTypes.KEY_SYSTEM_ERROR,details:e.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}var d=function(y){!r._media||(r._attemptSetMediaKeys(y),r._generateRequestWithPreferredKeySession(n.initDataType,n.initData))};this.mediaKeysPromise.then(d).catch(d)},T._attemptSetMediaKeys=function(n){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var r=this._mediaKeysList[0];if(!r||!r.mediaKeys){p.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),this.hls.trigger(t.Events.ERROR,{type:e.ErrorTypes.KEY_SYSTEM_ERROR,details:e.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}p.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(r.mediaKeys),this._hasSetMediaKeys=!0}},T._generateRequestWithPreferredKeySession=function(n,r){var d=this,u=this._mediaKeysList[0];if(!u){p.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),this.hls.trigger(t.Events.ERROR,{type:e.ErrorTypes.KEY_SYSTEM_ERROR,details:e.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}if(u.mediaKeysSessionInitialized){p.logger.warn("Key-Session already initialized but requested again");return}var y=u.mediaKeysSession;if(!y){p.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(t.Events.ERROR,{type:e.ErrorTypes.KEY_SYSTEM_ERROR,details:e.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});return}if(!r){p.logger.warn("Fatal: initData required for generating a key session is null"),this.hls.trigger(t.Events.ERROR,{type:e.ErrorTypes.KEY_SYSTEM_ERROR,details:e.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});return}p.logger.log('Generating key-session request for "'+n+'" init data type'),u.mediaKeysSessionInitialized=!0,y.generateRequest(n,r).then(function(){p.logger.debug("Key-session generation succeeded")}).catch(function(l){p.logger.error("Error generating key-session request:",l),d.hls.trigger(t.Events.ERROR,{type:e.ErrorTypes.KEY_SYSTEM_ERROR,details:e.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})},T._createLicenseXhr=function(n,r,d){var u=new XMLHttpRequest;u.responseType="arraybuffer",u.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,u,n,r,d);var y=this._licenseXhrSetup;if(y)try{y.call(this.hls,u,n),y=void 0}catch(l){p.logger.error(l)}try{u.readyState||u.open("POST",n,!0),y&&y.call(this.hls,u,n)}catch(l){throw new Error("issue setting up KeySystem license XHR "+l)}return u},T._onLicenseRequestReadyStageChange=function(n,r,d,u){switch(n.readyState){case 4:if(n.status===200){this._requestLicenseFailureCount=0,p.logger.log("License request succeeded");var y=n.response,l=this._licenseResponseCallback;if(l)try{y=l.call(this.hls,n,r)}catch(i){p.logger.error(i)}u(y)}else{if(p.logger.error("License Request XHR failed ("+r+"). Status: "+n.status+" ("+n.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>c){this.hls.trigger(t.Events.ERROR,{type:e.ErrorTypes.KEY_SYSTEM_ERROR,details:e.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});return}var a=c-this._requestLicenseFailureCount+1;p.logger.warn("Retrying license request, "+a+" attempts left"),this._requestLicense(d,u)}break}},T._generateLicenseRequestChallenge=function(n,r){switch(n.mediaKeySystemDomain){case I.KeySystems.WIDEVINE:return r}throw new Error("unsupported key-system: "+n.mediaKeySystemDomain)},T._requestLicense=function(n,r){p.logger.log("Requesting content license for key-system");var d=this._mediaKeysList[0];if(!d){p.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),this.hls.trigger(t.Events.ERROR,{type:e.ErrorTypes.KEY_SYSTEM_ERROR,details:e.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}try{var u=this.getLicenseServerUrl(d.mediaKeySystemDomain),y=this._createLicenseXhr(u,n,r);p.logger.log("Sending license request to URL: "+u);var l=this._generateLicenseRequestChallenge(d,n);y.send(l)}catch(a){p.logger.error("Failure requesting DRM license: "+a),this.hls.trigger(t.Events.ERROR,{type:e.ErrorTypes.KEY_SYSTEM_ERROR,details:e.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},T.onMediaAttached=function(n,r){if(!!this._emeEnabled){var d=r.media;this._media=d,d.addEventListener("encrypted",this._onMediaEncrypted)}},T.onMediaDetached=function(){var n=this._media,r=this._mediaKeysList;!n||(n.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(r.map(function(d){if(d.mediaKeysSession)return d.mediaKeysSession.close().catch(function(){})})).then(function(){return n.setMediaKeys(null)}).catch(function(){}))},T.onManifestParsed=function(n,r){if(!!this._emeEnabled){var d=r.levels.map(function(y){return y.audioCodec}).filter(function(y){return!!y}),u=r.levels.map(function(y){return y.videoCodec}).filter(function(y){return!!y});this._attemptKeySystemAccess(I.KeySystems.WIDEVINE,d,u)}},A(m,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),m}();M.default=v},"./src/controller/fps-controller.ts":function(R,M,s){s.r(M);var t=s("./src/events.ts"),e=s("./src/utils/logger.ts"),p=function(){function I(A){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=A,this.registerListeners()}var b=I.prototype;return b.setStreamController=function(c){this.streamController=c},b.registerListeners=function(){this.hls.on(t.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},b.unregisterListeners=function(){this.hls.off(t.Events.MEDIA_ATTACHING,this.onMediaAttaching)},b.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},b.onMediaAttaching=function(c,o){var h=this.hls.config;if(h.capLevelOnFPSDrop){var v=o.media instanceof self.HTMLVideoElement?o.media:null;this.media=v,v&&typeof v.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),h.fpsDroppedMonitoringPeriod)}},b.checkFPS=function(c,o,h){var v=performance.now();if(o){if(this.lastTime){var m=v-this.lastTime,T=h-this.lastDroppedFrames,f=o-this.lastDecodedFrames,n=1e3*T/m,r=this.hls;if(r.trigger(t.Events.FPS_DROP,{currentDropped:T,currentDecoded:f,totalDroppedFrames:h}),n>0&&T>r.config.fpsDroppedMonitoringThreshold*f){var d=r.currentLevel;e.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+d),d>0&&(r.autoLevelCapping===-1||r.autoLevelCapping>=d)&&(d=d-1,r.trigger(t.Events.FPS_DROP_LEVEL_CAPPING,{level:d,droppedLevel:r.currentLevel}),r.autoLevelCapping=d,this.streamController.nextLevelSwitch())}}this.lastTime=v,this.lastDroppedFrames=h,this.lastDecodedFrames=o}},b.checkFPSInterval=function(){var c=this.media;if(c)if(this.isVideoPlaybackQualityAvailable){var o=c.getVideoPlaybackQuality();this.checkFPS(c,o.totalVideoFrames,o.droppedVideoFrames)}else this.checkFPS(c,c.webkitDecodedFrameCount,c.webkitDroppedFrameCount)},I}();M.default=p},"./src/controller/fragment-finders.ts":function(R,M,s){s.r(M),s.d(M,"findFragmentByPDT",function(){return p}),s.d(M,"findFragmentByPTS",function(){return I}),s.d(M,"fragmentWithinToleranceTest",function(){return b}),s.d(M,"pdtWithinToleranceTest",function(){return A}),s.d(M,"findFragWithCC",function(){return c});var t=s("./src/polyfills/number.ts"),e=s("./src/utils/binary-search.ts");function p(o,h,v){if(h===null||!Array.isArray(o)||!o.length||!Object(t.isFiniteNumber)(h))return null;var m=o[0].programDateTime;if(h<(m||0))return null;var T=o[o.length-1].endProgramDateTime;if(h>=(T||0))return null;v=v||0;for(var f=0;f<o.length;++f){var n=o[f];if(A(h,v,n))return n}return null}function I(o,h,v,m){v===void 0&&(v=0),m===void 0&&(m=0);var T=null;if(o?T=h[o.sn-h[0].sn+1]||null:v===0&&h[0].start===0&&(T=h[0]),T&&b(v,m,T)===0)return T;var f=e.default.search(h,b.bind(null,v,m));return f||T}function b(o,h,v){o===void 0&&(o=0),h===void 0&&(h=0);var m=Math.min(h,v.duration+(v.deltaPTS?v.deltaPTS:0));return v.start+v.duration-m<=o?1:v.start-m>o&&v.start?-1:0}function A(o,h,v){var m=Math.min(h,v.duration+(v.deltaPTS?v.deltaPTS:0))*1e3,T=v.endProgramDateTime||0;return T-m>o}function c(o,h){return e.default.search(o,function(v){return v.cc<h?1:v.cc>h?-1:0})}},"./src/controller/fragment-tracker.ts":function(R,M,s){s.r(M),s.d(M,"FragmentState",function(){return p}),s.d(M,"FragmentTracker",function(){return I});var t=s("./src/events.ts"),e=s("./src/types/loader.ts"),p;(function(c){c.NOT_LOADED="NOT_LOADED",c.APPENDING="APPENDING",c.PARTIAL="PARTIAL",c.OK="OK"})(p||(p={}));var I=function(){function c(h){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=h,this._registerListeners()}var o=c.prototype;return o._registerListeners=function(){var v=this.hls;v.on(t.Events.BUFFER_APPENDED,this.onBufferAppended,this),v.on(t.Events.FRAG_BUFFERED,this.onFragBuffered,this),v.on(t.Events.FRAG_LOADED,this.onFragLoaded,this)},o._unregisterListeners=function(){var v=this.hls;v.off(t.Events.BUFFER_APPENDED,this.onBufferAppended,this),v.off(t.Events.FRAG_BUFFERED,this.onFragBuffered,this),v.off(t.Events.FRAG_LOADED,this.onFragLoaded,this)},o.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},o.getAppendedFrag=function(v,m){if(m===e.PlaylistLevelType.MAIN){var T=this.activeFragment,f=this.activeParts;if(!T)return null;if(f)for(var n=f.length;n--;){var r=f[n],d=r?r.end:T.appendedPTS;if(r.start<=v&&d!==void 0&&v<=d)return n>9&&(this.activeParts=f.slice(n-9)),r}else if(T.start<=v&&T.appendedPTS!==void 0&&v<=T.appendedPTS)return T}return this.getBufferedFrag(v,m)},o.getBufferedFrag=function(v,m){for(var T=this.fragments,f=Object.keys(T),n=f.length;n--;){var r=T[f[n]];if((r==null?void 0:r.body.type)===m&&r.buffered){var d=r.body;if(d.start<=v&&v<=d.end)return d}}return null},o.detectEvictedFragments=function(v,m,T){var f=this;Object.keys(this.fragments).forEach(function(n){var r=f.fragments[n];if(!!r){if(!r.buffered){r.body.type===T&&f.removeFragment(r.body);return}var d=r.range[v];!d||d.time.some(function(u){var y=!f.isTimeBuffered(u.startPTS,u.endPTS,m);return y&&f.removeFragment(r.body),y})}})},o.detectPartialFragments=function(v){var m=this,T=this.timeRanges,f=v.frag,n=v.part;if(!(!T||f.sn==="initSegment")){var r=A(f),d=this.fragments[r];!d||(Object.keys(T).forEach(function(u){var y=f.elementaryStreams[u];if(!!y){var l=T[u],a=n!==null||y.partial===!0;d.range[u]=m.getBufferedTimes(f,n,a,l)}}),d.loaded=null,Object.keys(d.range).length?d.buffered=!0:this.removeFragment(d.body))}},o.fragBuffered=function(v){var m=A(v),T=this.fragments[m];T&&(T.loaded=null,T.buffered=!0)},o.getBufferedTimes=function(v,m,T,f){for(var n={time:[],partial:T},r=m?m.start:v.start,d=m?m.end:v.end,u=v.minEndPTS||d,y=v.maxStartPTS||r,l=0;l<f.length;l++){var a=f.start(l)-this.bufferPadding,i=f.end(l)+this.bufferPadding;if(y>=a&&u<=i){n.time.push({startPTS:Math.max(r,f.start(l)),endPTS:Math.min(d,f.end(l))});break}else if(r<i&&d>a)n.partial=!0,n.time.push({startPTS:Math.max(r,f.start(l)),endPTS:Math.min(d,f.end(l))});else if(d<=a)break}return n},o.getPartialFragment=function(v){var m=null,T,f,n,r=0,d=this.bufferPadding,u=this.fragments;return Object.keys(u).forEach(function(y){var l=u[y];!l||b(l)&&(f=l.body.start-d,n=l.body.end+d,v>=f&&v<=n&&(T=Math.min(v-f,n-v),r<=T&&(m=l.body,r=T)))}),m},o.getState=function(v){var m=A(v),T=this.fragments[m];return T?T.buffered?b(T)?p.PARTIAL:p.OK:p.APPENDING:p.NOT_LOADED},o.isTimeBuffered=function(v,m,T){for(var f,n,r=0;r<T.length;r++){if(f=T.start(r)-this.bufferPadding,n=T.end(r)+this.bufferPadding,v>=f&&m<=n)return!0;if(m<=f)return!1}return!1},o.onFragLoaded=function(v,m){var T=m.frag,f=m.part;if(!(T.sn==="initSegment"||T.bitrateTest||f)){var n=A(T);this.fragments[n]={body:T,loaded:m,buffered:!1,range:Object.create(null)}}},o.onBufferAppended=function(v,m){var T=this,f=m.frag,n=m.part,r=m.timeRanges;if(f.type===e.PlaylistLevelType.MAIN)if(this.activeFragment=f,n){var d=this.activeParts;d||(this.activeParts=d=[]),d.push(n)}else this.activeParts=null;this.timeRanges=r,Object.keys(r).forEach(function(u){var y=r[u];if(T.detectEvictedFragments(u,y),!n)for(var l=0;l<y.length;l++)f.appendedPTS=Math.max(y.end(l),f.appendedPTS||0)})},o.onFragBuffered=function(v,m){this.detectPartialFragments(m)},o.hasFragment=function(v){var m=A(v);return!!this.fragments[m]},o.removeFragmentsInRange=function(v,m,T){var f=this;Object.keys(this.fragments).forEach(function(n){var r=f.fragments[n];if(!!r&&r.buffered){var d=r.body;d.type===T&&d.start<m&&d.end>v&&f.removeFragment(d)}})},o.removeFragment=function(v){var m=A(v);v.stats.loaded=0,v.clearElementaryStreamInfo(),delete this.fragments[m]},o.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},c}();function b(c){var o,h;return c.buffered&&(((o=c.range.video)===null||o===void 0?void 0:o.partial)||((h=c.range.audio)===null||h===void 0?void 0:h.partial))}function A(c){return c.type+"_"+c.level+"_"+c.urlId+"_"+c.sn}},"./src/controller/gap-controller.ts":function(R,M,s){s.r(M),s.d(M,"STALL_MINIMUM_DURATION_MS",function(){return b}),s.d(M,"MAX_START_GAP_JUMP",function(){return A}),s.d(M,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return c}),s.d(M,"SKIP_BUFFER_RANGE_START",function(){return o}),s.d(M,"default",function(){return h});var t=s("./src/utils/buffer-helper.ts"),e=s("./src/errors.ts"),p=s("./src/events.ts"),I=s("./src/utils/logger.ts"),b=250,A=2,c=.1,o=.05,h=function(){function v(T,f,n,r){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=T,this.media=f,this.fragmentTracker=n,this.hls=r}var m=v.prototype;return m.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},m.poll=function(f,n){var r=this.config,d=this.media,u=this.stalled;if(d!==null){var y=d.currentTime,l=d.seeking,a=this.seeking&&!l,i=!this.seeking&&l;if(this.seeking=l,y!==f){if(this.moved=!0,u!==null){if(this.stallReported){var D=self.performance.now()-u;I.logger.warn("playback not stuck anymore @"+y+", after "+Math.round(D)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((i||a)&&(this.stalled=null),!(d.paused&&!l||d.ended||d.playbackRate===0||!t.BufferHelper.getBuffered(d).length)){var E=t.BufferHelper.bufferInfo(d,y,0),S=E.len>0,L=E.nextStart||0;if(!(!S&&!L)){if(l){var x=E.len>A,g=!L||n&&n.start<=y||L-y>A&&!this.fragmentTracker.getPartialFragment(y);if(x||g)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var O,P=Math.max(L,E.start||0)-y,C=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,w=C==null||(O=C.details)===null||O===void 0?void 0:O.live,F=w?C.details.targetduration*2:A;if(P>0&&P<=F){this._trySkipBufferHole(null);return}}var k=self.performance.now();if(u===null){this.stalled=k;return}var _=k-u;if(!(!l&&_>=b&&(this._reportStall(E),!this.media))){var B=t.BufferHelper.bufferInfo(d,y,r.maxBufferHole);this._tryFixBufferStall(B,_)}}}}},m._tryFixBufferStall=function(f,n){var r=this.config,d=this.fragmentTracker,u=this.media;if(u!==null){var y=u.currentTime,l=d.getPartialFragment(y);if(l){var a=this._trySkipBufferHole(l);if(a||!this.media)return}f.len>r.maxBufferHole&&n>r.highBufferWatchdogPeriod*1e3&&(I.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},m._reportStall=function(f){var n=this.hls,r=this.media,d=this.stallReported;!d&&r&&(this.stallReported=!0,I.logger.warn("Playback stalling at @"+r.currentTime+" due to low buffer ("+JSON.stringify(f)+")"),n.trigger(p.Events.ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:f.len}))},m._trySkipBufferHole=function(f){var n=this.config,r=this.hls,d=this.media;if(d===null)return 0;for(var u=d.currentTime,y=0,l=t.BufferHelper.getBuffered(d),a=0;a<l.length;a++){var i=l.start(a);if(u+n.maxBufferHole>=y&&u<i){var D=Math.max(i+o,d.currentTime+c);return I.logger.warn("skipping hole, adjusting currentTime from "+u+" to "+D),this.moved=!0,this.stalled=null,d.currentTime=D,f&&r.trigger(p.Events.ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+u+" to "+D,frag:f}),D}y=l.end(a)}return 0},m._tryNudgeBuffer=function(){var f=this.config,n=this.hls,r=this.media,d=this.nudgeRetry;if(r!==null){var u=r.currentTime;if(this.nudgeRetry++,d<f.nudgeMaxRetry){var y=u+(d+1)*f.nudgeOffset;I.logger.warn("Nudging 'currentTime' from "+u+" to "+y),r.currentTime=y,n.trigger(p.Events.ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else I.logger.error("Playhead still not moving while enough data buffered @"+u+" after "+f.nudgeMaxRetry+" nudges"),n.trigger(p.Events.ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},v}()},"./src/controller/id3-track-controller.ts":function(R,M,s){s.r(M);var t=s("./src/polyfills/number.ts"),e=s("./src/events.ts"),p=s("./src/utils/texttrack-utils.ts"),I=s("./src/demux/id3.ts"),b=s("./src/loader/date-range.ts"),A=s("./src/types/demuxer.ts"),c=.25;function o(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}function h(T,f){return T.getTime()/1e3-f}function v(T){return Uint8Array.from(T.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var m=function(){function T(n){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=n,this._registerListeners()}var f=T.prototype;return f.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},f._registerListeners=function(){var r=this.hls;r.on(e.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(e.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(e.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(e.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),r.on(e.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),r.on(e.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},f._unregisterListeners=function(){var r=this.hls;r.off(e.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(e.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(e.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(e.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),r.off(e.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),r.off(e.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},f.onMediaAttached=function(r,d){this.media=d.media},f.onMediaDetaching=function(){!this.id3Track||(Object(p.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},f.onManifestLoading=function(){this.dateRangeCuesAppended={}},f.createTrack=function(r){var d=this.getID3Track(r.textTracks);return d.mode="hidden",d},f.getID3Track=function(r){if(!!this.media){for(var d=0;d<r.length;d++){var u=r[d];if(u.kind==="metadata"&&u.label==="id3")return Object(p.sendAddTrackEvent)(u,this.media),u}return this.media.addTextTrack("metadata","id3")}},f.onFragParsingMetadata=function(r,d){if(!!this.media){var u=this.hls.config,y=u.enableEmsgMetadataCues,l=u.enableID3MetadataCues;if(!(!y&&!l)){var a=d.frag,i=d.samples,D=d.details;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var E=D.edge||a.end,S=o(),L=!1,x={},g=0;g<i.length;g++){var O=i[g].type;if(!(O===A.MetadataSchema.emsg&&!y||!l)){var P=I.getID3Frames(i[g].data);if(P){var C=i[g].pts,w=E,F=w-C;F<=0&&(w=C+c);for(var k=0;k<P.length;k++){var _=P[k];if(!I.isTimeStampFrame(_)){var B=new S(C,w,"");B.value=_,O&&(B.type=O),this.id3Track.addCue(B),x[_.key]=null,L=!0}}}}}L&&this.updateId3CueEnds(x)}}},f.updateId3CueEnds=function(r){var d,u=(d=this.id3Track)===null||d===void 0?void 0:d.cues;if(u)for(var y=u.length;y--;){var l,a=u[y],i=(l=a.value)===null||l===void 0?void 0:l.key;if(i&&i in r){var D=r[i];D&&a.endTime!==D&&(a.endTime=D),r[i]=a.startTime}}},f.onBufferFlushing=function(r,d){var u=d.startOffset,y=d.endOffset,l=d.type,a=this.id3Track,i=this.hls;if(!!i){var D=i.config,E=D.enableEmsgMetadataCues,S=D.enableID3MetadataCues;if(a&&(E||S)){var L;l==="audio"?L=function(g){return g.type===A.MetadataSchema.audioId3&&S}:l==="video"?L=function(g){return g.type===A.MetadataSchema.emsg&&E}:L=function(g){return g.type===A.MetadataSchema.audioId3&&S||g.type===A.MetadataSchema.emsg&&E},Object(p.removeCuesInRange)(a,u,y,L)}}},f.onLevelUpdated=function(r,d){var u=this,y=d.details;if(!(!this.media||!y.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)){var l=this.dateRangeCuesAppended,a=this.id3Track,i=y.dateRanges,D=Object.keys(i);if(a)for(var E=Object.keys(l).filter(function(F){return!D.includes(F)}),S=function(k){var _=E[k];Object.keys(l[_].cues).forEach(function(B){a.removeCue(l[_].cues[B])}),delete l[_]},L=E.length;L--;)S(L);var x=y.fragments[y.fragments.length-1];if(!(D.length===0||!Object(t.isFiniteNumber)(x==null?void 0:x.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var g=x.programDateTime/1e3-x.start,O=y.edge||x.end,P=o(),C=function(k){var _=D[k],B=i[_],N=l[_],U=(N==null?void 0:N.cues)||{},j=(N==null?void 0:N.durationKnown)||!1,W=h(B.startDate,g),H=O,G=B.endDate;if(G)H=h(G,g),j=!0;else if(B.endOnNext&&!j){var K=D.reduce(function(Q,$){var J=i[$];return J.class===B.class&&J.id!==$&&J.startDate>B.startDate&&Q.push(J),Q},[]).sort(function(Q,$){return Q.startDate.getTime()-$.startDate.getTime()})[0];K&&(H=h(K.startDate,g),j=!0)}for(var X=Object.keys(B.attr),Z=0;Z<X.length;Z++){var z=X[Z];if(!(z===b.DateRangeAttribute.ID||z===b.DateRangeAttribute.CLASS||z===b.DateRangeAttribute.START_DATE||z===b.DateRangeAttribute.DURATION||z===b.DateRangeAttribute.END_DATE||z===b.DateRangeAttribute.END_ON_NEXT)){var V=U[z];if(V)j&&!N.durationKnown&&(V.endTime=H);else{var Y=B.attr[z];V=new P(W,H,""),(z===b.DateRangeAttribute.SCTE35_OUT||z===b.DateRangeAttribute.SCTE35_IN)&&(Y=v(Y)),V.value={key:z,data:Y},V.type=A.MetadataSchema.dateRange,u.id3Track.addCue(V),U[z]=V}}}l[_]={cues:U,dateRange:B,durationKnown:j}},w=0;w<D.length;w++)C(w)}}},T}();M.default=m},"./src/controller/latency-controller.ts":function(R,M,s){s.r(M),s.d(M,"default",function(){return A});var t=s("./src/errors.ts"),e=s("./src/events.ts"),p=s("./src/utils/logger.ts");function I(c,o){for(var h=0;h<o.length;h++){var v=o[h];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(c,v.key,v)}}function b(c,o,h){return o&&I(c.prototype,o),h&&I(c,h),Object.defineProperty(c,"prototype",{writable:!1}),c}var A=function(){function c(h){var v=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return v.timeupdate()},this.hls=h,this.config=h.config,this.registerListeners()}var o=c.prototype;return o.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},o.registerListeners=function(){this.hls.on(e.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(e.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(e.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(e.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(e.Events.ERROR,this.onError,this)},o.unregisterListeners=function(){this.hls.off(e.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(e.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(e.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(e.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(e.Events.ERROR,this.onError)},o.onMediaAttached=function(v,m){this.media=m.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},o.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},o.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},o.onLevelUpdated=function(v,m){var T=m.details;this.levelDetails=T,T.advanced&&this.timeupdate(),!T.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},o.onError=function(v,m){m.details===t.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,p.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},o.timeupdate=function(){var v=this.media,m=this.levelDetails;if(!(!v||!m)){this.currentTime=v.currentTime;var T=this.computeLatency();if(T!==null){this._latency=T;var f=this.config,n=f.lowLatencyMode,r=f.maxLiveSyncPlaybackRate;if(!(!n||r===1)){var d=this.targetLatency;if(d!==null){var u=T-d,y=Math.min(this.maxLatency,d+m.targetduration),l=u<y;if(m.live&&l&&u>.05&&this.forwardBufferLength>1){var a=Math.min(2,Math.max(1,r)),i=Math.round(2/(1+Math.exp(-.75*u-this.edgeStalled))*20)/20;v.playbackRate=Math.min(a,Math.max(1,i))}else v.playbackRate!==1&&v.playbackRate!==0&&(v.playbackRate=1)}}}}},o.estimateLiveEdge=function(){var v=this.levelDetails;return v===null?null:v.edge+v.age},o.computeLatency=function(){var v=this.estimateLiveEdge();return v===null?null:v-this.currentTime},b(c,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var v=this.config,m=this.levelDetails;return v.liveMaxLatencyDuration!==void 0?v.liveMaxLatencyDuration:m?v.liveMaxLatencyDurationCount*m.targetduration:0}},{key:"targetLatency",get:function(){var v=this.levelDetails;if(v===null)return null;var m=v.holdBack,T=v.partHoldBack,f=v.targetduration,n=this.config,r=n.liveSyncDuration,d=n.liveSyncDurationCount,u=n.lowLatencyMode,y=this.hls.userConfig,l=u&&T||m;(y.liveSyncDuration||y.liveSyncDurationCount||l===0)&&(l=r!==void 0?r:d*f);var a=f,i=1;return l+Math.min(this.stallCount*i,a)}},{key:"liveSyncPosition",get:function(){var v=this.estimateLiveEdge(),m=this.targetLatency,T=this.levelDetails;if(v===null||m===null||T===null)return null;var f=T.edge,n=v-m-this.edgeStalled,r=f-T.totalduration,d=f-(this.config.lowLatencyMode&&T.partTarget||T.targetduration);return Math.min(Math.max(r,n),d)}},{key:"drift",get:function(){var v=this.levelDetails;return v===null?1:v.drift}},{key:"edgeStalled",get:function(){var v=this.levelDetails;if(v===null)return 0;var m=(this.config.lowLatencyMode&&v.partTarget||v.targetduration)*3;return Math.max(v.age-m,0)}},{key:"forwardBufferLength",get:function(){var v=this.media,m=this.levelDetails;if(!v||!m)return 0;var T=v.buffered.length;return(T?v.buffered.end(T-1):m.edge)-this.currentTime}}]),c}()},"./src/controller/level-controller.ts":function(R,M,s){s.r(M),s.d(M,"default",function(){return n});var t=s("./src/types/level.ts"),e=s("./src/events.ts"),p=s("./src/errors.ts"),I=s("./src/utils/codecs.ts"),b=s("./src/controller/level-helper.ts"),A=s("./src/controller/base-playlist-controller.ts"),c=s("./src/types/loader.ts");function o(){return o=Object.assign?Object.assign.bind():function(r){for(var d=1;d<arguments.length;d++){var u=arguments[d];for(var y in u)Object.prototype.hasOwnProperty.call(u,y)&&(r[y]=u[y])}return r},o.apply(this,arguments)}function h(r,d){for(var u=0;u<d.length;u++){var y=d[u];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(r,y.key,y)}}function v(r,d,u){return d&&h(r.prototype,d),u&&h(r,u),Object.defineProperty(r,"prototype",{writable:!1}),r}function m(r,d){r.prototype=Object.create(d.prototype),r.prototype.constructor=r,T(r,d)}function T(r,d){return T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(y,l){return y.__proto__=l,y},T(r,d)}var f=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),n=function(r){m(d,r);function d(y){var l;return l=r.call(this,y,"[level-controller]")||this,l._levels=[],l._firstLevel=-1,l._startLevel=void 0,l.currentLevelIndex=-1,l.manualLevelIndex=-1,l.onParsedComplete=void 0,l._registerListeners(),l}var u=d.prototype;return u._registerListeners=function(){var l=this.hls;l.on(e.Events.MANIFEST_LOADED,this.onManifestLoaded,this),l.on(e.Events.LEVEL_LOADED,this.onLevelLoaded,this),l.on(e.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),l.on(e.Events.FRAG_LOADED,this.onFragLoaded,this),l.on(e.Events.ERROR,this.onError,this)},u._unregisterListeners=function(){var l=this.hls;l.off(e.Events.MANIFEST_LOADED,this.onManifestLoaded,this),l.off(e.Events.LEVEL_LOADED,this.onLevelLoaded,this),l.off(e.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),l.off(e.Events.FRAG_LOADED,this.onFragLoaded,this),l.off(e.Events.ERROR,this.onError,this)},u.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,r.prototype.destroy.call(this)},u.startLoad=function(){var l=this._levels;l.forEach(function(a){a.loadError=0}),r.prototype.startLoad.call(this)},u.onManifestLoaded=function(l,a){var i=[],D=[],E=[],S,L={},x,g=!1,O=!1,P=!1;if(a.levels.forEach(function(k){var _=k.attrs;g=g||!!(k.width&&k.height),O=O||!!k.videoCodec,P=P||!!k.audioCodec,f&&k.audioCodec&&k.audioCodec.indexOf("mp4a.40.34")!==-1&&(k.audioCodec=void 0);var B=k.bitrate+"-"+k.attrs.RESOLUTION+"-"+k.attrs.CODECS;x=L[B],x?x.url.push(k.url):(x=new t.Level(k),L[B]=x,i.push(x)),_&&(_.AUDIO&&Object(b.addGroupId)(x,"audio",_.AUDIO),_.SUBTITLES&&Object(b.addGroupId)(x,"text",_.SUBTITLES))}),(g||O)&&P&&(i=i.filter(function(k){var _=k.videoCodec,B=k.width,N=k.height;return!!_||!!(B&&N)})),i=i.filter(function(k){var _=k.audioCodec,B=k.videoCodec;return(!_||Object(I.isCodecSupportedInMp4)(_,"audio"))&&(!B||Object(I.isCodecSupportedInMp4)(B,"video"))}),a.audioTracks&&(D=a.audioTracks.filter(function(k){return!k.audioCodec||Object(I.isCodecSupportedInMp4)(k.audioCodec,"audio")}),Object(b.assignTrackIdsByGroup)(D)),a.subtitles&&(E=a.subtitles,Object(b.assignTrackIdsByGroup)(E)),i.length>0){S=i[0].bitrate,i.sort(function(k,_){return k.bitrate-_.bitrate}),this._levels=i;for(var C=0;C<i.length;C++)if(i[C].bitrate===S){this._firstLevel=C,this.log("manifest loaded, "+i.length+" level(s) found, first bitrate: "+S);break}var w=P&&!O,F={levels:i,audioTracks:D,subtitleTracks:E,firstLevel:this._firstLevel,stats:a.stats,audio:P,video:O,altAudio:!w&&D.some(function(k){return!!k.url})};this.hls.trigger(e.Events.MANIFEST_PARSED,F),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(e.Events.ERROR,{type:p.ErrorTypes.MEDIA_ERROR,details:p.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:a.url,reason:"no level with compatible codecs found in manifest"})},u.onError=function(l,a){if(r.prototype.onError.call(this,l,a),!a.fatal){var i=a.context,D=this._levels[this.currentLevelIndex];if(i&&(i.type===c.PlaylistContextType.AUDIO_TRACK&&D.audioGroupIds&&i.groupId===D.audioGroupIds[D.urlId]||i.type===c.PlaylistContextType.SUBTITLE_TRACK&&D.textGroupIds&&i.groupId===D.textGroupIds[D.urlId])){this.redundantFailover(this.currentLevelIndex);return}var E=!1,S=!0,L;switch(a.details){case p.ErrorDetails.FRAG_LOAD_ERROR:case p.ErrorDetails.FRAG_LOAD_TIMEOUT:case p.ErrorDetails.KEY_LOAD_ERROR:case p.ErrorDetails.KEY_LOAD_TIMEOUT:if(a.frag){var x=this._levels[a.frag.level];x?(x.fragmentError++,x.fragmentError>this.hls.config.fragLoadingMaxRetry&&(L=a.frag.level)):L=a.frag.level}break;case p.ErrorDetails.LEVEL_LOAD_ERROR:case p.ErrorDetails.LEVEL_LOAD_TIMEOUT:i&&(i.deliveryDirectives&&(S=!1),L=i.level),E=!0;break;case p.ErrorDetails.REMUX_ALLOC_ERROR:L=a.level,E=!0;break}L!==void 0&&this.recoverLevel(a,L,E,S)}},u.recoverLevel=function(l,a,i,D){var E=l.details,S=this._levels[a];if(S.loadError++,i){var L=this.retryLoadingOrFail(l);if(L)l.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(D){var x=S.url.length;if(x>1&&S.loadError<x)l.levelRetry=!0,this.redundantFailover(a);else if(this.manualLevelIndex===-1){var g=a===0?this._levels.length-1:a-1;this.currentLevelIndex!==g&&this._levels[g].loadError===0&&(this.warn(E+": switch to "+g),l.levelRetry=!0,this.hls.nextAutoLevel=g)}}},u.redundantFailover=function(l){var a=this._levels[l],i=a.url.length;if(i>1){var D=(a.urlId+1)%i;this.warn("Switching to redundant URL-id "+D),this._levels.forEach(function(E){E.urlId=D}),this.level=l}},u.onFragLoaded=function(l,a){var i=a.frag;if(i!==void 0&&i.type===c.PlaylistLevelType.MAIN){var D=this._levels[i.level];D!==void 0&&(D.fragmentError=0,D.loadError=0)}},u.onLevelLoaded=function(l,a){var i,D=a.level,E=a.details,S=this._levels[D];if(!S){var L;this.warn("Invalid level index "+D),(L=a.deliveryDirectives)!==null&&L!==void 0&&L.skip&&(E.deltaUpdateFailed=!0);return}D===this.currentLevelIndex?(S.fragmentError===0&&(S.loadError=0,this.retryCount=0),this.playlistLoaded(D,a,S.details)):(i=a.deliveryDirectives)!==null&&i!==void 0&&i.skip&&(E.deltaUpdateFailed=!0)},u.onAudioTrackSwitched=function(l,a){var i=this.hls.levels[this.currentLevelIndex];if(!!i&&i.audioGroupIds){for(var D=-1,E=this.hls.audioTracks[a.id].groupId,S=0;S<i.audioGroupIds.length;S++)if(i.audioGroupIds[S]===E){D=S;break}D!==i.urlId&&(i.urlId=D,this.startLoad())}},u.loadPlaylist=function(l){var a=this.currentLevelIndex,i=this._levels[a];if(this.canLoad&&i&&i.url.length>0){var D=i.urlId,E=i.url[D];if(l)try{E=l.addDirectives(E)}catch(S){this.warn("Could not construct new URL with HLS Delivery Directives: "+S)}this.log("Attempt loading level index "+a+(l?" at sn "+l.msn+" part "+l.part:"")+" with URL-id "+D+" "+E),this.clearTimer(),this.hls.trigger(e.Events.LEVEL_LOADING,{url:E,level:a,id:D,deliveryDirectives:l||null})}},u.removeLevel=function(l,a){var i=function(S,L){return L!==a},D=this._levels.filter(function(E,S){return S!==l?!0:E.url.length>1&&a!==void 0?(E.url=E.url.filter(i),E.audioGroupIds&&(E.audioGroupIds=E.audioGroupIds.filter(i)),E.textGroupIds&&(E.textGroupIds=E.textGroupIds.filter(i)),E.urlId=0,!0):!1}).map(function(E,S){var L=E.details;return L!=null&&L.fragments&&L.fragments.forEach(function(x){x.level=S}),E});this._levels=D,this.hls.trigger(e.Events.LEVELS_UPDATED,{levels:D})},v(d,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(l){var a,i=this._levels;if(i.length!==0&&!(this.currentLevelIndex===l&&(a=i[l])!==null&&a!==void 0&&a.details)){if(l<0||l>=i.length){var D=l<0;if(this.hls.trigger(e.Events.ERROR,{type:p.ErrorTypes.OTHER_ERROR,details:p.ErrorDetails.LEVEL_SWITCH_ERROR,level:l,fatal:D,reason:"invalid level idx"}),D)return;l=Math.min(l,i.length-1)}this.clearTimer();var E=this.currentLevelIndex,S=i[E],L=i[l];this.log("switching to level "+l+" from "+E),this.currentLevelIndex=l;var x=o({},L,{level:l,maxBitrate:L.maxBitrate,uri:L.uri,urlId:L.urlId});delete x._urlId,this.hls.trigger(e.Events.LEVEL_SWITCHING,x);var g=L.details;if(!g||g.live){var O=this.switchParams(L.uri,S==null?void 0:S.details);this.loadPlaylist(O)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(l){this.manualLevelIndex=l,this._startLevel===void 0&&(this._startLevel=l),l!==-1&&(this.level=l)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(l){this._firstLevel=l}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var l=this.hls.config.startLevel;return l!==void 0?l:this._firstLevel}else return this._startLevel},set:function(l){this._startLevel=l}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(l){this.level=l,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=l)}}]),d}(A.default)},"./src/controller/level-helper.ts":function(R,M,s){s.r(M),s.d(M,"addGroupId",function(){return b}),s.d(M,"assignTrackIdsByGroup",function(){return A}),s.d(M,"updatePTS",function(){return c}),s.d(M,"updateFragPTSDTS",function(){return h}),s.d(M,"mergeDetails",function(){return v}),s.d(M,"mapPartIntersection",function(){return T}),s.d(M,"mapFragmentIntersection",function(){return f}),s.d(M,"adjustSliding",function(){return n}),s.d(M,"addSliding",function(){return r}),s.d(M,"computeReloadInterval",function(){return d}),s.d(M,"getFragmentWithSN",function(){return u}),s.d(M,"getPartWith",function(){return y});var t=s("./src/polyfills/number.ts"),e=s("./src/utils/logger.ts"),p=s("./src/loader/date-range.ts");function I(){return I=Object.assign?Object.assign.bind():function(l){for(var a=1;a<arguments.length;a++){var i=arguments[a];for(var D in i)Object.prototype.hasOwnProperty.call(i,D)&&(l[D]=i[D])}return l},I.apply(this,arguments)}function b(l,a,i){switch(a){case"audio":l.audioGroupIds||(l.audioGroupIds=[]),l.audioGroupIds.push(i);break;case"text":l.textGroupIds||(l.textGroupIds=[]),l.textGroupIds.push(i);break}}function A(l){var a={};l.forEach(function(i){var D=i.groupId||"";i.id=a[D]=a[D]||0,a[D]++})}function c(l,a,i){var D=l[a],E=l[i];o(D,E)}function o(l,a){var i=a.startPTS;if(Object(t.isFiniteNumber)(i)){var D=0,E;a.sn>l.sn?(D=i-l.start,E=l):(D=l.start-i,E=a),E.duration!==D&&(E.duration=D)}else if(a.sn>l.sn){var S=l.cc===a.cc;S&&l.minEndPTS?a.start=l.start+(l.minEndPTS-l.start):a.start=l.start+l.duration}else a.start=Math.max(l.start-a.duration,0)}function h(l,a,i,D,E,S){var L=D-i;L<=0&&(e.logger.warn("Fragment should have a positive duration",a),D=i+a.duration,S=E+a.duration);var x=i,g=D,O=a.startPTS,P=a.endPTS;if(Object(t.isFiniteNumber)(O)){var C=Math.abs(O-i);Object(t.isFiniteNumber)(a.deltaPTS)?a.deltaPTS=Math.max(C,a.deltaPTS):a.deltaPTS=C,x=Math.max(i,O),i=Math.min(i,O),E=Math.min(E,a.startDTS),g=Math.min(D,P),D=Math.max(D,P),S=Math.max(S,a.endDTS)}a.duration=D-i;var w=i-a.start;a.appendedPTS=D,a.start=a.startPTS=i,a.maxStartPTS=x,a.startDTS=E,a.endPTS=D,a.minEndPTS=g,a.endDTS=S;var F=a.sn;if(!l||F<l.startSN||F>l.endSN)return 0;var k,_=F-l.startSN,B=l.fragments;for(B[_]=a,k=_;k>0;k--)o(B[k],B[k-1]);for(k=_;k<B.length-1;k++)o(B[k],B[k+1]);return l.fragmentHint&&o(B[B.length-1],l.fragmentHint),l.PTSKnown=l.alignedSliding=!0,w}function v(l,a){for(var i=null,D=l.fragments,E=D.length-1;E>=0;E--){var S=D[E].initSegment;if(S){i=S;break}}l.fragmentHint&&delete l.fragmentHint.endPTS;var L=0,x;if(f(l,a,function(k,_){k.relurl&&(L=k.cc-_.cc),Object(t.isFiniteNumber)(k.startPTS)&&Object(t.isFiniteNumber)(k.endPTS)&&(_.start=_.startPTS=k.startPTS,_.startDTS=k.startDTS,_.appendedPTS=k.appendedPTS,_.maxStartPTS=k.maxStartPTS,_.endPTS=k.endPTS,_.endDTS=k.endDTS,_.minEndPTS=k.minEndPTS,_.duration=k.endPTS-k.startPTS,_.duration&&(x=_),a.PTSKnown=a.alignedSliding=!0),_.elementaryStreams=k.elementaryStreams,_.loader=k.loader,_.stats=k.stats,_.urlId=k.urlId,k.initSegment&&(_.initSegment=k.initSegment,i=k.initSegment)}),i){var g=a.fragmentHint?a.fragments.concat(a.fragmentHint):a.fragments;g.forEach(function(k){var _;(!k.initSegment||k.initSegment.relurl===((_=i)===null||_===void 0?void 0:_.relurl))&&(k.initSegment=i)})}if(a.skippedSegments)if(a.deltaUpdateFailed=a.fragments.some(function(k){return!k}),a.deltaUpdateFailed){e.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var O=a.skippedSegments;O--;)a.fragments.shift();a.startSN=a.fragments[0].sn,a.startCC=a.fragments[0].cc}else a.canSkipDateRanges&&(a.dateRanges=m(l.dateRanges,a.dateRanges,a.recentlyRemovedDateranges));var P=a.fragments;if(L){e.logger.warn("discontinuity sliding from playlist, take drift into account");for(var C=0;C<P.length;C++)P[C].cc+=L}a.skippedSegments&&(a.startCC=a.fragments[0].cc),T(l.partList,a.partList,function(k,_){_.elementaryStreams=k.elementaryStreams,_.stats=k.stats}),x?h(a,x,x.startPTS,x.endPTS,x.startDTS,x.endDTS):n(l,a),P.length&&(a.totalduration=a.edge-P[0].start),a.driftStartTime=l.driftStartTime,a.driftStart=l.driftStart;var w=a.advancedDateTime;if(a.advanced&&w){var F=a.edge;a.driftStart||(a.driftStartTime=w,a.driftStart=F),a.driftEndTime=w,a.driftEnd=F}else a.driftEndTime=l.driftEndTime,a.driftEnd=l.driftEnd,a.advancedDateTime=l.advancedDateTime}function m(l,a,i){var D=I({},l);return i&&i.forEach(function(E){delete D[E]}),Object.keys(a).forEach(function(E){var S=new p.DateRange(a[E].attr,D[E]);S.isValid?D[E]=S:e.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(a[E].attr)+'"')}),D}function T(l,a,i){if(l&&a)for(var D=0,E=0,S=l.length;E<=S;E++){var L=l[E],x=a[E+D];L&&x&&L.index===x.index&&L.fragment.sn===x.fragment.sn?i(L,x):D--}}function f(l,a,i){for(var D=a.skippedSegments,E=Math.max(l.startSN,a.startSN)-a.startSN,S=(l.fragmentHint?1:0)+(D?a.endSN:Math.min(l.endSN,a.endSN))-a.startSN,L=a.startSN-l.startSN,x=a.fragmentHint?a.fragments.concat(a.fragmentHint):a.fragments,g=l.fragmentHint?l.fragments.concat(l.fragmentHint):l.fragments,O=E;O<=S;O++){var P=g[L+O],C=x[O];D&&!C&&O<D&&(C=a.fragments[O]=P),P&&C&&i(P,C)}}function n(l,a){var i=a.startSN+a.skippedSegments-l.startSN,D=l.fragments;i<0||i>=D.length||r(a,D[i].start)}function r(l,a){if(a){for(var i=l.fragments,D=l.skippedSegments;D<i.length;D++)i[D].start+=a;l.fragmentHint&&(l.fragmentHint.start+=a)}}function d(l,a){var i=1e3*l.levelTargetDuration,D=i/2,E=l.age,S=E>0&&E<i*3,L=a.loading.end-a.loading.start,x,g=l.availabilityDelay;if(l.updated===!1)if(S){var O=333*l.misses;x=Math.max(Math.min(D,L*2),O),l.availabilityDelay=(l.availabilityDelay||0)+x}else x=D;else S?(g=Math.min(g||i/2,E),l.availabilityDelay=g,x=g+i-E):x=i-L;return Math.round(x)}function u(l,a,i){if(!l||!l.details)return null;var D=l.details,E=D.fragments[a-D.startSN];return E||(E=D.fragmentHint,E&&E.sn===a)?E:a<D.startSN&&i&&i.sn===a?i:null}function y(l,a,i){if(!l||!l.details)return null;var D=l.details.partList;if(D)for(var E=D.length;E--;){var S=D[E];if(S.index===i&&S.fragment.sn===a)return S}return null}},"./src/controller/stream-controller.ts":function(R,M,s){s.r(M),s.d(M,"default",function(){return y});var t=s("./src/polyfills/number.ts"),e=s("./src/controller/base-stream-controller.ts"),p=s("./src/is-supported.ts"),I=s("./src/events.ts"),b=s("./src/utils/buffer-helper.ts"),A=s("./src/controller/fragment-tracker.ts"),c=s("./src/types/loader.ts"),o=s("./src/loader/fragment.ts"),h=s("./src/demux/transmuxer-interface.ts"),v=s("./src/types/transmuxer.ts"),m=s("./src/controller/gap-controller.ts"),T=s("./src/errors.ts");function f(l,a){for(var i=0;i<a.length;i++){var D=a[i];D.enumerable=D.enumerable||!1,D.configurable=!0,"value"in D&&(D.writable=!0),Object.defineProperty(l,D.key,D)}}function n(l,a,i){return a&&f(l.prototype,a),i&&f(l,i),Object.defineProperty(l,"prototype",{writable:!1}),l}function r(l,a){l.prototype=Object.create(a.prototype),l.prototype.constructor=l,d(l,a)}function d(l,a){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(D,E){return D.__proto__=E,D},d(l,a)}var u=100,y=function(l){r(a,l);function a(D,E){var S;return S=l.call(this,D,E,"[stream-controller]")||this,S.audioCodecSwap=!1,S.gapController=null,S.level=-1,S._forceStartLoad=!1,S.altAudio=!1,S.audioOnly=!1,S.fragPlaying=null,S.onvplaying=null,S.onvseeked=null,S.fragLastKbps=0,S.couldBacktrack=!1,S.backtrackFragment=null,S.audioCodecSwitch=!1,S.videoBuffer=null,S._registerListeners(),S}var i=a.prototype;return i._registerListeners=function(){var E=this.hls;E.on(I.Events.MEDIA_ATTACHED,this.onMediaAttached,this),E.on(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this),E.on(I.Events.MANIFEST_LOADING,this.onManifestLoading,this),E.on(I.Events.MANIFEST_PARSED,this.onManifestParsed,this),E.on(I.Events.LEVEL_LOADING,this.onLevelLoading,this),E.on(I.Events.LEVEL_LOADED,this.onLevelLoaded,this),E.on(I.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),E.on(I.Events.ERROR,this.onError,this),E.on(I.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),E.on(I.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),E.on(I.Events.BUFFER_CREATED,this.onBufferCreated,this),E.on(I.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),E.on(I.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),E.on(I.Events.FRAG_BUFFERED,this.onFragBuffered,this)},i._unregisterListeners=function(){var E=this.hls;E.off(I.Events.MEDIA_ATTACHED,this.onMediaAttached,this),E.off(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this),E.off(I.Events.MANIFEST_LOADING,this.onManifestLoading,this),E.off(I.Events.MANIFEST_PARSED,this.onManifestParsed,this),E.off(I.Events.LEVEL_LOADED,this.onLevelLoaded,this),E.off(I.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),E.off(I.Events.ERROR,this.onError,this),E.off(I.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),E.off(I.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),E.off(I.Events.BUFFER_CREATED,this.onBufferCreated,this),E.off(I.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),E.off(I.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),E.off(I.Events.FRAG_BUFFERED,this.onFragBuffered,this)},i.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},i.startLoad=function(E){if(this.levels){var S=this.lastCurrentTime,L=this.hls;if(this.stopLoad(),this.setInterval(u),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var x=L.startLevel;x===-1&&(L.config.testBandwidth?(x=0,this.bitrateTest=!0):x=L.nextAutoLevel),this.level=L.nextLoadLevel=x,this.loadedmetadata=!1}S>0&&E===-1&&(this.log("Override startPosition with lastCurrentTime @"+S.toFixed(3)),E=S),this.state=e.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=E,this.tick()}else this._forceStartLoad=!0,this.state=e.State.STOPPED},i.stopLoad=function(){this._forceStartLoad=!1,l.prototype.stopLoad.call(this)},i.doTick=function(){switch(this.state){case e.State.IDLE:this.doTickIdle();break;case e.State.WAITING_LEVEL:{var E,S=this.levels,L=this.level,x=S==null||(E=S[L])===null||E===void 0?void 0:E.details;if(x&&(!x.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(x))break;this.state=e.State.IDLE;break}break}case e.State.FRAG_LOADING_WAITING_RETRY:{var g,O=self.performance.now(),P=this.retryDate;(!P||O>=P||(g=this.media)!==null&&g!==void 0&&g.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=e.State.IDLE)}break}this.onTickEnd()},i.onTickEnd=function(){l.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},i.doTickIdle=function(){var E,S,L=this.hls,x=this.levelLastLoaded,g=this.levels,O=this.media,P=L.config,C=L.nextLoadLevel;if(!(x===null||!O&&(this.startFragRequested||!P.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)&&!(!g||!g[C])){var w=g[C];this.level=L.nextLoadLevel=C;var F=w.details;if(!F||this.state===e.State.WAITING_LEVEL||F.live&&this.levelLastLoaded!==C){this.state=e.State.WAITING_LEVEL;return}var k=this.getMainFwdBufferInfo();if(k!==null){var _=k.len,B=this.getMaxBufferLength(w.maxBitrate);if(!(_>=B)){if(this._streamEnded(k,F)){var N={};this.altAudio&&(N.type="video"),this.hls.trigger(I.Events.BUFFER_EOS,N),this.state=e.State.ENDED;return}this.backtrackFragment&&this.backtrackFragment.start>k.end&&(this.backtrackFragment=null);var U=this.backtrackFragment?this.backtrackFragment.start:k.end,j=this.getNextFragment(U,F);if(this.couldBacktrack&&!this.fragPrevious&&j&&j.sn!=="initSegment"&&this.fragmentTracker.getState(j)!==A.FragmentState.OK){var W,H=((W=this.backtrackFragment)!=null?W:j).sn,G=H-F.startSN,K=F.fragments[G-1];K&&j.cc===K.cc&&(j=K,this.fragmentTracker.removeFragment(K))}else this.backtrackFragment&&k.len&&(this.backtrackFragment=null);if(j&&this.fragmentTracker.getState(j)===A.FragmentState.OK&&this.nextLoadPosition>U){var X=this.audioOnly&&!this.altAudio?o.ElementaryStreamTypes.AUDIO:o.ElementaryStreamTypes.VIDEO;this.afterBufferFlushed(O,X,c.PlaylistLevelType.MAIN),j=this.getNextFragment(this.nextLoadPosition,F)}!j||(j.initSegment&&!j.initSegment.data&&!this.bitrateTest&&(j=j.initSegment),((E=j.decryptdata)===null||E===void 0?void 0:E.keyFormat)==="identity"&&!((S=j.decryptdata)!==null&&S!==void 0&&S.key)?this.loadKey(j,F):this.loadFragment(j,F,U))}}}},i.loadFragment=function(E,S,L){var x,g=this.fragmentTracker.getState(E);this.fragCurrent=E,g===A.FragmentState.NOT_LOADED||g===A.FragmentState.PARTIAL?E.sn==="initSegment"?this._loadInitSegment(E):this.bitrateTest?(E.bitrateTest=!0,this.log("Fragment "+E.sn+" of level "+E.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(E)):(this.startFragRequested=!0,l.prototype.loadFragment.call(this,E,S,L)):g===A.FragmentState.APPENDING?this.reduceMaxBufferLength(E.duration)&&this.fragmentTracker.removeFragment(E):((x=this.media)===null||x===void 0?void 0:x.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},i.getAppendedFrag=function(E){var S=this.fragmentTracker.getAppendedFrag(E,c.PlaylistLevelType.MAIN);return S&&"fragment"in S?S.fragment:S},i.getBufferedFrag=function(E){return this.fragmentTracker.getBufferedFrag(E,c.PlaylistLevelType.MAIN)},i.followingBufferedFrag=function(E){return E?this.getBufferedFrag(E.end+.5):null},i.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},i.nextLevelSwitch=function(){var E=this.levels,S=this.media;if(S!=null&&S.readyState){var L,x=this.getAppendedFrag(S.currentTime);if(x&&x.start>1&&this.flushMainBuffer(0,x.start-1),!S.paused&&E){var g=this.hls.nextLoadLevel,O=E[g],P=this.fragLastKbps;P&&this.fragCurrent?L=this.fragCurrent.duration*O.maxBitrate/(1e3*P)+1:L=0}else L=0;var C=this.getBufferedFrag(S.currentTime+L);if(C){var w=this.followingBufferedFrag(C);if(w){this.abortCurrentFrag();var F=w.maxStartPTS?w.maxStartPTS:w.start,k=w.duration,_=Math.max(C.end,F+Math.min(Math.max(k-this.config.maxFragLookUpTolerance,k*.5),k*.75));this.flushMainBuffer(_,Number.POSITIVE_INFINITY)}}}},i.abortCurrentFrag=function(){var E=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,E!=null&&E.loader&&E.loader.abort(),this.state){case e.State.KEY_LOADING:case e.State.FRAG_LOADING:case e.State.FRAG_LOADING_WAITING_RETRY:case e.State.PARSING:case e.State.PARSED:this.state=e.State.IDLE;break}this.nextLoadPosition=this.getLoadPosition()},i.flushMainBuffer=function(E,S){l.prototype.flushMainBuffer.call(this,E,S,this.altAudio?"video":null)},i.onMediaAttached=function(E,S){l.prototype.onMediaAttached.call(this,E,S);var L=S.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),L.addEventListener("playing",this.onvplaying),L.addEventListener("seeked",this.onvseeked),this.gapController=new m.default(this.config,L,this.fragmentTracker,this.hls)},i.onMediaDetaching=function(){var E=this.media;E&&(E.removeEventListener("playing",this.onvplaying),E.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),l.prototype.onMediaDetaching.call(this)},i.onMediaPlaying=function(){this.tick()},i.onMediaSeeked=function(){var E=this.media,S=E?E.currentTime:null;Object(t.isFiniteNumber)(S)&&this.log("Media seeked to "+S.toFixed(3)),this.tick()},i.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(I.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},i.onManifestParsed=function(E,S){var L=!1,x=!1,g;S.levels.forEach(function(O){g=O.audioCodec,g&&(g.indexOf("mp4a.40.2")!==-1&&(L=!0),g.indexOf("mp4a.40.5")!==-1&&(x=!0))}),this.audioCodecSwitch=L&&x&&!Object(p.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=S.levels,this.startFragRequested=!1},i.onLevelLoading=function(E,S){var L=this.levels;if(!(!L||this.state!==e.State.IDLE)){var x=L[S.level];(!x.details||x.details.live&&this.levelLastLoaded!==S.level||this.waitForCdnTuneIn(x.details))&&(this.state=e.State.WAITING_LEVEL)}},i.onLevelLoaded=function(E,S){var L,x=this.levels,g=S.level,O=S.details,P=O.totalduration;if(!x){this.warn("Levels were reset while loading level "+g);return}this.log("Level "+g+" loaded ["+O.startSN+","+O.endSN+"], cc ["+O.startCC+", "+O.endCC+"] duration:"+P);var C=this.fragCurrent;C&&(this.state===e.State.FRAG_LOADING||this.state===e.State.FRAG_LOADING_WAITING_RETRY)&&C.level!==S.level&&C.loader&&(this.state=e.State.IDLE,this.backtrackFragment=null,C.loader.abort());var w=x[g],F=0;if(O.live||(L=w.details)!==null&&L!==void 0&&L.live){if(O.fragments[0]||(O.deltaUpdateFailed=!0),O.deltaUpdateFailed)return;F=this.alignPlaylists(O,w.details)}if(w.details=O,this.levelLastLoaded=g,this.hls.trigger(I.Events.LEVEL_UPDATED,{details:O,level:g}),this.state===e.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(O))return;this.state=e.State.IDLE}this.startFragRequested?O.live&&this.synchronizeToLiveEdge(O):this.setStartPosition(O,F),this.tick()},i._handleFragmentLoadProgress=function(E){var S,L=E.frag,x=E.part,g=E.payload,O=this.levels;if(!O){this.warn("Levels were reset while fragment load was in progress. Fragment "+L.sn+" of level "+L.level+" will not be buffered");return}var P=O[L.level],C=P.details;if(!C){this.warn("Dropping fragment "+L.sn+" of level "+L.level+" after level details were reset");return}var w=P.videoCodec,F=C.PTSKnown||!C.live,k=(S=L.initSegment)===null||S===void 0?void 0:S.data,_=this._getAudioCodec(P),B=this.transmuxer=this.transmuxer||new h.default(this.hls,c.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),N=x?x.index:-1,U=N!==-1,j=new v.ChunkMetadata(L.level,L.sn,L.stats.chunkCount,g.byteLength,N,U),W=this.initPTS[L.cc];B.push(g,k,_,w,L,x,C.totalduration,F,j,W)},i.onAudioTrackSwitching=function(E,S){var L=this.altAudio,x=!!S.url,g=S.id;if(!x){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var O=this.fragCurrent;O!=null&&O.loader&&(this.log("Switching to main audio track, cancel main fragment load"),O.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var P=this.hls;L&&P.trigger(I.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),P.trigger(I.Events.AUDIO_TRACK_SWITCHED,{id:g})}},i.onAudioTrackSwitched=function(E,S){var L=S.id,x=!!this.hls.audioTracks[L].url;if(x){var g=this.videoBuffer;g&&this.mediaBuffer!==g&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=g)}this.altAudio=x,this.tick()},i.onBufferCreated=function(E,S){var L=S.tracks,x,g,O=!1;for(var P in L){var C=L[P];if(C.id==="main"){if(g=P,x=C,P==="video"){var w=L[P];w&&(this.videoBuffer=w.buffer)}}else O=!0}O&&x?(this.log("Alternate track found, use "+g+".buffered to schedule main fragment loading"),this.mediaBuffer=x.buffer):this.mediaBuffer=this.media},i.onFragBuffered=function(E,S){var L=S.frag,x=S.part;if(!(L&&L.type!==c.PlaylistLevelType.MAIN)){if(this.fragContextChanged(L)){this.warn("Fragment "+L.sn+(x?" p: "+x.index:"")+" of level "+L.level+" finished buffering, but was aborted. state: "+this.state),this.state===e.State.PARSED&&(this.state=e.State.IDLE);return}var g=x?x.stats:L.stats;this.fragLastKbps=Math.round(8*g.total/(g.buffering.end-g.loading.first)),L.sn!=="initSegment"&&(this.fragPrevious=L),this.fragBufferedComplete(L,x)}},i.onError=function(E,S){switch(S.details){case T.ErrorDetails.FRAG_LOAD_ERROR:case T.ErrorDetails.FRAG_LOAD_TIMEOUT:case T.ErrorDetails.KEY_LOAD_ERROR:case T.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(c.PlaylistLevelType.MAIN,S);break;case T.ErrorDetails.LEVEL_LOAD_ERROR:case T.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==e.State.ERROR&&(S.fatal?(this.warn(""+S.details),this.state=e.State.ERROR):!S.levelRetry&&this.state===e.State.WAITING_LEVEL&&(this.state=e.State.IDLE));break;case T.ErrorDetails.BUFFER_FULL_ERROR:if(S.parent==="main"&&(this.state===e.State.PARSING||this.state===e.State.PARSED)){var L=!0,x=this.getFwdBufferInfo(this.media,c.PlaylistLevelType.MAIN);x&&x.len>.5&&(L=!this.reduceMaxBufferLength(x.len)),L&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break}},i.checkBuffer=function(){var E=this.media,S=this.gapController;if(!(!E||!S||!E.readyState)){var L=b.BufferHelper.getBuffered(E);if(!this.loadedmetadata&&L.length)this.loadedmetadata=!0,this.seekToStartPos();else{var x=this.state!==e.State.IDLE?this.fragCurrent:null;S.poll(this.lastCurrentTime,x)}this.lastCurrentTime=E.currentTime}},i.onFragLoadEmergencyAborted=function(){this.state=e.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},i.onBufferFlushed=function(E,S){var L=S.type;if(L!==o.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var x=(L===o.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(x,L,c.PlaylistLevelType.MAIN)}},i.onLevelsUpdated=function(E,S){this.levels=S.levels},i.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},i.seekToStartPos=function(){var E=this.media,S=E.currentTime,L=this.startPosition;if(L>=0&&S<L){if(E.seeking){this.log("could not seek to "+L+", already seeking at "+S);return}var x=b.BufferHelper.getBuffered(E),g=x.length?x.start(0):0,O=g-L;O>0&&(O<this.config.maxBufferHole||O<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+O+" to match buffer start"),L+=O,this.startPosition=L),this.log("seek to target start position "+L+" from current time "+S),E.currentTime=L}},i._getAudioCodec=function(E){var S=this.config.defaultAudioCodec||E.audioCodec;return this.audioCodecSwap&&S&&(this.log("Swapping audio codec"),S.indexOf("mp4a.40.5")!==-1?S="mp4a.40.2":S="mp4a.40.5"),S},i._loadBitrateTestFrag=function(E){var S=this;this._doFragLoad(E).then(function(L){var x=S.hls;if(!(!L||x.nextLoadLevel||S.fragContextChanged(E))){S.fragLoadError=0,S.state=e.State.IDLE,S.startFragRequested=!1,S.bitrateTest=!1;var g=E.stats;g.parsing.start=g.parsing.end=g.buffering.start=g.buffering.end=self.performance.now(),x.trigger(I.Events.FRAG_LOADED,L)}})},i._handleTransmuxComplete=function(E){var S,L="main",x=this.hls,g=E.remuxResult,O=E.chunkMeta,P=this.getCurrentContext(O);if(!P){this.warn("The loading context changed while buffering fragment "+O.sn+" of level "+O.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(O.level);return}var C=P.frag,w=P.part,F=P.level,k=g.video,_=g.text,B=g.id3,N=g.initSegment,U=F.details,j=this.altAudio?void 0:g.audio;if(!this.fragContextChanged(C)){if(this.state=e.State.PARSING,N){N.tracks&&(this._bufferInitSegment(F,N.tracks,C,O),x.trigger(I.Events.FRAG_PARSING_INIT_SEGMENT,{frag:C,id:L,tracks:N.tracks}));var W=N.initPTS,H=N.timescale;Object(t.isFiniteNumber)(W)&&(this.initPTS[C.cc]=W,x.trigger(I.Events.INIT_PTS_FOUND,{frag:C,id:L,initPTS:W,timescale:H}))}if(k&&g.independent!==!1){if(U){var G=k.startPTS,K=k.endPTS,X=k.startDTS,Z=k.endDTS;if(w)w.elementaryStreams[k.type]={startPTS:G,endPTS:K,startDTS:X,endDTS:Z};else if(k.firstKeyFrame&&k.independent&&(this.couldBacktrack=!0),k.dropped&&k.independent){var z=this.getMainFwdBufferInfo(),V=(z?z.end:this.getLoadPosition())+this.config.maxBufferHole,Y=k.firstKeyFramePTS?k.firstKeyFramePTS:G;if(V<Y-this.config.maxBufferHole){this.backtrack(C);return}C.setElementaryStreamInfo(k.type,C.start,K,C.start,Z,!0)}C.setElementaryStreamInfo(k.type,G,K,X,Z),this.backtrackFragment&&(this.backtrackFragment=C),this.bufferFragmentData(k,C,w,O)}}else if(g.independent===!1){this.backtrack(C);return}if(j){var Q=j.startPTS,$=j.endPTS,J=j.startDTS,tt=j.endDTS;w&&(w.elementaryStreams[o.ElementaryStreamTypes.AUDIO]={startPTS:Q,endPTS:$,startDTS:J,endDTS:tt}),C.setElementaryStreamInfo(o.ElementaryStreamTypes.AUDIO,Q,$,J,tt),this.bufferFragmentData(j,C,w,O)}if(U&&B!==null&&B!==void 0&&(S=B.samples)!==null&&S!==void 0&&S.length){var rt={id:L,frag:C,details:U,samples:B.samples};x.trigger(I.Events.FRAG_PARSING_METADATA,rt)}if(U&&_){var nt={id:L,frag:C,details:U,samples:_.samples};x.trigger(I.Events.FRAG_PARSING_USERDATA,nt)}}},i._bufferInitSegment=function(E,S,L,x){var g=this;if(this.state===e.State.PARSING){this.audioOnly=!!S.audio&&!S.video,this.altAudio&&!this.audioOnly&&delete S.audio;var O=S.audio,P=S.video,C=S.audiovideo;if(O){var w=E.audioCodec,F=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(w&&(w.indexOf("mp4a.40.5")!==-1?w="mp4a.40.2":w="mp4a.40.5"),O.metadata.channelCount!==1&&F.indexOf("firefox")===-1&&(w="mp4a.40.5")),F.indexOf("android")!==-1&&O.container!=="audio/mpeg"&&(w="mp4a.40.2",this.log("Android: force audio codec to "+w)),E.audioCodec&&E.audioCodec!==w&&this.log('Swapping manifest audio codec "'+E.audioCodec+'" for "'+w+'"'),O.levelCodec=w,O.id="main",this.log("Init audio buffer, container:"+O.container+", codecs[selected/level/parsed]=["+(w||"")+"/"+(E.audioCodec||"")+"/"+O.codec+"]")}P&&(P.levelCodec=E.videoCodec,P.id="main",this.log("Init video buffer, container:"+P.container+", codecs[level/parsed]=["+(E.videoCodec||"")+"/"+P.codec+"]")),C&&this.log("Init audiovideo buffer, container:"+C.container+", codecs[level/parsed]=["+(E.attrs.CODECS||"")+"/"+C.codec+"]"),this.hls.trigger(I.Events.BUFFER_CODECS,S),Object.keys(S).forEach(function(k){var _=S[k],B=_.initSegment;B!=null&&B.byteLength&&g.hls.trigger(I.Events.BUFFER_APPENDING,{type:k,data:B,frag:L,part:null,chunkMeta:x,parent:L.type})}),this.tick()}},i.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,c.PlaylistLevelType.MAIN)},i.backtrack=function(E){this.couldBacktrack=!0,this.backtrackFragment=E,this.resetTransmuxer(),this.flushBufferGap(E),this.fragmentTracker.removeFragment(E),this.fragPrevious=null,this.nextLoadPosition=E.start,this.state=e.State.IDLE},i.checkFragmentChanged=function(){var E=this.media,S=null;if(E&&E.readyState>1&&E.seeking===!1){var L=E.currentTime;if(b.BufferHelper.isBuffered(E,L)?S=this.getAppendedFrag(L):b.BufferHelper.isBuffered(E,L+.1)&&(S=this.getAppendedFrag(L+.1)),S){this.backtrackFragment=null;var x=this.fragPlaying,g=S.level;(!x||S.sn!==x.sn||x.level!==g||S.urlId!==x.urlId)&&(this.hls.trigger(I.Events.FRAG_CHANGED,{frag:S}),(!x||x.level!==g)&&this.hls.trigger(I.Events.LEVEL_SWITCHED,{level:g}),this.fragPlaying=S)}}},n(a,[{key:"nextLevel",get:function(){var E=this.nextBufferedFrag;return E?E.level:-1}},{key:"currentFrag",get:function(){var E=this.media;return E?this.fragPlaying||this.getAppendedFrag(E.currentTime):null}},{key:"currentProgramDateTime",get:function(){var E=this.media;if(E){var S=E.currentTime,L=this.currentFrag;if(L&&Object(t.isFiniteNumber)(S)&&Object(t.isFiniteNumber)(L.programDateTime)){var x=L.programDateTime+(S-L.start)*1e3;return new Date(x)}}return null}},{key:"currentLevel",get:function(){var E=this.currentFrag;return E?E.level:-1}},{key:"nextBufferedFrag",get:function(){var E=this.currentFrag;return E?this.followingBufferedFrag(E):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),a}(e.default)},"./src/controller/subtitle-stream-controller.ts":function(R,M,s){s.r(M),s.d(M,"SubtitleStreamController",function(){return r});var t=s("./src/events.ts"),e=s("./src/utils/buffer-helper.ts"),p=s("./src/controller/fragment-finders.ts"),I=s("./src/utils/discontinuities.ts"),b=s("./src/controller/level-helper.ts"),A=s("./src/controller/fragment-tracker.ts"),c=s("./src/controller/base-stream-controller.ts"),o=s("./src/types/loader.ts"),h=s("./src/types/level.ts");function v(d,u){for(var y=0;y<u.length;y++){var l=u[y];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(d,l.key,l)}}function m(d,u,y){return u&&v(d.prototype,u),y&&v(d,y),Object.defineProperty(d,"prototype",{writable:!1}),d}function T(d,u){d.prototype=Object.create(u.prototype),d.prototype.constructor=d,f(d,u)}function f(d,u){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,a){return l.__proto__=a,l},f(d,u)}var n=500,r=function(d){T(u,d);function u(l,a){var i;return i=d.call(this,l,a,"[subtitle-stream-controller]")||this,i.levels=[],i.currentTrackId=-1,i.tracksBuffered=[],i.mainDetails=null,i._registerListeners(),i}var y=u.prototype;return y.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},y._registerListeners=function(){var a=this.hls;a.on(t.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.on(t.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(t.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(t.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.on(t.Events.ERROR,this.onError,this),a.on(t.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),a.on(t.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),a.on(t.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),a.on(t.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),a.on(t.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},y._unregisterListeners=function(){var a=this.hls;a.off(t.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.off(t.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(t.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(t.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.off(t.Events.ERROR,this.onError,this),a.off(t.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),a.off(t.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),a.off(t.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),a.off(t.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),a.off(t.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},y.startLoad=function(){this.stopLoad(),this.state=c.State.IDLE,this.setInterval(n),this.tick()},y.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},y.onLevelLoaded=function(a,i){this.mainDetails=i.details},y.onSubtitleFragProcessed=function(a,i){var D=i.frag,E=i.success;if(this.fragPrevious=D,this.state=c.State.IDLE,!!E){var S=this.tracksBuffered[this.currentTrackId];if(!!S){for(var L,x=D.start,g=0;g<S.length;g++)if(x>=S[g].start&&x<=S[g].end){L=S[g];break}var O=D.start+D.duration;L?L.end=O:(L={start:x,end:O},S.push(L)),this.fragmentTracker.fragBuffered(D)}}},y.onBufferFlushing=function(a,i){var D=i.startOffset,E=i.endOffset;if(D===0&&E!==Number.POSITIVE_INFINITY){var S=this.currentTrackId,L=this.levels;if(!L.length||!L[S]||!L[S].details)return;var x=L[S].details,g=x.targetduration,O=E-g;if(O<=0)return;i.endOffsetSubtitles=Math.max(0,O),this.tracksBuffered.forEach(function(P){for(var C=0;C<P.length;){if(P[C].end<=O){P.shift();continue}else if(P[C].start<O)P[C].start=O;else break;C++}}),this.fragmentTracker.removeFragmentsInRange(D,O,o.PlaylistLevelType.SUBTITLE)}},y.onError=function(a,i){var D,E=i.frag;!E||E.type!==o.PlaylistLevelType.SUBTITLE||((D=this.fragCurrent)!==null&&D!==void 0&&D.loader&&this.fragCurrent.loader.abort(),this.state=c.State.IDLE)},y.onSubtitleTracksUpdated=function(a,i){var D=this,E=i.subtitleTracks;this.tracksBuffered=[],this.levels=E.map(function(S){return new h.Level(S)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(S){D.tracksBuffered[S.id]=[]}),this.mediaBuffer=null},y.onSubtitleTrackSwitch=function(a,i){if(this.currentTrackId=i.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var D=this.levels[this.currentTrackId];D!=null&&D.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,D&&this.setInterval(n)},y.onSubtitleTrackLoaded=function(a,i){var D,E=i.details,S=i.id,L=this.currentTrackId,x=this.levels;if(!!x.length){var g=x[L];if(!(S>=x.length||S!==L||!g)){if(this.mediaBuffer=this.mediaBufferTimeRanges,E.live||(D=g.details)!==null&&D!==void 0&&D.live){var O=this.mainDetails;if(E.deltaUpdateFailed||!O)return;var P=O.fragments[0];if(!g.details)E.hasProgramDateTime&&O.hasProgramDateTime?Object(I.alignMediaPlaylistByPDT)(E,O):P&&Object(b.addSliding)(E,P.start);else{var C=this.alignPlaylists(E,g.details);C===0&&P&&Object(b.addSliding)(E,P.start)}}if(g.details=E,this.levelLastLoaded=S,this.tick(),E.live&&!this.fragCurrent&&this.media&&this.state===c.State.IDLE){var w=Object(p.findFragmentByPTS)(null,E.fragments,this.media.currentTime,0);w||(this.warn("Subtitle playlist not aligned with playback"),g.details=void 0)}}}},y._handleFragmentLoadComplete=function(a){var i=a.frag,D=a.payload,E=i.decryptdata,S=this.hls;if(!this.fragContextChanged(i)&&D&&D.byteLength>0&&E&&E.key&&E.iv&&E.method==="AES-128"){var L=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(D),E.key.buffer,E.iv.buffer).then(function(x){var g=performance.now();S.trigger(t.Events.FRAG_DECRYPTED,{frag:i,payload:x,stats:{tstart:L,tdecrypt:g}})})}},y.doTick=function(){if(!this.media){this.state=c.State.IDLE;return}if(this.state===c.State.IDLE){var a=this.currentTrackId,i=this.levels;if(!i.length||!i[a]||!i[a].details)return;var D=i[a].details,E=D.targetduration,S=this.config,L=this.media,x=e.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,L.currentTime-E,S.maxBufferHole),g=x.end,O=x.len,P=this.getMaxBufferLength()+E;if(O>P)return;console.assert(D,"Subtitle track details are defined on idle subtitle stream controller tick");var C=D.fragments,w=C.length,F=D.edge,k,_=this.fragPrevious;if(g<F){var B=S.maxFragLookUpTolerance;k=Object(p.findFragmentByPTS)(_,C,Math.max(C[0].start,g),B),!k&&_&&_.start<C[0].start&&(k=C[0])}else k=C[w-1];if(k=this.mapToInitFragWhenRequired(k),!k)return;k.encrypted?this.loadKey(k,D):this.fragmentTracker.getState(k)===A.FragmentState.NOT_LOADED&&this.loadFragment(k,D,g)}},y.loadFragment=function(a,i,D){this.fragCurrent=a,a.sn==="initSegment"?this._loadInitSegment(a):d.prototype.loadFragment.call(this,a,i,D)},m(u,[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}]),u}(c.default)},"./src/controller/subtitle-track-controller.ts":function(R,M,s){s.r(M);var t=s("./src/events.ts"),e=s("./src/utils/texttrack-utils.ts"),p=s("./src/controller/base-playlist-controller.ts"),I=s("./src/types/loader.ts");function b(m,T){for(var f=0;f<T.length;f++){var n=T[f];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(m,n.key,n)}}function A(m,T,f){return T&&b(m.prototype,T),f&&b(m,f),Object.defineProperty(m,"prototype",{writable:!1}),m}function c(m,T){m.prototype=Object.create(T.prototype),m.prototype.constructor=m,o(m,T)}function o(m,T){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},o(m,T)}var h=function(m){c(T,m);function T(n){var r;return r=m.call(this,n,"[subtitle-track-controller]")||this,r.media=null,r.tracks=[],r.groupId=null,r.tracksInGroup=[],r.trackId=-1,r.selectDefaultTrack=!0,r.queuedDefaultTrack=-1,r.trackChangeListener=function(){return r.onTextTracksChanged()},r.asyncPollTrackChange=function(){return r.pollTrackChange(0)},r.useTextTrackPolling=!1,r.subtitlePollingInterval=-1,r._subtitleDisplay=!0,r.registerListeners(),r}var f=T.prototype;return f.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,m.prototype.destroy.call(this)},f.registerListeners=function(){var r=this.hls;r.on(t.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(t.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(t.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(t.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(t.Events.LEVEL_LOADING,this.onLevelLoading,this),r.on(t.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),r.on(t.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.on(t.Events.ERROR,this.onError,this)},f.unregisterListeners=function(){var r=this.hls;r.off(t.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(t.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(t.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(t.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(t.Events.LEVEL_LOADING,this.onLevelLoading,this),r.off(t.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),r.off(t.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.off(t.Events.ERROR,this.onError,this)},f.onMediaAttached=function(r,d){this.media=d.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},f.pollTrackChange=function(r){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,r)},f.onMediaDetaching=function(){if(!!this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var r=v(this.media.textTracks);r.forEach(function(d){Object(e.clearCurrentCues)(d)}),this.subtitleTrack=-1,this.media=null}},f.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},f.onManifestParsed=function(r,d){this.tracks=d.subtitleTracks},f.onSubtitleTrackLoaded=function(r,d){var u=d.id,y=d.details,l=this.trackId,a=this.tracksInGroup[l];if(!a){this.warn("Invalid subtitle track id "+u);return}var i=a.details;a.details=d.details,this.log("subtitle track "+u+" loaded ["+y.startSN+"-"+y.endSN+"]"),u===this.trackId&&(this.retryCount=0,this.playlistLoaded(u,d,i))},f.onLevelLoading=function(r,d){this.switchLevel(d.level)},f.onLevelSwitching=function(r,d){this.switchLevel(d.level)},f.switchLevel=function(r){var d=this.hls.levels[r];if(!!(d!=null&&d.textGroupIds)){var u=d.textGroupIds[d.urlId];if(this.groupId!==u){var y=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,l=this.tracks.filter(function(D){return!u||D.groupId===u});this.tracksInGroup=l;var a=this.findTrackId(y==null?void 0:y.name)||this.findTrackId();this.groupId=u;var i={subtitleTracks:l};this.log("Updating subtitle tracks, "+l.length+' track(s) found in "'+u+'" group-id'),this.hls.trigger(t.Events.SUBTITLE_TRACKS_UPDATED,i),a!==-1&&this.setSubtitleTrack(a,y)}}},f.findTrackId=function(r){for(var d=this.tracksInGroup,u=0;u<d.length;u++){var y=d[u];if((!this.selectDefaultTrack||y.default)&&(!r||r===y.name))return y.id}return-1},f.onError=function(r,d){m.prototype.onError.call(this,r,d),!(d.fatal||!d.context)&&d.context.type===I.PlaylistContextType.SUBTITLE_TRACK&&d.context.id===this.trackId&&d.context.groupId===this.groupId&&this.retryLoadingOrFail(d)},f.loadPlaylist=function(r){var d=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(d)){var u=d.id,y=d.groupId,l=d.url;if(r)try{l=r.addDirectives(l)}catch(a){this.warn("Could not construct new URL with HLS Delivery Directives: "+a)}this.log("Loading subtitle playlist for id "+u),this.hls.trigger(t.Events.SUBTITLE_TRACK_LOADING,{url:l,id:u,groupId:y,deliveryDirectives:r||null})}},f.toggleTrackModes=function(r){var d=this,u=this.media,y=this.trackId;if(!!u){var l=v(u.textTracks),a=l.filter(function(E){return E.groupId===d.groupId});if(r===-1)[].slice.call(l).forEach(function(E){E.mode="disabled"});else{var i=a[y];i&&(i.mode="disabled")}var D=a[r];D&&(D.mode=this.subtitleDisplay?"showing":"hidden")}},f.setSubtitleTrack=function(r,d){var u,y=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=r;return}if(this.trackId!==r&&this.toggleTrackModes(r),!(this.trackId===r&&(r===-1||(u=y[r])!==null&&u!==void 0&&u.details)||r<-1||r>=y.length)){this.clearTimer();var l=y[r];if(this.log("Switching to subtitle track "+r),this.trackId=r,l){var a=l.id,i=l.groupId,D=i===void 0?"":i,E=l.name,S=l.type,L=l.url;this.hls.trigger(t.Events.SUBTITLE_TRACK_SWITCH,{id:a,groupId:D,name:E,type:S,url:L});var x=this.switchParams(l.url,d==null?void 0:d.details);this.loadPlaylist(x)}else this.hls.trigger(t.Events.SUBTITLE_TRACK_SWITCH,{id:r})}},f.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var r=-1,d=v(this.media.textTracks),u=0;u<d.length;u++)if(d[u].mode==="hidden")r=u;else if(d[u].mode==="showing"){r=u;break}this.subtitleTrack!==r&&(this.subtitleTrack=r)}},A(T,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(r){this._subtitleDisplay=r,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(r){this.selectDefaultTrack=!1;var d=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(r,d)}}]),T}(p.default);function v(m){for(var T=[],f=0;f<m.length;f++){var n=m[f];n.kind==="subtitles"&&n.label&&T.push(m[f])}return T}M.default=h},"./src/controller/timeline-controller.ts":function(R,M,s){s.r(M),s.d(M,"TimelineController",function(){return m});var t=s("./src/polyfills/number.ts"),e=s("./src/events.ts"),p=s("./src/utils/cea-608-parser.ts"),I=s("./src/utils/output-filter.ts"),b=s("./src/utils/webvtt-parser.ts"),A=s("./src/utils/texttrack-utils.ts"),c=s("./src/utils/imsc1-ttml-parser.ts"),o=s("./src/utils/mp4-tools.ts"),h=s("./src/types/loader.ts"),v=s("./src/utils/logger.ts"),m=function(){function r(u){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=n(),this.captionsProperties=void 0,this.hls=u,this.config=u.config,this.Cues=u.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var y=new I.default(this,"textTrack1"),l=new I.default(this,"textTrack2"),a=new I.default(this,"textTrack3"),i=new I.default(this,"textTrack4");this.cea608Parser1=new p.default(1,y,l),this.cea608Parser2=new p.default(3,a,i)}u.on(e.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),u.on(e.Events.MEDIA_DETACHING,this.onMediaDetaching,this),u.on(e.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.on(e.Events.MANIFEST_LOADED,this.onManifestLoaded,this),u.on(e.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),u.on(e.Events.FRAG_LOADING,this.onFragLoading,this),u.on(e.Events.FRAG_LOADED,this.onFragLoaded,this),u.on(e.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),u.on(e.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),u.on(e.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),u.on(e.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),u.on(e.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var d=r.prototype;return d.destroy=function(){var y=this.hls;y.off(e.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),y.off(e.Events.MEDIA_DETACHING,this.onMediaDetaching,this),y.off(e.Events.MANIFEST_LOADING,this.onManifestLoading,this),y.off(e.Events.MANIFEST_LOADED,this.onManifestLoaded,this),y.off(e.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),y.off(e.Events.FRAG_LOADING,this.onFragLoading,this),y.off(e.Events.FRAG_LOADED,this.onFragLoaded,this),y.off(e.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),y.off(e.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),y.off(e.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),y.off(e.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),y.off(e.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},d.addCues=function(y,l,a,i,D){for(var E=!1,S=D.length;S--;){var L=D[S],x=f(L[0],L[1],l,a);if(x>=0&&(L[0]=Math.min(L[0],l),L[1]=Math.max(L[1],a),E=!0,x/(a-l)>.5))return}if(E||D.push([l,a]),this.config.renderTextTracksNatively){var g=this.captionsTracks[y];this.Cues.newCue(g,l,a,i)}else{var O=this.Cues.newCue(null,l,a,i);this.hls.trigger(e.Events.CUES_PARSED,{type:"captions",cues:O,track:y})}},d.onInitPtsFound=function(y,l){var a=this,i=l.frag,D=l.id,E=l.initPTS,S=l.timescale,L=this.unparsedVttFrags;D==="main"&&(this.initPTS[i.cc]=E,this.timescale[i.cc]=S),L.length&&(this.unparsedVttFrags=[],L.forEach(function(x){a.onFragLoaded(e.Events.FRAG_LOADED,x)}))},d.getExistingTrack=function(y){var l=this.media;if(l)for(var a=0;a<l.textTracks.length;a++){var i=l.textTracks[a];if(i[y])return i}return null},d.createCaptionsTrack=function(y){this.config.renderTextTracksNatively?this.createNativeTrack(y):this.createNonNativeTrack(y)},d.createNativeTrack=function(y){if(!this.captionsTracks[y]){var l=this.captionsProperties,a=this.captionsTracks,i=this.media,D=l[y],E=D.label,S=D.languageCode,L=this.getExistingTrack(y);if(L)a[y]=L,Object(A.clearCurrentCues)(a[y]),Object(A.sendAddTrackEvent)(a[y],i);else{var x=this.createTextTrack("captions",E,S);x&&(x[y]=!0,a[y]=x)}}},d.createNonNativeTrack=function(y){if(!this.nonNativeCaptionsTracks[y]){var l=this.captionsProperties[y];if(!!l){var a=l.label,i={_id:y,label:a,kind:"captions",default:l.media?!!l.media.default:!1,closedCaptions:l.media};this.nonNativeCaptionsTracks[y]=i,this.hls.trigger(e.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}}},d.createTextTrack=function(y,l,a){var i=this.media;if(!!i)return i.addTextTrack(y,l,a)},d.onMediaAttaching=function(y,l){this.media=l.media,this._cleanTracks()},d.onMediaDetaching=function(){var y=this.captionsTracks;Object.keys(y).forEach(function(l){Object(A.clearCurrentCues)(y[l]),delete y[l]}),this.nonNativeCaptionsTracks={}},d.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=n(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},d._cleanTracks=function(){var y=this.media;if(!!y){var l=y.textTracks;if(l)for(var a=0;a<l.length;a++)Object(A.clearCurrentCues)(l[a])}},d.onSubtitleTracksUpdated=function(y,l){var a=this;this.textTracks=[];var i=l.subtitleTracks||[],D=i.some(function(x){return x.textCodec===c.IMSC1_CODEC});if(this.config.enableWebVTT||D&&this.config.enableIMSC1){var E=this.tracks&&i&&this.tracks.length===i.length;if(this.tracks=i||[],this.config.renderTextTracksNatively){var S=this.media?this.media.textTracks:[];this.tracks.forEach(function(x,g){var O;if(g<S.length){for(var P=null,C=0;C<S.length;C++)if(T(S[C],x)){P=S[C];break}P&&(O=P)}if(O)Object(A.clearCurrentCues)(O);else{var w=a._captionsOrSubtitlesFromCharacteristics(x);O=a.createTextTrack(w,x.name,x.lang),O&&(O.mode="disabled")}O&&(O.groupId=x.groupId,a.textTracks.push(O))})}else if(!E&&this.tracks&&this.tracks.length){var L=this.tracks.map(function(x){return{label:x.name,kind:x.type.toLowerCase(),default:x.default,subtitleTrack:x}});this.hls.trigger(e.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:L})}}},d._captionsOrSubtitlesFromCharacteristics=function(y){var l;if((l=y.attrs)!==null&&l!==void 0&&l.CHARACTERISTICS){var a=/transcribes-spoken-dialog/gi.test(y.attrs.CHARACTERISTICS),i=/describes-music-and-sound/gi.test(y.attrs.CHARACTERISTICS);if(a&&i)return"captions"}return"subtitles"},d.onManifestLoaded=function(y,l){var a=this;this.config.enableCEA708Captions&&l.captions&&l.captions.forEach(function(i){var D=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(!!D){var E="textTrack"+D[1],S=a.captionsProperties[E];!S||(S.label=i.name,i.lang&&(S.languageCode=i.lang),S.media=i)}})},d.onFragLoading=function(y,l){var a=this.cea608Parser1,i=this.cea608Parser2,D=this.lastSn,E=this.lastPartIndex;if(!(!this.enabled||!(a&&i))&&l.frag.type===h.PlaylistLevelType.MAIN){var S,L,x=l.frag.sn,g=(S=l==null||(L=l.part)===null||L===void 0?void 0:L.index)!=null?S:-1;x===D+1||x===D&&g===E+1||(a.reset(),i.reset()),this.lastSn=x,this.lastPartIndex=g}},d.onFragLoaded=function(y,l){var a=l.frag,i=l.payload,D=this.initPTS,E=this.unparsedVttFrags;if(a.type===h.PlaylistLevelType.SUBTITLE)if(i.byteLength){if(!Object(t.isFiniteNumber)(D[a.cc])){E.push(l),D.length&&this.hls.trigger(e.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:a,error:new Error("Missing initial subtitle PTS")});return}var S=a.decryptdata,L="stats"in l;if(S==null||S.key==null||S.method!=="AES-128"||L){var x=this.tracks[a.level],g=this.vttCCs;g[a.cc]||(g[a.cc]={start:a.start,prevCC:this.prevCC,new:!0},this.prevCC=a.cc),x&&x.textCodec===c.IMSC1_CODEC?this._parseIMSC1(a,i):this._parseVTTs(a,i,g)}}else this.hls.trigger(e.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:a,error:new Error("Empty subtitle payload")})},d._parseIMSC1=function(y,l){var a=this,i=this.hls;Object(c.parseIMSC1)(l,this.initPTS[y.cc],this.timescale[y.cc],function(D){a._appendCues(D,y.level),i.trigger(e.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:y})},function(D){v.logger.log("Failed to parse IMSC1: "+D),i.trigger(e.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:y,error:D})})},d._parseVTTs=function(y,l,a){var i,D=this,E=this.hls,S=(i=y.initSegment)!==null&&i!==void 0&&i.data?Object(o.appendUint8Array)(y.initSegment.data,new Uint8Array(l)):l;Object(b.parseWebVTT)(S,this.initPTS[y.cc],this.timescale[y.cc],a,y.cc,y.start,function(L){D._appendCues(L,y.level),E.trigger(e.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:y})},function(L){D._fallbackToIMSC1(y,l),v.logger.log("Failed to parse VTT cue: "+L),E.trigger(e.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:y,error:L})})},d._fallbackToIMSC1=function(y,l){var a=this,i=this.tracks[y.level];i.textCodec||Object(c.parseIMSC1)(l,this.initPTS[y.cc],this.timescale[y.cc],function(){i.textCodec=c.IMSC1_CODEC,a._parseIMSC1(y,l)},function(){i.textCodec="wvtt"})},d._appendCues=function(y,l){var a=this.hls;if(this.config.renderTextTracksNatively){var i=this.textTracks[l];if(!i||i.mode==="disabled")return;y.forEach(function(S){return Object(A.addCueToTrack)(i,S)})}else{var D=this.tracks[l];if(!D)return;var E=D.default?"default":"subtitles"+l;a.trigger(e.Events.CUES_PARSED,{type:"subtitles",cues:y,track:E})}},d.onFragDecrypted=function(y,l){var a=l.frag;if(a.type===h.PlaylistLevelType.SUBTITLE){if(!Object(t.isFiniteNumber)(this.initPTS[a.cc])){this.unparsedVttFrags.push(l);return}this.onFragLoaded(e.Events.FRAG_LOADED,l)}},d.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},d.onFragParsingUserdata=function(y,l){var a=this.cea608Parser1,i=this.cea608Parser2;if(!(!this.enabled||!(a&&i)))for(var D=0;D<l.samples.length;D++){var E=l.samples[D].bytes;if(E){var S=this.extractCea608Data(E);a.addData(l.samples[D].pts,S[0]),i.addData(l.samples[D].pts,S[1])}}},d.onBufferFlushing=function(y,l){var a=l.startOffset,i=l.endOffset,D=l.endOffsetSubtitles,E=l.type,S=this.media;if(!(!S||S.currentTime<i)){if(!E||E==="video"){var L=this.captionsTracks;Object.keys(L).forEach(function(g){return Object(A.removeCuesInRange)(L[g],a,i)})}if(this.config.renderTextTracksNatively&&a===0&&D!==void 0){var x=this.textTracks;Object.keys(x).forEach(function(g){return Object(A.removeCuesInRange)(x[g],a,D)})}}},d.extractCea608Data=function(y){for(var l=[[],[]],a=y[0]&31,i=2,D=0;D<a;D++){var E=y[i++],S=127&y[i++],L=127&y[i++];if(!(S===0&&L===0)){var x=(4&E)!==0;if(x){var g=3&E;(g===0||g===1)&&(l[g].push(S),l[g].push(L))}}}return l},r}();function T(r,d){return r&&r.label===d.name&&!(r.textTrack1||r.textTrack2)}function f(r,d,u,y){return Math.min(d,y)-Math.max(r,u)}function n(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}}}},"./src/crypt/aes-crypto.ts":function(R,M,s){s.r(M),s.d(M,"default",function(){return t});var t=function(){function e(I,b){this.subtle=void 0,this.aesIV=void 0,this.subtle=I,this.aesIV=b}var p=e.prototype;return p.decrypt=function(b,A){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},A,b)},e}()},"./src/crypt/aes-decryptor.ts":function(R,M,s){s.r(M),s.d(M,"removePadding",function(){return e}),s.d(M,"default",function(){return p});var t=s("./src/utils/typed-array.ts");function e(I){var b=I.byteLength,A=b&&new DataView(I.buffer).getUint8(b-1);return A?Object(t.sliceUint8)(I,0,b-A):I}var p=function(){function I(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var b=I.prototype;return b.uint8ArrayToUint32Array_=function(c){for(var o=new DataView(c),h=new Uint32Array(4),v=0;v<4;v++)h[v]=o.getUint32(v*4);return h},b.initTable=function(){var c=this.sBox,o=this.invSBox,h=this.subMix,v=h[0],m=h[1],T=h[2],f=h[3],n=this.invSubMix,r=n[0],d=n[1],u=n[2],y=n[3],l=new Uint32Array(256),a=0,i=0,D=0;for(D=0;D<256;D++)D<128?l[D]=D<<1:l[D]=D<<1^283;for(D=0;D<256;D++){var E=i^i<<1^i<<2^i<<3^i<<4;E=E>>>8^E&255^99,c[a]=E,o[E]=a;var S=l[a],L=l[S],x=l[L],g=l[E]*257^E*16843008;v[a]=g<<24|g>>>8,m[a]=g<<16|g>>>16,T[a]=g<<8|g>>>24,f[a]=g,g=x*16843009^L*65537^S*257^a*16843008,r[E]=g<<24|g>>>8,d[E]=g<<16|g>>>16,u[E]=g<<8|g>>>24,y[E]=g,a?(a=S^l[l[l[x^S]]],i^=l[l[i]]):a=i=1}},b.expandKey=function(c){for(var o=this.uint8ArrayToUint32Array_(c),h=!0,v=0;v<o.length&&h;)h=o[v]===this.key[v],v++;if(!h){this.key=o;var m=this.keySize=o.length;if(m!==4&&m!==6&&m!==8)throw new Error("Invalid aes key size="+m);var T=this.ksRows=(m+6+1)*4,f,n,r=this.keySchedule=new Uint32Array(T),d=this.invKeySchedule=new Uint32Array(T),u=this.sBox,y=this.rcon,l=this.invSubMix,a=l[0],i=l[1],D=l[2],E=l[3],S,L;for(f=0;f<T;f++){if(f<m){S=r[f]=o[f];continue}L=S,f%m===0?(L=L<<8|L>>>24,L=u[L>>>24]<<24|u[L>>>16&255]<<16|u[L>>>8&255]<<8|u[L&255],L^=y[f/m|0]<<24):m>6&&f%m===4&&(L=u[L>>>24]<<24|u[L>>>16&255]<<16|u[L>>>8&255]<<8|u[L&255]),r[f]=S=(r[f-m]^L)>>>0}for(n=0;n<T;n++)f=T-n,n&3?L=r[f]:L=r[f-4],n<4||f<=4?d[n]=L:d[n]=a[u[L>>>24]]^i[u[L>>>16&255]]^D[u[L>>>8&255]]^E[u[L&255]],d[n]=d[n]>>>0}},b.networkToHostOrderSwap=function(c){return c<<24|(c&65280)<<8|(c&16711680)>>8|c>>>24},b.decrypt=function(c,o,h){for(var v=this.keySize+6,m=this.invKeySchedule,T=this.invSBox,f=this.invSubMix,n=f[0],r=f[1],d=f[2],u=f[3],y=this.uint8ArrayToUint32Array_(h),l=y[0],a=y[1],i=y[2],D=y[3],E=new Int32Array(c),S=new Int32Array(E.length),L,x,g,O,P,C,w,F,k,_,B,N,U,j,W=this.networkToHostOrderSwap;o<E.length;){for(k=W(E[o]),_=W(E[o+1]),B=W(E[o+2]),N=W(E[o+3]),P=k^m[0],C=N^m[1],w=B^m[2],F=_^m[3],U=4,j=1;j<v;j++)L=n[P>>>24]^r[C>>16&255]^d[w>>8&255]^u[F&255]^m[U],x=n[C>>>24]^r[w>>16&255]^d[F>>8&255]^u[P&255]^m[U+1],g=n[w>>>24]^r[F>>16&255]^d[P>>8&255]^u[C&255]^m[U+2],O=n[F>>>24]^r[P>>16&255]^d[C>>8&255]^u[w&255]^m[U+3],P=L,C=x,w=g,F=O,U=U+4;L=T[P>>>24]<<24^T[C>>16&255]<<16^T[w>>8&255]<<8^T[F&255]^m[U],x=T[C>>>24]<<24^T[w>>16&255]<<16^T[F>>8&255]<<8^T[P&255]^m[U+1],g=T[w>>>24]<<24^T[F>>16&255]<<16^T[P>>8&255]<<8^T[C&255]^m[U+2],O=T[F>>>24]<<24^T[P>>16&255]<<16^T[C>>8&255]<<8^T[w&255]^m[U+3],S[o]=W(L^l),S[o+1]=W(O^a),S[o+2]=W(g^i),S[o+3]=W(x^D),l=k,a=_,i=B,D=N,o=o+4}return S.buffer},I}()},"./src/crypt/decrypter.ts":function(R,M,s){s.r(M),s.d(M,"default",function(){return o});var t=s("./src/crypt/aes-crypto.ts"),e=s("./src/crypt/fast-aes-key.ts"),p=s("./src/crypt/aes-decryptor.ts"),I=s("./src/utils/logger.ts"),b=s("./src/utils/mp4-tools.ts"),A=s("./src/utils/typed-array.ts"),c=16,o=function(){function h(m,T,f){var n=f===void 0?{}:f,r=n.removePKCS7Padding,d=r===void 0?!0:r;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=m,this.config=T,this.removePKCS7Padding=d,d)try{var u=self.crypto;u&&(this.subtle=u.subtle||u.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var v=h.prototype;return v.destroy=function(){this.observer=null},v.isSync=function(){return this.config.enableSoftwareAES},v.flush=function(){var T=this.currentResult;if(!T){this.reset();return}var f=new Uint8Array(T);return this.reset(),this.removePKCS7Padding?Object(p.removePadding)(f):f},v.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},v.decrypt=function(T,f,n,r){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(T),f,n);var d=this.flush();d&&r(d.buffer)}else this.webCryptoDecrypt(new Uint8Array(T),f,n).then(r)},v.softwareDecrypt=function(T,f,n){var r=this.currentIV,d=this.currentResult,u=this.remainderData;this.logOnce("JS AES decrypt"),u&&(T=Object(b.appendUint8Array)(u,T),this.remainderData=null);var y=this.getValidChunk(T);if(!y.length)return null;r&&(n=r);var l=this.softwareDecrypter;l||(l=this.softwareDecrypter=new p.default),l.expandKey(f);var a=d;return this.currentResult=l.decrypt(y.buffer,0,n),this.currentIV=Object(A.sliceUint8)(y,-16).buffer,a||null},v.webCryptoDecrypt=function(T,f,n){var r=this,d=this.subtle;return(this.key!==f||!this.fastAesKey)&&(this.key=f,this.fastAesKey=new e.default(d,f)),this.fastAesKey.expandKey().then(function(u){if(!d)return Promise.reject(new Error("web crypto not initialized"));var y=new t.default(d,n);return y.decrypt(T.buffer,u)}).catch(function(u){return r.onWebCryptoError(u,T,f,n)})},v.onWebCryptoError=function(T,f,n,r){return I.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",T),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(f,n,r)},v.getValidChunk=function(T){var f=T,n=T.length-T.length%c;return n!==T.length&&(f=Object(A.sliceUint8)(T,0,n),this.remainderData=Object(A.sliceUint8)(T,n)),f},v.logOnce=function(T){!this.logEnabled||(I.logger.log("[decrypter.ts]: "+T),this.logEnabled=!1)},h}()},"./src/crypt/fast-aes-key.ts":function(R,M,s){s.r(M),s.d(M,"default",function(){return t});var t=function(){function e(I,b){this.subtle=void 0,this.key=void 0,this.subtle=I,this.key=b}var p=e.prototype;return p.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},e}()},"./src/demux/aacdemuxer.ts":function(R,M,s){s.r(M);var t=s("./src/demux/base-audio-demuxer.ts"),e=s("./src/demux/adts.ts"),p=s("./src/utils/logger.ts"),I=s("./src/demux/id3.ts");function b(o,h){o.prototype=Object.create(h.prototype),o.prototype.constructor=o,A(o,h)}function A(o,h){return A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(m,T){return m.__proto__=T,m},A(o,h)}var c=function(o){b(h,o);function h(m,T){var f;return f=o.call(this)||this,f.observer=void 0,f.config=void 0,f.observer=m,f.config=T,f}var v=h.prototype;return v.resetInitSegment=function(T,f,n,r){o.prototype.resetInitSegment.call(this,T,f,n,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:f,duration:r,inputTimeScale:9e4,dropped:0}},h.probe=function(T){if(!T)return!1;for(var f=I.getID3Data(T,0)||[],n=f.length,r=T.length;n<r;n++)if(e.probe(T,n))return p.logger.log("ADTS sync word found !"),!0;return!1},v.canParse=function(T,f){return e.canParse(T,f)},v.appendFrame=function(T,f,n){e.initTrackConfig(T,this.observer,f,n,T.manifestCodec);var r=e.appendFrame(T,f,n,this.basePTS,this.frameIndex);if(r&&r.missing===0)return r},h}(t.default);c.minProbeByteLength=9,M.default=c},"./src/demux/adts.ts":function(R,M,s){s.r(M),s.d(M,"getAudioConfig",function(){return I}),s.d(M,"isHeaderPattern",function(){return b}),s.d(M,"getHeaderLength",function(){return A}),s.d(M,"getFullFrameLength",function(){return c}),s.d(M,"canGetFrameLength",function(){return o}),s.d(M,"isHeader",function(){return h}),s.d(M,"canParse",function(){return v}),s.d(M,"probe",function(){return m}),s.d(M,"initTrackConfig",function(){return T}),s.d(M,"getFrameDuration",function(){return f}),s.d(M,"parseFrameHeader",function(){return n}),s.d(M,"appendFrame",function(){return r});var t=s("./src/utils/logger.ts"),e=s("./src/errors.ts"),p=s("./src/events.ts");function I(d,u,y,l){var a,i,D,E,S=navigator.userAgent.toLowerCase(),L=l,x=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];a=((u[y+2]&192)>>>6)+1;var g=(u[y+2]&60)>>>2;if(g>x.length-1){d.trigger(p.Events.ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+g});return}return D=(u[y+2]&1)<<2,D|=(u[y+3]&192)>>>6,t.logger.log("manifest codec:"+l+", ADTS type:"+a+", samplingIndex:"+g),/firefox/i.test(S)?g>=6?(a=5,E=new Array(4),i=g-3):(a=2,E=new Array(2),i=g):S.indexOf("android")!==-1?(a=2,E=new Array(2),i=g):(a=5,E=new Array(4),l&&(l.indexOf("mp4a.40.29")!==-1||l.indexOf("mp4a.40.5")!==-1)||!l&&g>=6?i=g-3:((l&&l.indexOf("mp4a.40.2")!==-1&&(g>=6&&D===1||/vivaldi/i.test(S))||!l&&D===1)&&(a=2,E=new Array(2)),i=g)),E[0]=a<<3,E[0]|=(g&14)>>1,E[1]|=(g&1)<<7,E[1]|=D<<3,a===5&&(E[1]|=(i&14)>>1,E[2]=(i&1)<<7,E[2]|=2<<2,E[3]=0),{config:E,samplerate:x[g],channelCount:D,codec:"mp4a.40."+a,manifestCodec:L}}function b(d,u){return d[u]===255&&(d[u+1]&246)===240}function A(d,u){return d[u+1]&1?7:9}function c(d,u){return(d[u+3]&3)<<11|d[u+4]<<3|(d[u+5]&224)>>>5}function o(d,u){return u+5<d.length}function h(d,u){return u+1<d.length&&b(d,u)}function v(d,u){return o(d,u)&&b(d,u)&&c(d,u)<=d.length-u}function m(d,u){if(h(d,u)){var y=A(d,u);if(u+y>=d.length)return!1;var l=c(d,u);if(l<=y)return!1;var a=u+l;return a===d.length||h(d,a)}return!1}function T(d,u,y,l,a){if(!d.samplerate){var i=I(u,y,l,a);if(!i)return;d.config=i.config,d.samplerate=i.samplerate,d.channelCount=i.channelCount,d.codec=i.codec,d.manifestCodec=i.manifestCodec,t.logger.log("parsed codec:"+d.codec+", rate:"+i.samplerate+", channels:"+i.channelCount)}}function f(d){return 1024*9e4/d}function n(d,u){var y=A(d,u);if(u+y<=d.length){var l=c(d,u)-y;if(l>0)return{headerLength:y,frameLength:l}}}function r(d,u,y,l,a){var i=f(d.samplerate),D=l+a*i,E=n(u,y),S;if(E){var L=E.frameLength,x=E.headerLength,g=x+L,O=Math.max(0,y+g-u.length);O?(S=new Uint8Array(g-x),S.set(u.subarray(y+x,u.length),0)):S=u.subarray(y+x,y+g);var P={unit:S,pts:D};return O||d.samples.push(P),{sample:P,length:g,missing:O}}var C=u.length-y;S=new Uint8Array(C),S.set(u.subarray(y,u.length),0);var w={unit:S,pts:D};return{sample:w,length:C,missing:-1}}},"./src/demux/base-audio-demuxer.ts":function(R,M,s){s.r(M),s.d(M,"initPTSFn",function(){return o});var t=s("./src/polyfills/number.ts"),e=s("./src/demux/id3.ts"),p=s("./src/types/demuxer.ts"),I=s("./src/demux/dummy-demuxed-track.ts"),b=s("./src/utils/mp4-tools.ts"),A=s("./src/utils/typed-array.ts"),c=function(){function h(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null}var v=h.prototype;return v.resetInitSegment=function(T,f,n,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},v.resetTimeStamp=function(T){this.initPTS=T,this.resetContiguity()},v.resetContiguity=function(){this.basePTS=null,this.frameIndex=0},v.canParse=function(T,f){return!1},v.appendFrame=function(T,f,n){},v.demux=function(T,f){this.cachedData&&(T=Object(b.appendUint8Array)(this.cachedData,T),this.cachedData=null);var n=e.getID3Data(T,0),r=n?n.length:0,d,u,y=this._audioTrack,l=this._id3Track,a=n?e.getTimeStamp(n):void 0,i=T.length;for((this.basePTS===null||this.frameIndex===0&&Object(t.isFiniteNumber)(a))&&(this.basePTS=o(a,f,this.initPTS)),n&&n.length>0&&l.samples.push({pts:this.basePTS,dts:this.basePTS,data:n,type:p.MetadataSchema.audioId3}),u=this.basePTS;r<i;){if(this.canParse(T,r)){var D=this.appendFrame(y,T,r);D?(this.frameIndex++,u=D.sample.pts,r+=D.length,d=r):r=i}else e.canParse(T,r)?(n=e.getID3Data(T,r),l.samples.push({pts:u,dts:u,data:n,type:p.MetadataSchema.audioId3}),r+=n.length,d=r):r++;if(r===i&&d!==i){var E=Object(A.sliceUint8)(T,d);this.cachedData?this.cachedData=Object(b.appendUint8Array)(this.cachedData,E):this.cachedData=E}}return{audioTrack:y,videoTrack:Object(I.dummyTrack)(),id3Track:l,textTrack:Object(I.dummyTrack)()}},v.demuxSampleAes=function(T,f,n){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},v.flush=function(T){var f=this.cachedData;return f&&(this.cachedData=null,this.demux(f,0)),{audioTrack:this._audioTrack,videoTrack:Object(I.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(I.dummyTrack)()}},v.destroy=function(){},h}(),o=function(v,m,T){return Object(t.isFiniteNumber)(v)?v*90:m*9e4+(T||0)};M.default=c},"./src/demux/chunk-cache.ts":function(R,M,s){s.r(M),s.d(M,"default",function(){return t});var t=function(){function p(){this.chunks=[],this.dataLength=0}var I=p.prototype;return I.push=function(A){this.chunks.push(A),this.dataLength+=A.length},I.flush=function(){var A=this.chunks,c=this.dataLength,o;if(A.length)A.length===1?o=A[0]:o=e(A,c);else return new Uint8Array(0);return this.reset(),o},I.reset=function(){this.chunks.length=0,this.dataLength=0},p}();function e(p,I){for(var b=new Uint8Array(I),A=0,c=0;c<p.length;c++){var o=p[c];b.set(o,A),A+=o.length}return b}},"./src/demux/dummy-demuxed-track.ts":function(R,M,s){s.r(M),s.d(M,"dummyTrack",function(){return t});function t(e,p){return e===void 0&&(e=""),p===void 0&&(p=9e4),{type:e,id:-1,pid:-1,inputTimeScale:p,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":function(R,M,s){s.r(M);var t=s("./src/utils/logger.ts"),e=function(){function p(b){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=b,this.bytesAvailable=b.byteLength,this.word=0,this.bitsAvailable=0}var I=p.prototype;return I.loadWord=function(){var A=this.data,c=this.bytesAvailable,o=A.byteLength-c,h=new Uint8Array(4),v=Math.min(4,c);if(v===0)throw new Error("no bytes available");h.set(A.subarray(o,o+v)),this.word=new DataView(h.buffer).getUint32(0),this.bitsAvailable=v*8,this.bytesAvailable-=v},I.skipBits=function(A){var c;this.bitsAvailable>A?(this.word<<=A,this.bitsAvailable-=A):(A-=this.bitsAvailable,c=A>>3,A-=c>>3,this.bytesAvailable-=c,this.loadWord(),this.word<<=A,this.bitsAvailable-=A)},I.readBits=function(A){var c=Math.min(this.bitsAvailable,A),o=this.word>>>32-c;return A>32&&t.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=c,this.bitsAvailable>0?this.word<<=c:this.bytesAvailable>0&&this.loadWord(),c=A-c,c>0&&this.bitsAvailable?o<<c|this.readBits(c):o},I.skipLZ=function(){var A;for(A=0;A<this.bitsAvailable;++A)if((this.word&2147483648>>>A)!==0)return this.word<<=A,this.bitsAvailable-=A,A;return this.loadWord(),A+this.skipLZ()},I.skipUEG=function(){this.skipBits(1+this.skipLZ())},I.skipEG=function(){this.skipBits(1+this.skipLZ())},I.readUEG=function(){var A=this.skipLZ();return this.readBits(A+1)-1},I.readEG=function(){var A=this.readUEG();return 1&A?1+A>>>1:-1*(A>>>1)},I.readBoolean=function(){return this.readBits(1)===1},I.readUByte=function(){return this.readBits(8)},I.readUShort=function(){return this.readBits(16)},I.readUInt=function(){return this.readBits(32)},I.skipScalingList=function(A){for(var c=8,o=8,h,v=0;v<A;v++)o!==0&&(h=this.readEG(),o=(c+h+256)%256),c=o===0?c:o},I.readSPS=function(){var A=0,c=0,o=0,h=0,v,m,T,f=this.readUByte.bind(this),n=this.readBits.bind(this),r=this.readUEG.bind(this),d=this.readBoolean.bind(this),u=this.skipBits.bind(this),y=this.skipEG.bind(this),l=this.skipUEG.bind(this),a=this.skipScalingList.bind(this);f();var i=f();if(n(5),u(3),f(),l(),i===100||i===110||i===122||i===244||i===44||i===83||i===86||i===118||i===128){var D=r();if(D===3&&u(1),l(),l(),u(1),d())for(m=D!==3?8:12,T=0;T<m;T++)d()&&(T<6?a(16):a(64))}l();var E=r();if(E===0)r();else if(E===1)for(u(1),y(),y(),v=r(),T=0;T<v;T++)y();l(),u(1);var S=r(),L=r(),x=n(1);x===0&&u(1),u(1),d()&&(A=r(),c=r(),o=r(),h=r());var g=[1,1];if(d()&&d()){var O=f();switch(O){case 1:g=[1,1];break;case 2:g=[12,11];break;case 3:g=[10,11];break;case 4:g=[16,11];break;case 5:g=[40,33];break;case 6:g=[24,11];break;case 7:g=[20,11];break;case 8:g=[32,11];break;case 9:g=[80,33];break;case 10:g=[18,11];break;case 11:g=[15,11];break;case 12:g=[64,33];break;case 13:g=[160,99];break;case 14:g=[4,3];break;case 15:g=[3,2];break;case 16:g=[2,1];break;case 255:{g=[f()<<8|f(),f()<<8|f()];break}}}return{width:Math.ceil((S+1)*16-A*2-c*2),height:(2-x)*(L+1)*16-(x?2:4)*(o+h),pixelRatio:g}},I.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},p}();M.default=e},"./src/demux/id3.ts":function(R,M,s){s.r(M),s.d(M,"isHeader",function(){return t}),s.d(M,"isFooter",function(){return e}),s.d(M,"getID3Data",function(){return p}),s.d(M,"canParse",function(){return b}),s.d(M,"getTimeStamp",function(){return A}),s.d(M,"isTimeStampFrame",function(){return c}),s.d(M,"getID3Frames",function(){return h}),s.d(M,"decodeFrame",function(){return v}),s.d(M,"utf8ArrayToStr",function(){return r}),s.d(M,"testables",function(){return d});var t=function(a,i){return i+10<=a.length&&a[i]===73&&a[i+1]===68&&a[i+2]===51&&a[i+3]<255&&a[i+4]<255&&a[i+6]<128&&a[i+7]<128&&a[i+8]<128&&a[i+9]<128},e=function(a,i){return i+10<=a.length&&a[i]===51&&a[i+1]===68&&a[i+2]===73&&a[i+3]<255&&a[i+4]<255&&a[i+6]<128&&a[i+7]<128&&a[i+8]<128&&a[i+9]<128},p=function(a,i){for(var D=i,E=0;t(a,i);){E+=10;var S=I(a,i+6);E+=S,e(a,i+10)&&(E+=10),i+=E}if(E>0)return a.subarray(D,D+E)},I=function(a,i){var D=0;return D=(a[i]&127)<<21,D|=(a[i+1]&127)<<14,D|=(a[i+2]&127)<<7,D|=a[i+3]&127,D},b=function(a,i){return t(a,i)&&I(a,i+6)+10<=a.length-i},A=function(a){for(var i=h(a),D=0;D<i.length;D++){var E=i[D];if(c(E))return n(E)}},c=function(a){return a&&a.key==="PRIV"&&a.info==="com.apple.streaming.transportStreamTimestamp"},o=function(a){var i=String.fromCharCode(a[0],a[1],a[2],a[3]),D=I(a,4),E=10;return{type:i,size:D,data:a.subarray(E,E+D)}},h=function(a){for(var i=0,D=[];t(a,i);){var E=I(a,i+6);i+=10;for(var S=i+E;i+8<S;){var L=o(a.subarray(i)),x=v(L);x&&D.push(x),i+=L.size+10}e(a,i)&&(i+=10)}return D},v=function(a){return a.type==="PRIV"?m(a):a.type[0]==="W"?f(a):T(a)},m=function(a){if(!(a.size<2)){var i=r(a.data,!0),D=new Uint8Array(a.data.subarray(i.length+1));return{key:a.type,info:i,data:D.buffer}}},T=function(a){if(!(a.size<2)){if(a.type==="TXXX"){var i=1,D=r(a.data.subarray(i),!0);i+=D.length+1;var E=r(a.data.subarray(i));return{key:a.type,info:D,data:E}}var S=r(a.data.subarray(1));return{key:a.type,data:S}}},f=function(a){if(a.type==="WXXX"){if(a.size<2)return;var i=1,D=r(a.data.subarray(i),!0);i+=D.length+1;var E=r(a.data.subarray(i));return{key:a.type,info:D,data:E}}var S=r(a.data);return{key:a.type,data:S}},n=function(a){if(a.data.byteLength===8){var i=new Uint8Array(a.data),D=i[3]&1,E=(i[4]<<23)+(i[5]<<15)+(i[6]<<7)+i[7];return E/=45,D&&(E+=4772185884e-2),Math.round(E)}},r=function(a,i){i===void 0&&(i=!1);var D=y();if(D){var E=D.decode(a);if(i){var S=E.indexOf("\0");return S!==-1?E.substring(0,S):E}return E.replace(/\0/g,"")}for(var L=a.length,x,g,O,P="",C=0;C<L;){if(x=a[C++],x===0&&i)return P;if(x===0||x===3)continue;switch(x>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:P+=String.fromCharCode(x);break;case 12:case 13:g=a[C++],P+=String.fromCharCode((x&31)<<6|g&63);break;case 14:g=a[C++],O=a[C++],P+=String.fromCharCode((x&15)<<12|(g&63)<<6|(O&63)<<0);break}}return P},d={decodeTextFrame:T},u;function y(){return!u&&typeof self.TextDecoder<"u"&&(u=new self.TextDecoder("utf-8")),u}},"./src/demux/mp3demuxer.ts":function(R,M,s){s.r(M);var t=s("./src/demux/base-audio-demuxer.ts"),e=s("./src/demux/id3.ts"),p=s("./src/utils/logger.ts"),I=s("./src/demux/mpegaudio.ts");function b(o,h){o.prototype=Object.create(h.prototype),o.prototype.constructor=o,A(o,h)}function A(o,h){return A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(m,T){return m.__proto__=T,m},A(o,h)}var c=function(o){b(h,o);function h(){return o.apply(this,arguments)||this}var v=h.prototype;return v.resetInitSegment=function(T,f,n,r){o.prototype.resetInitSegment.call(this,T,f,n,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:f,duration:r,inputTimeScale:9e4,dropped:0}},h.probe=function(T){if(!T)return!1;for(var f=e.getID3Data(T,0)||[],n=f.length,r=T.length;n<r;n++)if(I.probe(T,n))return p.logger.log("MPEG Audio sync word found !"),!0;return!1},v.canParse=function(T,f){return I.canParse(T,f)},v.appendFrame=function(T,f,n){if(this.basePTS!==null)return I.appendFrame(T,f,n,this.basePTS,this.frameIndex)},h}(t.default);c.minProbeByteLength=4,M.default=c},"./src/demux/mp4demuxer.ts":function(R,M,s){s.r(M);var t=s("./src/polyfills/number.ts"),e=s("./src/types/demuxer.ts"),p=s("./src/utils/mp4-tools.ts"),I=s("./src/demux/dummy-demuxed-track.ts"),b=/\/emsg[-/]ID3/i,A=function(){function c(h,v){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=v}var o=c.prototype;return o.resetTimeStamp=function(){},o.resetInitSegment=function(v,m,T,f){var n=Object(p.parseInitSegment)(v),r=this.videoTrack=Object(I.dummyTrack)("video",1),d=this.audioTrack=Object(I.dummyTrack)("audio",1),u=this.txtTrack=Object(I.dummyTrack)("text",1);if(this.id3Track=Object(I.dummyTrack)("id3",1),this.timeOffset=0,n.video){var y=n.video,l=y.id,a=y.timescale,i=y.codec;r.id=l,r.timescale=u.timescale=a,r.codec=i}if(n.audio){var D=n.audio,E=D.id,S=D.timescale,L=D.codec;d.id=E,d.timescale=S,d.codec=L}u.id=p.RemuxerTrackIdConfig.text,r.sampleDuration=0,r.duration=d.duration=f},o.resetContiguity=function(){},c.probe=function(v){return v=v.length>16384?v.subarray(0,16384):v,Object(p.findBox)(v,["moof"]).length>0},o.demux=function(v,m){this.timeOffset=m;var T=v,f=this.videoTrack,n=this.txtTrack;if(this.config.progressive){this.remainderData&&(T=Object(p.appendUint8Array)(this.remainderData,v));var r=Object(p.segmentValidRange)(T);this.remainderData=r.remainder,f.samples=r.valid||new Uint8Array}else f.samples=T;var d=this.extractID3Track(f,m);return n.samples=Object(p.parseSamples)(m,f),{videoTrack:f,audioTrack:this.audioTrack,id3Track:d,textTrack:this.txtTrack}},o.flush=function(){var v=this.timeOffset,m=this.videoTrack,T=this.txtTrack;m.samples=this.remainderData||new Uint8Array,this.remainderData=null;var f=this.extractID3Track(m,this.timeOffset);return T.samples=Object(p.parseSamples)(v,m),{videoTrack:m,audioTrack:Object(I.dummyTrack)(),id3Track:f,textTrack:Object(I.dummyTrack)()}},o.extractID3Track=function(v,m){var T=this.id3Track;if(v.samples.length){var f=Object(p.findBox)(v.samples,["emsg"]);f&&f.forEach(function(n){var r=Object(p.parseEmsg)(n);if(b.test(r.schemeIdUri)){var d=Object(t.isFiniteNumber)(r.presentationTime)?r.presentationTime/r.timeScale:m+r.presentationTimeDelta/r.timeScale,u=r.payload;T.samples.push({data:u,len:u.byteLength,dts:d,pts:d,type:e.MetadataSchema.emsg})}})}return T},o.demuxSampleAes=function(v,m,T){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},o.destroy=function(){},c}();A.minProbeByteLength=1024,M.default=A},"./src/demux/mpegaudio.ts":function(R,M,s){s.r(M),s.d(M,"appendFrame",function(){return A}),s.d(M,"parseHeader",function(){return c}),s.d(M,"isHeaderPattern",function(){return o}),s.d(M,"isHeader",function(){return h}),s.d(M,"canParse",function(){return v}),s.d(M,"probe",function(){return m});var t=null,e=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],p=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],I=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],b=[0,1,1,4];function A(T,f,n,r,d){if(!(n+24>f.length)){var u=c(f,n);if(u&&n+u.frameLength<=f.length){var y=u.samplesPerFrame*9e4/u.sampleRate,l=r+d*y,a={unit:f.subarray(n,n+u.frameLength),pts:l,dts:l};return T.config=[],T.channelCount=u.channelCount,T.samplerate=u.sampleRate,T.samples.push(a),{sample:a,length:u.frameLength,missing:0}}}}function c(T,f){var n=T[f+1]>>3&3,r=T[f+1]>>1&3,d=T[f+2]>>4&15,u=T[f+2]>>2&3;if(n!==1&&d!==0&&d!==15&&u!==3){var y=T[f+2]>>1&1,l=T[f+3]>>6,a=n===3?3-r:r===3?3:4,i=e[a*14+d-1]*1e3,D=n===3?0:n===2?1:2,E=p[D*3+u],S=l===3?1:2,L=I[n][r],x=b[r],g=L*8*x,O=Math.floor(L*i/E+y)*x;if(t===null){var P=navigator.userAgent||"",C=P.match(/Chrome\/(\d+)/i);t=C?parseInt(C[1]):0}var w=!!t&&t<=87;return w&&r===2&&i>=224e3&&l===0&&(T[f+3]=T[f+3]|128),{sampleRate:E,channelCount:S,frameLength:O,samplesPerFrame:g}}}function o(T,f){return T[f]===255&&(T[f+1]&224)===224&&(T[f+1]&6)!==0}function h(T,f){return f+1<T.length&&o(T,f)}function v(T,f){var n=4;return o(T,f)&&n<=T.length-f}function m(T,f){if(f+1<T.length&&o(T,f)){var n=4,r=c(T,f),d=n;r!=null&&r.frameLength&&(d=r.frameLength);var u=f+d;return u===T.length||h(T,u)}return!1}},"./src/demux/sample-aes.ts":function(R,M,s){s.r(M);var t=s("./src/crypt/decrypter.ts"),e=s("./src/demux/tsdemuxer.ts"),p=function(){function I(A,c,o){this.keyData=void 0,this.decrypter=void 0,this.keyData=o,this.decrypter=new t.default(A,c,{removePKCS7Padding:!1})}var b=I.prototype;return b.decryptBuffer=function(c,o){this.decrypter.decrypt(c,this.keyData.key.buffer,this.keyData.iv.buffer,o)},b.decryptAacSample=function(c,o,h,v){var m=c[o].unit;if(!(m.length<=16)){var T=m.subarray(16,m.length-m.length%16),f=T.buffer.slice(T.byteOffset,T.byteOffset+T.length),n=this;this.decryptBuffer(f,function(r){var d=new Uint8Array(r);m.set(d,16),v||n.decryptAacSamples(c,o+1,h)})}},b.decryptAacSamples=function(c,o,h){for(;;o++){if(o>=c.length){h();return}if(!(c[o].unit.length<32)){var v=this.decrypter.isSync();if(this.decryptAacSample(c,o,h,v),!v)return}}},b.getAvcEncryptedData=function(c){for(var o=Math.floor((c.length-48)/160)*16+16,h=new Int8Array(o),v=0,m=32;m<c.length-16;m+=160,v+=16)h.set(c.subarray(m,m+16),v);return h},b.getAvcDecryptedUnit=function(c,o){for(var h=new Uint8Array(o),v=0,m=32;m<c.length-16;m+=160,v+=16)c.set(h.subarray(v,v+16),m);return c},b.decryptAvcSample=function(c,o,h,v,m,T){var f=Object(e.discardEPB)(m.data),n=this.getAvcEncryptedData(f),r=this;this.decryptBuffer(n.buffer,function(d){m.data=r.getAvcDecryptedUnit(f,d),T||r.decryptAvcSamples(c,o,h+1,v)})},b.decryptAvcSamples=function(c,o,h,v){if(c instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;o++,h=0){if(o>=c.length){v();return}for(var m=c[o].units;!(h>=m.length);h++){var T=m[h];if(!(T.data.length<=48||T.type!==1&&T.type!==5)){var f=this.decrypter.isSync();if(this.decryptAvcSample(c,o,h,v,T,f),!f)return}}}},I}();M.default=p},"./src/demux/transmuxer-interface.ts":function(R,M,s){s.r(M),s.d(M,"default",function(){return h});var t=s("./node_modules/webworkify-webpack/index.js"),e=s("./src/events.ts"),p=s("./src/demux/transmuxer.ts"),I=s("./src/utils/logger.ts"),b=s("./src/errors.ts"),A=s("./src/utils/mediasource-helper.ts"),c=s("./node_modules/eventemitter3/index.js"),o=Object(A.getMediaSource)()||{isTypeSupported:function(){return!1}},h=function(){function v(T,f,n,r){var d=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=T,this.id=f,this.onTransmuxComplete=n,this.onFlush=r;var u=T.config,y=function(E,S){S=S||{},S.frag=d.frag,S.id=d.id,T.trigger(E,S)};this.observer=new c.EventEmitter,this.observer.on(e.Events.FRAG_DECRYPTED,y),this.observer.on(e.Events.ERROR,y);var l={mp4:o.isTypeSupported("video/mp4"),mpeg:o.isTypeSupported("audio/mpeg"),mp3:o.isTypeSupported('audio/mp4; codecs="mp3"')},a=navigator.vendor;if(u.enableWorker&&typeof Worker<"u"){I.logger.log("demuxing in webworker");var i;try{i=this.worker=t("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),i.addEventListener("message",this.onwmsg),i.onerror=function(D){T.trigger(e.Events.ERROR,{type:b.ErrorTypes.OTHER_ERROR,details:b.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(D.message+"  ("+D.filename+":"+D.lineno+")")})},i.postMessage({cmd:"init",typeSupported:l,vendor:a,id:f,config:JSON.stringify(u)})}catch(D){I.logger.warn("Error in worker:",D),I.logger.error("Error while initializing DemuxerWorker, fallback to inline"),i&&self.URL.revokeObjectURL(i.objectURL),this.transmuxer=new p.default(this.observer,l,u,a,f),this.worker=null}}else this.transmuxer=new p.default(this.observer,l,u,a,f)}var m=v.prototype;return m.destroy=function(){var f=this.worker;if(f)f.removeEventListener("message",this.onwmsg),f.terminate(),this.worker=null,this.onwmsg=void 0;else{var n=this.transmuxer;n&&(n.destroy(),this.transmuxer=null)}var r=this.observer;r&&r.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},m.push=function(f,n,r,d,u,y,l,a,i,D){var E,S,L=this;i.transmuxing.start=self.performance.now();var x=this.transmuxer,g=this.worker,O=y?y.start:u.start,P=u.decryptdata,C=this.frag,w=!(C&&u.cc===C.cc),F=!(C&&i.level===C.level),k=C?i.sn-C.sn:-1,_=this.part?i.part-this.part.index:-1,B=k===0&&i.id>1&&i.id===(C==null?void 0:C.stats.chunkCount),N=!F&&(k===1||k===0&&(_===1||B&&_<=0)),U=self.performance.now();(F||k||u.stats.parsing.start===0)&&(u.stats.parsing.start=U),y&&(_||!N)&&(y.stats.parsing.start=U);var j=!(C&&((E=u.initSegment)===null||E===void 0?void 0:E.url)===((S=C.initSegment)===null||S===void 0?void 0:S.url)),W=new p.TransmuxState(w,N,a,F,O,j);if(!N||w||j){I.logger.log("[transmuxer-interface, "+u.type+"]: Starting new transmux session for sn: "+i.sn+" p: "+i.part+" level: "+i.level+" id: "+i.id+`
        discontinuity: `+w+`
        trackSwitch: `+F+`
        contiguous: `+N+`
        accurateTimeOffset: `+a+`
        timeOffset: `+O+`
        initSegmentChange: `+j);var H=new p.TransmuxConfig(r,d,n,l,D);this.configureTransmuxer(H)}if(this.frag=u,this.part=y,g)g.postMessage({cmd:"demux",data:f,decryptdata:P,chunkMeta:i,state:W},f instanceof ArrayBuffer?[f]:[]);else if(x){var G=x.push(f,P,i,W);Object(p.isPromise)(G)?G.then(function(K){L.handleTransmuxComplete(K)}):this.handleTransmuxComplete(G)}},m.flush=function(f){var n=this;f.transmuxing.start=self.performance.now();var r=this.transmuxer,d=this.worker;if(d)d.postMessage({cmd:"flush",chunkMeta:f});else if(r){var u=r.flush(f);Object(p.isPromise)(u)?u.then(function(y){n.handleFlushResult(y,f)}):this.handleFlushResult(u,f)}},m.handleFlushResult=function(f,n){var r=this;f.forEach(function(d){r.handleTransmuxComplete(d)}),this.onFlush(n)},m.onWorkerMessage=function(f){var n=f.data,r=this.hls;switch(n.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(n.data);break}case"flush":{this.onFlush(n.data);break}case"workerLog":I.logger[n.data.logType]&&I.logger[n.data.logType](n.data.message);break;default:{n.data=n.data||{},n.data.frag=this.frag,n.data.id=this.id,r.trigger(n.event,n.data);break}}},m.configureTransmuxer=function(f){var n=this.worker,r=this.transmuxer;n?n.postMessage({cmd:"configure",config:f}):r&&r.configure(f)},m.handleTransmuxComplete=function(f){f.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(f)},v}()},"./src/demux/transmuxer-worker.ts":function(R,M,s){s.r(M),s.d(M,"default",function(){return b});var t=s("./src/demux/transmuxer.ts"),e=s("./src/events.ts"),p=s("./src/utils/logger.ts"),I=s("./node_modules/eventemitter3/index.js");function b(v){var m=new I.EventEmitter,T=function(r,d){v.postMessage({event:r,data:d})};m.on(e.Events.FRAG_DECRYPTED,T),m.on(e.Events.ERROR,T);var f=function(){var r=function(y){var l=function(i){T("workerLog",{logType:y,message:i})};p.logger[y]=l};for(var d in p.logger)r(d)};v.addEventListener("message",function(n){var r=n.data;switch(r.cmd){case"init":{var d=JSON.parse(r.config);v.transmuxer=new t.default(m,r.typeSupported,d,r.vendor,r.id),Object(p.enableLogs)(d.debug),f(),T("init",null);break}case"configure":{v.transmuxer.configure(r.config);break}case"demux":{var u=v.transmuxer.push(r.data,r.decryptdata,r.chunkMeta,r.state);Object(t.isPromise)(u)?u.then(function(a){A(v,a)}):A(v,u);break}case"flush":{var y=r.chunkMeta,l=v.transmuxer.flush(y);Object(t.isPromise)(l)?l.then(function(a){o(v,a,y)}):o(v,l,y);break}}})}function A(v,m){if(h(m.remuxResult))return!1;var T=[],f=m.remuxResult,n=f.audio,r=f.video;return n&&c(T,n),r&&c(T,r),v.postMessage({event:"transmuxComplete",data:m},T),!0}function c(v,m){m.data1&&v.push(m.data1.buffer),m.data2&&v.push(m.data2.buffer)}function o(v,m,T){var f=m.reduce(function(n,r){return A(v,r)||n},!1);f||v.postMessage({event:"transmuxComplete",data:m[0]}),v.postMessage({event:"flush",data:T})}function h(v){return!v.audio&&!v.video&&!v.text&&!v.id3&&!v.initSegment}},"./src/demux/transmuxer.ts":function(R,M,s){s.r(M),s.d(M,"default",function(){return d}),s.d(M,"isPromise",function(){return l}),s.d(M,"TransmuxConfig",function(){return a}),s.d(M,"TransmuxState",function(){return i});var t=s("./src/events.ts"),e=s("./src/errors.ts"),p=s("./src/crypt/decrypter.ts"),I=s("./src/demux/aacdemuxer.ts"),b=s("./src/demux/mp4demuxer.ts"),A=s("./src/demux/tsdemuxer.ts"),c=s("./src/demux/mp3demuxer.ts"),o=s("./src/remux/mp4-remuxer.ts"),h=s("./src/remux/passthrough-remuxer.ts"),v=s("./src/demux/chunk-cache.ts"),m=s("./src/utils/mp4-tools.ts"),T=s("./src/utils/logger.ts"),f;try{f=self.performance.now.bind(self.performance)}catch{T.logger.debug("Unable to use Performance API on this environment"),f=self.Date.now}var n=[{demux:A.default,remux:o.default},{demux:b.default,remux:h.default},{demux:I.default,remux:o.default},{demux:c.default,remux:o.default}],r=1024;n.forEach(function(D){var E=D.demux;r=Math.max(r,E.minProbeByteLength)});var d=function(){function D(S,L,x,g,O){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new v.default,this.observer=S,this.typeSupported=L,this.config=x,this.vendor=g,this.id=O}var E=D.prototype;return E.configure=function(L){this.transmuxConfig=L,this.decrypter&&this.decrypter.reset()},E.push=function(L,x,g,O){var P=this,C=g.transmuxing;C.executeStart=f();var w=new Uint8Array(L),F=this.cache,k=this.config,_=this.currentTransmuxState,B=this.transmuxConfig;O&&(this.currentTransmuxState=O);var N=u(w,x);if(N&&N.method==="AES-128"){var U=this.getDecrypter();if(k.enableSoftwareAES){var j=U.softwareDecrypt(w,N.key.buffer,N.iv.buffer);if(!j)return C.executeEnd=f(),y(g);w=new Uint8Array(j)}else return this.decryptionPromise=U.webCryptoDecrypt(w,N.key.buffer,N.iv.buffer).then(function(it){var at=P.push(it,null,g);return P.decryptionPromise=null,at}),this.decryptionPromise}var W=O||_,H=W.contiguous,G=W.discontinuity,K=W.trackSwitch,X=W.accurateTimeOffset,Z=W.timeOffset,z=W.initSegmentChange,V=B.audioCodec,Y=B.videoCodec,Q=B.defaultInitPts,$=B.duration,J=B.initSegmentData;if((G||K||z)&&this.resetInitSegment(J,V,Y,$),(G||z)&&this.resetInitialTimestamp(Q),H||this.resetContiguity(),this.needsProbing(w,G,K)){if(F.dataLength){var tt=F.flush();w=Object(m.appendUint8Array)(tt,w)}this.configureTransmuxer(w,B)}var rt=this.transmux(w,N,Z,X,g),nt=this.currentTransmuxState;return nt.contiguous=!0,nt.discontinuity=!1,nt.trackSwitch=!1,C.executeEnd=f(),rt},E.flush=function(L){var x=this,g=L.transmuxing;g.executeStart=f();var O=this.decrypter,P=this.cache,C=this.currentTransmuxState,w=this.decryptionPromise;if(w)return w.then(function(){return x.flush(L)});var F=[],k=C.timeOffset;if(O){var _=O.flush();_&&F.push(this.push(_,null,L))}var B=P.dataLength;P.reset();var N=this.demuxer,U=this.remuxer;if(!N||!U)return B>=r&&this.observer.emit(t.Events.ERROR,t.Events.ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),g.executeEnd=f(),[y(L)];var j=N.flush(k);return l(j)?j.then(function(W){return x.flushRemux(F,W,L),F}):(this.flushRemux(F,j,L),F)},E.flushRemux=function(L,x,g){var O=x.audioTrack,P=x.videoTrack,C=x.id3Track,w=x.textTrack,F=this.currentTransmuxState,k=F.accurateTimeOffset,_=F.timeOffset;T.logger.log("[transmuxer.ts]: Flushed fragment "+g.sn+(g.part>-1?" p: "+g.part:"")+" of level "+g.level);var B=this.remuxer.remux(O,P,C,w,_,k,!0,this.id);L.push({remuxResult:B,chunkMeta:g}),g.transmuxing.executeEnd=f()},E.resetInitialTimestamp=function(L){var x=this.demuxer,g=this.remuxer;!x||!g||(x.resetTimeStamp(L),g.resetTimeStamp(L))},E.resetContiguity=function(){var L=this.demuxer,x=this.remuxer;!L||!x||(L.resetContiguity(),x.resetNextTimestamp())},E.resetInitSegment=function(L,x,g,O){var P=this.demuxer,C=this.remuxer;!P||!C||(P.resetInitSegment(L,x,g,O),C.resetInitSegment(L,x,g))},E.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},E.transmux=function(L,x,g,O,P){var C;return x&&x.method==="SAMPLE-AES"?C=this.transmuxSampleAes(L,x,g,O,P):C=this.transmuxUnencrypted(L,g,O,P),C},E.transmuxUnencrypted=function(L,x,g,O){var P=this.demuxer.demux(L,x,!1,!this.config.progressive),C=P.audioTrack,w=P.videoTrack,F=P.id3Track,k=P.textTrack,_=this.remuxer.remux(C,w,F,k,x,g,!1,this.id);return{remuxResult:_,chunkMeta:O}},E.transmuxSampleAes=function(L,x,g,O,P){var C=this;return this.demuxer.demuxSampleAes(L,x,g).then(function(w){var F=C.remuxer.remux(w.audioTrack,w.videoTrack,w.id3Track,w.textTrack,g,O,!1,C.id);return{remuxResult:F,chunkMeta:P}})},E.configureTransmuxer=function(L,x){for(var g=this.config,O=this.observer,P=this.typeSupported,C=this.vendor,w=x.audioCodec,F=x.defaultInitPts,k=x.duration,_=x.initSegmentData,B=x.videoCodec,N,U=0,j=n.length;U<j;U++)if(n[U].demux.probe(L)){N=n[U];break}N||(T.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),N={demux:b.default,remux:h.default});var W=this.demuxer,H=this.remuxer,G=N.remux,K=N.demux;(!H||!(H instanceof G))&&(this.remuxer=new G(O,g,P,C)),(!W||!(W instanceof K))&&(this.demuxer=new K(O,g,P),this.probe=K.probe),this.resetInitSegment(_,w,B,k),this.resetInitialTimestamp(F)},E.needsProbing=function(L,x,g){return!this.demuxer||!this.remuxer||x||g},E.getDecrypter=function(){var L=this.decrypter;return L||(L=this.decrypter=new p.default(this.observer,this.config)),L},D}();function u(D,E){var S=null;return D.byteLength>0&&E!=null&&E.key!=null&&E.iv!==null&&E.method!=null&&(S=E),S}var y=function(E){return{remuxResult:{},chunkMeta:E}};function l(D){return"then"in D&&D.then instanceof Function}var a=function(E,S,L,x,g){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=E,this.videoCodec=S,this.initSegmentData=L,this.duration=x,this.defaultInitPts=g},i=function(E,S,L,x,g,O){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=E,this.contiguous=S,this.accurateTimeOffset=L,this.trackSwitch=x,this.timeOffset=g,this.initSegmentChange=O}},"./src/demux/tsdemuxer.ts":function(R,M,s){s.r(M),s.d(M,"discardEPB",function(){return u});var t=s("./src/demux/adts.ts"),e=s("./src/demux/mpegaudio.ts"),p=s("./src/demux/exp-golomb.ts"),I=s("./src/demux/sample-aes.ts"),b=s("./src/events.ts"),A=s("./src/utils/mp4-tools.ts"),c=s("./src/utils/logger.ts"),o=s("./src/errors.ts"),h=s("./src/types/demuxer.ts");function v(){return v=Object.assign?Object.assign.bind():function(y){for(var l=1;l<arguments.length;l++){var a=arguments[l];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(y[i]=a[i])}return y},v.apply(this,arguments)}var m=function(){function y(a,i,D){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=a,this.config=i,this.typeSupported=D}y.probe=function(i){var D=y.syncOffset(i);return D<0?!1:(D&&c.logger.warn("MPEG2-TS detected but first sync word found @ offset "+D+", junk ahead ?"),!0)},y.syncOffset=function(i){for(var D=Math.min(1e3,i.length-564),E=0;E<D;){if(i[E]===71&&i[E+188]===71&&i[E+2*188]===71)return E;E++}return-1},y.createTrack=function(i,D){return{container:i==="video"||i==="audio"?"video/mp2t":void 0,type:i,id:A.RemuxerTrackIdConfig[i],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:i==="audio"?D:void 0}};var l=y.prototype;return l.resetInitSegment=function(i,D,E,S){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=y.createTrack("video"),this._audioTrack=y.createTrack("audio",S),this._id3Track=y.createTrack("id3"),this._txtTrack=y.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.audioCodec=D,this.videoCodec=E,this._duration=S},l.resetTimeStamp=function(){},l.resetContiguity=function(){var i=this._audioTrack,D=this._avcTrack,E=this._id3Track;i&&(i.pesData=null),D&&(D.pesData=null),E&&(E.pesData=null),this.aacOverFlow=null},l.demux=function(i,D,E,S){E===void 0&&(E=!1),S===void 0&&(S=!1),E||(this.sampleAes=null);var L,x=this._avcTrack,g=this._audioTrack,O=this._id3Track,P=this._txtTrack,C=x.pid,w=x.pesData,F=g.pid,k=O.pid,_=g.pesData,B=O.pesData,N=!1,U=this.pmtParsed,j=this._pmtId,W=i.length;if(this.remainderData&&(i=Object(A.appendUint8Array)(this.remainderData,i),W=i.length,this.remainderData=null),W<188&&!S)return this.remainderData=i,{audioTrack:g,videoTrack:x,id3Track:O,textTrack:P};var H=Math.max(0,y.syncOffset(i));W-=(W+H)%188,W<i.byteLength&&!S&&(this.remainderData=new Uint8Array(i.buffer,W,i.buffer.byteLength-W));for(var G=0,K=H;K<W;K+=188)if(i[K]===71){var X=!!(i[K+1]&64),Z=((i[K+1]&31)<<8)+i[K+2],z=(i[K+3]&48)>>4,V=void 0;if(z>1){if(V=K+5+i[K+4],V===K+188)continue}else V=K+4;switch(Z){case C:X&&(w&&(L=r(w))&&this.parseAVCPES(x,P,L,!1),w={data:[],size:0}),w&&(w.data.push(i.subarray(V,K+188)),w.size+=K+188-V);break;case F:if(X){if(_&&(L=r(_)))switch(g.segmentCodec){case"aac":this.parseAACPES(g,L);break;case"mp3":this.parseMPEGPES(g,L);break}_={data:[],size:0}}_&&(_.data.push(i.subarray(V,K+188)),_.size+=K+188-V);break;case k:X&&(B&&(L=r(B))&&this.parseID3PES(O,L),B={data:[],size:0}),B&&(B.data.push(i.subarray(V,K+188)),B.size+=K+188-V);break;case 0:X&&(V+=i[V]+1),j=this._pmtId=f(i,V);break;case j:{X&&(V+=i[V]+1);var Y=n(i,V,this.typeSupported,E);C=Y.avc,C>0&&(x.pid=C),F=Y.audio,F>0&&(g.pid=F,g.segmentCodec=Y.segmentCodec),k=Y.id3,k>0&&(O.pid=k),N&&!U&&(c.logger.log("reparse from beginning"),N=!1,K=H-188),U=this.pmtParsed=!0;break}case 17:case 8191:break;default:N=!0;break}}else G++;G>0&&this.observer.emit(b.Events.ERROR,b.Events.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+G+" TS packet/s that do not start with 0x47"}),x.pesData=w,g.pesData=_,O.pesData=B;var Q={audioTrack:g,videoTrack:x,id3Track:O,textTrack:P};return S&&this.extractRemainingSamples(Q),Q},l.flush=function(){var i=this.remainderData;this.remainderData=null;var D;return i?D=this.demux(i,-1,!1,!0):D={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(D),this.sampleAes?this.decrypt(D,this.sampleAes):D},l.extractRemainingSamples=function(i){var D=i.audioTrack,E=i.videoTrack,S=i.id3Track,L=i.textTrack,x=E.pesData,g=D.pesData,O=S.pesData,P;if(x&&(P=r(x))?(this.parseAVCPES(E,L,P,!0),E.pesData=null):E.pesData=x,g&&(P=r(g))){switch(D.segmentCodec){case"aac":this.parseAACPES(D,P);break;case"mp3":this.parseMPEGPES(D,P);break}D.pesData=null}else g!=null&&g.size&&c.logger.log("last AAC PES packet truncated,might overlap between fragments"),D.pesData=g;O&&(P=r(O))?(this.parseID3PES(S,P),S.pesData=null):S.pesData=O},l.demuxSampleAes=function(i,D,E){var S=this.demux(i,E,!0,!this.config.progressive),L=this.sampleAes=new I.default(this.observer,this.config,D);return this.decrypt(S,L)},l.decrypt=function(i,D){return new Promise(function(E){var S=i.audioTrack,L=i.videoTrack;S.samples&&S.segmentCodec==="aac"?D.decryptAacSamples(S.samples,0,function(){L.samples?D.decryptAvcSamples(L.samples,0,0,function(){E(i)}):E(i)}):L.samples&&D.decryptAvcSamples(L.samples,0,0,function(){E(i)})})},l.destroy=function(){this._duration=0},l.parseAVCPES=function(i,D,E,S){var L=this,x=this.parseAVCNALu(i,E.data),g=this.avcSample,O,P=!1;E.data=null,g&&x.length&&!i.audFound&&(d(g,i),g=this.avcSample=T(!1,E.pts,E.dts,"")),x.forEach(function(C){switch(C.type){case 1:{O=!0,g||(g=L.avcSample=T(!0,E.pts,E.dts,"")),g.frame=!0;var w=C.data;if(P&&w.length>4){var F=new p.default(w).readSliceType();(F===2||F===4||F===7||F===9)&&(g.key=!0)}break}case 5:O=!0,g||(g=L.avcSample=T(!0,E.pts,E.dts,"")),g.key=!0,g.frame=!0;break;case 6:{O=!0,Object(A.parseSEIMessageFromNALu)(u(C.data),E.pts,D.samples);break}case 7:if(O=!0,P=!0,!i.sps){var k=new p.default(C.data),_=k.readSPS();i.width=_.width,i.height=_.height,i.pixelRatio=_.pixelRatio,i.sps=[C.data],i.duration=L._duration;for(var B=C.data.subarray(1,4),N="avc1.",U=0;U<3;U++){var j=B[U].toString(16);j.length<2&&(j="0"+j),N+=j}i.codec=N}break;case 8:O=!0,i.pps||(i.pps=[C.data]);break;case 9:O=!1,i.audFound=!0,g&&d(g,i),g=L.avcSample=T(!1,E.pts,E.dts,"");break;case 12:O=!0;break;default:O=!1,g&&(g.debug+="unknown NAL "+C.type+" ");break}if(g&&O){var W=g.units;W.push(C)}}),S&&g&&(d(g,i),this.avcSample=null)},l.getLastNalUnit=function(i){var D,E=this.avcSample,S;if((!E||E.units.length===0)&&(E=i[i.length-1]),(D=E)!==null&&D!==void 0&&D.units){var L=E.units;S=L[L.length-1]}return S},l.parseAVCNALu=function(i,D){var E=D.byteLength,S=i.naluState||0,L=S,x=[],g=0,O,P,C,w=-1,F=0;for(S===-1&&(w=0,F=D[0]&31,S=0,g=1);g<E;){if(O=D[g++],!S){S=O?0:1;continue}if(S===1){S=O?0:2;continue}if(!O)S=3;else if(O===1){if(w>=0){var k={data:D.subarray(w,g-S-1),type:F};x.push(k)}else{var _=this.getLastNalUnit(i.samples);if(_&&(L&&g<=4-L&&_.state&&(_.data=_.data.subarray(0,_.data.byteLength-L)),P=g-S-1,P>0)){var B=new Uint8Array(_.data.byteLength+P);B.set(_.data,0),B.set(D.subarray(0,P),_.data.byteLength),_.data=B,_.state=0}}g<E?(C=D[g]&31,w=g,F=C,S=0):S=-1}else S=0}if(w>=0&&S>=0){var N={data:D.subarray(w,E),type:F,state:S};x.push(N)}if(x.length===0){var U=this.getLastNalUnit(i.samples);if(U){var j=new Uint8Array(U.data.byteLength+D.byteLength);j.set(U.data,0),j.set(D,U.data.byteLength),U.data=j}}return i.naluState=S,x},l.parseAACPES=function(i,D){var E=0,S=this.aacOverFlow,L=D.data;if(S){this.aacOverFlow=null;var x=S.missing,g=S.sample.unit.byteLength;if(x===-1){var O=new Uint8Array(g+L.byteLength);O.set(S.sample.unit,0),O.set(L,g),L=O}else{var P=g-x;S.sample.unit.set(L.subarray(0,x),P),i.samples.push(S.sample),E=S.missing}}var C,w;for(C=E,w=L.length;C<w-1&&!t.isHeader(L,C);C++);if(C!==E){var F,k;if(C<w-1?(F="AAC PES did not start with ADTS header,offset:"+C,k=!1):(F="no ADTS header found in AAC PES",k=!0),c.logger.warn("parsing error:"+F),this.observer.emit(b.Events.ERROR,b.Events.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.FRAG_PARSING_ERROR,fatal:k,reason:F}),k)return}t.initTrackConfig(i,this.observer,L,C,this.audioCodec);var _;if(D.pts!==void 0)_=D.pts;else if(S){var B=t.getFrameDuration(i.samplerate);_=S.sample.pts+B}else{c.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var N=0,U;C<w;)if(U=t.appendFrame(i,L,C,_,N),C+=U.length,U.missing){this.aacOverFlow=U;break}else for(N++;C<w-1&&!t.isHeader(L,C);C++);},l.parseMPEGPES=function(i,D){var E=D.data,S=E.length,L=0,x=0,g=D.pts;if(g===void 0){c.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;x<S;)if(e.isHeader(E,x)){var O=e.appendFrame(i,E,x,g,L);if(O)x+=O.length,L++;else break}else x++},l.parseID3PES=function(i,D){if(D.pts===void 0){c.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}var E=v({},D,{type:this._avcTrack?h.MetadataSchema.emsg:h.MetadataSchema.audioId3});i.samples.push(E)},y}();m.minProbeByteLength=188;function T(y,l,a,i){return{key:y,frame:!1,pts:l,dts:a,units:[],debug:i,length:0}}function f(y,l){return(y[l+10]&31)<<8|y[l+11]}function n(y,l,a,i){var D={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},E=(y[l+1]&15)<<8|y[l+2],S=l+3+E-4,L=(y[l+10]&15)<<8|y[l+11];for(l+=12+L;l<S;){var x=(y[l+1]&31)<<8|y[l+2];switch(y[l]){case 207:if(!i){c.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:D.audio===-1&&(D.audio=x);break;case 21:D.id3===-1&&(D.id3=x);break;case 219:if(!i){c.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:D.avc===-1&&(D.avc=x);break;case 3:case 4:a.mpeg!==!0&&a.mp3!==!0?c.logger.log("MPEG audio found, not supported in this browser"):D.audio===-1&&(D.audio=x,D.segmentCodec="mp3");break;case 36:c.logger.warn("Unsupported HEVC stream type found");break}l+=((y[l+3]&15)<<8|y[l+4])+5}return D}function r(y){var l=0,a,i,D,E,S,L=y.data;if(!y||y.size===0)return null;for(;L[0].length<19&&L.length>1;){var x=new Uint8Array(L[0].length+L[1].length);x.set(L[0]),x.set(L[1],L[0].length),L[0]=x,L.splice(1,1)}a=L[0];var g=(a[0]<<16)+(a[1]<<8)+a[2];if(g===1){if(i=(a[4]<<8)+a[5],i&&i>y.size-6)return null;var O=a[7];O&192&&(E=(a[9]&14)*536870912+(a[10]&255)*4194304+(a[11]&254)*16384+(a[12]&255)*128+(a[13]&254)/2,O&64?(S=(a[14]&14)*536870912+(a[15]&255)*4194304+(a[16]&254)*16384+(a[17]&255)*128+(a[18]&254)/2,E-S>60*9e4&&(c.logger.warn(Math.round((E-S)/9e4)+"s delta between PTS and DTS, align them"),E=S)):S=E),D=a[8];var P=D+9;if(y.size<=P)return null;y.size-=P;for(var C=new Uint8Array(y.size),w=0,F=L.length;w<F;w++){a=L[w];var k=a.byteLength;if(P)if(P>k){P-=k;continue}else a=a.subarray(P),k-=P,P=0;C.set(a,l),l+=k}return i&&(i-=D+3),{data:C,pts:E,dts:S,len:i}}return null}function d(y,l){if(y.units.length&&y.frame){if(y.pts===void 0){var a=l.samples,i=a.length;if(i){var D=a[i-1];y.pts=D.pts,y.dts=D.dts}else{l.dropped++;return}}l.samples.push(y)}y.debug.length&&c.logger.log(y.pts+"/"+y.dts+":"+y.debug)}function u(y){for(var l=y.byteLength,a=[],i=1;i<l-2;)y[i]===0&&y[i+1]===0&&y[i+2]===3?(a.push(i+2),i+=2):i++;if(a.length===0)return y;var D=l-a.length,E=new Uint8Array(D),S=0;for(i=0;i<D;S++,i++)S===a[0]&&(S++,a.shift()),E[i]=y[S];return E}M.default=m},"./src/errors.ts":function(R,M,s){s.r(M),s.d(M,"ErrorTypes",function(){return t}),s.d(M,"ErrorDetails",function(){return e});var t;(function(p){p.NETWORK_ERROR="networkError",p.MEDIA_ERROR="mediaError",p.KEY_SYSTEM_ERROR="keySystemError",p.MUX_ERROR="muxError",p.OTHER_ERROR="otherError"})(t||(t={}));var e;(function(p){p.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",p.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",p.KEY_SYSTEM_NO_SESSION="keySystemNoSession",p.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",p.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",p.MANIFEST_LOAD_ERROR="manifestLoadError",p.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",p.MANIFEST_PARSING_ERROR="manifestParsingError",p.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",p.LEVEL_EMPTY_ERROR="levelEmptyError",p.LEVEL_LOAD_ERROR="levelLoadError",p.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",p.LEVEL_SWITCH_ERROR="levelSwitchError",p.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",p.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",p.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",p.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",p.FRAG_LOAD_ERROR="fragLoadError",p.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",p.FRAG_DECRYPT_ERROR="fragDecryptError",p.FRAG_PARSING_ERROR="fragParsingError",p.REMUX_ALLOC_ERROR="remuxAllocError",p.KEY_LOAD_ERROR="keyLoadError",p.KEY_LOAD_TIMEOUT="keyLoadTimeOut",p.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",p.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",p.BUFFER_APPEND_ERROR="bufferAppendError",p.BUFFER_APPENDING_ERROR="bufferAppendingError",p.BUFFER_STALLED_ERROR="bufferStalledError",p.BUFFER_FULL_ERROR="bufferFullError",p.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",p.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",p.INTERNAL_EXCEPTION="internalException",p.INTERNAL_ABORTED="aborted",p.UNKNOWN="unknown"})(e||(e={}))},"./src/events.ts":function(R,M,s){s.r(M),s.d(M,"Events",function(){return t});var t;(function(e){e.MEDIA_ATTACHING="hlsMediaAttaching",e.MEDIA_ATTACHED="hlsMediaAttached",e.MEDIA_DETACHING="hlsMediaDetaching",e.MEDIA_DETACHED="hlsMediaDetached",e.BUFFER_RESET="hlsBufferReset",e.BUFFER_CODECS="hlsBufferCodecs",e.BUFFER_CREATED="hlsBufferCreated",e.BUFFER_APPENDING="hlsBufferAppending",e.BUFFER_APPENDED="hlsBufferAppended",e.BUFFER_EOS="hlsBufferEos",e.BUFFER_FLUSHING="hlsBufferFlushing",e.BUFFER_FLUSHED="hlsBufferFlushed",e.MANIFEST_LOADING="hlsManifestLoading",e.MANIFEST_LOADED="hlsManifestLoaded",e.MANIFEST_PARSED="hlsManifestParsed",e.LEVEL_SWITCHING="hlsLevelSwitching",e.LEVEL_SWITCHED="hlsLevelSwitched",e.LEVEL_LOADING="hlsLevelLoading",e.LEVEL_LOADED="hlsLevelLoaded",e.LEVEL_UPDATED="hlsLevelUpdated",e.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",e.LEVELS_UPDATED="hlsLevelsUpdated",e.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",e.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",e.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",e.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",e.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",e.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",e.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",e.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",e.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",e.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",e.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",e.CUES_PARSED="hlsCuesParsed",e.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",e.INIT_PTS_FOUND="hlsInitPtsFound",e.FRAG_LOADING="hlsFragLoading",e.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",e.FRAG_LOADED="hlsFragLoaded",e.FRAG_DECRYPTED="hlsFragDecrypted",e.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",e.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",e.FRAG_PARSING_METADATA="hlsFragParsingMetadata",e.FRAG_PARSED="hlsFragParsed",e.FRAG_BUFFERED="hlsFragBuffered",e.FRAG_CHANGED="hlsFragChanged",e.FPS_DROP="hlsFpsDrop",e.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",e.ERROR="hlsError",e.DESTROYING="hlsDestroying",e.KEY_LOADING="hlsKeyLoading",e.KEY_LOADED="hlsKeyLoaded",e.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",e.BACK_BUFFER_REACHED="hlsBackBufferReached"})(t||(t={}))},"./src/hls.ts":function(R,M,s){s.r(M),s.d(M,"default",function(){return u});var t=s("./node_modules/url-toolkit/src/url-toolkit.js"),e=s("./src/loader/playlist-loader.ts"),p=s("./src/loader/key-loader.ts"),I=s("./src/controller/id3-track-controller.ts"),b=s("./src/controller/latency-controller.ts"),A=s("./src/controller/level-controller.ts"),c=s("./src/controller/fragment-tracker.ts"),o=s("./src/controller/stream-controller.ts"),h=s("./src/is-supported.ts"),v=s("./src/utils/logger.ts"),m=s("./src/config.ts"),T=s("./node_modules/eventemitter3/index.js"),f=s("./src/events.ts"),n=s("./src/errors.ts");function r(y,l){for(var a=0;a<l.length;a++){var i=l[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(y,i.key,i)}}function d(y,l,a){return l&&r(y.prototype,l),a&&r(y,a),Object.defineProperty(y,"prototype",{writable:!1}),y}var u=function(){y.isSupported=function(){return Object(h.isSupported)()};function y(a){a===void 0&&(a={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new T.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var i=this.config=Object(m.mergeConfig)(y.DefaultConfig,a);this.userConfig=a,Object(v.enableLogs)(i.debug),this._autoLevelCapping=-1,i.progressive&&Object(m.enableStreamingMode)(i);var D=i.abrController,E=i.bufferController,S=i.capLevelController,L=i.fpsController,x=this.abrController=new D(this),g=this.bufferController=new E(this),O=this.capLevelController=new S(this),P=new L(this),C=new e.default(this),w=new p.default(this),F=new I.default(this),k=this.levelController=new A.default(this),_=new c.FragmentTracker(this),B=this.streamController=new o.default(this,_);O.setStreamController(B),P.setStreamController(B);var N=[k,B];this.networkControllers=N;var U=[C,w,x,g,O,P,F,_];this.audioTrackController=this.createController(i.audioTrackController,null,N),this.createController(i.audioStreamController,_,N),this.subtitleTrackController=this.createController(i.subtitleTrackController,null,N),this.createController(i.subtitleStreamController,_,N),this.createController(i.timelineController,null,U),this.emeController=this.createController(i.emeController,null,U),this.cmcdController=this.createController(i.cmcdController,null,U),this.latencyController=this.createController(b.default,null,U),this.coreComponents=U}var l=y.prototype;return l.createController=function(i,D,E){if(i){var S=D?new i(this,D):new i(this);return E&&E.push(S),S}return null},l.on=function(i,D,E){E===void 0&&(E=this),this._emitter.on(i,D,E)},l.once=function(i,D,E){E===void 0&&(E=this),this._emitter.once(i,D,E)},l.removeAllListeners=function(i){this._emitter.removeAllListeners(i)},l.off=function(i,D,E,S){E===void 0&&(E=this),this._emitter.off(i,D,E,S)},l.listeners=function(i){return this._emitter.listeners(i)},l.emit=function(i,D,E){return this._emitter.emit(i,D,E)},l.trigger=function(i,D){if(this.config.debug)return this.emit(i,i,D);try{return this.emit(i,i,D)}catch(E){v.logger.error("An internal error happened while handling event "+i+'. Error message: "'+E.message+'". Here is a stacktrace:',E),this.trigger(f.Events.ERROR,{type:n.ErrorTypes.OTHER_ERROR,details:n.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:i,error:E})}return!1},l.listenerCount=function(i){return this._emitter.listenerCount(i)},l.destroy=function(){v.logger.log("destroy"),this.trigger(f.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(i){return i.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(i){return i.destroy()}),this.coreComponents.length=0},l.attachMedia=function(i){v.logger.log("attachMedia"),this._media=i,this.trigger(f.Events.MEDIA_ATTACHING,{media:i})},l.detachMedia=function(){v.logger.log("detachMedia"),this.trigger(f.Events.MEDIA_DETACHING,void 0),this._media=null},l.loadSource=function(i){this.stopLoad();var D=this.media,E=this.url,S=this.url=t.buildAbsoluteURL(self.location.href,i,{alwaysNormalize:!0});v.logger.log("loadSource:"+S),D&&E&&E!==S&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(D)),this.trigger(f.Events.MANIFEST_LOADING,{url:i})},l.startLoad=function(i){i===void 0&&(i=-1),v.logger.log("startLoad("+i+")"),this.networkControllers.forEach(function(D){D.startLoad(i)})},l.stopLoad=function(){v.logger.log("stopLoad"),this.networkControllers.forEach(function(i){i.stopLoad()})},l.swapAudioCodec=function(){v.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},l.recoverMediaError=function(){v.logger.log("recoverMediaError");var i=this._media;this.detachMedia(),i&&this.attachMedia(i)},l.removeLevel=function(i,D){D===void 0&&(D=0),this.levelController.removeLevel(i,D)},d(y,[{key:"levels",get:function(){var i=this.levelController.levels;return i||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(i){v.logger.log("set currentLevel:"+i),this.loadLevel=i,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(i){v.logger.log("set nextLevel:"+i),this.levelController.manualLevel=i,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(i){v.logger.log("set loadLevel:"+i),this.levelController.manualLevel=i}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(i){this.levelController.nextLoadLevel=i}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(i){v.logger.log("set firstLevel:"+i),this.levelController.firstLevel=i}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(i){v.logger.log("set startLevel:"+i),i!==-1&&(i=Math.max(i,this.minAutoLevel)),this.levelController.startLevel=i}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(i){var D=!!i;D!==this.config.capLevelToPlayerSize&&(D?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=D)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(i){this._autoLevelCapping!==i&&(v.logger.log("set autoLevelCapping:"+i),this._autoLevelCapping=i)}},{key:"bandwidthEstimate",get:function(){var i=this.abrController.bwEstimator;return i?i.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var i=this.levels,D=this.config.minAutoBitrate;if(!i)return 0;for(var E=i.length,S=0;S<E;S++)if(i[S].maxBitrate>=D)return S;return 0}},{key:"maxAutoLevel",get:function(){var i=this.levels,D=this.autoLevelCapping,E;return D===-1&&i&&i.length?E=i.length-1:E=D,E}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(i){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,i)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"audioTracks",get:function(){var i=this.audioTrackController;return i?i.audioTracks:[]}},{key:"audioTrack",get:function(){var i=this.audioTrackController;return i?i.audioTrack:-1},set:function(i){var D=this.audioTrackController;D&&(D.audioTrack=i)}},{key:"subtitleTracks",get:function(){var i=this.subtitleTrackController;return i?i.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var i=this.subtitleTrackController;return i?i.subtitleTrack:-1},set:function(i){var D=this.subtitleTrackController;D&&(D.subtitleTrack=i)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var i=this.subtitleTrackController;return i?i.subtitleDisplay:!1},set:function(i){var D=this.subtitleTrackController;D&&(D.subtitleDisplay=i)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(i){this.config.lowLatencyMode=i}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.2.1"}},{key:"Events",get:function(){return f.Events}},{key:"ErrorTypes",get:function(){return n.ErrorTypes}},{key:"ErrorDetails",get:function(){return n.ErrorDetails}},{key:"DefaultConfig",get:function(){return y.defaultConfig?y.defaultConfig:m.hlsDefaultConfig},set:function(i){y.defaultConfig=i}}]),y}();u.defaultConfig=void 0},"./src/is-supported.ts":function(R,M,s){s.r(M),s.d(M,"isSupported",function(){return p}),s.d(M,"changeTypeSupported",function(){return I});var t=s("./src/utils/mediasource-helper.ts");function e(){return self.SourceBuffer||self.WebKitSourceBuffer}function p(){var b=Object(t.getMediaSource)();if(!b)return!1;var A=e(),c=b&&typeof b.isTypeSupported=="function"&&b.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),o=!A||A.prototype&&typeof A.prototype.appendBuffer=="function"&&typeof A.prototype.remove=="function";return!!c&&!!o}function I(){var b,A=e();return typeof(A==null||(b=A.prototype)===null||b===void 0?void 0:b.changeType)=="function"}},"./src/loader/date-range.ts":function(R,M,s){s.r(M),s.d(M,"DateRangeAttribute",function(){return c}),s.d(M,"DateRange",function(){return o});var t=s("./src/polyfills/number.ts"),e=s("./src/utils/attr-list.ts"),p=s("./src/utils/logger.ts");function I(){return I=Object.assign?Object.assign.bind():function(h){for(var v=1;v<arguments.length;v++){var m=arguments[v];for(var T in m)Object.prototype.hasOwnProperty.call(m,T)&&(h[T]=m[T])}return h},I.apply(this,arguments)}function b(h,v){for(var m=0;m<v.length;m++){var T=v[m];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(h,T.key,T)}}function A(h,v,m){return v&&b(h.prototype,v),m&&b(h,m),Object.defineProperty(h,"prototype",{writable:!1}),h}var c;(function(h){h.ID="ID",h.CLASS="CLASS",h.START_DATE="START-DATE",h.DURATION="DURATION",h.END_DATE="END-DATE",h.END_ON_NEXT="END-ON-NEXT",h.PLANNED_DURATION="PLANNED-DURATION",h.SCTE35_OUT="SCTE35-OUT",h.SCTE35_IN="SCTE35-IN"})(c||(c={}));var o=function(){function h(v,m){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,m){var T=m.attr;for(var f in T)if(Object.prototype.hasOwnProperty.call(v,f)&&v[f]!==T[f]){p.logger.warn('DATERANGE tag attribute: "'+f+'" does not match for tags with ID: "'+v.ID+'"'),this._badValueForSameId=f;break}v=I(new e.AttrList({}),T,v)}if(this.attr=v,this._startDate=new Date(v[c.START_DATE]),c.END_DATE in this.attr){var n=new Date(this.attr[c.END_DATE]);Object(t.isFiniteNumber)(n.getTime())&&(this._endDate=n)}}return A(h,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var m=this.duration;return m!==null?new Date(this._startDate.getTime()+m*1e3):null}},{key:"duration",get:function(){if(c.DURATION in this.attr){var m=this.attr.decimalFloatingPoint(c.DURATION);if(Object(t.isFiniteNumber)(m))return m}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return c.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(c.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(c.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&Object(t.isFiniteNumber)(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),h}()},"./src/loader/fragment-loader.ts":function(R,M,s){s.r(M),s.d(M,"default",function(){return m}),s.d(M,"LoadError",function(){return f});var t=s("./src/polyfills/number.ts"),e=s("./src/errors.ts");function p(n,r){n.prototype=Object.create(r.prototype),n.prototype.constructor=n,o(n,r)}function I(n){var r=typeof Map=="function"?new Map:void 0;return I=function(u){if(u===null||!c(u))return u;if(typeof u!="function")throw new TypeError("Super expression must either be null or a function");if(typeof r<"u"){if(r.has(u))return r.get(u);r.set(u,y)}function y(){return b(u,arguments,h(this).constructor)}return y.prototype=Object.create(u.prototype,{constructor:{value:y,enumerable:!1,writable:!0,configurable:!0}}),o(y,u)},I(n)}function b(n,r,d){return A()?b=Reflect.construct.bind():b=function(y,l,a){var i=[null];i.push.apply(i,l);var D=Function.bind.apply(y,i),E=new D;return a&&o(E,a.prototype),E},b.apply(null,arguments)}function A(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function c(n){return Function.toString.call(n).indexOf("[native code]")!==-1}function o(n,r){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(u,y){return u.__proto__=y,u},o(n,r)}function h(n){return h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(d){return d.__proto__||Object.getPrototypeOf(d)},h(n)}var v=Math.pow(2,17),m=function(){function n(d){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=d}var r=n.prototype;return r.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},r.abort=function(){this.loader&&this.loader.abort()},r.load=function(u,y){var l=this,a=u.url;if(!a)return Promise.reject(new f({type:e.ErrorTypes.NETWORK_ERROR,details:e.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:u,networkDetails:null},"Fragment does not have a "+(a?"part list":"url")));this.abort();var i=this.config,D=i.fLoader,E=i.loader;return new Promise(function(S,L){l.loader&&l.loader.destroy();var x=l.loader=u.loader=D?new D(i):new E(i),g=T(u),O={timeout:i.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:i.fragLoadingMaxRetryTimeout,highWaterMark:u.sn==="initSegment"?1/0:v};u.stats=x.stats,x.load(g,O,{onSuccess:function(C,w,F,k){l.resetLoader(u,x),S({frag:u,part:null,payload:C.data,networkDetails:k})},onError:function(C,w,F){l.resetLoader(u,x),L(new f({type:e.ErrorTypes.NETWORK_ERROR,details:e.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:u,response:C,networkDetails:F}))},onAbort:function(C,w,F){l.resetLoader(u,x),L(new f({type:e.ErrorTypes.NETWORK_ERROR,details:e.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:u,networkDetails:F}))},onTimeout:function(C,w,F){l.resetLoader(u,x),L(new f({type:e.ErrorTypes.NETWORK_ERROR,details:e.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:u,networkDetails:F}))},onProgress:function(C,w,F,k){y&&y({frag:u,part:null,payload:F,networkDetails:k})}})})},r.loadPart=function(u,y,l){var a=this;this.abort();var i=this.config,D=i.fLoader,E=i.loader;return new Promise(function(S,L){a.loader&&a.loader.destroy();var x=a.loader=u.loader=D?new D(i):new E(i),g=T(u,y),O={timeout:i.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:i.fragLoadingMaxRetryTimeout,highWaterMark:v};y.stats=x.stats,x.load(g,O,{onSuccess:function(C,w,F,k){a.resetLoader(u,x),a.updateStatsFromPart(u,y);var _={frag:u,part:y,payload:C.data,networkDetails:k};l(_),S(_)},onError:function(C,w,F){a.resetLoader(u,x),L(new f({type:e.ErrorTypes.NETWORK_ERROR,details:e.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:u,part:y,response:C,networkDetails:F}))},onAbort:function(C,w,F){u.stats.aborted=y.stats.aborted,a.resetLoader(u,x),L(new f({type:e.ErrorTypes.NETWORK_ERROR,details:e.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:u,part:y,networkDetails:F}))},onTimeout:function(C,w,F){a.resetLoader(u,x),L(new f({type:e.ErrorTypes.NETWORK_ERROR,details:e.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:u,part:y,networkDetails:F}))}})})},r.updateStatsFromPart=function(u,y){var l=u.stats,a=y.stats,i=a.total;if(l.loaded+=a.loaded,i){var D=Math.round(u.duration/y.duration),E=Math.min(Math.round(l.loaded/i),D),S=D-E,L=S*Math.round(l.loaded/E);l.total=l.loaded+L}else l.total=Math.max(l.loaded,l.total);var x=l.loading,g=a.loading;x.start?x.first+=g.first-g.start:(x.start=g.start,x.first=g.first),x.end=g.end},r.resetLoader=function(u,y){u.loader=null,this.loader===y&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),y.destroy()},n}();function T(n,r){r===void 0&&(r=null);var d=r||n,u={frag:n,part:r,responseType:"arraybuffer",url:d.url,headers:{},rangeStart:0,rangeEnd:0},y=d.byteRangeStartOffset,l=d.byteRangeEndOffset;return Object(t.isFiniteNumber)(y)&&Object(t.isFiniteNumber)(l)&&(u.rangeStart=y,u.rangeEnd=l),u}var f=function(n){p(r,n);function r(d){for(var u,y=arguments.length,l=new Array(y>1?y-1:0),a=1;a<y;a++)l[a-1]=arguments[a];return u=n.call.apply(n,[this].concat(l))||this,u.data=void 0,u.data=d,u}return r}(I(Error))},"./src/loader/fragment.ts":function(R,M,s){s.r(M),s.d(M,"ElementaryStreamTypes",function(){return v}),s.d(M,"BaseSegment",function(){return m}),s.d(M,"Fragment",function(){return T}),s.d(M,"Part",function(){return f});var t=s("./src/polyfills/number.ts"),e=s("./node_modules/url-toolkit/src/url-toolkit.js"),p=s("./src/utils/logger.ts"),I=s("./src/loader/level-key.ts"),b=s("./src/loader/load-stats.ts");function A(n,r){n.prototype=Object.create(r.prototype),n.prototype.constructor=n,c(n,r)}function c(n,r){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(u,y){return u.__proto__=y,u},c(n,r)}function o(n,r){for(var d=0;d<r.length;d++){var u=r[d];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(n,u.key,u)}}function h(n,r,d){return r&&o(n.prototype,r),d&&o(n,d),Object.defineProperty(n,"prototype",{writable:!1}),n}var v;(function(n){n.AUDIO="audio",n.VIDEO="video",n.AUDIOVIDEO="audiovideo"})(v||(v={}));var m=function(){function n(d){var u;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(u={},u[v.AUDIO]=null,u[v.VIDEO]=null,u[v.AUDIOVIDEO]=null,u),this.baseurl=d}var r=n.prototype;return r.setByteRange=function(u,y){var l=u.split("@",2),a=[];l.length===1?a[0]=y?y.byteRangeEndOffset:0:a[0]=parseInt(l[1]),a[1]=parseInt(l[0])+a[0],this._byteRange=a},h(n,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(e.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(u){this._url=u}}]),n}(),T=function(n){A(r,n);function r(u,y){var l;return l=n.call(this,y)||this,l._decryptdata=null,l.rawProgramDateTime=null,l.programDateTime=null,l.tagList=[],l.duration=0,l.sn=0,l.levelkey=void 0,l.type=void 0,l.loader=null,l.level=-1,l.cc=0,l.startPTS=void 0,l.endPTS=void 0,l.appendedPTS=void 0,l.startDTS=void 0,l.endDTS=void 0,l.start=0,l.deltaPTS=void 0,l.maxStartPTS=void 0,l.minEndPTS=void 0,l.stats=new b.LoadStats,l.urlId=0,l.data=void 0,l.bitrateTest=!1,l.title=null,l.initSegment=null,l.type=u,l}var d=r.prototype;return d.createInitializationVector=function(y){for(var l=new Uint8Array(16),a=12;a<16;a++)l[a]=y>>8*(15-a)&255;return l},d.setDecryptDataFromLevelKey=function(y,l){var a=y;return(y==null?void 0:y.method)==="AES-128"&&y.uri&&!y.iv&&(a=I.LevelKey.fromURI(y.uri),a.method=y.method,a.iv=this.createInitializationVector(l),a.keyFormat="identity"),a},d.setElementaryStreamInfo=function(y,l,a,i,D,E){E===void 0&&(E=!1);var S=this.elementaryStreams,L=S[y];if(!L){S[y]={startPTS:l,endPTS:a,startDTS:i,endDTS:D,partial:E};return}L.startPTS=Math.min(L.startPTS,l),L.endPTS=Math.max(L.endPTS,a),L.startDTS=Math.min(L.startDTS,i),L.endDTS=Math.max(L.endDTS,D)},d.clearElementaryStreamInfo=function(){var y=this.elementaryStreams;y[v.AUDIO]=null,y[v.VIDEO]=null,y[v.AUDIOVIDEO]=null},h(r,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var y=this.sn;typeof y!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&p.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),y=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,y)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(t.isFiniteNumber)(this.programDateTime))return null;var y=Object(t.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+y*1e3}},{key:"encrypted",get:function(){var y;return!!((y=this.decryptdata)!==null&&y!==void 0&&y.keyFormat&&this.decryptdata.uri)}}]),r}(m),f=function(n){A(r,n);function r(d,u,y,l,a){var i;i=n.call(this,y)||this,i.fragOffset=0,i.duration=0,i.gap=!1,i.independent=!1,i.relurl=void 0,i.fragment=void 0,i.index=void 0,i.stats=new b.LoadStats,i.duration=d.decimalFloatingPoint("DURATION"),i.gap=d.bool("GAP"),i.independent=d.bool("INDEPENDENT"),i.relurl=d.enumeratedString("URI"),i.fragment=u,i.index=l;var D=d.enumeratedString("BYTERANGE");return D&&i.setByteRange(D,a),a&&(i.fragOffset=a.fragOffset+a.duration),i}return h(r,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var u=this.elementaryStreams;return!!(u.audio||u.video||u.audiovideo)}}]),r}(m)},"./src/loader/key-loader.ts":function(R,M,s){s.r(M),s.d(M,"default",function(){return I});var t=s("./src/events.ts"),e=s("./src/errors.ts"),p=s("./src/utils/logger.ts"),I=function(){function b(c){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=c,this._registerListeners()}var A=b.prototype;return A._registerListeners=function(){this.hls.on(t.Events.KEY_LOADING,this.onKeyLoading,this)},A._unregisterListeners=function(){this.hls.off(t.Events.KEY_LOADING,this.onKeyLoading)},A.destroy=function(){this._unregisterListeners();for(var o in this.loaders){var h=this.loaders[o];h&&h.destroy()}this.loaders={}},A.onKeyLoading=function(o,h){var v=h.frag,m=v.type,T=this.loaders[m];if(!v.decryptdata){p.logger.warn("Missing decryption data on fragment in onKeyLoading");return}var f=v.decryptdata.uri;if(f!==this.decrypturl||this.decryptkey===null){var n=this.hls.config;if(T&&(p.logger.warn("abort previous key loader for type:"+m),T.abort()),!f){p.logger.warn("key uri is falsy");return}var r=n.loader,d=v.loader=this.loaders[m]=new r(n);this.decrypturl=f,this.decryptkey=null;var u={url:f,frag:v,responseType:"arraybuffer"},y={timeout:n.fragLoadingTimeOut,maxRetry:0,retryDelay:n.fragLoadingRetryDelay,maxRetryDelay:n.fragLoadingMaxRetryTimeout,highWaterMark:0},l={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};d.load(u,y,l)}else this.decryptkey&&(v.decryptdata.key=this.decryptkey,this.hls.trigger(t.Events.KEY_LOADED,{frag:v}))},A.loadsuccess=function(o,h,v){var m=v.frag;if(!m.decryptdata){p.logger.error("after key load, decryptdata unset");return}this.decryptkey=m.decryptdata.key=new Uint8Array(o.data),m.loader=null,delete this.loaders[m.type],this.hls.trigger(t.Events.KEY_LOADED,{frag:m})},A.loaderror=function(o,h){var v=h.frag,m=v.loader;m&&m.abort(),delete this.loaders[v.type],this.hls.trigger(t.Events.ERROR,{type:e.ErrorTypes.NETWORK_ERROR,details:e.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:v,response:o})},A.loadtimeout=function(o,h){var v=h.frag,m=v.loader;m&&m.abort(),delete this.loaders[v.type],this.hls.trigger(t.Events.ERROR,{type:e.ErrorTypes.NETWORK_ERROR,details:e.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:v})},b}()},"./src/loader/level-details.ts":function(R,M,s){s.r(M),s.d(M,"LevelDetails",function(){return b});var t=s("./src/polyfills/number.ts");function e(A,c){for(var o=0;o<c.length;o++){var h=c[o];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(A,h.key,h)}}function p(A,c,o){return c&&e(A.prototype,c),o&&e(A,o),Object.defineProperty(A,"prototype",{writable:!1}),A}var I=10,b=function(){function A(o){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.dateRanges={},this.url=o}var c=A.prototype;return c.reloaded=function(h){if(!h){this.advanced=!0,this.updated=!0;return}var v=this.lastPartSn-h.lastPartSn,m=this.lastPartIndex-h.lastPartIndex;this.updated=this.endSN!==h.endSN||!!m||!!v,this.advanced=this.endSN>h.endSN||v>0||v===0&&m>0,this.updated||this.advanced?this.misses=Math.floor(h.misses*.6):this.misses=h.misses+1,this.availabilityDelay=h.availabilityDelay},p(A,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?Object(t.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||I}},{key:"drift",get:function(){var h=this.driftEndTime-this.driftStartTime;if(h>0){var v=this.driftEnd-this.driftStart;return v*1e3/h}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var h;return(h=this.partList)!==null&&h!==void 0&&h.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var h;return(h=this.fragments)!==null&&h!==void 0&&h.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var h;return(h=this.partList)!==null&&h!==void 0&&h.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var h;return(h=this.partList)!==null&&h!==void 0&&h.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),A}()},"./src/loader/level-key.ts":function(R,M,s){s.r(M),s.d(M,"LevelKey",function(){return I});var t=s("./node_modules/url-toolkit/src/url-toolkit.js");function e(b,A){for(var c=0;c<A.length;c++){var o=A[c];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(b,o.key,o)}}function p(b,A,c){return A&&e(b.prototype,A),c&&e(b,c),Object.defineProperty(b,"prototype",{writable:!1}),b}var I=function(){b.fromURL=function(c,o){return new b(c,o)},b.fromURI=function(c){return new b(c)};function b(A,c){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,c?this._uri=Object(t.buildAbsoluteURL)(A,c,{alwaysNormalize:!0}):this._uri=A}return p(b,[{key:"uri",get:function(){return this._uri}}]),b}()},"./src/loader/load-stats.ts":function(R,M,s){s.r(M),s.d(M,"LoadStats",function(){return t});var t=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(R,M,s){s.r(M),s.d(M,"default",function(){return d});var t=s("./src/polyfills/number.ts"),e=s("./node_modules/url-toolkit/src/url-toolkit.js"),p=s("./src/loader/date-range.ts"),I=s("./src/loader/fragment.ts"),b=s("./src/loader/level-details.ts"),A=s("./src/loader/level-key.ts"),c=s("./src/utils/attr-list.ts"),o=s("./src/utils/logger.ts"),h=s("./src/utils/codecs.ts"),v=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,m=/#EXT-X-MEDIA:(.*)/g,T=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),f=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),n=/\.(mp4|m4s|m4v|m4a)$/i;function r(D){var E,S;return n.test((E=(S=e.parseURL(D))===null||S===void 0?void 0:S.path)!=null?E:"")}var d=function(){function D(){}return D.findGroup=function(S,L){for(var x=0;x<S.length;x++){var g=S[x];if(g.id===L)return g}},D.convertAVC1ToAVCOTI=function(S){var L=S.split(".");if(L.length>2){var x=L.shift()+".";return x+=parseInt(L.shift()).toString(16),x+=("000"+parseInt(L.shift()).toString(16)).slice(-4),x}return S},D.resolve=function(S,L){return e.buildAbsoluteURL(L,S,{alwaysNormalize:!0})},D.parseMasterPlaylist=function(S,L){var x=[],g={},O=!1;v.lastIndex=0;for(var P;(P=v.exec(S))!=null;)if(P[1]){var C=new c.AttrList(P[1]),w={attrs:C,bitrate:C.decimalInteger("AVERAGE-BANDWIDTH")||C.decimalInteger("BANDWIDTH"),name:C.NAME,url:D.resolve(P[2],L)},F=C.decimalResolution("RESOLUTION");F&&(w.width=F.width,w.height=F.height),u((C.CODECS||"").split(/[ ,]+/).filter(function(_){return _}),w),w.videoCodec&&w.videoCodec.indexOf("avc1")!==-1&&(w.videoCodec=D.convertAVC1ToAVCOTI(w.videoCodec)),x.push(w)}else if(P[3]){var k=new c.AttrList(P[3]);k["DATA-ID"]&&(O=!0,g[k["DATA-ID"]]=k)}return{levels:x,sessionData:O?g:null}},D.parseMasterPlaylistMedia=function(S,L,x,g){g===void 0&&(g=[]);var O,P=[],C=0;for(m.lastIndex=0;(O=m.exec(S))!==null;){var w=new c.AttrList(O[1]);if(w.TYPE===x){var F={attrs:w,bitrate:0,id:C++,groupId:w["GROUP-ID"],instreamId:w["INSTREAM-ID"],name:w.NAME||w.LANGUAGE||"",type:x,default:w.bool("DEFAULT"),autoselect:w.bool("AUTOSELECT"),forced:w.bool("FORCED"),lang:w.LANGUAGE,url:w.URI?D.resolve(w.URI,L):""};if(g.length){var k=D.findGroup(g,F.groupId)||g[0];y(F,k,"audioCodec"),y(F,k,"textCodec")}P.push(F)}}return P},D.parseLevelPlaylist=function(S,L,x,g,O){var P=new b.LevelDetails(L),C=P.fragments,w=null,F=0,k=0,_=0,B=0,N=null,U=new I.Fragment(g,L),j,W,H,G=-1,K=!1;for(T.lastIndex=0,P.m3u8=S;(j=T.exec(S))!==null;){K&&(K=!1,U=new I.Fragment(g,L),U.start=_,U.sn=F,U.cc=B,U.level=x,w&&(U.initSegment=w,U.rawProgramDateTime=w.rawProgramDateTime,w.rawProgramDateTime=null));var X=j[1];if(X){U.duration=parseFloat(X);var Z=(" "+j[2]).slice(1);U.title=Z||null,U.tagList.push(Z?["INF",X,Z]:["INF",X])}else if(j[3])Object(t.isFiniteNumber)(U.duration)&&(U.start=_,H&&(U.levelkey=H),U.sn=F,U.level=x,U.cc=B,U.urlId=O,C.push(U),U.relurl=(" "+j[3]).slice(1),a(U,N),N=U,_+=U.duration,F++,k=0,K=!0);else if(j[4]){var z=(" "+j[4]).slice(1);N?U.setByteRange(z,N):U.setByteRange(z)}else if(j[5])U.rawProgramDateTime=(" "+j[5]).slice(1),U.tagList.push(["PROGRAM-DATE-TIME",U.rawProgramDateTime]),G===-1&&(G=C.length);else{if(j=j[0].match(f),!j){o.logger.warn("No matches on slow regex match for level playlist!");continue}for(W=1;W<j.length&&!(typeof j[W]<"u");W++);var V=(" "+j[W]).slice(1),Y=(" "+j[W+1]).slice(1),Q=j[W+2]?(" "+j[W+2]).slice(1):"";switch(V){case"PLAYLIST-TYPE":P.type=Y.toUpperCase();break;case"MEDIA-SEQUENCE":F=P.startSN=parseInt(Y);break;case"SKIP":{var $=new c.AttrList(Y),J=$.decimalInteger("SKIPPED-SEGMENTS");if(Object(t.isFiniteNumber)(J)){P.skippedSegments=J;for(var tt=J;tt--;)C.unshift(null);F+=J}var rt=$.enumeratedString("RECENTLY-REMOVED-DATERANGES");rt&&(P.recentlyRemovedDateranges=rt.split("	"));break}case"TARGETDURATION":P.targetduration=parseFloat(Y);break;case"VERSION":P.version=parseInt(Y);break;case"EXTM3U":break;case"ENDLIST":P.live=!1;break;case"#":(Y||Q)&&U.tagList.push(Q?[Y,Q]:[Y]);break;case"DISCONTINUITY":B++,U.tagList.push(["DIS"]);break;case"GAP":U.tagList.push([V]);break;case"BITRATE":U.tagList.push([V,Y]);break;case"DATERANGE":{var nt=new c.AttrList(Y),it=new p.DateRange(nt,P.dateRanges[nt.ID]);it.isValid||P.skippedSegments?P.dateRanges[it.id]=it:o.logger.warn('Ignoring invalid DATERANGE tag: "'+Y+'"'),U.tagList.push(["EXT-X-DATERANGE",Y]);break}case"DISCONTINUITY-SEQUENCE":B=parseInt(Y);break;case"KEY":{var at,ut=new c.AttrList(Y),dt=ut.enumeratedString("METHOD"),st=ut.URI,yt=ut.hexadecimalInteger("IV"),vt=ut.enumeratedString("KEYFORMATVERSIONS"),ct=ut.enumeratedString("KEYID"),Et=(at=ut.enumeratedString("KEYFORMAT"))!=null?at:"identity",Tt=["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"];if(Tt.indexOf(Et)>-1){o.logger.warn("Keyformat "+Et+" is not supported from the manifest");continue}else if(Et!=="identity")continue;dt&&(H=A.LevelKey.fromURL(L,st),st&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(dt)>=0&&(H.method=dt,H.keyFormat=Et,ct&&(H.keyID=ct),vt&&(H.keyFormatVersions=vt),H.iv=yt));break}case"START":{var xt=new c.AttrList(Y),ot=xt.decimalFloatingPoint("TIME-OFFSET");Object(t.isFiniteNumber)(ot)&&(P.startTimeOffset=ot);break}case"MAP":{var ht=new c.AttrList(Y);if(U.duration){var pt=new I.Fragment(g,L);i(pt,ht,x,H),w=pt,U.initSegment=w,w.rawProgramDateTime&&!U.rawProgramDateTime&&(U.rawProgramDateTime=w.rawProgramDateTime)}else i(U,ht,x,H),w=U,K=!0;break}case"SERVER-CONTROL":{var mt=new c.AttrList(Y);P.canBlockReload=mt.bool("CAN-BLOCK-RELOAD"),P.canSkipUntil=mt.optionalFloat("CAN-SKIP-UNTIL",0),P.canSkipDateRanges=P.canSkipUntil>0&&mt.bool("CAN-SKIP-DATERANGES"),P.partHoldBack=mt.optionalFloat("PART-HOLD-BACK",0),P.holdBack=mt.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var St=new c.AttrList(Y);P.partTarget=St.decimalFloatingPoint("PART-TARGET");break}case"PART":{var ft=P.partList;ft||(ft=P.partList=[]);var gt=k>0?ft[ft.length-1]:void 0,q=k++,At=new I.Part(new c.AttrList(Y),U,L,q,gt);ft.push(At),U.duration+=At.duration;break}case"PRELOAD-HINT":{var It=new c.AttrList(Y);P.preloadHint=It;break}case"RENDITION-REPORT":{var Dt=new c.AttrList(Y);P.renditionReports=P.renditionReports||[],P.renditionReports.push(Dt);break}default:o.logger.warn("line parsed but not handled: "+j);break}}}N&&!N.relurl?(C.pop(),_-=N.duration,P.partList&&(P.fragmentHint=N)):P.partList&&(a(U,N),U.cc=B,P.fragmentHint=U);var Ct=C.length,Rt=C[0],Ot=C[Ct-1];if(_+=P.skippedSegments*P.targetduration,_>0&&Ct&&Ot){P.averagetargetduration=_/Ct;var Mt=Ot.sn;P.endSN=Mt!=="initSegment"?Mt:0,Rt&&(P.startCC=Rt.cc,Rt.initSegment||P.fragments.every(function(Pt){return Pt.relurl&&r(Pt.relurl)})&&(o.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),U=new I.Fragment(g,L),U.relurl=Ot.relurl,U.level=x,U.sn="initSegment",Rt.initSegment=U,P.needSidxRanges=!0))}else P.endSN=0,P.startCC=0;return P.fragmentHint&&(_+=P.fragmentHint.duration),P.totalduration=_,P.endCC=B,G>0&&l(C,G),P},D}();function u(D,E){["video","audio","text"].forEach(function(S){var L=D.filter(function(g){return Object(h.isCodecType)(g,S)});if(L.length){var x=L.filter(function(g){return g.lastIndexOf("avc1",0)===0||g.lastIndexOf("mp4a",0)===0});E[S+"Codec"]=x.length>0?x[0]:L[0],D=D.filter(function(g){return L.indexOf(g)===-1})}}),E.unknownCodecs=D}function y(D,E,S){var L=E[S];L&&(D[S]=L)}function l(D,E){for(var S=D[E],L=E;L--;){var x=D[L];if(!x)return;x.programDateTime=S.programDateTime-x.duration*1e3,S=x}}function a(D,E){D.rawProgramDateTime?D.programDateTime=Date.parse(D.rawProgramDateTime):E!=null&&E.programDateTime&&(D.programDateTime=E.endProgramDateTime),Object(t.isFiniteNumber)(D.programDateTime)||(D.programDateTime=null,D.rawProgramDateTime=null)}function i(D,E,S,L){D.relurl=E.URI,E.BYTERANGE&&D.setByteRange(E.BYTERANGE),D.level=S,D.sn="initSegment",L&&(D.levelkey=L),D.initSegment=null}},"./src/loader/playlist-loader.ts":function(R,M,s){s.r(M);var t=s("./src/polyfills/number.ts"),e=s("./src/events.ts"),p=s("./src/errors.ts"),I=s("./src/utils/logger.ts"),b=s("./src/utils/mp4-tools.ts"),A=s("./src/loader/m3u8-parser.ts"),c=s("./src/types/loader.ts"),o=s("./src/utils/attr-list.ts");function h(T){var f=T.type;switch(f){case c.PlaylistContextType.AUDIO_TRACK:return c.PlaylistLevelType.AUDIO;case c.PlaylistContextType.SUBTITLE_TRACK:return c.PlaylistLevelType.SUBTITLE;default:return c.PlaylistLevelType.MAIN}}function v(T,f){var n=T.url;return(n===void 0||n.indexOf("data:")===0)&&(n=f.url),n}var m=function(){function T(n){this.hls=void 0,this.loaders=Object.create(null),this.hls=n,this.registerListeners()}var f=T.prototype;return f.registerListeners=function(){var r=this.hls;r.on(e.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(e.Events.LEVEL_LOADING,this.onLevelLoading,this),r.on(e.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),r.on(e.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},f.unregisterListeners=function(){var r=this.hls;r.off(e.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(e.Events.LEVEL_LOADING,this.onLevelLoading,this),r.off(e.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),r.off(e.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},f.createInternalLoader=function(r){var d=this.hls.config,u=d.pLoader,y=d.loader,l=u||y,a=new l(d);return r.loader=a,this.loaders[r.type]=a,a},f.getInternalLoader=function(r){return this.loaders[r.type]},f.resetInternalLoader=function(r){this.loaders[r]&&delete this.loaders[r]},f.destroyInternalLoaders=function(){for(var r in this.loaders){var d=this.loaders[r];d&&d.destroy(),this.resetInternalLoader(r)}},f.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},f.onManifestLoading=function(r,d){var u=d.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:c.PlaylistContextType.MANIFEST,url:u,deliveryDirectives:null})},f.onLevelLoading=function(r,d){var u=d.id,y=d.level,l=d.url,a=d.deliveryDirectives;this.load({id:u,groupId:null,level:y,responseType:"text",type:c.PlaylistContextType.LEVEL,url:l,deliveryDirectives:a})},f.onAudioTrackLoading=function(r,d){var u=d.id,y=d.groupId,l=d.url,a=d.deliveryDirectives;this.load({id:u,groupId:y,level:null,responseType:"text",type:c.PlaylistContextType.AUDIO_TRACK,url:l,deliveryDirectives:a})},f.onSubtitleTrackLoading=function(r,d){var u=d.id,y=d.groupId,l=d.url,a=d.deliveryDirectives;this.load({id:u,groupId:y,level:null,responseType:"text",type:c.PlaylistContextType.SUBTITLE_TRACK,url:l,deliveryDirectives:a})},f.load=function(r){var d,u=this.hls.config,y=this.getInternalLoader(r);if(y){var l=y.context;if(l&&l.url===r.url){I.logger.trace("[playlist-loader]: playlist request ongoing");return}I.logger.log("[playlist-loader]: aborting previous loader for type: "+r.type),y.abort()}var a,i,D,E;switch(r.type){case c.PlaylistContextType.MANIFEST:a=u.manifestLoadingMaxRetry,i=u.manifestLoadingTimeOut,D=u.manifestLoadingRetryDelay,E=u.manifestLoadingMaxRetryTimeout;break;case c.PlaylistContextType.LEVEL:case c.PlaylistContextType.AUDIO_TRACK:case c.PlaylistContextType.SUBTITLE_TRACK:a=0,i=u.levelLoadingTimeOut;break;default:a=u.levelLoadingMaxRetry,i=u.levelLoadingTimeOut,D=u.levelLoadingRetryDelay,E=u.levelLoadingMaxRetryTimeout;break}if(y=this.createInternalLoader(r),(d=r.deliveryDirectives)!==null&&d!==void 0&&d.part){var S;if(r.type===c.PlaylistContextType.LEVEL&&r.level!==null?S=this.hls.levels[r.level].details:r.type===c.PlaylistContextType.AUDIO_TRACK&&r.id!==null?S=this.hls.audioTracks[r.id].details:r.type===c.PlaylistContextType.SUBTITLE_TRACK&&r.id!==null&&(S=this.hls.subtitleTracks[r.id].details),S){var L=S.partTarget,x=S.targetduration;L&&x&&(i=Math.min(Math.max(L*3,x*.8)*1e3,i))}}var g={timeout:i,maxRetry:a,retryDelay:D,maxRetryDelay:E,highWaterMark:0},O={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};y.load(r,g,O)},f.loadsuccess=function(r,d,u,y){if(y===void 0&&(y=null),u.isSidxRequest){this.handleSidxRequest(r,u),this.handlePlaylistLoaded(r,d,u,y);return}this.resetInternalLoader(u.type);var l=r.data;if(l.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(r,u,"no EXTM3U delimiter",y);return}d.parsing.start=performance.now(),l.indexOf("#EXTINF:")>0||l.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(r,d,u,y):this.handleMasterPlaylist(r,d,u,y)},f.loaderror=function(r,d,u){u===void 0&&(u=null),this.handleNetworkError(d,u,!1,r)},f.loadtimeout=function(r,d,u){u===void 0&&(u=null),this.handleNetworkError(d,u,!0)},f.handleMasterPlaylist=function(r,d,u,y){var l=this.hls,a=r.data,i=v(r,u),D=A.default.parseMasterPlaylist(a,i),E=D.levels,S=D.sessionData;if(!E.length){this.handleManifestParsingError(r,u,"no level found in manifest",y);return}var L=E.map(function(w){return{id:w.attrs.AUDIO,audioCodec:w.audioCodec}}),x=E.map(function(w){return{id:w.attrs.SUBTITLES,textCodec:w.textCodec}}),g=A.default.parseMasterPlaylistMedia(a,i,"AUDIO",L),O=A.default.parseMasterPlaylistMedia(a,i,"SUBTITLES",x),P=A.default.parseMasterPlaylistMedia(a,i,"CLOSED-CAPTIONS");if(g.length){var C=g.some(function(w){return!w.url});!C&&E[0].audioCodec&&!E[0].attrs.AUDIO&&(I.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),g.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new o.AttrList({}),bitrate:0,url:""}))}l.trigger(e.Events.MANIFEST_LOADED,{levels:E,audioTracks:g,subtitles:O,captions:P,url:i,stats:d,networkDetails:y,sessionData:S})},f.handleTrackOrLevelPlaylist=function(r,d,u,y){var l=this.hls,a=u.id,i=u.level,D=u.type,E=v(r,u),S=Object(t.isFiniteNumber)(a)?a:0,L=Object(t.isFiniteNumber)(i)?i:S,x=h(u),g=A.default.parseLevelPlaylist(r.data,E,L,x,S);if(!g.fragments.length){l.trigger(e.Events.ERROR,{type:p.ErrorTypes.NETWORK_ERROR,details:p.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:E,reason:"no fragments found in level",level:typeof u.level=="number"?u.level:void 0});return}if(D===c.PlaylistContextType.MANIFEST){var O={attrs:new o.AttrList({}),bitrate:0,details:g,name:"",url:E};l.trigger(e.Events.MANIFEST_LOADED,{levels:[O],audioTracks:[],url:E,stats:d,networkDetails:y,sessionData:null})}if(d.parsing.end=performance.now(),g.needSidxRanges){var P,C=(P=g.fragments[0].initSegment)===null||P===void 0?void 0:P.url;this.load({url:C,isSidxRequest:!0,type:D,level:i,levelDetails:g,id:a,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null});return}u.levelDetails=g,this.handlePlaylistLoaded(r,d,u,y)},f.handleSidxRequest=function(r,d){var u=new Uint8Array(r.data),y=Object(b.findBox)(u,["sidx"])[0];if(!!y){var l=Object(b.parseSegmentIndex)(y);if(!!l){var a=l.references,i=d.levelDetails;a.forEach(function(D,E){var S=D.info,L=i.fragments[E];if(L.byteRange.length===0&&L.setByteRange(String(1+S.end-S.start)+"@"+String(S.start)),L.initSegment){var x=Object(b.findBox)(u,["moov"])[0],g=x?x.length:null;L.initSegment.setByteRange(String(g)+"@0")}})}}},f.handleManifestParsingError=function(r,d,u,y){this.hls.trigger(e.Events.ERROR,{type:p.ErrorTypes.NETWORK_ERROR,details:p.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:d.type===c.PlaylistContextType.MANIFEST,url:r.url,reason:u,response:r,context:d,networkDetails:y})},f.handleNetworkError=function(r,d,u,y){u===void 0&&(u=!1),I.logger.warn("[playlist-loader]: A network "+(u?"timeout":"error")+" occurred while loading "+r.type+" level: "+r.level+" id: "+r.id+' group-id: "'+r.groupId+'"');var l=p.ErrorDetails.UNKNOWN,a=!1,i=this.getInternalLoader(r);switch(r.type){case c.PlaylistContextType.MANIFEST:l=u?p.ErrorDetails.MANIFEST_LOAD_TIMEOUT:p.ErrorDetails.MANIFEST_LOAD_ERROR,a=!0;break;case c.PlaylistContextType.LEVEL:l=u?p.ErrorDetails.LEVEL_LOAD_TIMEOUT:p.ErrorDetails.LEVEL_LOAD_ERROR,a=!1;break;case c.PlaylistContextType.AUDIO_TRACK:l=u?p.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:p.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,a=!1;break;case c.PlaylistContextType.SUBTITLE_TRACK:l=u?p.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:p.ErrorDetails.SUBTITLE_LOAD_ERROR,a=!1;break}i&&this.resetInternalLoader(r.type);var D={type:p.ErrorTypes.NETWORK_ERROR,details:l,fatal:a,url:r.url,loader:i,context:r,networkDetails:d};y&&(D.response=y),this.hls.trigger(e.Events.ERROR,D)},f.handlePlaylistLoaded=function(r,d,u,y){var l=u.type,a=u.level,i=u.id,D=u.groupId,E=u.loader,S=u.levelDetails,L=u.deliveryDirectives;if(!(S!=null&&S.targetduration)){this.handleManifestParsingError(r,u,"invalid target duration",y);return}if(!!E)switch(S.live&&(E.getCacheAge&&(S.ageHeader=E.getCacheAge()||0),(!E.getCacheAge||isNaN(S.ageHeader))&&(S.ageHeader=0)),l){case c.PlaylistContextType.MANIFEST:case c.PlaylistContextType.LEVEL:this.hls.trigger(e.Events.LEVEL_LOADED,{details:S,level:a||0,id:i||0,stats:d,networkDetails:y,deliveryDirectives:L});break;case c.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(e.Events.AUDIO_TRACK_LOADED,{details:S,id:i||0,groupId:D||"",stats:d,networkDetails:y,deliveryDirectives:L});break;case c.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(e.Events.SUBTITLE_TRACK_LOADED,{details:S,id:i||0,groupId:D||"",stats:d,networkDetails:y,deliveryDirectives:L});break}},T}();M.default=m},"./src/polyfills/number.ts":function(R,M,s){s.r(M),s.d(M,"isFiniteNumber",function(){return t}),s.d(M,"MAX_SAFE_INTEGER",function(){return e});var t=Number.isFinite||function(p){return typeof p=="number"&&isFinite(p)},e=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(R,M,s){s.r(M);var t=function(){function e(){}return e.getSilentFrame=function(I,b){switch(I){case"mp4a.40.2":if(b===1)return new Uint8Array([0,200,0,128,35,128]);if(b===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(b===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(b===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(b===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(b===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(b===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(b===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(b===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},e}();M.default=t},"./src/remux/mp4-generator.ts":function(R,M,s){s.r(M);var t=Math.pow(2,32)-1,e=function(){function p(){}return p.init=function(){p.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var b;for(b in p.types)p.types.hasOwnProperty(b)&&(p.types[b]=[b.charCodeAt(0),b.charCodeAt(1),b.charCodeAt(2),b.charCodeAt(3)]);var A=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),c=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);p.HDLR_TYPES={video:A,audio:c};var o=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),h=new Uint8Array([0,0,0,0,0,0,0,0]);p.STTS=p.STSC=p.STCO=h,p.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),p.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),p.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),p.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var v=new Uint8Array([105,115,111,109]),m=new Uint8Array([97,118,99,49]),T=new Uint8Array([0,0,0,1]);p.FTYP=p.box(p.types.ftyp,v,T,v,m),p.DINF=p.box(p.types.dinf,p.box(p.types.dref,o))},p.box=function(b){for(var A=8,c=arguments.length,o=new Array(c>1?c-1:0),h=1;h<c;h++)o[h-1]=arguments[h];for(var v=o.length,m=v;v--;)A+=o[v].byteLength;var T=new Uint8Array(A);for(T[0]=A>>24&255,T[1]=A>>16&255,T[2]=A>>8&255,T[3]=A&255,T.set(b,4),v=0,A=8;v<m;v++)T.set(o[v],A),A+=o[v].byteLength;return T},p.hdlr=function(b){return p.box(p.types.hdlr,p.HDLR_TYPES[b])},p.mdat=function(b){return p.box(p.types.mdat,b)},p.mdhd=function(b,A){A*=b;var c=Math.floor(A/(t+1)),o=Math.floor(A%(t+1));return p.box(p.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,b>>24&255,b>>16&255,b>>8&255,b&255,c>>24,c>>16&255,c>>8&255,c&255,o>>24,o>>16&255,o>>8&255,o&255,85,196,0,0]))},p.mdia=function(b){return p.box(p.types.mdia,p.mdhd(b.timescale,b.duration),p.hdlr(b.type),p.minf(b))},p.mfhd=function(b){return p.box(p.types.mfhd,new Uint8Array([0,0,0,0,b>>24,b>>16&255,b>>8&255,b&255]))},p.minf=function(b){return b.type==="audio"?p.box(p.types.minf,p.box(p.types.smhd,p.SMHD),p.DINF,p.stbl(b)):p.box(p.types.minf,p.box(p.types.vmhd,p.VMHD),p.DINF,p.stbl(b))},p.moof=function(b,A,c){return p.box(p.types.moof,p.mfhd(b),p.traf(c,A))},p.moov=function(b){for(var A=b.length,c=[];A--;)c[A]=p.trak(b[A]);return p.box.apply(null,[p.types.moov,p.mvhd(b[0].timescale,b[0].duration)].concat(c).concat(p.mvex(b)))},p.mvex=function(b){for(var A=b.length,c=[];A--;)c[A]=p.trex(b[A]);return p.box.apply(null,[p.types.mvex].concat(c))},p.mvhd=function(b,A){A*=b;var c=Math.floor(A/(t+1)),o=Math.floor(A%(t+1)),h=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,b>>24&255,b>>16&255,b>>8&255,b&255,c>>24,c>>16&255,c>>8&255,c&255,o>>24,o>>16&255,o>>8&255,o&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return p.box(p.types.mvhd,h)},p.sdtp=function(b){var A=b.samples||[],c=new Uint8Array(4+A.length),o,h;for(o=0;o<A.length;o++)h=A[o].flags,c[o+4]=h.dependsOn<<4|h.isDependedOn<<2|h.hasRedundancy;return p.box(p.types.sdtp,c)},p.stbl=function(b){return p.box(p.types.stbl,p.stsd(b),p.box(p.types.stts,p.STTS),p.box(p.types.stsc,p.STSC),p.box(p.types.stsz,p.STSZ),p.box(p.types.stco,p.STCO))},p.avc1=function(b){var A=[],c=[],o,h,v;for(o=0;o<b.sps.length;o++)h=b.sps[o],v=h.byteLength,A.push(v>>>8&255),A.push(v&255),A=A.concat(Array.prototype.slice.call(h));for(o=0;o<b.pps.length;o++)h=b.pps[o],v=h.byteLength,c.push(v>>>8&255),c.push(v&255),c=c.concat(Array.prototype.slice.call(h));var m=p.box(p.types.avcC,new Uint8Array([1,A[3],A[4],A[5],255,224|b.sps.length].concat(A).concat([b.pps.length]).concat(c))),T=b.width,f=b.height,n=b.pixelRatio[0],r=b.pixelRatio[1];return p.box(p.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,T>>8&255,T&255,f>>8&255,f&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),m,p.box(p.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),p.box(p.types.pasp,new Uint8Array([n>>24,n>>16&255,n>>8&255,n&255,r>>24,r>>16&255,r>>8&255,r&255])))},p.esds=function(b){var A=b.config.length;return new Uint8Array([0,0,0,0,3,23+A,0,1,0,4,15+A,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([A]).concat(b.config).concat([6,1,2]))},p.mp4a=function(b){var A=b.samplerate;return p.box(p.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,b.channelCount,0,16,0,0,0,0,A>>8&255,A&255,0,0]),p.box(p.types.esds,p.esds(b)))},p.mp3=function(b){var A=b.samplerate;return p.box(p.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,b.channelCount,0,16,0,0,0,0,A>>8&255,A&255,0,0]))},p.stsd=function(b){return b.type==="audio"?b.segmentCodec==="mp3"&&b.codec==="mp3"?p.box(p.types.stsd,p.STSD,p.mp3(b)):p.box(p.types.stsd,p.STSD,p.mp4a(b)):p.box(p.types.stsd,p.STSD,p.avc1(b))},p.tkhd=function(b){var A=b.id,c=b.duration*b.timescale,o=b.width,h=b.height,v=Math.floor(c/(t+1)),m=Math.floor(c%(t+1));return p.box(p.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,A>>24&255,A>>16&255,A>>8&255,A&255,0,0,0,0,v>>24,v>>16&255,v>>8&255,v&255,m>>24,m>>16&255,m>>8&255,m&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,o>>8&255,o&255,0,0,h>>8&255,h&255,0,0]))},p.traf=function(b,A){var c=p.sdtp(b),o=b.id,h=Math.floor(A/(t+1)),v=Math.floor(A%(t+1));return p.box(p.types.traf,p.box(p.types.tfhd,new Uint8Array([0,0,0,0,o>>24,o>>16&255,o>>8&255,o&255])),p.box(p.types.tfdt,new Uint8Array([1,0,0,0,h>>24,h>>16&255,h>>8&255,h&255,v>>24,v>>16&255,v>>8&255,v&255])),p.trun(b,c.length+16+20+8+16+8+8),c)},p.trak=function(b){return b.duration=b.duration||4294967295,p.box(p.types.trak,p.tkhd(b),p.mdia(b))},p.trex=function(b){var A=b.id;return p.box(p.types.trex,new Uint8Array([0,0,0,0,A>>24,A>>16&255,A>>8&255,A&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},p.trun=function(b,A){var c=b.samples||[],o=c.length,h=12+16*o,v=new Uint8Array(h),m,T,f,n,r,d;for(A+=8+h,v.set([0,0,15,1,o>>>24&255,o>>>16&255,o>>>8&255,o&255,A>>>24&255,A>>>16&255,A>>>8&255,A&255],0),m=0;m<o;m++)T=c[m],f=T.duration,n=T.size,r=T.flags,d=T.cts,v.set([f>>>24&255,f>>>16&255,f>>>8&255,f&255,n>>>24&255,n>>>16&255,n>>>8&255,n&255,r.isLeading<<2|r.dependsOn,r.isDependedOn<<6|r.hasRedundancy<<4|r.paddingValue<<1|r.isNonSync,r.degradPrio&240<<8,r.degradPrio&15,d>>>24&255,d>>>16&255,d>>>8&255,d&255],12+16*m);return p.box(p.types.trun,v)},p.initSegment=function(b){p.types||p.init();var A=p.moov(b),c=new Uint8Array(p.FTYP.byteLength+A.byteLength);return c.set(p.FTYP),c.set(A,p.FTYP.byteLength),c},p}();e.types=void 0,e.HDLR_TYPES=void 0,e.STTS=void 0,e.STSC=void 0,e.STCO=void 0,e.STSZ=void 0,e.VMHD=void 0,e.SMHD=void 0,e.STSD=void 0,e.FTYP=void 0,e.DINF=void 0,M.default=e},"./src/remux/mp4-remuxer.ts":function(R,M,s){s.r(M),s.d(M,"default",function(){return d}),s.d(M,"normalizePts",function(){return u}),s.d(M,"flushTextTrackMetadataCueSamples",function(){return l}),s.d(M,"flushTextTrackUserdataCueSamples",function(){return a});var t=s("./src/polyfills/number.ts"),e=s("./src/remux/aac-helper.ts"),p=s("./src/remux/mp4-generator.ts"),I=s("./src/events.ts"),b=s("./src/errors.ts"),A=s("./src/utils/logger.ts"),c=s("./src/types/loader.ts"),o=s("./src/utils/timescale-conversion.ts");function h(){return h=Object.assign?Object.assign.bind():function(E){for(var S=1;S<arguments.length;S++){var L=arguments[S];for(var x in L)Object.prototype.hasOwnProperty.call(L,x)&&(E[x]=L[x])}return E},h.apply(this,arguments)}var v=10*1e3,m=1024,T=1152,f=null,n=null,r=!1,d=function(){function E(L,x,g,O){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=L,this.config=x,this.typeSupported=g,this.ISGenerated=!1,f===null){var P=navigator.userAgent||"",C=P.match(/Chrome\/(\d+)/i);f=C?parseInt(C[1]):0}if(n===null){var w=navigator.userAgent.match(/Safari\/(\d+)/i);n=w?parseInt(w[1]):0}r=!(!!f&&f>=75||!!n&&n>=600)}var S=E.prototype;return S.destroy=function(){},S.resetTimeStamp=function(x){A.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=x},S.resetNextTimestamp=function(){A.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},S.resetInitSegment=function(){A.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},S.getVideoStartPts=function(x){var g=!1,O=x.reduce(function(P,C){var w=C.pts-P;return w<-4294967296?(g=!0,u(P,C.pts)):w>0?P:C.pts},x[0].pts);return g&&A.logger.debug("PTS rollover detected"),O},S.remux=function(x,g,O,P,C,w,F,k){var _,B,N,U,j,W,H=C,G=C,K=x.pid>-1,X=g.pid>-1,Z=g.samples.length,z=x.samples.length>0,V=F&&Z>0||Z>1,Y=(!K||z)&&(!X||V)||this.ISGenerated||F;if(Y){this.ISGenerated||(N=this.generateIS(x,g,C));var Q=this.isVideoContiguous,$=-1,J;if(V&&($=y(g.samples),!Q&&this.config.forceKeyFrameOnDiscontinuity))if(W=!0,$>0){A.logger.warn("[mp4-remuxer]: Dropped "+$+" out of "+Z+" video samples due to a missing keyframe");var tt=this.getVideoStartPts(g.samples);g.samples=g.samples.slice($),g.dropped+=$,G+=(g.samples[0].pts-tt)/g.inputTimeScale,J=G}else $===-1&&(A.logger.warn("[mp4-remuxer]: No keyframe found out of "+Z+" video samples"),W=!1);if(this.ISGenerated){if(z&&V){var rt=this.getVideoStartPts(g.samples),nt=u(x.samples[0].pts,rt)-rt,it=nt/g.inputTimeScale;H+=Math.max(0,it),G+=Math.max(0,-it)}if(z){if(x.samplerate||(A.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),N=this.generateIS(x,g,C)),B=this.remuxAudio(x,H,this.isAudioContiguous,w,X||V||k===c.PlaylistLevelType.AUDIO?G:void 0),V){var at=B?B.endPTS-B.startPTS:0;g.inputTimeScale||(A.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),N=this.generateIS(x,g,C)),_=this.remuxVideo(g,G,Q,at)}}else V&&(_=this.remuxVideo(g,G,Q,0));_&&(_.firstKeyFrame=$,_.independent=$!==-1,_.firstKeyFramePTS=J)}}return this.ISGenerated&&(O.samples.length&&(j=l(O,C,this._initPTS,this._initDTS)),P.samples.length&&(U=a(P,C,this._initPTS))),{audio:B,video:_,initSegment:N,independent:W,text:U,id3:j}},S.generateIS=function(x,g,O){var P=x.samples,C=g.samples,w=this.typeSupported,F={},k=!Object(t.isFiniteNumber)(this._initPTS),_="audio/mp4",B,N,U;if(k&&(B=N=1/0),x.config&&P.length){switch(x.timescale=x.samplerate,x.segmentCodec){case"mp3":w.mpeg?(_="audio/mpeg",x.codec=""):w.mp3&&(x.codec="mp3");break}F.audio={id:"audio",container:_,codec:x.codec,initSegment:x.segmentCodec==="mp3"&&w.mpeg?new Uint8Array(0):p.default.initSegment([x]),metadata:{channelCount:x.channelCount}},k&&(U=x.inputTimeScale,B=N=P[0].pts-Math.round(U*O))}if(g.sps&&g.pps&&C.length&&(g.timescale=g.inputTimeScale,F.video={id:"main",container:"video/mp4",codec:g.codec,initSegment:p.default.initSegment([g]),metadata:{width:g.width,height:g.height}},k)){U=g.inputTimeScale;var j=this.getVideoStartPts(C),W=Math.round(U*O);N=Math.min(N,u(C[0].dts,j)-W),B=Math.min(B,j-W)}if(Object.keys(F).length)return this.ISGenerated=!0,k&&(this._initPTS=B,this._initDTS=N),{tracks:F,initPTS:B,timescale:U}},S.remuxVideo=function(x,g,O,P){var C=x.inputTimeScale,w=x.samples,F=[],k=w.length,_=this._initPTS,B=this.nextAvcDts,N=8,U=this.videoSampleDuration,j,W,H=Number.POSITIVE_INFINITY,G=Number.NEGATIVE_INFINITY,K=0,X=!1;if(!O||B===null){var Z=g*C,z=w[0].pts-u(w[0].dts,w[0].pts);B=Z-z}for(var V=0;V<k;V++){var Y=w[V];if(Y.pts=u(Y.pts-_,B),Y.dts=u(Y.dts-_,B),Y.dts>Y.pts){var Q=18e3;K=Math.max(Math.min(K,Y.pts-Y.dts),-1*Q)}Y.dts<w[V>0?V-1:V].dts&&(X=!0)}X&&w.sort(function(Ut,Kt){var Jt=Ut.dts-Kt.dts,qt=Ut.pts-Kt.pts;return Jt||qt}),j=w[0].dts,W=w[w.length-1].dts;var $=W-j,J=$?Math.round($/(k-1)):U||x.inputTimeScale/30;if(K<0){if(K<J*-2){A.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(o.toMsFromMpegTsClock)(-J,!0)+" ms");for(var tt=K,rt=0;rt<k;rt++)w[rt].dts=tt=Math.max(tt,w[rt].pts-J),w[rt].pts=Math.max(tt,w[rt].pts)}else{A.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(o.toMsFromMpegTsClock)(K,!0)+" ms to overcome this issue");for(var nt=0;nt<k;nt++)w[nt].dts=w[nt].dts+K}j=w[0].dts}if(O){var it=j-B,at=it>J,ut=it<-1;if(at||ut){at?A.logger.warn("AVC: "+Object(o.toMsFromMpegTsClock)(it,!0)+" ms ("+it+"dts) hole between fragments detected, filling it"):A.logger.warn("AVC: "+Object(o.toMsFromMpegTsClock)(-it,!0)+" ms ("+it+"dts) overlapping between fragments detected"),j=B;var dt=w[0].pts-it;w[0].dts=j,w[0].pts=dt,A.logger.log("Video: First PTS/DTS adjusted: "+Object(o.toMsFromMpegTsClock)(dt,!0)+"/"+Object(o.toMsFromMpegTsClock)(j,!0)+", delta: "+Object(o.toMsFromMpegTsClock)(it,!0)+" ms")}}r&&(j=Math.max(0,j));for(var st=0,yt=0,vt=0;vt<k;vt++){for(var ct=w[vt],Et=ct.units,Tt=Et.length,xt=0,ot=0;ot<Tt;ot++)xt+=Et[ot].data.length;yt+=xt,st+=Tt,ct.length=xt,ct.dts=Math.max(ct.dts,j),ct.pts=Math.max(ct.pts,ct.dts,0),H=Math.min(ct.pts,H),G=Math.max(ct.pts,G)}W=w[k-1].dts;var ht=yt+4*st+8,pt;try{pt=new Uint8Array(ht)}catch{this.observer.emit(I.Events.ERROR,I.Events.ERROR,{type:b.ErrorTypes.MUX_ERROR,details:b.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:ht,reason:"fail allocating video mdat "+ht});return}var mt=new DataView(pt.buffer);mt.setUint32(0,ht),pt.set(p.default.types.mdat,4);for(var St=!1,ft=0;ft<k;ft++){for(var gt=w[ft],q=gt.units,At=0,It=0,Dt=q.length;It<Dt;It++){var Ct=q[It],Rt=Ct.data,Ot=Ct.data.byteLength;mt.setUint32(N,Ot),N+=4,pt.set(Rt,N),N+=Ot,At+=4+Ot}if(ft<k-1)U=w[ft+1].dts-gt.dts;else{var Mt=this.config,Pt=ft>0?gt.dts-w[ft-1].dts:J;if(Mt.stretchShortVideoTrack&&this.nextAudioPts!==null){var zt=Math.floor(Mt.maxBufferHole*C),Bt=(P?H+P*C:this.nextAudioPts)-gt.pts;Bt>zt?(U=Bt-Pt,U<0?U=Pt:St=!0,A.logger.log("[mp4-remuxer]: It is approximately "+Bt/90+" ms to the next segment; using duration "+U/90+" ms for the last video frame.")):U=Pt}else U=Pt}var Yt=Math.round(gt.pts-gt.dts);F.push(new i(gt.key,U,At,Yt))}if(F.length&&f&&f<70){var Wt=F[0].flags;Wt.dependsOn=2,Wt.isNonSync=0}console.assert(U!==null,"mp4SampleDuration must be computed"),U=St||!U?J:U,this.nextAvcDts=B=W+U,this.videoSampleDuration=U,this.isVideoContiguous=!0;var Xt=p.default.moof(x.sequenceNumber++,j,h({},x,{samples:F})),Qt="video",Zt={data1:Xt,data2:pt,startPTS:H/C,endPTS:(G+U)/C,startDTS:j/C,endDTS:B/C,type:Qt,hasAudio:!1,hasVideo:!0,nb:F.length,dropped:x.dropped};return x.samples=[],x.dropped=0,console.assert(pt.length,"MDAT length must not be zero"),Zt},S.remuxAudio=function(x,g,O,P,C){var w=x.inputTimeScale,F=x.samplerate?x.samplerate:w,k=w/F,_=x.segmentCodec==="aac"?m:T,B=_*k,N=this._initPTS,U=x.segmentCodec==="mp3"&&this.typeSupported.mpeg,j=[],W=C!==void 0,H=x.samples,G=U?0:8,K=this.nextAudioPts||-1,X=g*w;if(this.isAudioContiguous=O=O||H.length&&K>0&&(P&&Math.abs(X-K)<9e3||Math.abs(u(H[0].pts-N,X)-K)<20*B),H.forEach(function(Dt){Dt.pts=u(Dt.pts-N,X)}),!O||K<0){if(H=H.filter(function(Dt){return Dt.pts>=0}),!H.length)return;C===0?K=0:P&&!W?K=Math.max(0,X):K=H[0].pts}if(x.segmentCodec==="aac")for(var Z=this.config.maxAudioFramesDrift,z=0,V=K;z<H.length;z++){var Y=H[z],Q=Y.pts,$=Q-V,J=Math.abs(1e3*$/w);if($<=-Z*B&&W)z===0&&(A.logger.warn("Audio frame @ "+(Q/w).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*$/w)+" ms."),this.nextAudioPts=K=V=Q);else if($>=Z*B&&J<v&&W){var tt=Math.round($/B);V=Q-tt*B,V<0&&(tt--,V+=B),z===0&&(this.nextAudioPts=K=V),A.logger.warn("[mp4-remuxer]: Injecting "+tt+" audio frame @ "+(V/w).toFixed(3)+"s due to "+Math.round(1e3*$/w)+" ms gap.");for(var rt=0;rt<tt;rt++){var nt=Math.max(V,0),it=e.default.getSilentFrame(x.manifestCodec||x.codec,x.channelCount);it||(A.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),it=Y.unit.subarray()),H.splice(z,0,{unit:it,pts:nt}),V+=B,z++}}Y.pts=V,V+=B}for(var at=null,ut=null,dt,st=0,yt=H.length;yt--;)st+=H[yt].unit.byteLength;for(var vt=0,ct=H.length;vt<ct;vt++){var Et=H[vt],Tt=Et.unit,xt=Et.pts;if(ut!==null){var ot=j[vt-1];ot.duration=Math.round((xt-ut)/k)}else if(O&&x.segmentCodec==="aac"&&(xt=K),at=xt,st>0){st+=G;try{dt=new Uint8Array(st)}catch{this.observer.emit(I.Events.ERROR,I.Events.ERROR,{type:b.ErrorTypes.MUX_ERROR,details:b.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:st,reason:"fail allocating audio mdat "+st});return}if(!U){var ht=new DataView(dt.buffer);ht.setUint32(0,st),dt.set(p.default.types.mdat,4)}}else return;dt.set(Tt,G);var pt=Tt.byteLength;G+=pt,j.push(new i(!0,_,pt,0)),ut=xt}var mt=j.length;if(!!mt){var St=j[j.length-1];this.nextAudioPts=K=ut+k*St.duration;var ft=U?new Uint8Array(0):p.default.moof(x.sequenceNumber++,at/k,h({},x,{samples:j}));x.samples=[];var gt=at/w,q=K/w,At="audio",It={data1:ft,data2:dt,startPTS:gt,endPTS:q,startDTS:gt,endDTS:q,type:At,hasAudio:!0,hasVideo:!1,nb:mt};return this.isAudioContiguous=!0,console.assert(dt.length,"MDAT length must not be zero"),It}},S.remuxEmptyAudio=function(x,g,O,P){var C=x.inputTimeScale,w=x.samplerate?x.samplerate:C,F=C/w,k=this.nextAudioPts,_=(k!==null?k:P.startDTS*C)+this._initDTS,B=P.endDTS*C+this._initDTS,N=F*m,U=Math.ceil((B-_)/N),j=e.default.getSilentFrame(x.manifestCodec||x.codec,x.channelCount);if(A.logger.warn("[mp4-remuxer]: remux empty Audio"),!j){A.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var W=[],H=0;H<U;H++){var G=_+H*N;W.push({unit:j,pts:G,dts:G})}return x.samples=W,this.remuxAudio(x,g,O,!1)},E}();function u(E,S){var L;if(S===null)return E;for(S<E?L=-8589934592:L=8589934592;Math.abs(E-S)>4294967296;)E+=L;return E}function y(E){for(var S=0;S<E.length;S++)if(E[S].key)return S;return-1}function l(E,S,L,x){var g=E.samples.length;if(!!g){for(var O=E.inputTimeScale,P=0;P<g;P++){var C=E.samples[P];C.pts=u(C.pts-L,S*O)/O,C.dts=u(C.dts-x,S*O)/O}var w=E.samples;return E.samples=[],{samples:w}}}function a(E,S,L){var x=E.samples.length;if(!!x){for(var g=E.inputTimeScale,O=0;O<x;O++){var P=E.samples[O];P.pts=u(P.pts-L,S*g)/g}E.samples.sort(function(w,F){return w.pts-F.pts});var C=E.samples;return E.samples=[],{samples:C}}}var i=function(S,L,x,g){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=L,this.size=x,this.cts=g,this.flags=new D(S)},D=function(S){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=S?2:1,this.isNonSync=S?0:1}},"./src/remux/passthrough-remuxer.ts":function(R,M,s){s.r(M);var t=s("./src/polyfills/number.ts"),e=s("./src/remux/mp4-remuxer.ts"),p=s("./src/utils/mp4-tools.ts"),I=s("./src/loader/fragment.ts"),b=s("./src/utils/logger.ts"),A=function(){function h(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var v=h.prototype;return v.destroy=function(){},v.resetTimeStamp=function(T){this.initPTS=T,this.lastEndDTS=null},v.resetNextTimestamp=function(){this.lastEndDTS=null},v.resetInitSegment=function(T,f,n){this.audioCodec=f,this.videoCodec=n,this.generateInitSegment(T),this.emitInitSegment=!0},v.generateInitSegment=function(T){var f=this.audioCodec,n=this.videoCodec;if(!T||!T.byteLength){this.initTracks=void 0,this.initData=void 0;return}var r=this.initData=Object(p.parseInitSegment)(T);f||(f=o(r.audio,I.ElementaryStreamTypes.AUDIO)),n||(n=o(r.video,I.ElementaryStreamTypes.VIDEO));var d={};r.audio&&r.video?d.audiovideo={container:"video/mp4",codec:f+","+n,initSegment:T,id:"main"}:r.audio?d.audio={container:"audio/mp4",codec:f,initSegment:T,id:"audio"}:r.video?d.video={container:"video/mp4",codec:n,initSegment:T,id:"main"}:b.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=d},v.remux=function(T,f,n,r,d){var u,y=this.initPTS,l=this.lastEndDTS,a={audio:void 0,video:void 0,text:r,id3:n,initSegment:void 0};Object(t.isFiniteNumber)(l)||(l=this.lastEndDTS=d||0);var i=f.samples;if(!i||!i.length)return a;var D={initPTS:void 0,timescale:1},E=this.initData;if((!E||!E.length)&&(this.generateInitSegment(i),E=this.initData),!E||!E.length)return b.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),a;this.emitInitSegment&&(D.tracks=this.initTracks,this.emitInitSegment=!1),Object(t.isFiniteNumber)(y)||(this.initPTS=D.initPTS=y=c(E,i,l));var S=Object(p.getDuration)(i,E),L=l,x=S+L;Object(p.offsetStartDTS)(E,i,y),S>0?this.lastEndDTS=x:(b.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var g=!!E.audio,O=!!E.video,P="";g&&(P+="audio"),O&&(P+="video");var C={data1:i,startPTS:L,startDTS:L,endPTS:x,endDTS:x,type:P,hasAudio:g,hasVideo:O,nb:1,dropped:0};a.audio=C.type==="audio"?C:void 0,a.video=C.type!=="audio"?C:void 0,a.initSegment=D;var w=(u=this.initPTS)!=null?u:0;return a.id3=Object(e.flushTextTrackMetadataCueSamples)(n,d,w,w),r.samples.length&&(a.text=Object(e.flushTextTrackUserdataCueSamples)(r,d,w)),a},h}(),c=function(v,m,T){return Object(p.getStartDTS)(v,m)-T};function o(h,v){var m=h==null?void 0:h.codec;return m&&m.length>4?m:m==="hvc1"||m==="hev1"?"hvc1.1.c.L120.90":m==="av01"?"av01.0.04M.08":m==="avc1"||v===I.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}M.default=A},"./src/task-loop.ts":function(R,M,s){s.r(M),s.d(M,"default",function(){return t});var t=function(){function e(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var p=e.prototype;return p.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},p.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},p.onHandlerDestroyed=function(){},p.hasInterval=function(){return!!this._tickInterval},p.hasNextTick=function(){return!!this._tickTimer},p.setInterval=function(b){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,b),!0)},p.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},p.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},p.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},p.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},p.doTick=function(){},e}()},"./src/types/cmcd.ts":function(R,M,s){s.r(M),s.d(M,"CMCDVersion",function(){return t}),s.d(M,"CMCDObjectType",function(){return e}),s.d(M,"CMCDStreamingFormat",function(){return p}),s.d(M,"CMCDStreamType",function(){return I});var t=1,e;(function(b){b.MANIFEST="m",b.AUDIO="a",b.VIDEO="v",b.MUXED="av",b.INIT="i",b.CAPTION="c",b.TIMED_TEXT="tt",b.KEY="k",b.OTHER="o"})(e||(e={}));var p;(function(b){b.DASH="d",b.HLS="h",b.SMOOTH="s",b.OTHER="o"})(p||(p={}));var I;(function(b){b.VOD="v",b.LIVE="l"})(I||(I={}))},"./src/types/demuxer.ts":function(R,M,s){s.r(M),s.d(M,"MetadataSchema",function(){return t});var t;(function(e){e.audioId3="org.id3",e.dateRange="com.apple.quicktime.HLS",e.emsg="https://aomedia.org/emsg/ID3"})(t||(t={}))},"./src/types/level.ts":function(R,M,s){s.r(M),s.d(M,"HlsSkip",function(){return p}),s.d(M,"getSkipValue",function(){return I}),s.d(M,"HlsUrlParameters",function(){return b}),s.d(M,"Level",function(){return A});function t(c,o){for(var h=0;h<o.length;h++){var v=o[h];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(c,v.key,v)}}function e(c,o,h){return o&&t(c.prototype,o),h&&t(c,h),Object.defineProperty(c,"prototype",{writable:!1}),c}var p;(function(c){c.No="",c.Yes="YES",c.v2="v2"})(p||(p={}));function I(c,o){var h=c.canSkipUntil,v=c.canSkipDateRanges,m=c.endSN,T=o!==void 0?o-m:0;return h&&T<h?v?p.v2:p.Yes:p.No}var b=function(){function c(h,v,m){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=h,this.part=v,this.skip=m}var o=c.prototype;return o.addDirectives=function(v){var m=new self.URL(v);return this.msn!==void 0&&m.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&m.searchParams.set("_HLS_part",this.part.toString()),this.skip&&m.searchParams.set("_HLS_skip",this.skip),m.toString()},c}(),A=function(){function c(o){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[o.url],this.attrs=o.attrs,this.bitrate=o.bitrate,o.details&&(this.details=o.details),this.id=o.id||0,this.name=o.name,this.width=o.width||0,this.height=o.height||0,this.audioCodec=o.audioCodec,this.videoCodec=o.videoCodec,this.unknownCodecs=o.unknownCodecs,this.codecSet=[o.videoCodec,o.audioCodec].filter(function(h){return h}).join(",").replace(/\.[^.,]+/g,"")}return e(c,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(h){var v=h%this.url.length;this._urlId!==v&&(this.details=void 0,this._urlId=v)}}]),c}()},"./src/types/loader.ts":function(R,M,s){s.r(M),s.d(M,"PlaylistContextType",function(){return t}),s.d(M,"PlaylistLevelType",function(){return e});var t;(function(p){p.MANIFEST="manifest",p.LEVEL="level",p.AUDIO_TRACK="audioTrack",p.SUBTITLE_TRACK="subtitleTrack"})(t||(t={}));var e;(function(p){p.MAIN="main",p.AUDIO="audio",p.SUBTITLE="subtitle"})(e||(e={}))},"./src/types/transmuxer.ts":function(R,M,s){s.r(M),s.d(M,"ChunkMetadata",function(){return t});var t=function(I,b,A,c,o,h){c===void 0&&(c=0),o===void 0&&(o=-1),h===void 0&&(h=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=e(),this.buffering={audio:e(),video:e(),audiovideo:e()},this.level=I,this.sn=b,this.id=A,this.size=c,this.part=o,this.partial=h};function e(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":function(R,M,s){s.r(M),s.d(M,"AttrList",function(){return p});var t=/^(\d+)x(\d+)$/,e=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,p=function(){function I(A){typeof A=="string"&&(A=I.parseAttrList(A));for(var c in A)A.hasOwnProperty(c)&&(this[c]=A[c])}var b=I.prototype;return b.decimalInteger=function(c){var o=parseInt(this[c],10);return o>Number.MAX_SAFE_INTEGER?1/0:o},b.hexadecimalInteger=function(c){if(this[c]){var o=(this[c]||"0x").slice(2);o=(o.length&1?"0":"")+o;for(var h=new Uint8Array(o.length/2),v=0;v<o.length/2;v++)h[v]=parseInt(o.slice(v*2,v*2+2),16);return h}else return null},b.hexadecimalIntegerAsNumber=function(c){var o=parseInt(this[c],16);return o>Number.MAX_SAFE_INTEGER?1/0:o},b.decimalFloatingPoint=function(c){return parseFloat(this[c])},b.optionalFloat=function(c,o){var h=this[c];return h?parseFloat(h):o},b.enumeratedString=function(c){return this[c]},b.bool=function(c){return this[c]==="YES"},b.decimalResolution=function(c){var o=t.exec(this[c]);if(o!==null)return{width:parseInt(o[1],10),height:parseInt(o[2],10)}},I.parseAttrList=function(c){var o,h={},v='"';for(e.lastIndex=0;(o=e.exec(c))!==null;){var m=o[2];m.indexOf(v)===0&&m.lastIndexOf(v)===m.length-1&&(m=m.slice(1,-1)),h[o[1]]=m}return h},I}()},"./src/utils/binary-search.ts":function(R,M,s){s.r(M);var t={search:function(p,I){for(var b=0,A=p.length-1,c=null,o=null;b<=A;){c=(b+A)/2|0,o=p[c];var h=I(o);if(h>0)b=c+1;else if(h<0)A=c-1;else return o}return null}};M.default=t},"./src/utils/buffer-helper.ts":function(R,M,s){s.r(M),s.d(M,"BufferHelper",function(){return p});var t=s("./src/utils/logger.ts"),e={length:0,start:function(){return 0},end:function(){return 0}},p=function(){function I(){}return I.isBuffered=function(A,c){try{if(A){for(var o=I.getBuffered(A),h=0;h<o.length;h++)if(c>=o.start(h)&&c<=o.end(h))return!0}}catch{}return!1},I.bufferInfo=function(A,c,o){try{if(A){var h=I.getBuffered(A),v=[],m;for(m=0;m<h.length;m++)v.push({start:h.start(m),end:h.end(m)});return this.bufferedInfo(v,c,o)}}catch{}return{len:0,start:c,end:c,nextStart:void 0}},I.bufferedInfo=function(A,c,o){c=Math.max(0,c),A.sort(function(a,i){var D=a.start-i.start;return D||i.end-a.end});var h=[];if(o)for(var v=0;v<A.length;v++){var m=h.length;if(m){var T=h[m-1].end;A[v].start-T<o?A[v].end>T&&(h[m-1].end=A[v].end):h.push(A[v])}else h.push(A[v])}else h=A;for(var f=0,n,r=c,d=c,u=0;u<h.length;u++){var y=h[u].start,l=h[u].end;if(c+o>=y&&c<l)r=y,d=l,f=d-c;else if(c+o<y){n=y;break}}return{len:f,start:r||0,end:d||0,nextStart:n}},I.getBuffered=function(A){try{return A.buffered}catch(c){return t.logger.log("failed to get media.buffered",c),e}},I}()},"./src/utils/cea-608-parser.ts":function(R,M,s){s.r(M),s.d(M,"Row",function(){return d}),s.d(M,"CaptionScreen",function(){return u});var t=s("./src/utils/logger.ts"),e={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},p=function(S){var L=S;return e.hasOwnProperty(S)&&(L=e[S]),String.fromCharCode(L)},I=15,b=100,A={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},c={17:2,18:4,21:6,22:8,23:10,19:13,20:15},o={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},h={25:2,26:4,29:6,30:8,31:10,27:13,28:15},v=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],m;(function(E){E[E.ERROR=0]="ERROR",E[E.TEXT=1]="TEXT",E[E.WARNING=2]="WARNING",E[E.INFO=2]="INFO",E[E.DEBUG=3]="DEBUG",E[E.DATA=3]="DATA"})(m||(m={}));var T=function(){function E(){this.time=null,this.verboseLevel=m.ERROR}var S=E.prototype;return S.log=function(x,g){this.verboseLevel>=x&&t.logger.log(this.time+" ["+x+"] "+g)},E}(),f=function(S){for(var L=[],x=0;x<S.length;x++)L.push(S[x].toString(16));return L},n=function(){function E(L,x,g,O,P){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=L||"white",this.underline=x||!1,this.italics=g||!1,this.background=O||"black",this.flash=P||!1}var S=E.prototype;return S.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},S.setStyles=function(x){for(var g=["foreground","underline","italics","background","flash"],O=0;O<g.length;O++){var P=g[O];x.hasOwnProperty(P)&&(this[P]=x[P])}},S.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},S.equals=function(x){return this.foreground===x.foreground&&this.underline===x.underline&&this.italics===x.italics&&this.background===x.background&&this.flash===x.flash},S.copy=function(x){this.foreground=x.foreground,this.underline=x.underline,this.italics=x.italics,this.background=x.background,this.flash=x.flash},S.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},E}(),r=function(){function E(L,x,g,O,P,C){this.uchar=void 0,this.penState=void 0,this.uchar=L||" ",this.penState=new n(x,g,O,P,C)}var S=E.prototype;return S.reset=function(){this.uchar=" ",this.penState.reset()},S.setChar=function(x,g){this.uchar=x,this.penState.copy(g)},S.setPenState=function(x){this.penState.copy(x)},S.equals=function(x){return this.uchar===x.uchar&&this.penState.equals(x.penState)},S.copy=function(x){this.uchar=x.uchar,this.penState.copy(x.penState)},S.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},E}(),d=function(){function E(L){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var x=0;x<b;x++)this.chars.push(new r);this.logger=L,this.pos=0,this.currPenState=new n}var S=E.prototype;return S.equals=function(x){for(var g=!0,O=0;O<b;O++)if(!this.chars[O].equals(x.chars[O])){g=!1;break}return g},S.copy=function(x){for(var g=0;g<b;g++)this.chars[g].copy(x.chars[g])},S.isEmpty=function(){for(var x=!0,g=0;g<b;g++)if(!this.chars[g].isEmpty()){x=!1;break}return x},S.setCursor=function(x){this.pos!==x&&(this.pos=x),this.pos<0?(this.logger.log(m.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>b&&(this.logger.log(m.DEBUG,"Too large cursor position "+this.pos),this.pos=b)},S.moveCursor=function(x){var g=this.pos+x;if(x>1)for(var O=this.pos+1;O<g+1;O++)this.chars[O].setPenState(this.currPenState);this.setCursor(g)},S.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},S.insertChar=function(x){x>=144&&this.backSpace();var g=p(x);if(this.pos>=b){this.logger.log(m.ERROR,"Cannot insert "+x.toString(16)+" ("+g+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(g,this.currPenState),this.moveCursor(1)},S.clearFromPos=function(x){var g;for(g=x;g<b;g++)this.chars[g].reset()},S.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},S.clearToEndOfRow=function(){this.clearFromPos(this.pos)},S.getTextString=function(){for(var x=[],g=!0,O=0;O<b;O++){var P=this.chars[O].uchar;P!==" "&&(g=!1),x.push(P)}return g?"":x.join("")},S.setPenStyles=function(x){this.currPenState.setStyles(x);var g=this.chars[this.pos];g.setPenState(this.currPenState)},E}(),u=function(){function E(L){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var x=0;x<I;x++)this.rows.push(new d(L));this.logger=L,this.currRow=I-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var S=E.prototype;return S.reset=function(){for(var x=0;x<I;x++)this.rows[x].clear();this.currRow=I-1},S.equals=function(x){for(var g=!0,O=0;O<I;O++)if(!this.rows[O].equals(x.rows[O])){g=!1;break}return g},S.copy=function(x){for(var g=0;g<I;g++)this.rows[g].copy(x.rows[g])},S.isEmpty=function(){for(var x=!0,g=0;g<I;g++)if(!this.rows[g].isEmpty()){x=!1;break}return x},S.backSpace=function(){var x=this.rows[this.currRow];x.backSpace()},S.clearToEndOfRow=function(){var x=this.rows[this.currRow];x.clearToEndOfRow()},S.insertChar=function(x){var g=this.rows[this.currRow];g.insertChar(x)},S.setPen=function(x){var g=this.rows[this.currRow];g.setPenStyles(x)},S.moveCursor=function(x){var g=this.rows[this.currRow];g.moveCursor(x)},S.setCursor=function(x){this.logger.log(m.INFO,"setCursor: "+x);var g=this.rows[this.currRow];g.setCursor(x)},S.setPAC=function(x){this.logger.log(m.INFO,"pacData = "+JSON.stringify(x));var g=x.row-1;if(this.nrRollUpRows&&g<this.nrRollUpRows-1&&(g=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==g){for(var O=0;O<I;O++)this.rows[O].clear();var P=this.currRow+1-this.nrRollUpRows,C=this.lastOutputScreen;if(C){var w=C.rows[P].cueStartTime,F=this.logger.time;if(w&&F!==null&&w<F)for(var k=0;k<this.nrRollUpRows;k++)this.rows[g-this.nrRollUpRows+k+1].copy(C.rows[P+k])}}this.currRow=g;var _=this.rows[this.currRow];if(x.indent!==null){var B=x.indent,N=Math.max(B-1,0);_.setCursor(x.indent),x.color=_.chars[N].penState.foreground}var U={foreground:x.color,underline:x.underline,italics:x.italics,background:"black",flash:!1};this.setPen(U)},S.setBkgData=function(x){this.logger.log(m.INFO,"bkgData = "+JSON.stringify(x)),this.backSpace(),this.setPen(x),this.insertChar(32)},S.setRollUpRows=function(x){this.nrRollUpRows=x},S.rollUp=function(){if(this.nrRollUpRows===null){this.logger.log(m.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(m.TEXT,this.getDisplayText());var x=this.currRow+1-this.nrRollUpRows,g=this.rows.splice(x,1)[0];g.clear(),this.rows.splice(this.currRow,0,g),this.logger.log(m.INFO,"Rolling up")},S.getDisplayText=function(x){x=x||!1;for(var g=[],O="",P=-1,C=0;C<I;C++){var w=this.rows[C].getTextString();w&&(P=C+1,x?g.push("Row "+P+": '"+w+"'"):g.push(w.trim()))}return g.length>0&&(x?O="["+g.join(" | ")+"]":O=g.join(`
`)),O},S.getTextAndFormat=function(){return this.rows},E}(),y=function(){function E(L,x,g){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=L,this.outputFilter=x,this.mode=null,this.verbose=0,this.displayedMemory=new u(g),this.nonDisplayedMemory=new u(g),this.lastOutputScreen=new u(g),this.currRollUpRow=this.displayedMemory.rows[I-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=g}var S=E.prototype;return S.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[I-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},S.getHandler=function(){return this.outputFilter},S.setHandler=function(x){this.outputFilter=x},S.setPAC=function(x){this.writeScreen.setPAC(x)},S.setBkgData=function(x){this.writeScreen.setBkgData(x)},S.setMode=function(x){x!==this.mode&&(this.mode=x,this.logger.log(m.INFO,"MODE="+x),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=x)},S.insertChars=function(x){for(var g=0;g<x.length;g++)this.writeScreen.insertChar(x[g]);var O=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(m.INFO,O+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(m.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},S.ccRCL=function(){this.logger.log(m.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},S.ccBS=function(){this.logger.log(m.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},S.ccAOF=function(){},S.ccAON=function(){},S.ccDER=function(){this.logger.log(m.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},S.ccRU=function(x){this.logger.log(m.INFO,"RU("+x+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(x)},S.ccFON=function(){this.logger.log(m.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},S.ccRDC=function(){this.logger.log(m.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},S.ccTR=function(){this.logger.log(m.INFO,"TR"),this.setMode("MODE_TEXT")},S.ccRTD=function(){this.logger.log(m.INFO,"RTD"),this.setMode("MODE_TEXT")},S.ccEDM=function(){this.logger.log(m.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},S.ccCR=function(){this.logger.log(m.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},S.ccENM=function(){this.logger.log(m.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},S.ccEOC=function(){if(this.logger.log(m.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var x=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=x,this.writeScreen=this.nonDisplayedMemory,this.logger.log(m.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},S.ccTO=function(x){this.logger.log(m.INFO,"TO("+x+") - Tab Offset"),this.writeScreen.moveCursor(x)},S.ccMIDROW=function(x){var g={flash:!1};if(g.underline=x%2===1,g.italics=x>=46,g.italics)g.foreground="white";else{var O=Math.floor(x/2)-16,P=["white","green","blue","cyan","red","yellow","magenta"];g.foreground=P[O]}this.logger.log(m.INFO,"MIDROW: "+JSON.stringify(g)),this.writeScreen.setPen(g)},S.outputDataUpdate=function(x){x===void 0&&(x=!1);var g=this.logger.time;g!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=g:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,g,this.lastOutputScreen),x&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:g),this.lastOutputScreen.copy(this.displayedMemory))},S.cueSplitAtTime=function(x){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,x,this.displayedMemory),this.cueStartTime=x))},E}(),l=function(){function E(L,x,g){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var O=new T;this.channels=[null,new y(L,x,O),new y(L+1,g,O)],this.cmdHistory=D(),this.logger=O}var S=E.prototype;return S.getHandler=function(x){return this.channels[x].getHandler()},S.setHandler=function(x,g){this.channels[x].setHandler(g)},S.addData=function(x,g){var O,P,C,w=!1;this.logger.time=x;for(var F=0;F<g.length;F+=2)if(P=g[F]&127,C=g[F+1]&127,!(P===0&&C===0)){if(this.logger.log(m.DATA,"["+f([g[F],g[F+1]])+"] -> ("+f([P,C])+")"),O=this.parseCmd(P,C),O||(O=this.parseMidrow(P,C)),O||(O=this.parsePAC(P,C)),O||(O=this.parseBackgroundAttributes(P,C)),!O&&(w=this.parseChars(P,C),w)){var k=this.currentChannel;if(k&&k>0){var _=this.channels[k];_.insertChars(w)}else this.logger.log(m.WARNING,"No channel found yet. TEXT-MODE?")}!O&&!w&&this.logger.log(m.WARNING,"Couldn't parse cleaned data "+f([P,C])+" orig: "+f([g[F],g[F+1]]))}},S.parseCmd=function(x,g){var O=this.cmdHistory,P=(x===20||x===28||x===21||x===29)&&g>=32&&g<=47,C=(x===23||x===31)&&g>=33&&g<=35;if(!(P||C))return!1;if(i(x,g,O))return a(null,null,O),this.logger.log(m.DEBUG,"Repeated command ("+f([x,g])+") is dropped"),!0;var w=x===20||x===21||x===23?1:2,F=this.channels[w];return x===20||x===21||x===28||x===29?g===32?F.ccRCL():g===33?F.ccBS():g===34?F.ccAOF():g===35?F.ccAON():g===36?F.ccDER():g===37?F.ccRU(2):g===38?F.ccRU(3):g===39?F.ccRU(4):g===40?F.ccFON():g===41?F.ccRDC():g===42?F.ccTR():g===43?F.ccRTD():g===44?F.ccEDM():g===45?F.ccCR():g===46?F.ccENM():g===47&&F.ccEOC():F.ccTO(g-32),a(x,g,O),this.currentChannel=w,!0},S.parseMidrow=function(x,g){var O=0;if((x===17||x===25)&&g>=32&&g<=47){if(x===17?O=1:O=2,O!==this.currentChannel)return this.logger.log(m.ERROR,"Mismatch channel in midrow parsing"),!1;var P=this.channels[O];return P?(P.ccMIDROW(g),this.logger.log(m.DEBUG,"MIDROW ("+f([x,g])+")"),!0):!1}return!1},S.parsePAC=function(x,g){var O,P=this.cmdHistory,C=(x>=17&&x<=23||x>=25&&x<=31)&&g>=64&&g<=127,w=(x===16||x===24)&&g>=64&&g<=95;if(!(C||w))return!1;if(i(x,g,P))return a(null,null,P),!0;var F=x<=23?1:2;g>=64&&g<=95?O=F===1?A[x]:o[x]:O=F===1?c[x]:h[x];var k=this.channels[F];return k?(k.setPAC(this.interpretPAC(O,g)),a(x,g,P),this.currentChannel=F,!0):!1},S.interpretPAC=function(x,g){var O,P={color:null,italics:!1,indent:null,underline:!1,row:x};return g>95?O=g-96:O=g-64,P.underline=(O&1)===1,O<=13?P.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(O/2)]:O<=15?(P.italics=!0,P.color="white"):P.indent=Math.floor((O-16)/2)*4,P},S.parseChars=function(x,g){var O,P=null,C=null;if(x>=25?(O=2,C=x-8):(O=1,C=x),C>=17&&C<=19){var w;C===17?w=g+80:C===18?w=g+112:w=g+144,this.logger.log(m.INFO,"Special char '"+p(w)+"' in channel "+O),P=[w]}else x>=32&&x<=127&&(P=g===0?[x]:[x,g]);if(P){var F=f(P);this.logger.log(m.DEBUG,"Char codes =  "+F.join(",")),a(x,g,this.cmdHistory)}return P},S.parseBackgroundAttributes=function(x,g){var O=(x===16||x===24)&&g>=32&&g<=47,P=(x===23||x===31)&&g>=45&&g<=47;if(!(O||P))return!1;var C,w={};x===16||x===24?(C=Math.floor((g-32)/2),w.background=v[C],g%2===1&&(w.background=w.background+"_semi")):g===45?w.background="transparent":(w.foreground="black",g===47&&(w.underline=!0));var F=x<=23?1:2,k=this.channels[F];return k.setBkgData(w),a(x,g,this.cmdHistory),!0},S.reset=function(){for(var x=0;x<Object.keys(this.channels).length;x++){var g=this.channels[x];g&&g.reset()}this.cmdHistory=D()},S.cueSplitAtTime=function(x){for(var g=0;g<this.channels.length;g++){var O=this.channels[g];O&&O.cueSplitAtTime(x)}},E}();function a(E,S,L){L.a=E,L.b=S}function i(E,S,L){return L.a===E&&L.b===S}function D(){return{a:null,b:null}}M.default=l},"./src/utils/codecs.ts":function(R,M,s){s.r(M),s.d(M,"isCodecType",function(){return e}),s.d(M,"isCodecSupportedInMp4",function(){return p});var t={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function e(I,b){var A=t[b];return!!A&&A[I.slice(0,4)]===!0}function p(I,b){return MediaSource.isTypeSupported((b||"video")+'/mp4;codecs="'+I+'"')}},"./src/utils/cues.ts":function(R,M,s){s.r(M);var t=s("./src/utils/vttparser.ts"),e=s("./src/utils/webvtt-parser.ts"),p=s("./src/utils/texttrack-utils.ts"),I=/\s/,b={newCue:function(c,o,h,v){for(var m=[],T,f,n,r,d,u=self.VTTCue||self.TextTrackCue,y=0;y<v.rows.length;y++)if(T=v.rows[y],n=!0,r=0,d="",!T.isEmpty()){for(var l=0;l<T.chars.length;l++)I.test(T.chars[l].uchar)&&n?r++:(d+=T.chars[l].uchar,n=!1);T.cueStartTime=o,o===h&&(h+=1e-4),r>=16?r--:r++;var a=Object(t.fixLineBreaks)(d.trim()),i=Object(e.generateCueId)(o,h,a);(!c||!c.cues||!c.cues.getCueById(i))&&(f=new u(o,h,a),f.id=i,f.line=y+1,f.align="left",f.position=10+Math.min(80,Math.floor(r*8/32)*10),m.push(f))}return c&&m.length&&(m.sort(function(D,E){return D.line==="auto"||E.line==="auto"?0:D.line>8&&E.line>8?E.line-D.line:D.line-E.line}),m.forEach(function(D){return Object(p.addCueToTrack)(c,D)})),m}};M.default=b},"./src/utils/discontinuities.ts":function(R,M,s){s.r(M),s.d(M,"findFirstFragWithCC",function(){return I}),s.d(M,"shouldAlignOnDiscontinuities",function(){return b}),s.d(M,"findDiscontinuousReferenceFrag",function(){return A}),s.d(M,"adjustSlidingStart",function(){return o}),s.d(M,"alignStream",function(){return h}),s.d(M,"alignPDT",function(){return m}),s.d(M,"alignFragmentByPDTDelta",function(){return T}),s.d(M,"alignMediaPlaylistByPDT",function(){return f});var t=s("./src/polyfills/number.ts"),e=s("./src/utils/logger.ts"),p=s("./src/controller/level-helper.ts");function I(n,r){for(var d=null,u=0,y=n.length;u<y;u++){var l=n[u];if(l&&l.cc===r){d=l;break}}return d}function b(n,r,d){return!!(r.details&&(d.endCC>d.startCC||n&&n.cc<d.startCC))}function A(n,r){var d=n.fragments,u=r.fragments;if(!u.length||!d.length){e.logger.log("No fragments to align");return}var y=I(d,u[0].cc);if(!y||y&&!y.startPTS){e.logger.log("No frag in previous level to align on");return}return y}function c(n,r){if(n){var d=n.start+r;n.start=n.startPTS=d,n.endPTS=d+n.duration}}function o(n,r){for(var d=r.fragments,u=0,y=d.length;u<y;u++)c(d[u],n);r.fragmentHint&&c(r.fragmentHint,n),r.alignedSliding=!0}function h(n,r,d){!r||(v(n,d,r),!d.alignedSliding&&r.details&&m(d,r.details),!d.alignedSliding&&r.details&&!d.skippedSegments&&Object(p.adjustSliding)(r.details,d))}function v(n,r,d){if(b(n,d,r)){var u=A(d.details,r);u&&Object(t.isFiniteNumber)(u.start)&&(e.logger.log("Adjusting PTS using last level due to CC increase within current level "+r.url),o(u.start,r))}}function m(n,r){if(!(!r.fragments.length||!n.hasProgramDateTime||!r.hasProgramDateTime)){var d=r.fragments[0].programDateTime,u=n.fragments[0].programDateTime,y=(u-d)/1e3+r.fragments[0].start;y&&Object(t.isFiniteNumber)(y)&&(e.logger.log("Adjusting PTS using programDateTime delta "+(u-d)+"ms, sliding:"+y.toFixed(3)+" "+n.url+" "),o(y,n))}}function T(n,r){var d=n.programDateTime;if(!!d){var u=(d-r)/1e3;n.start=n.startPTS=u,n.endPTS=u+n.duration}}function f(n,r){if(!(!r.fragments.length||!n.hasProgramDateTime||!r.hasProgramDateTime)){var d=r.fragments[0].programDateTime,u=r.fragments[0].start,y=d-u*1e3;n.fragments.forEach(function(l){T(l,y)}),n.fragmentHint&&T(n.fragmentHint,y),n.alignedSliding=!0}}},"./src/utils/ewma-bandwidth-estimator.ts":function(R,M,s){s.r(M);var t=s("./src/utils/ewma.ts"),e=function(){function p(b,A,c){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=c,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new t.default(b),this.fast_=new t.default(A)}var I=p.prototype;return I.update=function(A,c){var o=this.slow_,h=this.fast_;this.slow_.halfLife!==A&&(this.slow_=new t.default(A,o.getEstimate(),o.getTotalWeight())),this.fast_.halfLife!==c&&(this.fast_=new t.default(c,h.getEstimate(),h.getTotalWeight()))},I.sample=function(A,c){A=Math.max(A,this.minDelayMs_);var o=8*c,h=A/1e3,v=o/h;this.fast_.sample(h,v),this.slow_.sample(h,v)},I.canEstimate=function(){var A=this.fast_;return A&&A.getTotalWeight()>=this.minWeight_},I.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},I.destroy=function(){},p}();M.default=e},"./src/utils/ewma.ts":function(R,M,s){s.r(M);var t=function(){function e(I,b,A){b===void 0&&(b=0),A===void 0&&(A=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=I,this.alpha_=I?Math.exp(Math.log(.5)/I):0,this.estimate_=b,this.totalWeight_=A}var p=e.prototype;return p.sample=function(b,A){var c=Math.pow(this.alpha_,b);this.estimate_=A*(1-c)+c*this.estimate_,this.totalWeight_+=b},p.getTotalWeight=function(){return this.totalWeight_},p.getEstimate=function(){if(this.alpha_){var b=1-Math.pow(this.alpha_,this.totalWeight_);if(b)return this.estimate_/b}return this.estimate_},e}();M.default=t},"./src/utils/fetch-loader.ts":function(R,M,s){s.r(M),s.d(M,"fetchSupported",function(){return T});var t=s("./src/polyfills/number.ts"),e=s("./src/loader/load-stats.ts"),p=s("./src/demux/chunk-cache.ts");function I(u,y){u.prototype=Object.create(y.prototype),u.prototype.constructor=u,h(u,y)}function b(u){var y=typeof Map=="function"?new Map:void 0;return b=function(a){if(a===null||!o(a))return a;if(typeof a!="function")throw new TypeError("Super expression must either be null or a function");if(typeof y<"u"){if(y.has(a))return y.get(a);y.set(a,i)}function i(){return A(a,arguments,v(this).constructor)}return i.prototype=Object.create(a.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),h(i,a)},b(u)}function A(u,y,l){return c()?A=Reflect.construct.bind():A=function(i,D,E){var S=[null];S.push.apply(S,D);var L=Function.bind.apply(i,S),x=new L;return E&&h(x,E.prototype),x},A.apply(null,arguments)}function c(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function o(u){return Function.toString.call(u).indexOf("[native code]")!==-1}function h(u,y){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,i){return a.__proto__=i,a},h(u,y)}function v(u){return v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(l){return l.__proto__||Object.getPrototypeOf(l)},v(u)}function m(){return m=Object.assign?Object.assign.bind():function(u){for(var y=1;y<arguments.length;y++){var l=arguments[y];for(var a in l)Object.prototype.hasOwnProperty.call(l,a)&&(u[a]=l[a])}return u},m.apply(this,arguments)}function T(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var f=function(){function u(l){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=l.fetchSetup||r,this.controller=new self.AbortController,this.stats=new e.LoadStats}var y=u.prototype;return y.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},y.abortInternal=function(){var a=this.response;(!a||!a.ok)&&(this.stats.aborted=!0,this.controller.abort())},y.abort=function(){var a;this.abortInternal(),(a=this.callbacks)!==null&&a!==void 0&&a.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},y.load=function(a,i,D){var E=this,S=this.stats;if(S.loading.start)throw new Error("Loader can only be used once.");S.loading.start=self.performance.now();var L=n(a,this.controller.signal),x=D.onProgress,g=a.responseType==="arraybuffer",O=g?"byteLength":"length";this.context=a,this.config=i,this.callbacks=D,this.request=this.fetchSetup(a,L),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){E.abortInternal(),D.onTimeout(S,a,E.response)},i.timeout),self.fetch(this.request).then(function(P){if(E.response=E.loader=P,!P.ok){var C=P.status,w=P.statusText;throw new d(w||"fetch, bad network response",C,P)}return S.loading.first=Math.max(self.performance.now(),S.loading.start),S.total=parseInt(P.headers.get("Content-Length")||"0"),x&&Object(t.isFiniteNumber)(i.highWaterMark)?E.loadProgressively(P,S,a,i.highWaterMark,x):g?P.arrayBuffer():P.text()}).then(function(P){var C=E.response;self.clearTimeout(E.requestTimeout),S.loading.end=Math.max(self.performance.now(),S.loading.first),S.loaded=S.total=P[O];var w={url:C.url,data:P};x&&!Object(t.isFiniteNumber)(i.highWaterMark)&&x(S,a,P,C),D.onSuccess(w,S,a,C)}).catch(function(P){if(self.clearTimeout(E.requestTimeout),!S.aborted){var C=P&&P.code||0,w=P?P.message:null;D.onError({code:C,text:w},a,P?P.details:null)}})},y.getCacheAge=function(){var a=null;if(this.response){var i=this.response.headers.get("age");a=i?parseFloat(i):null}return a},y.loadProgressively=function(a,i,D,E,S){E===void 0&&(E=0);var L=new p.default,x=a.body.getReader(),g=function O(){return x.read().then(function(P){if(P.done)return L.dataLength&&S(i,D,L.flush(),a),Promise.resolve(new ArrayBuffer(0));var C=P.value,w=C.length;return i.loaded+=w,w<E||L.dataLength?(L.push(C),L.dataLength>=E&&S(i,D,L.flush(),a)):S(i,D,C,a),O()}).catch(function(){return Promise.reject()})};return g()},u}();function n(u,y){var l={method:"GET",mode:"cors",credentials:"same-origin",signal:y,headers:new self.Headers(m({},u.headers))};return u.rangeEnd&&l.headers.set("Range","bytes="+u.rangeStart+"-"+String(u.rangeEnd-1)),l}function r(u,y){return new self.Request(u.url,y)}var d=function(u){I(y,u);function y(l,a,i){var D;return D=u.call(this,l)||this,D.code=void 0,D.details=void 0,D.code=a,D.details=i,D}return y}(b(Error));M.default=f},"./src/utils/imsc1-ttml-parser.ts":function(R,M,s){s.r(M),s.d(M,"IMSC1_CODEC",function(){return o}),s.d(M,"parseIMSC1",function(){return T});var t=s("./src/utils/mp4-tools.ts"),e=s("./src/utils/vttparser.ts"),p=s("./src/utils/vttcue.ts"),I=s("./src/demux/id3.ts"),b=s("./src/utils/timescale-conversion.ts"),A=s("./src/utils/webvtt-parser.ts");function c(){return c=Object.assign?Object.assign.bind():function(E){for(var S=1;S<arguments.length;S++){var L=arguments[S];for(var x in L)Object.prototype.hasOwnProperty.call(L,x)&&(E[x]=L[x])}return E},c.apply(this,arguments)}var o="stpp.ttml.im1t",h=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,v=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,m={left:"start",center:"center",right:"end",start:"start",end:"end"};function T(E,S,L,x,g){var O=Object(t.findBox)(new Uint8Array(E),["mdat"]);if(O.length===0){g(new Error("Could not parse IMSC1 mdat"));return}var P=O.map(function(w){return Object(I.utf8ArrayToStr)(w)}),C=Object(b.toTimescaleFromScale)(S,1,L);try{P.forEach(function(w){return x(f(w,C))})}catch(w){g(w)}}function f(E,S){var L=new DOMParser,x=L.parseFromString(E,"text/xml"),g=x.getElementsByTagName("tt")[0];if(!g)throw new Error("Invalid ttml");var O={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},P=Object.keys(O).reduce(function(_,B){return _[B]=g.getAttribute("ttp:"+B)||O[B],_},{}),C=g.getAttribute("xml:space")!=="preserve",w=r(n(g,"styling","style")),F=r(n(g,"layout","region")),k=n(g,"body","[begin]");return[].map.call(k,function(_){var B=d(_,C);if(!B||!_.hasAttribute("begin"))return null;var N=a(_.getAttribute("begin"),P),U=a(_.getAttribute("dur"),P),j=a(_.getAttribute("end"),P);if(N===null)throw l(_);if(j===null){if(U===null)throw l(_);j=N+U}var W=new p.default(N-S,j-S,B);W.id=Object(A.generateCueId)(W.startTime,W.endTime,W.text);var H=F[_.getAttribute("region")],G=w[_.getAttribute("style")];W.position=10,W.size=80;var K=u(H,G,w),X=K.textAlign;if(X){var Z=m[X];Z&&(W.lineAlign=Z),W.align=X}return c(W,K),W}).filter(function(_){return _!==null})}function n(E,S,L){var x=E.getElementsByTagName(S)[0];return x?[].slice.call(x.querySelectorAll(L)):[]}function r(E){return E.reduce(function(S,L){var x=L.getAttribute("xml:id");return x&&(S[x]=L),S},{})}function d(E,S){return[].slice.call(E.childNodes).reduce(function(L,x,g){var O;return x.nodeName==="br"&&g?L+`
`:(O=x.childNodes)!==null&&O!==void 0&&O.length?d(x,S):S?L+x.textContent.trim().replace(/\s+/g," "):L+x.textContent},"")}function u(E,S,L){var x="http://www.w3.org/ns/ttml#styling",g=null,O=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],P=E!=null&&E.hasAttribute("style")?E.getAttribute("style"):null;return P&&L.hasOwnProperty(P)&&(g=L[P]),O.reduce(function(C,w){var F=y(S,x,w)||y(E,x,w)||y(g,x,w);return F&&(C[w]=F),C},{})}function y(E,S,L){return E&&E.hasAttributeNS(S,L)?E.getAttributeNS(S,L):null}function l(E){return new Error("Could not parse ttml timestamp "+E)}function a(E,S){if(!E)return null;var L=Object(e.parseTimeStamp)(E);return L===null&&(h.test(E)?L=i(E,S):v.test(E)&&(L=D(E,S))),L}function i(E,S){var L=h.exec(E),x=(L[4]|0)+(L[5]|0)/S.subFrameRate;return(L[1]|0)*3600+(L[2]|0)*60+(L[3]|0)+x/S.frameRate}function D(E,S){var L=v.exec(E),x=Number(L[1]),g=L[2];switch(g){case"h":return x*3600;case"m":return x*60;case"ms":return x*1e3;case"f":return x/S.frameRate;case"t":return x/S.tickRate}return x}},"./src/utils/logger.ts":function(R,M,s){s.r(M),s.d(M,"enableLogs",function(){return A}),s.d(M,"logger",function(){return c});var t=function(){},e={trace:t,debug:t,log:t,warn:t,info:t,error:t},p=e;function I(o){var h=self.console[o];return h?h.bind(self.console,"["+o+"] >"):t}function b(o){for(var h=arguments.length,v=new Array(h>1?h-1:0),m=1;m<h;m++)v[m-1]=arguments[m];v.forEach(function(T){p[T]=o[T]?o[T].bind(o):I(T)})}function A(o){if(self.console&&o===!0||typeof o=="object"){b(o,"debug","log","info","warn","error");try{p.log()}catch{p=e}}else p=e}var c=p},"./src/utils/mediakeys-helper.ts":function(R,M,s){s.r(M),s.d(M,"KeySystems",function(){return t}),s.d(M,"requestMediaKeySystemAccess",function(){return e});var t;(function(p){p.WIDEVINE="com.widevine.alpha",p.PLAYREADY="com.microsoft.playready"})(t||(t={}));var e=function(){return typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}()},"./src/utils/mediasource-helper.ts":function(R,M,s){s.r(M),s.d(M,"getMediaSource",function(){return t});function t(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":function(R,M,s){s.r(M),s.d(M,"RemuxerTrackIdConfig",function(){return A}),s.d(M,"bin2str",function(){return c}),s.d(M,"readUint16",function(){return o}),s.d(M,"readUint32",function(){return h}),s.d(M,"readSint32",function(){return v}),s.d(M,"writeUint32",function(){return m}),s.d(M,"findBox",function(){return T}),s.d(M,"parseSegmentIndex",function(){return f}),s.d(M,"parseInitSegment",function(){return n}),s.d(M,"getStartDTS",function(){return r}),s.d(M,"getDuration",function(){return d}),s.d(M,"computeRawDurationFromSamples",function(){return u}),s.d(M,"offsetStartDTS",function(){return y}),s.d(M,"segmentValidRange",function(){return l}),s.d(M,"appendUint8Array",function(){return a}),s.d(M,"parseSamples",function(){return i}),s.d(M,"parseSEIMessageFromNALu",function(){return S}),s.d(M,"parseEmsg",function(){return x});var t=s("./src/utils/typed-array.ts"),e=s("./src/loader/fragment.ts"),p=s("./src/demux/id3.ts"),I=Math.pow(2,32)-1,b=[].push,A={video:1,audio:2,id3:3,text:4};function c(g){return String.fromCharCode.apply(null,g)}function o(g,O){var P=g[O]<<8|g[O+1];return P<0?65536+P:P}function h(g,O){var P=v(g,O);return P<0?4294967296+P:P}function v(g,O){return g[O]<<24|g[O+1]<<16|g[O+2]<<8|g[O+3]}function m(g,O,P){g[O]=P>>24,g[O+1]=P>>16&255,g[O+2]=P>>8&255,g[O+3]=P&255}function T(g,O){var P=[];if(!O.length)return P;for(var C=g.byteLength,w=0;w<C;){var F=h(g,w),k=c(g.subarray(w+4,w+8)),_=F>1?w+F:C;if(k===O[0])if(O.length===1)P.push(g.subarray(w+8,_));else{var B=T(g.subarray(w+8,_),O.slice(1));B.length&&b.apply(P,B)}w=_}return P}function f(g){var O=[],P=g[0],C=8,w=h(g,C);C+=4;var F=0,k=0;P===0?C+=8:C+=16,C+=2;var _=g.length+k,B=o(g,C);C+=2;for(var N=0;N<B;N++){var U=C,j=h(g,U);U+=4;var W=j&2147483647,H=(j&2147483648)>>>31;if(H===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var G=h(g,U);U+=4,O.push({referenceSize:W,subsegmentDuration:G,info:{duration:G/w,start:_,end:_+W-1}}),_+=W,U+=4,C=U}return{earliestPresentationTime:F,timescale:w,version:P,referencesCount:B,references:O}}function n(g){for(var O=[],P=T(g,["moov","trak"]),C=0;C<P.length;C++){var w=P[C],F=T(w,["tkhd"])[0];if(F){var k=F[0],_=k===0?12:20,B=h(F,_),N=T(w,["mdia","mdhd"])[0];if(N){k=N[0],_=k===0?12:20;var U=h(N,_),j=T(w,["mdia","hdlr"])[0];if(j){var W=c(j.subarray(8,12)),H={soun:e.ElementaryStreamTypes.AUDIO,vide:e.ElementaryStreamTypes.VIDEO}[W];if(H){var G=T(w,["mdia","minf","stbl","stsd"])[0],K=void 0;G&&(K=c(G.subarray(12,16))),O[B]={timescale:U,type:H},O[H]={timescale:U,id:B,codec:K}}}}}}var X=T(g,["moov","mvex","trex"]);return X.forEach(function(Z){var z=h(Z,4),V=O[z];V&&(V.default={duration:h(Z,12),flags:h(Z,20)})}),O}function r(g,O){return T(O,["moof","traf"]).reduce(function(P,C){var w=T(C,["tfdt"])[0],F=w[0],k=T(C,["tfhd"]).reduce(function(_,B){var N=h(B,4),U=g[N];if(U){var j=h(w,4);F===1&&(j*=Math.pow(2,32),j+=h(w,8));var W=U.timescale||9e4,H=j/W;if(isFinite(H)&&(_===null||H<_))return H}return _},null);return k!==null&&isFinite(k)&&(P===null||k<P)?k:P},null)||0}function d(g,O){for(var P=0,C=0,w=0,F=T(g,["moof","traf"]),k=0;k<F.length;k++){var _=F[k],B=T(_,["tfhd"])[0],N=h(B,4),U=O[N];if(!!U){var j=U.default,W=h(B,0)|(j==null?void 0:j.flags),H=j==null?void 0:j.duration;W&8&&(W&2?H=h(B,12):H=h(B,8));for(var G=U.timescale||9e4,K=T(_,["trun"]),X=0;X<K.length;X++){if(P=u(K[X]),!P&&H){var Z=h(K[X],4);P=H*Z}U.type===e.ElementaryStreamTypes.VIDEO?C+=P/G:U.type===e.ElementaryStreamTypes.AUDIO&&(w+=P/G)}}}if(C===0&&w===0){for(var z=0,V=T(g,["sidx"]),Y=0;Y<V.length;Y++){var Q=f(V[Y]);Q!=null&&Q.references&&(z+=Q.references.reduce(function($,J){return $+J.info.duration||0},0))}return z}return C||w}function u(g){var O=h(g,0),P=8;O&1&&(P+=4),O&4&&(P+=4);for(var C=0,w=h(g,4),F=0;F<w;F++){if(O&256){var k=h(g,P);C+=k,P+=4}O&512&&(P+=4),O&1024&&(P+=4),O&2048&&(P+=4)}return C}function y(g,O,P){T(O,["moof","traf"]).forEach(function(C){T(C,["tfhd"]).forEach(function(w){var F=h(w,4),k=g[F];if(!!k){var _=k.timescale||9e4;T(C,["tfdt"]).forEach(function(B){var N=B[0],U=h(B,4);if(N===0)U-=P*_,U=Math.max(U,0),m(B,4,U);else{U*=Math.pow(2,32),U+=h(B,8),U-=P*_,U=Math.max(U,0);var j=Math.floor(U/(I+1)),W=Math.floor(U%(I+1));m(B,4,j),m(B,8,W)}})}})})}function l(g){var O={valid:null,remainder:null},P=T(g,["moof"]);if(P){if(P.length<2)return O.remainder=g,O}else return O;var C=P[P.length-1];return O.valid=Object(t.sliceUint8)(g,0,C.byteOffset-8),O.remainder=Object(t.sliceUint8)(g,C.byteOffset-8),O}function a(g,O){var P=new Uint8Array(g.length+O.length);return P.set(g),P.set(O,g.length),P}function i(g,O){var P=[],C=O.samples,w=O.timescale,F=O.id,k=!1,_=T(C,["moof"]);return _.map(function(B){var N=B.byteOffset-8,U=T(B,["traf"]);U.map(function(j){var W=T(j,["tfdt"]).map(function(H){var G=H[0],K=h(H,4);return G===1&&(K*=Math.pow(2,32),K+=h(H,8)),K/w})[0];return W!==void 0&&(g=W),T(j,["tfhd"]).map(function(H){var G=h(H,4),K=h(H,0)&16777215,X=(K&1)!==0,Z=(K&2)!==0,z=(K&8)!==0,V=0,Y=(K&16)!==0,Q=0,$=(K&32)!==0,J=8;G===F&&(X&&(J+=8),Z&&(J+=4),z&&(V=h(H,J),J+=4),Y&&(Q=h(H,J),J+=4),$&&(J+=4),O.type==="video"&&(k=D(O.codec)),T(j,["trun"]).map(function(tt){var rt=tt[0],nt=h(tt,0)&16777215,it=(nt&1)!==0,at=0,ut=(nt&4)!==0,dt=(nt&256)!==0,st=0,yt=(nt&512)!==0,vt=0,ct=(nt&1024)!==0,Et=(nt&2048)!==0,Tt=0,xt=h(tt,4),ot=8;it&&(at=h(tt,ot),ot+=4),ut&&(ot+=4);for(var ht=at+N,pt=0;pt<xt;pt++){if(dt?(st=h(tt,ot),ot+=4):st=V,yt?(vt=h(tt,ot),ot+=4):vt=Q,ct&&(ot+=4),Et&&(rt===0?Tt=h(tt,ot):Tt=v(tt,ot),ot+=4),O.type===e.ElementaryStreamTypes.VIDEO)for(var mt=0;mt<vt;){var St=h(C,ht);ht+=4;var ft=C[ht]&31;if(E(k,ft)){var gt=C.subarray(ht,ht+St);S(gt,g+Tt/w,P)}ht+=St,mt+=St+4}g+=st/w}}))})})}),P}function D(g){if(!g)return!1;var O=g.indexOf("."),P=O<0?g:g.substring(0,O);return P==="hvc1"||P==="hev1"||P==="dvh1"||P==="dvhe"}function E(g,O){return g?O===39||O===40:O===6}function S(g,O,P){var C=L(g),w=0;w++;for(var F=0,k=0,_=!1,B=0;w<C.length;){F=0;do{if(w>=C.length)break;B=C[w++],F+=B}while(B===255);k=0;do{if(w>=C.length)break;B=C[w++],k+=B}while(B===255);var N=C.length-w;if(!_&&F===4&&w<C.length){_=!0;var U=C[w++];if(U===181){var j=o(C,w);if(w+=2,j===49){var W=h(C,w);if(w+=4,W===1195456820){var H=C[w++];if(H===3){var G=C[w++],K=31&G,X=64&G,Z=X?2+K*3:0,z=new Uint8Array(Z);if(X){z[0]=G;for(var V=1;V<Z;V++)z[V]=C[w++]}P.push({type:H,payloadType:F,pts:O,bytes:z})}}}}}else if(F===5&&k<N){if(_=!0,k>16){for(var Y=[],Q=0;Q<16;Q++){var $=C[w++].toString(16);Y.push($.length==1?"0"+$:$),(Q===3||Q===5||Q===7||Q===9)&&Y.push("-")}for(var J=k-16,tt=new Uint8Array(J),rt=0;rt<J;rt++)tt[rt]=C[w++];P.push({payloadType:F,pts:O,uuid:Y.join(""),userData:Object(p.utf8ArrayToStr)(tt),userDataBytes:tt})}}else if(k<N)w+=k;else if(k>N)break}}function L(g){for(var O=g.byteLength,P=[],C=1;C<O-2;)g[C]===0&&g[C+1]===0&&g[C+2]===3?(P.push(C+2),C+=2):C++;if(P.length===0)return g;var w=O-P.length,F=new Uint8Array(w),k=0;for(C=0;C<w;k++,C++)k===P[0]&&(k++,P.shift()),F[C]=g[k];return F}function x(g){var O=g[0],P="",C="",w=0,F=0,k=0,_=0,B=0,N=0;if(O===0){for(;c(g.subarray(N,N+1))!=="\0";)P+=c(g.subarray(N,N+1)),N+=1;for(P+=c(g.subarray(N,N+1)),N+=1;c(g.subarray(N,N+1))!=="\0";)C+=c(g.subarray(N,N+1)),N+=1;C+=c(g.subarray(N,N+1)),N+=1,w=h(g,12),F=h(g,16),_=h(g,20),B=h(g,24),N=28}else if(O===1){N+=4,w=h(g,N),N+=4;var U=h(g,N);N+=4;var j=h(g,N);for(N+=4,k=Math.pow(2,32)*U+j,Number.isSafeInteger(k)||(k=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),_=h(g,N),N+=4,B=h(g,N),N+=4;c(g.subarray(N,N+1))!=="\0";)P+=c(g.subarray(N,N+1)),N+=1;for(P+=c(g.subarray(N,N+1)),N+=1;c(g.subarray(N,N+1))!=="\0";)C+=c(g.subarray(N,N+1)),N+=1;C+=c(g.subarray(N,N+1)),N+=1}var W=g.subarray(N,g.byteLength);return{schemeIdUri:P,value:C,timeScale:w,presentationTime:k,presentationTimeDelta:F,eventDuration:_,id:B,payload:W}}},"./src/utils/output-filter.ts":function(R,M,s){s.r(M),s.d(M,"default",function(){return t});var t=function(){function e(I,b){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=I,this.trackName=b}var p=e.prototype;return p.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},p.newCue=function(b,A,c){(this.startTime===null||this.startTime>b)&&(this.startTime=b),this.endTime=A,this.screen=c,this.timelineController.createCaptionsTrack(this.trackName)},p.reset=function(){this.cueRanges=[],this.startTime=null},e}()},"./src/utils/texttrack-utils.ts":function(R,M,s){s.r(M),s.d(M,"sendAddTrackEvent",function(){return e}),s.d(M,"addCueToTrack",function(){return p}),s.d(M,"clearCurrentCues",function(){return I}),s.d(M,"removeCuesInRange",function(){return b}),s.d(M,"getCuesInRange",function(){return c});var t=s("./src/utils/logger.ts");function e(o,h){var v;try{v=new Event("addtrack")}catch{v=document.createEvent("Event"),v.initEvent("addtrack",!1,!1)}v.track=o,h.dispatchEvent(v)}function p(o,h){var v=o.mode;if(v==="disabled"&&(o.mode="hidden"),o.cues&&!o.cues.getCueById(h.id))try{if(o.addCue(h),!o.cues.getCueById(h.id))throw new Error("addCue is failed for: "+h)}catch(T){t.logger.debug("[texttrack-utils]: "+T);var m=new self.TextTrackCue(h.startTime,h.endTime,h.text);m.id=h.id,o.addCue(m)}v==="disabled"&&(o.mode=v)}function I(o){var h=o.mode;if(h==="disabled"&&(o.mode="hidden"),o.cues)for(var v=o.cues.length;v--;)o.removeCue(o.cues[v]);h==="disabled"&&(o.mode=h)}function b(o,h,v,m){var T=o.mode;if(T==="disabled"&&(o.mode="hidden"),o.cues&&o.cues.length>0)for(var f=c(o.cues,h,v),n=0;n<f.length;n++)(!m||m(f[n]))&&o.removeCue(f[n]);T==="disabled"&&(o.mode=T)}function A(o,h){if(h<o[0].startTime)return 0;var v=o.length-1;if(h>o[v].endTime)return-1;for(var m=0,T=v;m<=T;){var f=Math.floor((T+m)/2);if(h<o[f].startTime)T=f-1;else if(h>o[f].startTime&&m<v)m=f+1;else return f}return o[m].startTime-h<h-o[T].startTime?m:T}function c(o,h,v){var m=[],T=A(o,h);if(T>-1)for(var f=T,n=o.length;f<n;f++){var r=o[f];if(r.startTime>=h&&r.endTime<=v)m.push(r);else if(r.startTime>v)return m}return m}},"./src/utils/time-ranges.ts":function(R,M,s){s.r(M);var t={toString:function(p){for(var I="",b=p.length,A=0;A<b;A++)I+="["+p.start(A).toFixed(3)+","+p.end(A).toFixed(3)+"]";return I}};M.default=t},"./src/utils/timescale-conversion.ts":function(R,M,s){s.r(M),s.d(M,"toTimescaleFromBase",function(){return e}),s.d(M,"toTimescaleFromScale",function(){return p}),s.d(M,"toMsFromMpegTsClock",function(){return I}),s.d(M,"toMpegTsClockFromTimescale",function(){return b});var t=9e4;function e(A,c,o,h){o===void 0&&(o=1),h===void 0&&(h=!1);var v=A*c*o;return h?Math.round(v):v}function p(A,c,o,h){return o===void 0&&(o=1),h===void 0&&(h=!1),e(A,c,1/o,h)}function I(A,c){return c===void 0&&(c=!1),e(A,1e3,1/t,c)}function b(A,c){return c===void 0&&(c=1),e(A,t,1/c)}},"./src/utils/typed-array.ts":function(R,M,s){s.r(M),s.d(M,"sliceUint8",function(){return t});function t(e,p,I){return Uint8Array.prototype.slice?e.slice(p,I):new Uint8Array(Array.prototype.slice.call(e,p,I))}},"./src/utils/vttcue.ts":function(R,M,s){s.r(M),M.default=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;var t=["","lr","rl"],e=["start","middle","end","left","right"];function p(o,h){if(typeof h!="string"||!Array.isArray(o))return!1;var v=h.toLowerCase();return~o.indexOf(v)?v:!1}function I(o){return p(t,o)}function b(o){return p(e,o)}function A(o){for(var h=arguments.length,v=new Array(h>1?h-1:0),m=1;m<h;m++)v[m-1]=arguments[m];for(var T=1;T<arguments.length;T++){var f=arguments[T];for(var n in f)o[n]=f[n]}return o}function c(o,h,v){var m=this,T={enumerable:!0};m.hasBeenReset=!1;var f="",n=!1,r=o,d=h,u=v,y=null,l="",a=!0,i="auto",D="start",E=50,S="middle",L=50,x="middle";Object.defineProperty(m,"id",A({},T,{get:function(){return f},set:function(O){f=""+O}})),Object.defineProperty(m,"pauseOnExit",A({},T,{get:function(){return n},set:function(O){n=!!O}})),Object.defineProperty(m,"startTime",A({},T,{get:function(){return r},set:function(O){if(typeof O!="number")throw new TypeError("Start time must be set to a number.");r=O,this.hasBeenReset=!0}})),Object.defineProperty(m,"endTime",A({},T,{get:function(){return d},set:function(O){if(typeof O!="number")throw new TypeError("End time must be set to a number.");d=O,this.hasBeenReset=!0}})),Object.defineProperty(m,"text",A({},T,{get:function(){return u},set:function(O){u=""+O,this.hasBeenReset=!0}})),Object.defineProperty(m,"region",A({},T,{get:function(){return y},set:function(O){y=O,this.hasBeenReset=!0}})),Object.defineProperty(m,"vertical",A({},T,{get:function(){return l},set:function(O){var P=I(O);if(P===!1)throw new SyntaxError("An invalid or illegal string was specified.");l=P,this.hasBeenReset=!0}})),Object.defineProperty(m,"snapToLines",A({},T,{get:function(){return a},set:function(O){a=!!O,this.hasBeenReset=!0}})),Object.defineProperty(m,"line",A({},T,{get:function(){return i},set:function(O){if(typeof O!="number"&&O!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");i=O,this.hasBeenReset=!0}})),Object.defineProperty(m,"lineAlign",A({},T,{get:function(){return D},set:function(O){var P=b(O);if(!P)throw new SyntaxError("An invalid or illegal string was specified.");D=P,this.hasBeenReset=!0}})),Object.defineProperty(m,"position",A({},T,{get:function(){return E},set:function(O){if(O<0||O>100)throw new Error("Position must be between 0 and 100.");E=O,this.hasBeenReset=!0}})),Object.defineProperty(m,"positionAlign",A({},T,{get:function(){return S},set:function(O){var P=b(O);if(!P)throw new SyntaxError("An invalid or illegal string was specified.");S=P,this.hasBeenReset=!0}})),Object.defineProperty(m,"size",A({},T,{get:function(){return L},set:function(O){if(O<0||O>100)throw new Error("Size must be between 0 and 100.");L=O,this.hasBeenReset=!0}})),Object.defineProperty(m,"align",A({},T,{get:function(){return x},set:function(O){var P=b(O);if(!P)throw new SyntaxError("An invalid or illegal string was specified.");x=P,this.hasBeenReset=!0}})),m.displayState=void 0}return c.prototype.getCueAsHTML=function(){var o=self.WebVTT;return o.convertCueToDOMTree(self,this.text)},c}()},"./src/utils/vttparser.ts":function(R,M,s){s.r(M),s.d(M,"parseTimeStamp",function(){return p}),s.d(M,"fixLineBreaks",function(){return h}),s.d(M,"VTTParser",function(){return v});var t=s("./src/utils/vttcue.ts"),e=function(){function m(){}var T=m.prototype;return T.decode=function(n,r){if(!n)return"";if(typeof n!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(n))},m}();function p(m){function T(n,r,d,u){return(n|0)*3600+(r|0)*60+(d|0)+parseFloat(u||0)}var f=m.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return f?parseFloat(f[2])>59?T(f[2],f[3],0,f[4]):T(f[1],f[2],f[3],f[4]):null}var I=function(){function m(){this.values=Object.create(null)}var T=m.prototype;return T.set=function(n,r){!this.get(n)&&r!==""&&(this.values[n]=r)},T.get=function(n,r,d){return d?this.has(n)?this.values[n]:r[d]:this.has(n)?this.values[n]:r},T.has=function(n){return n in this.values},T.alt=function(n,r,d){for(var u=0;u<d.length;++u)if(r===d[u]){this.set(n,r);break}},T.integer=function(n,r){/^-?\d+$/.test(r)&&this.set(n,parseInt(r,10))},T.percent=function(n,r){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(r)){var d=parseFloat(r);if(d>=0&&d<=100)return this.set(n,d),!0}return!1},m}();function b(m,T,f,n){var r=n?m.split(n):[m];for(var d in r)if(typeof r[d]=="string"){var u=r[d].split(f);if(u.length===2){var y=u[0],l=u[1];T(y,l)}}}var A=new t.default(0,0,""),c=A.align==="middle"?"middle":"center";function o(m,T,f){var n=m;function r(){var y=p(m);if(y===null)throw new Error("Malformed timestamp: "+n);return m=m.replace(/^[^\sa-zA-Z-]+/,""),y}function d(y,l){var a=new I;b(y,function(E,S){var L;switch(E){case"region":for(var x=f.length-1;x>=0;x--)if(f[x].id===S){a.set(E,f[x].region);break}break;case"vertical":a.alt(E,S,["rl","lr"]);break;case"line":L=S.split(","),a.integer(E,L[0]),a.percent(E,L[0])&&a.set("snapToLines",!1),a.alt(E,L[0],["auto"]),L.length===2&&a.alt("lineAlign",L[1],["start",c,"end"]);break;case"position":L=S.split(","),a.percent(E,L[0]),L.length===2&&a.alt("positionAlign",L[1],["start",c,"end","line-left","line-right","auto"]);break;case"size":a.percent(E,S);break;case"align":a.alt(E,S,["start",c,"end","left","right"]);break}},/:/,/\s/),l.region=a.get("region",null),l.vertical=a.get("vertical","");var i=a.get("line","auto");i==="auto"&&A.line===-1&&(i=-1),l.line=i,l.lineAlign=a.get("lineAlign","start"),l.snapToLines=a.get("snapToLines",!0),l.size=a.get("size",100),l.align=a.get("align",c);var D=a.get("position","auto");D==="auto"&&A.position===50&&(D=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=D}function u(){m=m.replace(/^\s+/,"")}if(u(),T.startTime=r(),u(),m.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+n);m=m.slice(3),u(),T.endTime=r(),u(),d(m,T)}function h(m){return m.replace(/<br(?: \/)?>/gi,`
`)}var v=function(){function m(){this.state="INITIAL",this.buffer="",this.decoder=new e,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var T=m.prototype;return T.parse=function(n){var r=this;n&&(r.buffer+=r.decoder.decode(n,{stream:!0}));function d(){var D=r.buffer,E=0;for(D=h(D);E<D.length&&D[E]!=="\r"&&D[E]!==`
`;)++E;var S=D.slice(0,E);return D[E]==="\r"&&++E,D[E]===`
`&&++E,r.buffer=D.slice(E),S}function u(D){b(D,function(E,S){},/:/)}try{var y="";if(r.state==="INITIAL"){if(!/\r\n|\n/.test(r.buffer))return this;y=d();var l=y.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!l||!l[0])throw new Error("Malformed WebVTT signature.");r.state="HEADER"}for(var a=!1;r.buffer;){if(!/\r\n|\n/.test(r.buffer))return this;switch(a?a=!1:y=d(),r.state){case"HEADER":/:/.test(y)?u(y):y||(r.state="ID");continue;case"NOTE":y||(r.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(y)){r.state="NOTE";break}if(!y)continue;if(r.cue=new t.default(0,0,""),r.state="CUE",y.indexOf("-->")===-1){r.cue.id=y;continue}case"CUE":if(!r.cue){r.state="BADCUE";continue}try{o(y,r.cue,r.regionList)}catch{r.cue=null,r.state="BADCUE";continue}r.state="CUETEXT";continue;case"CUETEXT":{var i=y.indexOf("-->")!==-1;if(!y||i&&(a=!0)){r.oncue&&r.cue&&r.oncue(r.cue),r.cue=null,r.state="ID";continue}if(r.cue===null)continue;r.cue.text&&(r.cue.text+=`
`),r.cue.text+=y}continue;case"BADCUE":y||(r.state="ID")}}}catch{r.state==="CUETEXT"&&r.cue&&r.oncue&&r.oncue(r.cue),r.cue=null,r.state=r.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},T.flush=function(){var n=this;try{if((n.cue||n.state==="HEADER")&&(n.buffer+=`

`,n.parse()),n.state==="INITIAL"||n.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(r){n.onparsingerror&&n.onparsingerror(r)}return n.onflush&&n.onflush(),this},m}()},"./src/utils/webvtt-parser.ts":function(R,M,s){s.r(M),s.d(M,"generateCueId",function(){return v}),s.d(M,"parseWebVTT",function(){return T});var t=s("./src/polyfills/number.ts"),e=s("./src/utils/vttparser.ts"),p=s("./src/demux/id3.ts"),I=s("./src/utils/timescale-conversion.ts"),b=s("./src/remux/mp4-remuxer.ts"),A=/\r\n|\n\r|\n|\r/g,c=function(n,r,d){return d===void 0&&(d=0),n.slice(d,d+r.length)===r},o=function(n){var r=parseInt(n.slice(-3)),d=parseInt(n.slice(-6,-4)),u=parseInt(n.slice(-9,-7)),y=n.length>9?parseInt(n.substring(0,n.indexOf(":"))):0;if(!Object(t.isFiniteNumber)(r)||!Object(t.isFiniteNumber)(d)||!Object(t.isFiniteNumber)(u)||!Object(t.isFiniteNumber)(y))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+n);return r+=1e3*d,r+=60*1e3*u,r+=60*60*1e3*y,r},h=function(n){for(var r=5381,d=n.length;d;)r=r*33^n.charCodeAt(--d);return(r>>>0).toString()};function v(f,n,r){return h(f.toString())+h(n.toString())+h(r)}var m=function(n,r,d){var u=n[r],y=n[u.prevCC];if(!y||!y.new&&u.new){n.ccOffset=n.presentationOffset=u.start,u.new=!1;return}for(;(l=y)!==null&&l!==void 0&&l.new;){var l;n.ccOffset+=u.start-y.start,u.new=!1,u=y,y=n[u.prevCC]}n.presentationOffset=d};function T(f,n,r,d,u,y,l,a){var i=new e.VTTParser,D=Object(p.utf8ArrayToStr)(new Uint8Array(f)).trim().replace(A,`
`).split(`
`),E=[],S=Object(I.toMpegTsClockFromTimescale)(n,r),L="00:00.000",x=0,g=0,O,P=!0;i.oncue=function(C){var w=d[u],F=d.ccOffset,k=(x-S)/9e4;w!=null&&w.new&&(g!==void 0?F=d.ccOffset=w.start:m(d,u,k)),k&&(F=k-d.presentationOffset);var _=C.endTime-C.startTime,B=Object(b.normalizePts)((C.startTime+F-g)*9e4,y*9e4)/9e4;C.startTime=Math.max(B,0),C.endTime=Math.max(B+_,0);var N=C.text.trim();C.text=decodeURIComponent(encodeURIComponent(N)),C.id||(C.id=v(C.startTime,C.endTime,N)),C.endTime>0&&E.push(C)},i.onparsingerror=function(C){O=C},i.onflush=function(){if(O){a(O);return}l(E)},D.forEach(function(C){if(P)if(c(C,"X-TIMESTAMP-MAP=")){P=!1,C.slice(16).split(",").forEach(function(w){c(w,"LOCAL:")?L=w.slice(6):c(w,"MPEGTS:")&&(x=parseInt(w.slice(7)))});try{g=o(L)/1e3}catch(w){O=w}return}else C===""&&(P=!1);i.parse(C+`
`)}),i.flush()}},"./src/utils/xhr-loader.ts":function(R,M,s){s.r(M);var t=s("./src/utils/logger.ts"),e=s("./src/loader/load-stats.ts"),p=/^age:\s*[\d.]+\s*$/m,I=function(){function b(c){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=c?c.xhrSetup:null,this.stats=new e.LoadStats,this.retryDelay=0}var A=b.prototype;return A.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},A.abortInternal=function(){var o=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),o&&(o.onreadystatechange=null,o.onprogress=null,o.readyState!==4&&(this.stats.aborted=!0,o.abort()))},A.abort=function(){var o;this.abortInternal(),(o=this.callbacks)!==null&&o!==void 0&&o.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},A.load=function(o,h,v){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=o,this.config=h,this.callbacks=v,this.retryDelay=h.retryDelay,this.loadInternal()},A.loadInternal=function(){var o=this.config,h=this.context;if(!!o){var v=this.loader=new self.XMLHttpRequest,m=this.stats;m.loading.first=0,m.loaded=0;var T=this.xhrSetup;try{if(T)try{T(v,h.url)}catch{v.open("GET",h.url,!0),T(v,h.url)}v.readyState||v.open("GET",h.url,!0);var f=this.context.headers;if(f)for(var n in f)v.setRequestHeader(n,f[n])}catch(r){this.callbacks.onError({code:v.status,text:r.message},h,v);return}h.rangeEnd&&v.setRequestHeader("Range","bytes="+h.rangeStart+"-"+(h.rangeEnd-1)),v.onreadystatechange=this.readystatechange.bind(this),v.onprogress=this.loadprogress.bind(this),v.responseType=h.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),o.timeout),v.send()}},A.readystatechange=function(){var o=this.context,h=this.loader,v=this.stats;if(!(!o||!h)){var m=h.readyState,T=this.config;if(!v.aborted&&m>=2)if(self.clearTimeout(this.requestTimeout),v.loading.first===0&&(v.loading.first=Math.max(self.performance.now(),v.loading.start)),m===4){h.onreadystatechange=null,h.onprogress=null;var f=h.status;if(f>=200&&f<300){v.loading.end=Math.max(self.performance.now(),v.loading.first);var n,r;if(o.responseType==="arraybuffer"?(n=h.response,r=n.byteLength):(n=h.responseText,r=n.length),v.loaded=v.total=r,!this.callbacks)return;var d=this.callbacks.onProgress;if(d&&d(v,o,n,h),!this.callbacks)return;var u={url:h.responseURL,data:n};this.callbacks.onSuccess(u,v,o,h)}else v.retry>=T.maxRetry||f>=400&&f<499?(t.logger.error(f+" while loading "+o.url),this.callbacks.onError({code:f,text:h.statusText},o,h)):(t.logger.warn(f+" while loading "+o.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,T.maxRetryDelay),v.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),T.timeout)}},A.loadtimeout=function(){t.logger.warn("timeout while loading "+this.context.url);var o=this.callbacks;o&&(this.abortInternal(),o.onTimeout(this.stats,this.context,this.loader))},A.loadprogress=function(o){var h=this.stats;h.loaded=o.loaded,o.lengthComputable&&(h.total=o.total)},A.getCacheAge=function(){var o=null;if(this.loader&&p.test(this.loader.getAllResponseHeaders())){var h=this.loader.getResponseHeader("age");o=h?parseFloat(h):null}return o},b}();M.default=I}}).default})})(Vt);const Pe=jt(Vt.exports);pe.PLAYBACK_RATE=[.5,.75,1,1.25,1.5,2,3,4];const be=[{icon:"infuse",name:"Infuse",scheme:"infuse://x-callback-url/play?url=$durl"},{icon:"nplayer",name:"nPlayer",scheme:"nplayer-$durl"},{icon:"potplayer",name:"PotPlayer",scheme:"potplayer://$durl"},{icon:"mxplayer-pro",name:"MX Player Pro",scheme:"intent:$durl#Intent;package=com.mxtech.videoplayer.pro;S.title=$name;end"},{icon:"iina",name:"IINA",scheme:"iina://weblink?url=$durl"}],Ce=et=>{const{$container:lt,$video:R}=et.template,M=lt.parentElement;et.on("ready",()=>{const s="1.75rem";M.style.maxHeight=`calc(100vh - ${M.offsetTop}px - ${s})`,M.style.minHeight="320px",et.autoHeight()}),et.on("resize",()=>{et.autoHeight()}),et.on("error",()=>{R.style.height||(lt.style.height="60vh",R.style.height="100%")})},Re=et=>{const{replace:lt}=te(),{currentObjLink:R}=ee();let M=wt.objs.filter(e=>e.type===ve.VIDEO);M.length===0&&(M=[wt.obj]);const s=re();let t=localStorage.getItem("video_auto_next");return t||(t="true"),et.onAutoNextChange(t==="true"),Lt(he,{w:"$full",spacing:"$2",get children(){return[ie(()=>et.children),Lt(ne,{spacing:"$2",w:"$full",get children(){return[Lt(ae,{onChange:e=>{lt(e)},get value(){return wt.obj.name},get options(){return M.map(e=>({value:e.name}))}}),Lt(se,{css:{whiteSpace:"nowrap"},defaultChecked:t==="true",onChange:e=>{et.onAutoNextChange(e.currentTarget.checked),localStorage.setItem("video_auto_next",e.currentTarget.checked.toString())},get children(){return s("home.preview.auto_next")}})]}}),Lt(oe,{wrap:"wrap",gap:"$1",justifyContent:"center",get children(){return Lt(le,{each:be,children:e=>Lt(ue,{placement:"top",withArrow:!0,get label(){return e.name},get children(){return Lt(de,{get href(){return fe(e.scheme,{raw_url:wt.raw_url,name:wt.obj.name,d_url:R(!0)})},get children(){return Lt(ce,{m:"0 auto",boxSize:"$8",get src(){return`${window.__dynamic_base__}/images/${e.icon}.webp`}})}})}})})}})]}})};export{Ce as A,Pe as H,Re as V,Oe as a,Ie as b,pe as c};
