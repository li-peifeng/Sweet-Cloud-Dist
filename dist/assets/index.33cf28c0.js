import{bK as q,ay as x,R,b as z,bG as p,bL as $,d as Q,e,av as U,a_ as S,bF as X,bM as Y,bN as Z,bO as ee,W as P,a as te,j as ne,k as d,bP as se,aL as y,a3 as oe,bE as v,an as re,bD as ae,S as w,I as C,bQ as ie,aW as le,a8 as ce,B as F,ar as ue,bv as T,n as b,a$ as ge}from"./index.28ddc39c.js";import{r as de,b as pe,s as he}from"./index.a43344fa.js";import{s as me,g as fe,a as we}from"./webauthn-json.browser-ponyfill.1c672167.js";const be="https://github.com/alist-org/alist";function Se(i){return q(`${i}-${be}`)}const $e=()=>{const i=x("sso_login_enabled"),k=R("sso_login_platform"),n=x("sso_compatibility_mode"),{searchParams:l,to:h}=z(),o=l.token;o!=null&&o!=""&&(p(o),h(decodeURIComponent(l.redirect||$||"/"),!0));function c(a){const s=a.data;s.token&&(p(s.token),h(decodeURIComponent(l.redirect||$||"/"),!0))}if(window.addEventListener("message",c),Q(()=>{window.removeEventListener("message",c)}),i){const a=()=>{const u=S.getUri()+"/auth/sso?method=sso_get_token";if(n){window.location.href=u;return}window.open(u,"authPopup","width=500,height=600")};let s;switch(k){case"Github":s=ee;break;case"Microsoft":s=de;break;case"Google":s=Z;break;case"Dingtalk":s=Y;break;default:s=X}return e(U,{cursor:"pointer",boxSize:"$8",as:s,p:"$0_5",onclick:a})}},ye=()=>{const i=R("logo").split(`
`),k=P(i[0],i.pop()),n=te(),l=ne(()=>`${R("site_title")}`);pe(l);const h=P("white","$neutral1"),[o,c]=d(localStorage.getItem("username")||""),[a,s]=d(localStorage.getItem("password")||""),[u,O]=d(""),[m,D]=d(!1),[f,G]=se("remember-pwd","false"),[M,N]=y(async()=>S.post("/auth/login/hash",{username:o(),password:Se(a()),otp_code:u()})),[,j]=y((t,r,g)=>S.post("/authn/webauthn_finish_login?username="+g,JSON.stringify(r),{headers:{session:t}})),[,A]=y(t=>S.get("/authn/webauthn_begin_login?username="+t)),{searchParams:E,to:L}=z(),B=x("webauthn_login_enabled"),K=async()=>{D(!m())},I=async()=>{if(m()){if(!me()){b.error(n("users.webauthn_not_supported"));return}p(),f()==="true"?localStorage.setItem("username",o()):localStorage.removeItem("username");const t=await A(o());ge(t,async r=>{const g=fe(r.options),H=await we(g),J=await j(r.session,H,o());T(J,V=>{b.success(n("login.success")),p(V.token),L(decodeURIComponent(E.redirect||$||"/"),!0)})})}else{f()==="true"?(localStorage.setItem("username",o()),localStorage.setItem("password",a())):(localStorage.removeItem("username"),localStorage.removeItem("password"));const t=await N();T(t,r=>{b.success(n("login.success")),p(r.token),L(decodeURIComponent(E.redirect||$||"/"),!0)},(r,g)=>{!_()&&g===402?W(!0):b.error(r)})}},[_,W]=d(!1);return e(ue,{zIndex:"1",w:"$full",h:"100vh",get children(){return e(oe,{get bgColor(){return h()},rounded:"$xl",p:"24px",w:{"@initial":"90%","@sm":"364px"},spacing:"$4",get children(){return[e(v,{alignItems:"center",justifyContent:"space-around",get children(){return[e(re,{mr:"$2",boxSize:"$12",get src(){return k()}}),e(ae,{color:"$info9",fontSize:"$2xl",get children(){return l()}})]}}),e(w,{get when(){return!_()},get fallback(){return e(C,{id:"totp",name:"otp",get placeholder(){return n("login.otp-tips")},get value(){return u()},onInput:t=>O(t.currentTarget.value),onKeyDown:t=>{t.key==="Enter"&&I()}})},get children(){return[e(C,{name:"username",get placeholder(){return n("login.username-tips")},get value(){return o()},onInput:t=>c(t.currentTarget.value)}),e(w,{get when(){return!m()},get children(){return e(C,{name:"password",get placeholder(){return n("login.password-tips")},type:"password",get value(){return a()},onInput:t=>s(t.currentTarget.value),onKeyDown:t=>{t.key==="Enter"&&I()}})}}),e(v,{px:"$1",w:"$full",fontSize:"$sm",color:"$neutral10",justifyContent:"space-between",alignItems:"center",get children(){return[e(ie,{get checked(){return f()==="true"},onChange:()=>G(f()==="true"?"false":"true"),get children(){return n("login.remember")}}),e(le,{get children(){return n("\u672A\u6388\u6743\u4E0D\u5F97\u8FDB\u5165!")}})]}})]}}),e(ce,{w:"$full",spacing:"$2",get children(){return[e(w,{get when(){return!m()},get children(){return e(F,{colorScheme:"primary",w:"$full",onClick:()=>{_()?O(""):(c(""),s(""))},get children(){return n("login.clear")}})}}),e(F,{w:"$full",get loading(){return M()},onClick:I,get children(){return n("login.login")}})]}}),e(v,{mt:"$2",justifyContent:"space-evenly",alignItems:"center",color:"$neutral10",w:"$full",get children(){return[e($e,{}),e(w,{when:B,get children(){return e(U,{cursor:"pointer",boxSize:"$8",as:he,p:"$0_5",onclick:K})}})]}})]}})}})};export{ye as default};
