System.register(["./index-legacy.c362e6b6.js","./useTitle-legacy.451b6304.js","./webauthn-json.browser-ponyfill-legacy.8ddd819a.js"],(function(e){"use strict";var t,r,n,o,s,a,l,c,i,u,g,d,h,p,m,w,b,f,$,_,y,I,k,S,v,C,x,j,z,E,R,U,D,T,G,P,q,K,L,N,O;return{setters:[e=>{t=e.c4,r=e.aI,n=e.X,o=e.e,s=e.b$,a=e.c5,l=e.j,c=e.c,i=e.I,u=e.b9,g=e.c6,d=e.c7,h=e.c8,p=e.a,m=e.d,w=e.q,b=e.r,f=e.c9,$=e.aW,_=e.a6,y=e.bO,I=e.av,k=e.bN,S=e.S,v=e.D,C=e.ca,x=e.b5,j=e.R,z=e.as,E=e.G,R=e.ay,U=e.bE,D=e.n,T=e.ba},e=>{G=e.c,P=e.h,q=e.b,K=e.i},e=>{L=e.s,N=e.g,O=e.a}],execute:function(){const J=()=>{const e=r("sso_login_enabled"),t=n("sso_login_platform"),p=r("sso_compatibility_mode"),{searchParams:m,to:w}=o(),b=m.token;function f(e){const t=e.data;t.token&&(s(t.token),w(decodeURIComponent(m.redirect||a||"/"),!0))}if(null!=b&&""!=b&&(s(b),w(decodeURIComponent(m.redirect||a||"/"),!0)),window.addEventListener("message",f),l((()=>{window.removeEventListener("message",f)})),e){const e=()=>{const e=u.getUri()+"/auth/sso?method=sso_get_token";p?window.location.href=e:window.open(e,"authPopup","width=500,height=600")};let r;switch(t){case"Github":r=P;break;case"Microsoft":r=h;break;case"Google":r=d;break;case"Dingtalk":r=g;break;default:r=G}return c(i,{cursor:"pointer",boxSize:"$8",as:r,p:"$0_5",onclick:e})}};e("default",(()=>{const e=n("logo").split("\n"),l=p(e[0],e.pop()),g=m(),d=w((()=>`${n("site_title")}`));q(d);const h=p("white","$neutral1"),[G,P]=b(localStorage.getItem("username")||""),[M,W]=b(localStorage.getItem("password")||""),[X,A]=b(""),[B,F]=b(!1),[H,Q]=f("remember-pwd","false"),[V,Y]=b(!1),[Z,ee]=$((async()=>{return V()?u.post("/auth/login/ldap",{username:G(),password:M(),otp_code:X()}):u.post("/auth/login/hash",{username:G(),password:(e=M(),t(`${e}-https://github.com/alist-org/alist`)),otp_code:X()});var e})),[,te]=$(((e,t,r)=>u.post("/authn/webauthn_finish_login?username="+r,JSON.stringify(t),{headers:{session:e}}))),[,re]=$((e=>u.get("/authn/webauthn_begin_login?username="+e))),{searchParams:ne,to:oe}=o(),se=r("webauthn_login_enabled"),ae=async()=>{F(!B())},le=async()=>{if(B()){if(!L())return void D.error(g("users.webauthn_not_supported"));s(),"true"===H()?localStorage.setItem("username",G()):localStorage.removeItem("username");const e=await re(G());T(e,(async e=>{try{const t=N(e.options),r=await O(t),n=await te(e.session,r,G());U(n,(e=>{D.success(g("login.success")),s(e.token),oe(decodeURIComponent(ne.redirect||a||"/"),!0)}))}catch(t){t instanceof Error&&D.error(t.message)}}))}else{"true"===H()?(localStorage.setItem("username",G()),localStorage.setItem("password",M())):(localStorage.removeItem("username"),localStorage.removeItem("password"));const e=await ee();U(e,(e=>{D.success(g("login.success")),s(e.token),oe(decodeURIComponent(ne.redirect||a||"/"),!0)}),((e,t)=>{ce()||402!==t?D.error(e):ie(!0)}))}},[ce,ie]=b(!1),ue=r("ldap_login_enabled"),ge=n("ldap_login_tips");return ue&&Y(!0),c(R,{zIndex:"1",w:"$full",h:"100vh",get children(){return c(_,{get bgColor(){return h()},rounded:"$xl",p:"24px",w:{"@initial":"90%","@sm":"364px"},spacing:"$4",get children(){return[c(y,{alignItems:"center",justifyContent:"space-around",get children(){return[c(I,{mr:"$2",boxSize:"$12",get src(){return l()}}),c(k,{color:"$info9",fontSize:"$2xl",get children(){return d()}})]}}),c(S,{get when(){return!ce()},get fallback(){return c(v,{id:"totp",name:"otp",get placeholder(){return g("login.otp-tips")},get value(){return X()},onInput:e=>A(e.currentTarget.value),onKeyDown:e=>{"Enter"===e.key&&le()}})},get children(){return[c(v,{name:"username",get placeholder(){return g("login.username-tips")},get value(){return G()},onInput:e=>P(e.currentTarget.value)}),c(S,{get when(){return!B()},get children(){return c(v,{name:"password",get placeholder(){return g("login.password-tips")},type:"password",get value(){return M()},onInput:e=>W(e.currentTarget.value),onKeyDown:e=>{"Enter"===e.key&&le()}})}}),c(y,{px:"$1",w:"$full",fontSize:"$sm",color:"$neutral10",justifyContent:"space-between",alignItems:"center",get children(){return[c(C,{get checked(){return"true"===H()},onChange:()=>Q("true"===H()?"false":"true"),get children(){return g("login.remember")}}),c(x,{color:"$success9",as:j,href:"https://peifeng.li/request-account-authorization",children:"获取账户访问授权"})]}})]}}),c(z,{w:"$full",spacing:"$2",get children(){return[c(S,{get when(){return!B()},get children(){return[c(E,{w:"$full",colorScheme:"danger",onClick:()=>{s(),oe(decodeURIComponent(ne.redirect||a||"/"),!0)},get children(){return g("login.use_guest")}}),c(E,{colorScheme:"warning",w:"$full",onClick:()=>{ce()?A(""):(P(""),W(""))},get children(){return g("login.clear")}})]}}),c(E,{colorScheme:"success",w:"$full",get loading(){return Z()},onClick:le,get children(){return g("login.login")}})]}}),c(S,{when:ue,get children(){return c(C,{w:"$full",get checked(){return!0===V()},onChange:()=>Y(!V()),children:ge})}}),c(y,{mt:"$2",justifyContent:"space-evenly",alignItems:"center",color:"$neutral10",w:"$full",get children(){return[c(J,{}),c(S,{when:se,get children(){return c(i,{cursor:"pointer",boxSize:"$8",as:K,p:"$0_5",onclick:ae})}})]}})]}})}})}))}}}));
