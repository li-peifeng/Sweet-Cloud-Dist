import{bL as ee,ay as y,R as C,b as N,bH as l,bM as p,d as te,e,av as j,a_ as w,bG as ne,bN as re,bO as oe,bP as se,W as z,a as ae,j as ie,k as d,bQ as le,aL as E,a3 as ce,bF as O,an as ue,bE as ge,S as m,I as U,bR as G,aW as de,a8 as pe,B as I,ar as he,bv as M,n as f,a$ as me}from"./index.6a6408c4.js";import{r as fe,b as we,s as be}from"./index.74fe453f.js";import{s as Se,g as $e,a as _e}from"./webauthn-json.browser-ponyfill.1c672167.js";const ke="https://github.com/alist-org/alist";function Ie(c){return ee(`${c}-${ke}`)}const Ce=()=>{const c=y("sso_login_enabled"),v=C("sso_login_platform"),n=y("sso_compatibility_mode"),{searchParams:u,to:b}=N(),o=u.token;o!=null&&o!=""&&(l(o),b(decodeURIComponent(u.redirect||p||"/"),!0));function h(s){const r=s.data;r.token&&(l(r.token),b(decodeURIComponent(u.redirect||p||"/"),!0))}if(window.addEventListener("message",h),te(()=>{window.removeEventListener("message",h)}),c){const s=()=>{const g=w.getUri()+"/auth/sso?method=sso_get_token";if(n){window.location.href=g;return}window.open(g,"authPopup","width=500,height=600")};let r;switch(v){case"Github":r=se;break;case"Microsoft":r=fe;break;case"Google":r=oe;break;case"Dingtalk":r=re;break;default:r=ne}return e(j,{cursor:"pointer",boxSize:"$8",as:r,p:"$0_5",onclick:s})}},Re=()=>{const c=C("logo").split(`
`),v=z(c[0],c.pop()),n=ae(),u=ie(()=>`${C("site_title")}`);we(u);const b=z("white","$neutral1"),[o,h]=d(localStorage.getItem("username")||""),[s,r]=d(localStorage.getItem("password")||""),[g,P]=d(""),[S,A]=d(!1),[$,B]=le("remember-pwd","false"),[x,T]=d(!1),[D,H]=E(async()=>x()?w.post("/auth/login/ldap",{username:o(),password:s(),otp_code:g()}):w.post("/auth/login/hash",{username:o(),password:Ie(s()),otp_code:g()})),[,W]=E((t,a,i)=>w.post("/authn/webauthn_finish_login?username="+i,JSON.stringify(a),{headers:{session:t}})),[,J]=E(t=>w.get("/authn/webauthn_begin_login?username="+t)),{searchParams:_,to:k}=N(),K=y("webauthn_login_enabled"),V=async()=>{A(!S())},R=async()=>{if(S()){if(!Se()){f.error(n("users.webauthn_not_supported"));return}l(),$()==="true"?localStorage.setItem("username",o()):localStorage.removeItem("username");const t=await J(o());me(t,async a=>{try{const i=$e(a.options),X=await _e(i),Y=await W(a.session,X,o());M(Y,Z=>{f.success(n("login.success")),l(Z.token),k(decodeURIComponent(_.redirect||p||"/"),!0)})}catch(i){i instanceof Error&&f.error(i.message)}})}else{$()==="true"?(localStorage.setItem("username",o()),localStorage.setItem("password",s())):(localStorage.removeItem("username"),localStorage.removeItem("password"));const t=await H();M(t,a=>{f.success(n("login.success")),l(a.token),k(decodeURIComponent(_.redirect||p||"/"),!0)},(a,i)=>{!L()&&i===402?q(!0):f.error(a)})}},[L,q]=d(!1),F=y("ldap_login_enabled"),Q=C("ldap_login_tips");return F&&T(!0),e(he,{zIndex:"1",w:"$full",h:"100vh",get children(){return e(ce,{get bgColor(){return b()},rounded:"$xl",p:"24px",w:{"@initial":"90%","@sm":"364px"},spacing:"$4",get children(){return[e(O,{alignItems:"center",justifyContent:"space-around",get children(){return[e(ue,{mr:"$2",boxSize:"$12",get src(){return v()}}),e(ge,{color:"$info9",fontSize:"$2xl",get children(){return u()}})]}}),e(m,{get when(){return!L()},get fallback(){return e(U,{id:"totp",name:"otp",get placeholder(){return n("login.otp-tips")},get value(){return g()},onInput:t=>P(t.currentTarget.value),onKeyDown:t=>{t.key==="Enter"&&R()}})},get children(){return[e(U,{name:"username",get placeholder(){return n("login.username-tips")},get value(){return o()},onInput:t=>h(t.currentTarget.value)}),e(m,{get when(){return!S()},get children(){return e(U,{name:"password",get placeholder(){return n("login.password-tips")},type:"password",get value(){return s()},onInput:t=>r(t.currentTarget.value),onKeyDown:t=>{t.key==="Enter"&&R()}})}}),e(O,{px:"$1",w:"$full",fontSize:"$sm",color:"$neutral10",justifyContent:"space-between",alignItems:"center",get children(){return[e(G,{get checked(){return $()==="true"},onChange:()=>B($()==="true"?"false":"true"),get children(){return n("login.remember")}}),e(de,{get children(){return n("\u6E38\u5BA2\u767B\u5F55\u4E0D\u9700\u8981\u5BC6\u7801\u54E6")}})]}})]}}),e(pe,{w:"$full",spacing:"$2",get children(){return[e(m,{get when(){return!S()},get children(){return[e(I,{w:"$full",colorScheme:"danger",onClick:()=>{l(),k(decodeURIComponent(_.redirect||p||"/"),!0)},get children(){return n("login.use_guest")}}),e(I,{colorScheme:"warning",w:"$full",onClick:()=>{L()?P(""):(h(""),r(""))},get children(){return n("login.clear")}})]}}),e(I,{colorScheme:"success",w:"$full",get loading(){return D()},onClick:R,get children(){return n("login.login")}})]}}),e(m,{when:F,get children(){return e(G,{w:"$full",get checked(){return x()===!0},onChange:()=>T(!x()),children:Q})}}),e(I,{w:"$full",colorScheme:"accent",onClick:()=>{l(),k(decodeURIComponent(_.redirect||p||"/"),!0)},get children(){return n("login.use_guest")}}),e(O,{mt:"$2",justifyContent:"space-evenly",alignItems:"center",color:"$neutral10",w:"$full",get children(){return[e(Ce,{}),e(m,{when:K,get children(){return e(j,{cursor:"pointer",boxSize:"$8",as:be,p:"$0_5",onclick:V})}})]}})]}})}})};export{Re as default};
